{"ast":null,"code":"import _slicedToArray from\"/home/mandeep/Downloads/Song-sorch work/site/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _classCallCheck from\"/home/mandeep/Downloads/Song-sorch work/site/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/mandeep/Downloads/Song-sorch work/site/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/home/mandeep/Downloads/Song-sorch work/site/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/mandeep/Downloads/Song-sorch work/site/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{useEffect,useState,useRef}from\"react\";import{Link}from\"react-router-dom\";import{Waypoint}from\"react-waypoint\";import{Helmet}from\"react-helmet\";import{Loading,SetHTMLHeaders,isServer,YouTubeSnippet,SpotifySnippet,IntersectionLazy,// loadCarbonScript,\nloadAdsenseScript,loadAmplifiedScript,RenderParagraphs,ServerError,AmazonRelatedProducts}from\"./Common\";import{cachedFetch}from\"./Cache\";import{SongComments}from\"./Comments\";import\"./Song.css\";import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var PUBLIC_URL=process.env.PUBLIC_URL||\"\";var placeholderImage=PUBLIC_URL+\"/static/placeholder.png\";var skullImage=PUBLIC_URL+\"/static/skull.png\";var NO_ADS=process.env.REACT_APP_NO_ADS===\"true\";var AdTag=function AdTag(props){useEffect(function(){if(window.cf_async===undefined){window.cf_async=false;}document.getElementById(\"inject_ad\");var unique_part=Math.floor(Math.random()*999999999);var opts={artist:props.Artistname,song:props.Songname,adunit_id:100004858,div_id:\"cf_async_\"+unique_part};var cf_div=document.createElement(\"div\");cf_div.setAttribute(\"id\",opts.div_id);document.getElementById(\"inject_ad\").parentNode.setAttribute(\"id\",\"ad_\"+unique_part);document.getElementById(\"ad_\"+unique_part).appendChild(cf_div);var c=function c(){cf.showAsyncAd(opts);};if(typeof window.cf!==\"undefined\")c();else{cf_async=!0;var r=document.createElement(\"script\"),s=document.getElementsByTagName(\"script\")[0];r.async=!0;r.src=\"//srv.tunefindforfans.com/fruits/apricots.js\";r.readyState?r.onreadystatechange=function(){if(\"loaded\"==r.readyState||\"complete\"==r.readyState)r.onreadystatechange=null,c();}:r.onload=c;s.parentNode.insertBefore(r,s);}},[]);return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(\"div\",{id:\"inject_ad\"})});};var Songchal=function Songchal(props){useEffect(function(){if(window.ddcf_async===undefined){window.ddcf_async=false;}document.getElementById(\"inject_cf_ad\");var unique_part_add=Math.floor(Math.random()*999999999);var arr={cf_page_artist:props.Artistname,cf_page_song:props.Songname,cf_adunit_id:100005466,cf_flex:true,div_id:\"cf_async_add_\"+unique_part_add};var cf_add=document.createElement(\"div\");cf_add.setAttribute(\"id\",arr.div_id);document.getElementById(\"inject_cf_ad\").parentNode.setAttribute(\"id\",\"cf_ad_\"+unique_part_add);document.getElementById(\"cf_ad_\"+unique_part_add).appendChild(cf_add);var c=function c(){cf.showAsyncAd(arr);};if(typeof window.cf!==\"undefined\")c();else{cf_async=!0;var r=document.createElement(\"script\"),s=document.getElementsByTagName(\"script\")[0];r.async=!0;r.src=\"//srv.tunefindforfans.com/fruits/apricots.js\";r.readyState?r.onreadystatechange=function(){if(\"loaded\"==r.readyState||\"complete\"==r.readyState)r.onreadystatechange=null,c();}:r.onload=c;s.parentNode.insertBefore(r,s);}},[]);return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(\"div\",{id:\"inject_cf_ad\"})});};var Song=/*#__PURE__*/function(_React$Component){_inherits(Song,_React$Component);var _super=_createSuper(Song);function Song(){var _this;_classCallCheck(this,Song);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={song:_this.props.song||null,loading:false,notFound:_this.props.songNotFound||false,serverError:null};return _this;}_createClass(Song,[{key:\"componentDidMount\",value:function componentDidMount(){var match=this.props.match;var id=parseInt(match.params.id,10);if(!this.state.song||this.state.song.id!==id){if(!this.props.songNotFound){this.loadSong(id);}}}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){this.dismounted=true;}},{key:\"componentDidUpdate\",value:function componentDidUpdate(prevProps){var _this2=this;if(this.props.match.params.id!==prevProps.match.params.id){this.setState({song:null,loading:false,notFound:false,serverError:null},function(){try{localStorage.removeItem(\"searched\");}catch(ex){console.warn(\"'localStorage.removeItem(\\\"searched\\\")' didn't work\");}_this2.loadSong(_this2.props.match.params.id);});}}},{key:\"loadSong\",value:function loadSong(id){var _this3=this;SetHTMLHeaders({title:\"Loading... - Song Search\"});if(!isServer){this.showLoadingSoon=window.setTimeout(function(){if(!_this3.dismounted){if(!_this3.state.serverError&&!_this3.state.notFound&&!_this3.state.song&&!_this3.state.loading){_this3.setState({loading:true});}}},500);}var url=\"/api/song/\".concat(id);var searched=null;try{searched=localStorage.getItem(\"searched\");}catch(ex){console.warn(\"'localStorage.getItem(\\\"searched\\\")' didn't work\");}if(searched){if(searched.includes(\",\")){// It *used* to be that what was stored in localStorage.searched was just the\n// search ID. Then in April 2019 this changed to become `ID,timestamp`.\n// E.g. '92613,1556152340091'. So, we need to deal with handling both\n// the new and the old.\nvar timestamp=parseInt(searched.split(\",\")[1],10);var age=(new Date().getTime()-timestamp)/1000;if(age>3600){searched=null;}else{searched=searched.split(\",\")[0];}}if(searched){url+=\"?searched=\".concat(encodeURIComponent(searched));}}return cachedFetch(url).then(function(r){if(!isServer&&_this3.showLoadingSoon){window.clearTimeout(_this3.showLoadingSoon);}if(r.status===400){return r.json().then(function(result){_this3.setState({loading:false});if(result.error&&result.error===\"redirected\"){if(isServer){_this3.setState({notFound:true});}else{document.location.href=result.new_url;}}else{// Some other error\n_this3.setState({serverError:true});}});}else if(r.status===404){_this3.setState({loading:false,notFound:true});SetHTMLHeaders({title:\"Not Found\"});}else if(r.status===500){_this3.setState({loading:false,serverError:true});SetHTMLHeaders({title:\"Song loading error :(\"});}else{return r.json().then(function(result){if(result&&!result.error){_this3.renderResult(result);}else if(result&&result.error){console.log(\"ERROR:\",result.error);}// if (searched) {\n//   localStorage.removeItem(\"searched\");\n// }\nreturn result;});}});}},{key:\"renderResult\",value:function renderResult(result){// Make sure this matches server/render.js\nvar title=\"\".concat(result.song.name,\" lyrics by \").concat(result.song.artist.name);if(!isServer){SetHTMLHeaders({title:title,image:result.song.image});}this.setState({loading:false,song:result.song});}},{key:\"render\",value:function render(){var _this$state=this.state,loading=_this$state.loading,song=_this$state.song,serverError=_this$state.serverError,notFound=_this$state.notFound;return/*#__PURE__*/_jsxs(\"div\",{children:[loading&&/*#__PURE__*/_jsx(Loading,{text:\"Loading...\"}),song&&/*#__PURE__*/_jsx(Result,{song:song}),serverError&&!song&&/*#__PURE__*/_jsx(ServerError,{}),notFound&&/*#__PURE__*/_jsx(NotFound,{})]});}}]);return Song;}(React.Component);function Result(_ref){var song=_ref.song;// useEffect(() => {\n//   // loadCarbonScript();\n// }, []);\nvar searchedId;if(!isServer){var searched=null;try{searched=localStorage.getItem(\"searched\");}catch(ex){console.warn(\"'localStorage.getItem(\\\"searched\\\")' didn't work\");}if(searched){if(searched.includes(\",\")){// The new way\nsearchedId=parseInt(searched.split(\",\")[0],10);}else{// The old way!\nsearchedId=parseInt(searched,10);}}}var comments=null;var commentsCount=null;if(song.comments){comments=song.comments.comments;commentsCount=song.comments.comments_count;}return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"header-add\",children:/*#__PURE__*/_jsx(Songchal,{Songname:song.name,Artistname:song.artist.name})}),/*#__PURE__*/_jsxs(\"div\",{className:\"result song oka\",children:[/*#__PURE__*/_jsx(RenderSongHead,{song:song}),/*#__PURE__*/_jsx(RenderParagraphs,{song:song.id,text:song.text_html}),!NO_ADS&&/*#__PURE__*/_jsx(AmplifiedSnippet,{song:song}),/*#__PURE__*/_jsx(SongComments,{comments:comments,commentsCount:commentsCount,song:song,searchedId:searchedId}),/*#__PURE__*/_jsx(ShareSong,{song:song}),/*#__PURE__*/_jsx(AmazonRelatedProducts,{song:song}),!isServer?/*#__PURE__*/_jsx(IntersectionLazy,{render:function render(){return/*#__PURE__*/_jsx(SpotifySnippet,{song:song});}}):null,!isServer?/*#__PURE__*/_jsx(IntersectionLazy,{render:function render(){return/*#__PURE__*/_jsx(YouTubeSnippet,{song:song});}}):null,!isServer?/*#__PURE__*/_jsx(ShowRelated,{song:song}):null]})]});}function AmplifiedSnippet(_ref2){var song=_ref2.song;useEffect(function(){loadAmplifiedScript({song:song.name,artist:song.artist.name});},[song]);return/*#__PURE__*/_jsx(\"div\",{id:\"amplifiedouter\",children:/*#__PURE__*/_jsx(\"div\",{id:\"amplified_100003500\"})});}function ShareSong(_ref3){var song=_ref3.song;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),showShare=_useState2[0],setShowShare=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),shared=_useState4[0],setShared=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),shareError=_useState6[0],setShareError=_useState6[1];useEffect(function(){if(navigator.share){setShowShare(true);}},[]);if(!showShare)return null;return/*#__PURE__*/_jsxs(\"div\",{style:{margin:\"30px 0\",textAlign:\"center\"},children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-primary\",onClick:function onClick(){var shareData={title:song.name,text:\"I found '\".concat(song.name,\"' on Song Search!\"),url:window.location.href};try{navigator.share(shareData).then(function(){setShared(true);setShareError(null);}).catch(function(e){setShareError(e);}).finally(function(){fetch(\"/api/song/\".concat(song.id,\"/shared/\"),{method:\"POST\"});});}catch(err){setShareError(err);}},children:shared?\"Thanks!\":\"Share this song\"}),shareError&&/*#__PURE__*/_jsx(\"p\",{children:\"Sharing failed or was canceled. Oh well.\"})]});}// XXX Check if this React.memo works\nvar RenderSongHead=/*#__PURE__*/React.memo(function(_ref4){var song=_ref4.song;var image=null;if(song.image){image=/*#__PURE__*/_jsx(\"img\",{src:song.image.url,alt:song.image.name,className:\"song-picture\"});}else{image=/*#__PURE__*/_jsx(\"img\",{src:placeholderImage,alt:song.artist.name,width:150,height:150});}var albums=null;if(song.albums.length){var albumNames=song.albums.map(function(a){if(a.year){return\"\".concat(a.name,\" (\").concat(a.year,\")\");}else{return a.name;}}).join(\", \");albums=/*#__PURE__*/_jsxs(\"h3\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"by\",children:\"on\"}),\" \",albumNames]});}return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center last\",children:[image,/*#__PURE__*/_jsx(\"h2\",{className:\"\",children:song.name}),/*#__PURE__*/_jsxs(\"h3\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"by\",children:\"by\"}),\" \",song.artist.name]}),albums,/*#__PURE__*/_jsx(AdTag,{Songname:song.name,Artistname:song.artist.name})]})});});var ShowRelated=/*#__PURE__*/React.memo(function(_ref5){var song=_ref5.song;var _useState7=useState(null),_useState8=_slicedToArray(_useState7,2),related=_useState8[0],setRelated=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),loading=_useState10[0],setLoading=_useState10[1];var mounted=React.useRef(false);useEffect(function(){if(loading&&related){setLoading(false);}},[related,loading]);function loadRelated(){var url=\"/api/song/\".concat(song.id,\"/related\");return cachedFetch(url).then(function(r){if(r.ok){r.json().then(function(result){if(result&&result.categories){setRelated(result.categories);}});}});}var _started=useRef();function loadRelatedDebounced(){if(!_started.current){_started.current=new Date().getTime();loadRelated();}}function onEnter(){if(!related&&!loading){loadRelatedDebounced();}}useEffect(function(){mounted.current=true;return function(){mounted.current=false;};},[]);if(related){if(!related.length){return null;}return/*#__PURE__*/_jsx(\"div\",{className:\"related\",children:related.map(function(category){return/*#__PURE__*/_jsx(ShowRelatedGroup,{label:category.label,songs:category.results},category.label);})});}else if(loading){return null;}return/*#__PURE__*/_jsx(Waypoint,{onEnter:onEnter});});function ShowRelatedGroup(_ref6){var label=_ref6.label,songs=_ref6.songs;return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h4\",{children:label}),/*#__PURE__*/_jsx(\"ul\",{children:songs.map(function(song){return/*#__PURE__*/_jsx(\"li\",{children:/*#__PURE__*/_jsxs(Link,{to:song._url,children:[/*#__PURE__*/_jsx(\"b\",{children:song.name}),\" \",/*#__PURE__*/_jsx(\"span\",{className:\"by\",children:\"by\"}),\" \",song.artist.name]})},song.id);})})]});}function NotFound(){return/*#__PURE__*/_jsxs(\"div\",{className:\"not-found\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Song Not Found\"}),/*#__PURE__*/_jsx(\"p\",{children:/*#__PURE__*/_jsx(\"img\",{alt:\"Skull\",src:skullImage})}),/*#__PURE__*/_jsx(\"p\",{children:/*#__PURE__*/_jsx(Link,{to:\"/\",children:\"Try another search\"})})]});}export default Song;","map":{"version":3,"sources":["/home/mandeep/Downloads/Song-sorch work/site/src/Song.js"],"names":["React","useEffect","useState","useRef","Link","Waypoint","Helmet","Loading","SetHTMLHeaders","isServer","YouTubeSnippet","SpotifySnippet","IntersectionLazy","loadAdsenseScript","loadAmplifiedScript","RenderParagraphs","ServerError","AmazonRelatedProducts","cachedFetch","SongComments","PUBLIC_URL","process","env","placeholderImage","skullImage","NO_ADS","REACT_APP_NO_ADS","AdTag","props","window","cf_async","undefined","document","getElementById","unique_part","Math","floor","random","opts","artist","Artistname","song","Songname","adunit_id","div_id","cf_div","createElement","setAttribute","parentNode","appendChild","c","cf","showAsyncAd","r","s","getElementsByTagName","async","src","readyState","onreadystatechange","onload","insertBefore","Songchal","ddcf_async","unique_part_add","arr","cf_page_artist","cf_page_song","cf_adunit_id","cf_flex","cf_add","Song","state","loading","notFound","songNotFound","serverError","match","id","parseInt","params","loadSong","dismounted","prevProps","setState","localStorage","removeItem","ex","console","warn","title","showLoadingSoon","setTimeout","url","searched","getItem","includes","timestamp","split","age","Date","getTime","encodeURIComponent","then","clearTimeout","status","json","result","error","location","href","new_url","renderResult","log","name","image","Component","Result","searchedId","comments","commentsCount","comments_count","text_html","AmplifiedSnippet","ShareSong","showShare","setShowShare","shared","setShared","shareError","setShareError","navigator","share","margin","textAlign","shareData","text","catch","e","finally","fetch","method","err","RenderSongHead","memo","albums","length","albumNames","map","a","year","join","ShowRelated","related","setRelated","setLoading","mounted","loadRelated","ok","categories","_started","loadRelatedDebounced","current","onEnter","category","label","results","ShowRelatedGroup","songs","_url","NotFound"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, useRef } from \"react\";\nimport { Link } from \"react-router-dom\";\nimport { Waypoint } from \"react-waypoint\";\nimport { Helmet } from \"react-helmet\";\nimport {\n  Loading,\n  SetHTMLHeaders,\n  isServer,\n  YouTubeSnippet,\n  SpotifySnippet,\n  IntersectionLazy,\n  // loadCarbonScript,\n  loadAdsenseScript,\n  loadAmplifiedScript,\n  RenderParagraphs,\n  ServerError,\n  AmazonRelatedProducts,\n} from \"./Common\";\nimport { cachedFetch } from \"./Cache\";\nimport { SongComments } from \"./Comments\";\n\nimport \"./Song.css\";\n\nconst PUBLIC_URL = process.env.PUBLIC_URL || \"\";\nconst placeholderImage = PUBLIC_URL + \"/static/placeholder.png\";\nconst skullImage = PUBLIC_URL + \"/static/skull.png\";\n\nconst NO_ADS = process.env.REACT_APP_NO_ADS === \"true\";\n\nconst AdTag = (props) => {\n  useEffect(() => {\n    if (window.cf_async === undefined) {\n      window.cf_async = false;\n    }\n    document.getElementById(\"inject_ad\");\n    let unique_part = Math.floor(Math.random() * 999999999);\n    let opts = {\n      artist: props.Artistname,\n      song: props.Songname,\n      adunit_id: 100004858,\n      div_id: \"cf_async_\" + unique_part,\n    };\n    let cf_div = document.createElement(\"div\");\n    cf_div.setAttribute(\"id\", opts.div_id);\n    document\n      .getElementById(\"inject_ad\")\n      .parentNode.setAttribute(\"id\", \"ad_\" + unique_part);\n    document.getElementById(\"ad_\" + unique_part).appendChild(cf_div);\n    let c = function () {\n      cf.showAsyncAd(opts);\n    };\n    if (typeof window.cf !== \"undefined\") c();\n    else {\n      cf_async = !0;\n      let r = document.createElement(\"script\"),\n        s = document.getElementsByTagName(\"script\")[0];\n      r.async = !0;\n      r.src = \"//srv.tunefindforfans.com/fruits/apricots.js\";\n      r.readyState\n        ? (r.onreadystatechange = function () {\n            if (\"loaded\" == r.readyState || \"complete\" == r.readyState)\n              (r.onreadystatechange = null), c();\n          })\n        : (r.onload = c);\n      s.parentNode.insertBefore(r, s);\n    }\n  }, []);\n\n  return (\n    <>\n      <div id=\"inject_ad\"></div>\n    </>\n  );\n};\n\nconst Songchal = (props) => {\n  useEffect(() => {\n    if (window.ddcf_async === undefined) {\n      window.ddcf_async = false;\n    }\n    document.getElementById(\"inject_cf_ad\");\n    let unique_part_add = Math.floor(Math.random() * 999999999);\n    let arr = {\n      cf_page_artist: props.Artistname,\n      cf_page_song: props.Songname,\n      cf_adunit_id: 100005466,\n      cf_flex: true,\n      div_id: \"cf_async_add_\" + unique_part_add,\n    };\n    let cf_add = document.createElement(\"div\");\n    cf_add.setAttribute(\"id\", arr.div_id);\n    document\n      .getElementById(\"inject_cf_ad\")\n      .parentNode.setAttribute(\"id\", \"cf_ad_\" + unique_part_add);\n    document.getElementById(\"cf_ad_\" + unique_part_add).appendChild(cf_add);\n    let c = function () {\n      cf.showAsyncAd(arr);\n    };\n    if (typeof window.cf !== \"undefined\") c();\n    else {\n      cf_async = !0;\n      let r = document.createElement(\"script\"),\n        s = document.getElementsByTagName(\"script\")[0];\n      r.async = !0;\n      r.src = \"//srv.tunefindforfans.com/fruits/apricots.js\";\n      r.readyState\n        ? (r.onreadystatechange = function () {\n            if (\"loaded\" == r.readyState || \"complete\" == r.readyState)\n              (r.onreadystatechange = null), c();\n          })\n        : (r.onload = c);\n      s.parentNode.insertBefore(r, s);\n    }\n  }, []);\n\n  return (\n    <>\n      <div id=\"inject_cf_ad\"></div>\n    </>\n  );\n};\n\nclass Song extends React.Component {\n  state = {\n    song: this.props.song || null,\n    loading: false,\n    notFound: this.props.songNotFound || false,\n    serverError: null,\n  };\n\n  componentDidMount() {\n    const { match } = this.props;\n    const id = parseInt(match.params.id, 10);\n    if (!this.state.song || this.state.song.id !== id) {\n      if (!this.props.songNotFound) {\n        this.loadSong(id);\n      }\n    }\n  }\n\n  componentWillUnmount() {\n    this.dismounted = true;\n  }\n\n  componentDidUpdate(prevProps) {\n    if (this.props.match.params.id !== prevProps.match.params.id) {\n      this.setState(\n        {\n          song: null,\n          loading: false,\n          notFound: false,\n          serverError: null,\n        },\n        () => {\n          try {\n            localStorage.removeItem(\"searched\");\n          } catch (ex) {\n            console.warn(\"'localStorage.removeItem(\\\"searched\\\")' didn't work\");\n          }\n\n          this.loadSong(this.props.match.params.id);\n        }\n      );\n    }\n  }\n\n  loadSong(id) {\n    SetHTMLHeaders({\n      title: \"Loading... - Song Search\",\n    });\n    if (!isServer) {\n      this.showLoadingSoon = window.setTimeout(() => {\n        if (!this.dismounted) {\n          if (\n            !this.state.serverError &&\n            !this.state.notFound &&\n            !this.state.song &&\n            !this.state.loading\n          ) {\n            this.setState({ loading: true });\n          }\n        }\n      }, 500);\n    }\n\n    let url = `/api/song/${id}`;\n    let searched = null;\n    try {\n      searched = localStorage.getItem(\"searched\");\n    } catch (ex) {\n      console.warn(\"'localStorage.getItem(\\\"searched\\\")' didn't work\");\n    }\n    if (searched) {\n      if (searched.includes(\",\")) {\n        // It *used* to be that what was stored in localStorage.searched was just the\n        // search ID. Then in April 2019 this changed to become `ID,timestamp`.\n        // E.g. '92613,1556152340091'. So, we need to deal with handling both\n        // the new and the old.\n        const timestamp = parseInt(searched.split(\",\")[1], 10);\n        const age = (new Date().getTime() - timestamp) / 1000;\n        if (age > 3600) {\n          searched = null;\n        } else {\n          searched = searched.split(\",\")[0];\n        }\n      }\n      if (searched) {\n        url += `?searched=${encodeURIComponent(searched)}`;\n      }\n    }\n\n    return cachedFetch(url).then((r) => {\n      if (!isServer && this.showLoadingSoon) {\n        window.clearTimeout(this.showLoadingSoon);\n      }\n      if (r.status === 400) {\n        return r.json().then((result) => {\n          this.setState({ loading: false });\n          if (result.error && result.error === \"redirected\") {\n            if (isServer) {\n              this.setState({ notFound: true });\n            } else {\n              document.location.href = result.new_url;\n            }\n          } else {\n            // Some other error\n            this.setState({ serverError: true });\n          }\n        });\n      } else if (r.status === 404) {\n        this.setState({ loading: false, notFound: true });\n        SetHTMLHeaders({ title: \"Not Found\" });\n      } else if (r.status === 500) {\n        this.setState({ loading: false, serverError: true });\n        SetHTMLHeaders({ title: \"Song loading error :(\" });\n      } else {\n        return r.json().then((result) => {\n          if (result && !result.error) {\n            this.renderResult(result);\n          } else if (result && result.error) {\n            console.log(\"ERROR:\", result.error);\n          }\n          // if (searched) {\n          //   localStorage.removeItem(\"searched\");\n          // }\n          return result;\n        });\n      }\n    });\n  }\n\n  renderResult(result) {\n    // Make sure this matches server/render.js\n    let title = `${result.song.name} lyrics by ${result.song.artist.name}`;\n    if (!isServer) {\n      SetHTMLHeaders({\n        title: title,\n        image: result.song.image,\n      });\n    }\n    this.setState({\n      loading: false,\n      song: result.song,\n    });\n  }\n\n  render() {\n    const { loading, song, serverError, notFound } = this.state;\n\n    return (\n      <div>\n        {loading && <Loading text=\"Loading...\" />}\n        {song && <Result song={song} />}\n\n        {serverError && !song && <ServerError />}\n        {notFound && <NotFound />}\n      </div>\n    );\n  }\n}\n\nfunction Result({ song }) {\n  // useEffect(() => {\n  //   // loadCarbonScript();\n  // }, []);\n\n  let searchedId;\n\n  if (!isServer) {\n    let searched = null;\n    try {\n      searched = localStorage.getItem(\"searched\");\n    } catch (ex) {\n      console.warn(\"'localStorage.getItem(\\\"searched\\\")' didn't work\");\n    }\n\n    if (searched) {\n      if (searched.includes(\",\")) {\n        // The new way\n        searchedId = parseInt(searched.split(\",\")[0], 10);\n      } else {\n        // The old way!\n        searchedId = parseInt(searched, 10);\n      }\n    }\n  }\n\n  let comments = null;\n  let commentsCount = null;\n  if (song.comments) {\n    comments = song.comments.comments;\n    commentsCount = song.comments.comments_count;\n  }\n\n  return (\n    <>\n      <div className=\"header-add\">\n        <Songchal Songname={song.name} Artistname={song.artist.name} />\n      </div>\n      <div className=\"result song oka\">\n        <RenderSongHead song={song} />\n        {/* {!NO_ADS ? <div id=\"carbonadsouter\" /> : <span id=\"_nocardonads\" />} */}\n        <RenderParagraphs song={song.id} text={song.text_html} />\n\n        {!NO_ADS && <AmplifiedSnippet song={song} />}\n\n        <SongComments\n          comments={comments}\n          commentsCount={commentsCount}\n          song={song}\n          searchedId={searchedId}\n        />\n        <ShareSong song={song} />\n        <AmazonRelatedProducts song={song} />\n        {!isServer ? (\n          <IntersectionLazy render={() => <SpotifySnippet song={song} />} />\n        ) : null}\n        {!isServer ? (\n          <IntersectionLazy render={() => <YouTubeSnippet song={song} />} />\n        ) : null}\n        {!isServer ? <ShowRelated song={song} /> : null}\n      </div>\n    </>\n  );\n}\n\nfunction AmplifiedSnippet({ song }) {\n  useEffect(() => {\n    loadAmplifiedScript({ song: song.name, artist: song.artist.name });\n  }, [song]);\n\n  return (\n    <div id=\"amplifiedouter\">\n      <div id=\"amplified_100003500\" />\n    </div>\n  );\n}\n\nfunction ShareSong({ song }) {\n  const [showShare, setShowShare] = useState(false);\n  const [shared, setShared] = useState(false);\n  const [shareError, setShareError] = useState(null);\n  useEffect(() => {\n    if (navigator.share) {\n      setShowShare(true);\n    }\n  }, []);\n  if (!showShare) return null;\n\n  return (\n    <div style={{ margin: \"30px 0\", textAlign: \"center\" }}>\n      <button\n        className=\"btn btn-primary\"\n        onClick={() => {\n          const shareData = {\n            title: song.name,\n            text: `I found '${song.name}' on Song Search!`,\n            url: window.location.href,\n          };\n          try {\n            navigator\n              .share(shareData)\n              .then(() => {\n                setShared(true);\n                setShareError(null);\n              })\n              .catch((e) => {\n                setShareError(e);\n              })\n              .finally(() => {\n                fetch(`/api/song/${song.id}/shared/`, {\n                  method: \"POST\",\n                });\n              });\n          } catch (err) {\n            setShareError(err);\n          }\n        }}\n      >\n        {shared ? \"Thanks!\" : \"Share this song\"}\n      </button>\n      {shareError && <p>Sharing failed or was canceled. Oh well.</p>}\n    </div>\n  );\n}\n\n// XXX Check if this React.memo works\nconst RenderSongHead = React.memo(({ song }) => {\n  let image = null;\n  if (song.image) {\n    image = (\n      <img\n        src={song.image.url}\n        alt={song.image.name}\n        className=\"song-picture\"\n      />\n    );\n  } else {\n    image = (\n      <img\n        src={placeholderImage}\n        alt={song.artist.name}\n        width={150}\n        height={150}\n      />\n    );\n  }\n  let albums = null;\n  if (song.albums.length) {\n    let albumNames = song.albums\n      .map((a) => {\n        if (a.year) {\n          return `${a.name} (${a.year})`;\n        } else {\n          return a.name;\n        }\n      })\n      .join(\", \");\n    albums = (\n      <h3>\n        <span className=\"by\">on</span> {albumNames}\n      </h3>\n    );\n  }\n  return (\n    <>\n      <div className=\"text-center last\">\n        {image}\n        <h2 className=\"\">{song.name}</h2>\n        <h3>\n          <span className=\"by\">by</span> {song.artist.name}\n        </h3>\n        {albums}\n        <AdTag Songname={song.name} Artistname={song.artist.name} />\n      </div>\n    </>\n  );\n});\n\nconst ShowRelated = React.memo(({ song }) => {\n  const [related, setRelated] = useState(null);\n  const [loading, setLoading] = useState(false);\n\n  const mounted = React.useRef(false);\n\n  useEffect(() => {\n    if (loading && related) {\n      setLoading(false);\n    }\n  }, [related, loading]);\n\n  function loadRelated() {\n    const url = `/api/song/${song.id}/related`;\n    return cachedFetch(url).then((r) => {\n      if (r.ok) {\n        r.json().then((result) => {\n          if (result && result.categories) {\n            setRelated(result.categories);\n          }\n        });\n      }\n    });\n  }\n\n  const _started = useRef();\n\n  function loadRelatedDebounced() {\n    if (!_started.current) {\n      _started.current = new Date().getTime();\n      loadRelated();\n    }\n  }\n\n  function onEnter() {\n    if (!related && !loading) {\n      loadRelatedDebounced();\n    }\n  }\n\n  useEffect(() => {\n    mounted.current = true;\n    return () => {\n      mounted.current = false;\n    };\n  }, []);\n\n  if (related) {\n    if (!related.length) {\n      return null;\n    }\n    return (\n      <div className=\"related\">\n        {related.map((category) => {\n          return (\n            <ShowRelatedGroup\n              key={category.label}\n              label={category.label}\n              songs={category.results}\n            />\n          );\n        })}\n      </div>\n    );\n  } else if (loading) {\n    return null;\n  }\n  return <Waypoint onEnter={onEnter} />;\n});\n\nfunction ShowRelatedGroup({ label, songs }) {\n  return (\n    <div>\n      <h4>{label}</h4>\n      <ul>\n        {songs.map((song) => {\n          return (\n            <li key={song.id}>\n              <Link to={song._url}>\n                <b>{song.name}</b> <span className=\"by\">by</span>{\" \"}\n                {song.artist.name}\n              </Link>\n            </li>\n          );\n        })}\n      </ul>\n    </div>\n  );\n}\n\nfunction NotFound() {\n  return (\n    <div className=\"not-found\">\n      <h3>Song Not Found</h3>\n      <p>\n        <img alt=\"Skull\" src={skullImage} />\n      </p>\n      <p>\n        <Link to=\"/\">Try another search</Link>\n      </p>\n    </div>\n  );\n}\n\nexport default Song;\n"]},"metadata":{},"sourceType":"module"}