{"ast":null,"code":"import _objectSpread from\"/home/mandeep/Downloads/Song-sorch work/site/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _classCallCheck from\"/home/mandeep/Downloads/Song-sorch work/site/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/mandeep/Downloads/Song-sorch work/site/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/home/mandeep/Downloads/Song-sorch work/site/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/mandeep/Downloads/Song-sorch work/site/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import _regeneratorRuntime from\"/home/mandeep/Downloads/Song-sorch work/site/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/mandeep/Downloads/Song-sorch work/site/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/mandeep/Downloads/Song-sorch work/site/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from\"react\";import{Link}from\"react-router-dom\";import TimeAgo from\"react-timeago\";import{Waypoint}from\"react-waypoint\";import useSWR from\"swr\";import{cachedFetch}from\"./Cache\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var PUBLIC_URL=process.env.PUBLIC_URL||\"\";// const itunesAppImage = PUBLIC_URL + \"/static/itunes-app-icon.png\";\nvar skullImage=PUBLIC_URL+\"/static/skull.png\";export var isServer=typeof document===\"undefined\";var defaultHTMLHeaders={title:\"Song Search - Find Songs by Lyrics\",image:isServer?null:document.querySelector('meta[itemprop=\"image\"]').content};export var SetHTMLHeaders=function SetHTMLHeaders(_ref){var title=_ref.title,_ref$image=_ref.image,image=_ref$image===void 0?null:_ref$image;if(isServer){console.warn(\"SetHTMLHeaders should not be called in server mode\");return;}/* Only set when it's different */if(title!==document.title){document.title=title;}var ogtitle=document.querySelector('meta[property=\"og:title\"]');if(ogtitle.content!==title){ogtitle.content=title;}var itemtitle=document.querySelector('meta[itemprop=\"name\"]');if(itemtitle!==title){itemtitle.content=title;}var img=document.querySelector('meta[itemprop=\"image\"]');if(img.content!==image){img.content=image;}};export var ResetHTMLHeaders=function ResetHTMLHeaders(){SetHTMLHeaders(defaultHTMLHeaders);};export var Loading=function Loading(_ref2){var text=_ref2.text;return/*#__PURE__*/_jsxs(\"div\",{className:\"loading\",title:text,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"cssload-wrapper\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"cssload-square\"}),/*#__PURE__*/_jsx(\"div\",{className:\"cssload-square\"}),/*#__PURE__*/_jsx(\"div\",{className:\"cssload-square\"}),/*#__PURE__*/_jsx(\"div\",{className:\"cssload-square\"}),/*#__PURE__*/_jsx(\"div\",{className:\"cssload-square\"})]}),/*#__PURE__*/_jsx(\"p\",{children:text})]});};export function FormattedNumber(_ref3){var value=_ref3.value;return value.toLocaleString();}export function AmazonRelatedProducts(_ref4){var song=_ref4.song;var _useState=useState(null),_useState2=_slicedToArray(_useState,2),result=_useState2[0],setResult=_useState2[1];var _useState3=useState(1),_useState4=_slicedToArray(_useState3,2),page=_useState4[0],setPage=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),loadingMore=_useState6[0],setLoadingMore=_useState6[1];useEffect(function(){if(page>1){setLoadingMore(true);}},[page]);useEffect(function(){var mounted=true;var url=\"/api/song/\".concat(song.id,\"/amazon?v=5\");if(page>1){url+=\"&page=\".concat(page);}fetch(url).then(function(r){if(!mounted)return;if(r.ok){r.json().then(function(result){setResult(result);setLoadingMore(false);});}});return function(){mounted=false;};},[song,page]);function loadMore(){setPage(page+1);}if(!result||!result.items.length){return null;}var items=result.items,total=result.total;return/*#__PURE__*/_jsxs(\"div\",{className:\"amazon-related-products\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"Relevant on Amazon.com\"}),items.map(function(item){return/*#__PURE__*/_jsx(AmazonRelatedItem,{item:item},item.asin||item.ASIN);}),/*#__PURE__*/_jsx(\"small\",{children:\"As an Amazon Associate I earn from qualifying purchases.\"}),total>items.length&&/*#__PURE__*/_jsx(\"p\",{style:{textAlign:\"right\"},children:/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-default btn-sm\",onClick:loadMore,disabled:loadingMore,children:loadingMore?\"Loading...\":\"Load more products...\"})})]});}function AmazonRelatedItem(_ref5){var item=_ref5.item;if(!item.detail_page_url){// Later in 2020, this can be replaced with just `return null`\nreturn old__AmazonRelatedItem({item:item});}var productTypeInfo=item.product_group;if(productTypeInfo&&item.binding&&productTypeInfo!==item.binding){productTypeInfo+=\", \".concat(item.binding);}return/*#__PURE__*/_jsxs(\"div\",{className:\"media amazon-item\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"media-left media-top\",children:/*#__PURE__*/_jsx(\"a\",{href:item.detail_page_url,target:\"_blank\",rel:\"noopener noreferrer\",children:/*#__PURE__*/_jsx(\"img\",{className:\"media-object\",loading:\"lazy\",src:item.image_small||item.image_medium,alt:\"Product\"})})}),/*#__PURE__*/_jsxs(\"div\",{className:\"media-body\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"media-heading\",children:/*#__PURE__*/_jsx(\"a\",{href:item.detail_page_url,target:\"_blank\",rel:\"noopener noreferrer\",children:item.title})}),item.contributor&&/*#__PURE__*/_jsxs(\"p\",{children:[\"By \",/*#__PURE__*/_jsx(\"b\",{children:item.contributor})]}),/*#__PURE__*/_jsxs(\"p\",{children:[item.price&&/*#__PURE__*/_jsx(\"b\",{className:\"price\",children:item.price}),productTypeInfo,/*#__PURE__*/_jsx(\"br\",{}),item.release_date&&/*#__PURE__*/_jsxs(\"span\",{children:[\"Release date: \",item.release_date]})]})]})]});}function old__AmazonRelatedItem(_ref6){var item=_ref6.item;var productTypeInfo=item.ItemAttributes.ProductGroup;if(productTypeInfo&&item.ItemAttributes.Binding&&productTypeInfo!==item.ItemAttributes.Binding){productTypeInfo+=\", \".concat(item.ItemAttributes.Binding);}return/*#__PURE__*/_jsxs(\"div\",{className:\"media amazon-item\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"media-left media-top\",children:/*#__PURE__*/_jsx(\"a\",{href:item.URL,target:\"_blank\",rel:\"noopener noreferrer\",children:/*#__PURE__*/_jsx(\"img\",{className:\"media-object\",src:item.SmallImage,alt:\"Product\"})})}),/*#__PURE__*/_jsxs(\"div\",{className:\"media-body\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"media-heading\",children:/*#__PURE__*/_jsx(\"a\",{href:item.URL,target:\"_blank\",rel:\"noopener noreferrer\",children:item.Title})}),item.Creator&&/*#__PURE__*/_jsxs(\"p\",{children:[\"By \",/*#__PURE__*/_jsx(\"b\",{children:item.Creator})]}),/*#__PURE__*/_jsxs(\"p\",{children:[item.ItemAttributes.ListPrice&&/*#__PURE__*/_jsx(\"b\",{className:\"price\",children:item.ItemAttributes.ListPrice.FormattedPrice}),productTypeInfo]})]})]});}// export function Affiliates({ song }) {\n//   console.log(\"IS THIS STILL USED?!??!?!?!?!\");\n//   // const [amazon, setAmazon] = React.useState(null);\n//   const [itunes, setItunes] = React.useState(null);\n//   useEffect(() => {\n//     let dismounted = false;\n//     const url = `/api/song/${song.id}/affiliate/itunes`;\n//     cachedFetch(url).then((response) => {\n//       if (response.ok) {\n//         if (dismounted) {\n//           return;\n//         }\n//         response.json().then((results) => {\n//           if (\n//             results.itunes &&\n//             results.itunes.matches &&\n//             results.itunes.matches.length\n//           ) {\n//             setItunes(results.itunes);\n//           }\n//         });\n//       } else {\n//         console.warn(response);\n//       }\n//     });\n//     return () => {\n//       dismounted = true;\n//     };\n//   }, [song]);\n//   if (isServer) {\n//     return null;\n//   }\n//   return (\n//     <>\n//       {/* XXX This causes a double-render even though 'song' hasn't changed!! */}\n//       <AmazonRelatedProducts song={song} />\n//       <ITunesBadge itunes={itunes} />\n//     </>\n//   );\n// }\n// const ITunesBadge = React.memo(({ itunes }) => {\n//   if (!itunes) {\n//     return null;\n//   }\n//   if (!itunes.matches.length) {\n//     return null;\n//   }\n//   const first = itunes.matches[0];\n//   const trackURL = `${first.trackViewUrl}&at=${itunes.token}`;\n//   const trackLink = (\n//     <p>\n//       <a href={trackURL}>\n//         <b>{first.trackName}</b>\n//         {\" by \"}\n//         <b>{first.artistName}</b>\n//         {first.trackPrice &&\n//           first.trackPrice > 0.0 &&\n//           ` ($${first.trackPrice})`}\n//       </a>\n//     </p>\n//   );\n//   const trackIcon = (\n//     <p style={{ float: \"left\", marginBottom: 15 }}>\n//       <a href={trackURL} className=\"app-icon\" title={first.trackName}>\n//         <img src={itunesAppImage} alt=\"iTunes\" />\n//       </a>\n//     </p>\n//   );\n//   let albumLink = null;\n//   if (first.collectionName) {\n//     const collectionURL = `${first.collectionViewUrl}&at=${itunes.token}`;\n//     albumLink = (\n//       <p>\n//         <a href={collectionURL}>\n//           On album <b>{first.collectionName}</b>\n//           {first.collectionPrice &&\n//             first.collectionPrice > 0 &&\n//             ` ($${first.collectionPrice})`}\n//         </a>\n//       </p>\n//     );\n//   }\n//   let preview = null;\n//   if (first.previewUrl) {\n//     preview = (\n//       <div style={{ clear: \"left\", textAlign: \"center\" }}>\n//         <b>iTunes</b> Preview\n//         <br />\n//         <audio controls preload=\"none\" src={first.previewUrl} />\n//       </div>\n//     );\n//   }\n//   return (\n//     <div style={{ marginTop: 30, marginBottom: 20 }}>\n//       <h4>On Apple iTunes</h4>\n//       {trackIcon}\n//       {trackLink}\n//       {albumLink}\n//       {preview}\n//     </div>\n//   );\n// });\nexport function SpotifySnippet(_ref7){var song=_ref7.song,_ref7$compact=_ref7.compact,compact=_ref7$compact===void 0?true:_ref7$compact;var _useSWR=useSWR(\"/api/song/\".concat(song.id,\"/spotify\"),/*#__PURE__*/function(){var _ref8=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(url){var r;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return fetch(url);case 2:r=_context.sent;if(r.ok){_context.next=6;break;}if(process.env.NODE_ENV===\"development\"){console.warn(\"\".concat(r.status,\" on \").concat(url));}throw new Error(\"\".concat(r.status,\" on \").concat(url));case 6:_context.next=8;return r.json();case 8:return _context.abrupt(\"return\",_context.sent);case 9:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref8.apply(this,arguments);};}(),{revalidateOnFocus:false}),data=_useSWR.data;if(!data){return null;}return/*#__PURE__*/_jsxs(\"div\",{className:\"spotify\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"On Spotify\\u2122\"}),/*#__PURE__*/_jsx(\"div\",{style:{textAlign:\"center\"},children:/*#__PURE__*/_jsx(\"iframe\",{src:data.embed_url,width:\"300\",height:compact?80:380,frameBorder:\"0\",allowtransparency:\"true\",allow:\"encrypted-media\"})})]});}export var YouTubeSnippet=/*#__PURE__*/function(_React$PureComponent){_inherits(YouTubeSnippet,_React$PureComponent);var _super=_createSuper(YouTubeSnippet);function YouTubeSnippet(){var _this;_classCallCheck(this,YouTubeSnippet);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={snippet:null,searched:false,clicked:false};_this.onClickThumbnail=function(event){event.preventDefault();_this.setState({clicked:true});};return _this;}_createClass(YouTubeSnippet,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;var id=this.props.song.id;var url=\"/api/song/\".concat(id,\"/youtube\");return cachedFetch(url).then(function(r){if(_this2.dismounted){return;}if(r.status!==200){console.warn(r.status,\"loading\",url);}else{r.json().then(function(response){if(response.snippet){_this2.setState({snippet:response.snippet,searched:true});}else{_this2.setState({searched:true});}});}});}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){this.dismounted=true;}},{key:\"render\",value:function render(){var _this$state=this.state,clicked=_this$state.clicked,snippet=_this$state.snippet;if(isServer||snippet===null){return null;}var media;var videoId=snippet.videoId;var href=\"https://www.youtube.com/watch?v=\".concat(videoId);if(clicked){// const src = `https://www.youtube-nocookie.com/embed/${videoId}?rel=0&amp;showinfo=0`\nvar src=\"https://www.youtube-nocookie.com/embed/\".concat(videoId,\"?rel=0\");var width=335;var height=178;// =335/(16/9)\nvar containerDiv=document.querySelector(\"div.result\");if(containerDiv&&containerDiv.offsetWidth>335){width=560;height=315;}media=/*#__PURE__*/_jsx(\"iframe\",{width:width,height:height,title:snippet.title||\"YouTube Snippet\",src:src,frameBorder:0,allow:\"autoplay; encrypted-media\",allowFullScreen:true});}else{var thumbnail=snippet.thumbnails.medium;var _containerDiv=document.querySelector(\"div.result\");if(_containerDiv&&_containerDiv.offsetWidth>335){thumbnail=snippet.thumbnails.high;}media=/*#__PURE__*/_jsx(\"a\",{href:href,onClick:this.onClickThumbnail,children:/*#__PURE__*/_jsx(\"img\",{src:thumbnail.url,width:thumbnail.width,height:thumbnail.height,title:\"Click to load video\",alt:\"Video thumbnail\",loading:\"lazy\"})});}return/*#__PURE__*/_jsxs(\"div\",{className:\"youtube\",children:[/*#__PURE__*/_jsxs(\"h4\",{children:[\"YouTube\\u2122\",\" \",!clicked?/*#__PURE__*/_jsx(\"small\",{onClick:this.onClickThumbnail,children:\"Click to load\"}):null]}),/*#__PURE__*/_jsxs(\"div\",{style:{textAlign:\"center\"},children:[media,/*#__PURE__*/_jsx(\"p\",{children:/*#__PURE__*/_jsx(\"small\",{children:/*#__PURE__*/_jsx(\"a\",{href:href,target:\"_blank\",rel:\"noopener noreferrer\",children:\"Watch on YouTube\\u2122\"})})})]})]});}}]);return YouTubeSnippet;}(React.PureComponent);export function IntersectionLazy(_ref9){var render=_ref9.render;var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),entered=_useState8[0],setEntered=_useState8[1];function onEnter(){setEntered(true);}if(entered){return render();// return <YouTubeSnippet song={song} />;\n}return/*#__PURE__*/_jsx(Waypoint,{onEnter:onEnter});}// export function YouTubeSnippetIntersectionLazy({ song }) {\n//   const [entered, setEntered] = useState(false);\n//   function onEnter() {\n//     setEntered(true);\n//   }\n//   if (entered) {\n//     return <YouTubeSnippet song={song} />;\n//   }\n//   return <Waypoint onEnter={onEnter} />;\n// }\n// export function YouTubeSnippetIntersectionLazy({ song }) {\n//   const [entered, setEntered] = useState(false);\n//   function onEnter() {\n//     setEntered(true);\n//   }\n//   if (entered) {\n//     return <YouTubeSnippet song={song} />;\n//   }\n//   return <Waypoint onEnter={onEnter} />;\n// }\nexport function loadCarbonScript(){var carbonParent=document.getElementById(\"carbonadsouter\");if(carbonParent){if(!carbonParent.querySelector(\"script\")){var script=document.createElement(\"script\");script.id=\"_carbonads_js\";script.src=\"https://cdn.carbonads.com/carbon.js?serve=CK7DCK7W&placement=songsearch\";script.async=true;carbonParent.appendChild(script);}}}export function loadAdsenseScript(){var carbonParent=document.getElementById(\"carbonadsouter\");if(carbonParent){if(!carbonParent.querySelector(\"script\")){var script=document.createElement(\"script\");script.id=\"_carbonads_js\";script.src=\"https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js\";script.async=true;script.setAttribute('data-ad-client','ca-pub-8561605615946624');carbonParent.appendChild(script);}}}export function loadAmplifiedScript(_ref10){var song=_ref10.song,artist=_ref10.artist;var parent=document.getElementById(\"amplifiedouter\");if(parent){if(!parent.querySelector(\"script\")){window.amplified=window.amplified||{init:[]};window.amplified.init.push(function(){amplified.setParams({artist:artist,song:song});amplified.pushAdUnit(100003500);amplified.run();});var script=document.createElement(\"script\");script.id=\"_amplified_js\";script.src=\"https://srv.clickfuse.com/ads/ads.js\";script.async=true;parent.appendChild(script);}}}export var RenderParagraphs=/*#__PURE__*/React.memo(function(_ref11){var text=_ref11.text;return/*#__PURE__*/_jsx(\"blockquote\",{dangerouslySetInnerHTML:{__html:text}});});export function CustomTimeAgo(props){return/*#__PURE__*/_jsx(TimeAgo// Since the smallest granularity is 1 min, no point making the\n// setInterval any smaller than this.\n,_objectSpread({minPeriod:60,formatter:function formatter(value,unit,suffix,epochSeconds,nextFormatter){if(unit===\"second\"){return\"seconds ago\";}return nextFormatter(value,unit,suffix,epochSeconds);}},props));}export function ServerError(){return/*#__PURE__*/_jsxs(\"div\",{className:\"not-found\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Server Error\"}),/*#__PURE__*/_jsx(\"p\",{children:/*#__PURE__*/_jsx(\"img\",{alt:\"Skull\",src:skullImage})}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Most likely a \",/*#__PURE__*/_jsx(\"b\",{children:\"temporary problem\"}),\" which will go away if you\",\" \",/*#__PURE__*/_jsx(\"b\",{children:\"reload this page soon\"}),\".\"]}),/*#__PURE__*/_jsx(\"p\",{children:/*#__PURE__*/_jsx(Link,{to:\"/\",children:\"Back to the home page\"})})]});}","map":{"version":3,"sources":["/home/mandeep/Downloads/Song-sorch work/site/src/Common.js"],"names":["React","useEffect","useState","Link","TimeAgo","Waypoint","useSWR","cachedFetch","PUBLIC_URL","process","env","skullImage","isServer","document","defaultHTMLHeaders","title","image","querySelector","content","SetHTMLHeaders","console","warn","ogtitle","itemtitle","img","ResetHTMLHeaders","Loading","text","FormattedNumber","value","toLocaleString","AmazonRelatedProducts","song","result","setResult","page","setPage","loadingMore","setLoadingMore","mounted","url","id","fetch","then","r","ok","json","loadMore","items","length","total","map","item","asin","ASIN","textAlign","AmazonRelatedItem","detail_page_url","old__AmazonRelatedItem","productTypeInfo","product_group","binding","image_small","image_medium","contributor","price","release_date","ItemAttributes","ProductGroup","Binding","URL","SmallImage","Title","Creator","ListPrice","FormattedPrice","SpotifySnippet","compact","NODE_ENV","status","Error","revalidateOnFocus","data","embed_url","YouTubeSnippet","state","snippet","searched","clicked","onClickThumbnail","event","preventDefault","setState","props","dismounted","response","media","videoId","href","src","width","height","containerDiv","offsetWidth","thumbnail","thumbnails","medium","high","PureComponent","IntersectionLazy","render","entered","setEntered","onEnter","loadCarbonScript","carbonParent","getElementById","script","createElement","async","appendChild","loadAdsenseScript","setAttribute","loadAmplifiedScript","artist","parent","window","amplified","init","push","setParams","pushAdUnit","run","RenderParagraphs","memo","__html","CustomTimeAgo","unit","suffix","epochSeconds","nextFormatter","ServerError"],"mappings":"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,YAAK,SAAS,CAAC,cAAf,CAA8B,GAAG,CAAElB,IAAI,CAACmB,UAAxC,CAAoD,GAAG,CAAC,SAAxD,EADF,EADF,EADF,cAME,aAAK,SAAS,CAAC,YAAf,wBACE,WAAI,SAAS,CAAC,eAAd,uBACE,UAAG,IAAI,CAAEnB,IAAI,CAACkB,GAAd,CAAmB,MAAM,CAAC,QAA1B,CAAmC,GAAG,CAAC,qBAAvC,UACGlB,IAAI,CAACoB,KADR,EADF,EADF,CAMGpB,IAAI,CAACqB,OAAL,eACC,wCACK,mBAAIrB,IAAI,CAACqB,OAAT,EADL,GAPJ,cAWE,qBACGrB,IAAI,CAACe,cAAL,CAAoBO,SAApB,eACC,UAAG,SAAS,CAAC,OAAb,UACGtB,IAAI,CAACe,cAAL,CAAoBO,SAApB,CAA8BC,cADjC,EAFJ,CAMGhB,eANH,GAXF,GANF,GADF,CA6BD,CAED;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA,MAAO,SAASiB,CAAAA,cAAT,OAAkD,IAAxB5C,CAAAA,IAAwB,OAAxBA,IAAwB,qBAAlB6C,OAAkB,CAAlBA,OAAkB,wBAAR,IAAQ,eACvD,YAAiBvE,MAAM,qBACR0B,IAAI,CAACS,EADG,uGAErB,iBAAOD,GAAP,8IACkBE,CAAAA,KAAK,CAACF,GAAD,CADv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","sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport { Link } from \"react-router-dom\";\nimport TimeAgo from \"react-timeago\";\nimport { Waypoint } from \"react-waypoint\";\nimport useSWR from \"swr\";\n\nimport { cachedFetch } from \"./Cache\";\n\nconst PUBLIC_URL = process.env.PUBLIC_URL || \"\";\n// const itunesAppImage = PUBLIC_URL + \"/static/itunes-app-icon.png\";\nconst skullImage = PUBLIC_URL + \"/static/skull.png\";\n\nexport const isServer = typeof document === \"undefined\";\n\nconst defaultHTMLHeaders = {\n  title: \"Song Search - Find Songs by Lyrics\",\n  image: isServer\n    ? null\n    : document.querySelector('meta[itemprop=\"image\"]').content\n};\n\nexport const SetHTMLHeaders = function ({ title, image = null }) {\n  if (isServer) {\n    console.warn(\"SetHTMLHeaders should not be called in server mode\");\n    return;\n  }\n  /* Only set when it's different */\n  if (title !== document.title) {\n    document.title = title;\n  }\n  let ogtitle = document.querySelector('meta[property=\"og:title\"]');\n  if (ogtitle.content !== title) {\n    ogtitle.content = title;\n  }\n\n  let itemtitle = document.querySelector('meta[itemprop=\"name\"]');\n  if (itemtitle !== title) {\n    itemtitle.content = title;\n  }\n  let img = document.querySelector('meta[itemprop=\"image\"]');\n  if (img.content !== image) {\n    img.content = image;\n  }\n};\n\nexport const ResetHTMLHeaders = function () {\n  SetHTMLHeaders(defaultHTMLHeaders);\n};\n\nexport const Loading = ({ text }) => {\n  return (\n    <div className=\"loading\" title={text}>\n      <div className=\"cssload-wrapper\">\n        <div className=\"cssload-square\" />\n        <div className=\"cssload-square\" />\n        <div className=\"cssload-square\" />\n        <div className=\"cssload-square\" />\n        <div className=\"cssload-square\" />\n      </div>\n      <p>{text}</p>\n    </div>\n  );\n};\n\nexport function FormattedNumber({ value }) {\n  return value.toLocaleString();\n}\n\nexport function AmazonRelatedProducts({ song }) {\n  const [result, setResult] = useState(null);\n  const [page, setPage] = useState(1);\n  const [loadingMore, setLoadingMore] = useState(false);\n\n  useEffect(() => {\n    if (page > 1) {\n      setLoadingMore(true);\n    }\n  }, [page]);\n\n  useEffect(() => {\n    let mounted = true;\n    let url = `/api/song/${song.id}/amazon?v=5`;\n    if (page > 1) {\n      url += `&page=${page}`;\n    }\n    fetch(url).then((r) => {\n      if (!mounted) return;\n      if (r.ok) {\n        r.json().then((result) => {\n          setResult(result);\n          setLoadingMore(false);\n        });\n      }\n    });\n    return () => {\n      mounted = false;\n    };\n  }, [song, page]);\n\n  function loadMore() {\n    setPage(page + 1);\n  }\n\n  if (!result || !result.items.length) {\n    return null;\n  }\n  const { items, total } = result;\n  return (\n    <div className=\"amazon-related-products\">\n      <h4>Relevant on Amazon.com</h4>\n      {items.map((item) => (\n        <AmazonRelatedItem key={item.asin || item.ASIN} item={item} />\n      ))}\n      <small>As an Amazon Associate I earn from qualifying purchases.</small>\n      {total > items.length && (\n        <p style={{ textAlign: \"right\" }}>\n          <button\n            className=\"btn btn-default btn-sm\"\n            onClick={loadMore}\n            disabled={loadingMore}\n          >\n            {loadingMore ? \"Loading...\" : \"Load more products...\"}\n          </button>\n        </p>\n      )}\n    </div>\n  );\n}\n\nfunction AmazonRelatedItem({ item }) {\n  if (!item.detail_page_url) {\n    // Later in 2020, this can be replaced with just `return null`\n    return old__AmazonRelatedItem({ item });\n  }\n\n  let productTypeInfo = item.product_group;\n  if (productTypeInfo && item.binding && productTypeInfo !== item.binding) {\n    productTypeInfo += `, ${item.binding}`;\n  }\n  return (\n    <div className=\"media amazon-item\">\n      <div className=\"media-left media-top\">\n        <a\n          href={item.detail_page_url}\n          target=\"_blank\"\n          rel=\"noopener noreferrer\"\n        >\n          <img\n            className=\"media-object\"\n            loading=\"lazy\"\n            src={item.image_small || item.image_medium}\n            alt=\"Product\"\n          />\n        </a>\n      </div>\n      <div className=\"media-body\">\n        <h4 className=\"media-heading\">\n          <a\n            href={item.detail_page_url}\n            target=\"_blank\"\n            rel=\"noopener noreferrer\"\n          >\n            {item.title}\n          </a>\n        </h4>\n        {item.contributor && (\n          <p>\n            By <b>{item.contributor}</b>\n          </p>\n        )}\n        <p>\n          {item.price && <b className=\"price\">{item.price}</b>}\n          {productTypeInfo}\n          <br />\n          {item.release_date && <span>Release date: {item.release_date}</span>}\n        </p>\n      </div>\n    </div>\n  );\n}\n\nfunction old__AmazonRelatedItem({ item }) {\n  let productTypeInfo = item.ItemAttributes.ProductGroup;\n  if (\n    productTypeInfo &&\n    item.ItemAttributes.Binding &&\n    productTypeInfo !== item.ItemAttributes.Binding\n  ) {\n    productTypeInfo += `, ${item.ItemAttributes.Binding}`;\n  }\n  return (\n    <div className=\"media amazon-item\">\n      <div className=\"media-left media-top\">\n        <a href={item.URL} target=\"_blank\" rel=\"noopener noreferrer\">\n          <img className=\"media-object\" src={item.SmallImage} alt=\"Product\" />\n        </a>\n      </div>\n      <div className=\"media-body\">\n        <h4 className=\"media-heading\">\n          <a href={item.URL} target=\"_blank\" rel=\"noopener noreferrer\">\n            {item.Title}\n          </a>\n        </h4>\n        {item.Creator && (\n          <p>\n            By <b>{item.Creator}</b>\n          </p>\n        )}\n        <p>\n          {item.ItemAttributes.ListPrice && (\n            <b className=\"price\">\n              {item.ItemAttributes.ListPrice.FormattedPrice}\n            </b>\n          )}\n          {productTypeInfo}\n        </p>\n      </div>\n    </div>\n  );\n}\n\n// export function Affiliates({ song }) {\n//   console.log(\"IS THIS STILL USED?!??!?!?!?!\");\n//   // const [amazon, setAmazon] = React.useState(null);\n//   const [itunes, setItunes] = React.useState(null);\n\n//   useEffect(() => {\n//     let dismounted = false;\n//     const url = `/api/song/${song.id}/affiliate/itunes`;\n//     cachedFetch(url).then((response) => {\n//       if (response.ok) {\n//         if (dismounted) {\n//           return;\n//         }\n//         response.json().then((results) => {\n//           if (\n//             results.itunes &&\n//             results.itunes.matches &&\n//             results.itunes.matches.length\n//           ) {\n//             setItunes(results.itunes);\n//           }\n//         });\n//       } else {\n//         console.warn(response);\n//       }\n//     });\n//     return () => {\n//       dismounted = true;\n//     };\n//   }, [song]);\n\n//   if (isServer) {\n//     return null;\n//   }\n//   return (\n//     <>\n//       {/* XXX This causes a double-render even though 'song' hasn't changed!! */}\n//       <AmazonRelatedProducts song={song} />\n//       <ITunesBadge itunes={itunes} />\n//     </>\n//   );\n// }\n\n// const ITunesBadge = React.memo(({ itunes }) => {\n//   if (!itunes) {\n//     return null;\n//   }\n//   if (!itunes.matches.length) {\n//     return null;\n//   }\n\n//   const first = itunes.matches[0];\n//   const trackURL = `${first.trackViewUrl}&at=${itunes.token}`;\n//   const trackLink = (\n//     <p>\n//       <a href={trackURL}>\n//         <b>{first.trackName}</b>\n//         {\" by \"}\n//         <b>{first.artistName}</b>\n//         {first.trackPrice &&\n//           first.trackPrice > 0.0 &&\n//           ` ($${first.trackPrice})`}\n//       </a>\n//     </p>\n//   );\n\n//   const trackIcon = (\n//     <p style={{ float: \"left\", marginBottom: 15 }}>\n//       <a href={trackURL} className=\"app-icon\" title={first.trackName}>\n//         <img src={itunesAppImage} alt=\"iTunes\" />\n//       </a>\n//     </p>\n//   );\n\n//   let albumLink = null;\n//   if (first.collectionName) {\n//     const collectionURL = `${first.collectionViewUrl}&at=${itunes.token}`;\n//     albumLink = (\n//       <p>\n//         <a href={collectionURL}>\n//           On album <b>{first.collectionName}</b>\n//           {first.collectionPrice &&\n//             first.collectionPrice > 0 &&\n//             ` ($${first.collectionPrice})`}\n//         </a>\n//       </p>\n//     );\n//   }\n\n//   let preview = null;\n//   if (first.previewUrl) {\n//     preview = (\n//       <div style={{ clear: \"left\", textAlign: \"center\" }}>\n//         <b>iTunes</b> Preview\n//         <br />\n//         <audio controls preload=\"none\" src={first.previewUrl} />\n//       </div>\n//     );\n//   }\n\n//   return (\n//     <div style={{ marginTop: 30, marginBottom: 20 }}>\n//       <h4>On Apple iTunes</h4>\n//       {trackIcon}\n//       {trackLink}\n//       {albumLink}\n//       {preview}\n//     </div>\n//   );\n// });\n\nexport function SpotifySnippet({ song, compact = true }) {\n  const { data } = useSWR(\n    `/api/song/${song.id}/spotify`,\n    async (url) => {\n      const r = await fetch(url);\n      if (!r.ok) {\n        if (process.env.NODE_ENV === \"development\") {\n          console.warn(`${r.status} on ${url}`);\n        }\n        throw new Error(`${r.status} on ${url}`);\n      }\n      return await r.json();\n    },\n    { revalidateOnFocus: false }\n  );\n  if (!data) {\n    return null;\n  }\n  return (\n    <div className=\"spotify\">\n      <h4>On Spotify™</h4>\n      <div style={{ textAlign: \"center\" }}>\n        {/* https://developer.spotify.com/documentation/widgets/generate/embed/ */}\n        <iframe\n          src={data.embed_url}\n          width=\"300\"\n          height={compact ? 80 : 380}\n          frameBorder=\"0\"\n          allowtransparency=\"true\"\n          allow=\"encrypted-media\"\n        ></iframe>\n      </div>\n    </div>\n  );\n}\n\nexport class YouTubeSnippet extends React.PureComponent {\n  state = {\n    snippet: null,\n    searched: false,\n    clicked: false\n  };\n\n  componentDidMount() {\n    const id = this.props.song.id;\n    let url = `/api/song/${id}/youtube`;\n    return cachedFetch(url).then((r) => {\n      if (this.dismounted) {\n        return;\n      }\n      if (r.status !== 200) {\n        console.warn(r.status, \"loading\", url);\n      } else {\n        r.json().then((response) => {\n          if (response.snippet) {\n            this.setState({ snippet: response.snippet, searched: true });\n          } else {\n            this.setState({ searched: true });\n          }\n        });\n      }\n    });\n  }\n  componentWillUnmount() {\n    this.dismounted = true;\n  }\n\n  onClickThumbnail = (event) => {\n    event.preventDefault();\n    this.setState({ clicked: true });\n  };\n\n  render() {\n    const { clicked, snippet } = this.state;\n    if (isServer || snippet === null) {\n      return null;\n    }\n    let media;\n    const videoId = snippet.videoId;\n    const href = `https://www.youtube.com/watch?v=${videoId}`;\n    if (clicked) {\n      // const src = `https://www.youtube-nocookie.com/embed/${videoId}?rel=0&amp;showinfo=0`\n      const src = `https://www.youtube-nocookie.com/embed/${videoId}?rel=0`;\n      let width = 335;\n      let height = 178; // =335/(16/9)\n      const containerDiv = document.querySelector(\"div.result\");\n      if (containerDiv && containerDiv.offsetWidth > 335) {\n        width = 560;\n        height = 315;\n      }\n      media = (\n        <iframe\n          width={width}\n          height={height}\n          title={snippet.title || \"YouTube Snippet\"}\n          src={src}\n          frameBorder={0}\n          allow=\"autoplay; encrypted-media\"\n          allowFullScreen\n        />\n      );\n    } else {\n      let thumbnail = snippet.thumbnails.medium;\n      const containerDiv = document.querySelector(\"div.result\");\n      if (containerDiv && containerDiv.offsetWidth > 335) {\n        thumbnail = snippet.thumbnails.high;\n      }\n      media = (\n        <a href={href} onClick={this.onClickThumbnail}>\n          <img\n            src={thumbnail.url}\n            width={thumbnail.width}\n            height={thumbnail.height}\n            title=\"Click to load video\"\n            alt=\"Video thumbnail\"\n            loading=\"lazy\"\n          />\n        </a>\n      );\n    }\n    return (\n      <div className=\"youtube\">\n        <h4>\n          YouTube™{\" \"}\n          {!clicked ? (\n            <small onClick={this.onClickThumbnail}>Click to load</small>\n          ) : null}\n        </h4>\n        <div style={{ textAlign: \"center\" }}>\n          {media}\n          <p>\n            <small>\n              <a href={href} target=\"_blank\" rel=\"noopener noreferrer\">\n                Watch on YouTube™\n              </a>\n            </small>\n          </p>\n        </div>\n      </div>\n    );\n  }\n}\n\nexport function IntersectionLazy({ render }) {\n  const [entered, setEntered] = useState(false);\n  function onEnter() {\n    setEntered(true);\n  }\n  if (entered) {\n    return render();\n    // return <YouTubeSnippet song={song} />;\n  }\n  return <Waypoint onEnter={onEnter} />;\n}\n\n// export function YouTubeSnippetIntersectionLazy({ song }) {\n//   const [entered, setEntered] = useState(false);\n//   function onEnter() {\n//     setEntered(true);\n//   }\n//   if (entered) {\n//     return <YouTubeSnippet song={song} />;\n//   }\n//   return <Waypoint onEnter={onEnter} />;\n// }\n\n// export function YouTubeSnippetIntersectionLazy({ song }) {\n//   const [entered, setEntered] = useState(false);\n//   function onEnter() {\n//     setEntered(true);\n//   }\n//   if (entered) {\n//     return <YouTubeSnippet song={song} />;\n//   }\n//   return <Waypoint onEnter={onEnter} />;\n// }\n\nexport function loadCarbonScript() {\n  const carbonParent = document.getElementById(\"carbonadsouter\");\n  if (carbonParent) {\n    if (!carbonParent.querySelector(\"script\")) {\n      const script = document.createElement(\"script\");\n      script.id = \"_carbonads_js\";\n      script.src =\n        \"https://cdn.carbonads.com/carbon.js?serve=CK7DCK7W&placement=songsearch\";\n      script.async = true;\n      carbonParent.appendChild(script);\n    }\n  }\n}\n\nexport function loadAdsenseScript() {\n  const carbonParent = document.getElementById(\"carbonadsouter\");\n  if (carbonParent) {\n    if (!carbonParent.querySelector(\"script\")) {\n      const script = document.createElement(\"script\");\n      script.id = \"_carbonads_js\";\n      script.src =\n        \"https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js\";\n      script.async = true;\n      script.setAttribute('data-ad-client', 'ca-pub-8561605615946624');\n      carbonParent.appendChild(script);\n    }\n  }\n}\n\nexport function loadAmplifiedScript({ song, artist }) {\n  const parent = document.getElementById(\"amplifiedouter\");\n  if (parent) {\n    if (!parent.querySelector(\"script\")) {\n      window.amplified = window.amplified || { init: [] };\n      window.amplified.init.push(() => {\n        amplified.setParams({\n          artist,\n          song\n        });\n        amplified.pushAdUnit(100003500);\n        amplified.run();\n      });\n      const script = document.createElement(\"script\");\n      script.id = \"_amplified_js\";\n      script.src = \"https://srv.clickfuse.com/ads/ads.js\";\n      script.async = true;\n      parent.appendChild(script);\n    }\n  }\n}\n\nexport const RenderParagraphs = React.memo(({ text }) => {\n  return <blockquote dangerouslySetInnerHTML={{ __html: text }} />;\n});\n\nexport function CustomTimeAgo(props) {\n  return (\n    <TimeAgo\n      // Since the smallest granularity is 1 min, no point making the\n      // setInterval any smaller than this.\n      minPeriod={60}\n      formatter={(value, unit, suffix, epochSeconds, nextFormatter) => {\n        if (unit === \"second\") {\n          return \"seconds ago\";\n        }\n        return nextFormatter(value, unit, suffix, epochSeconds);\n      }}\n      {...props}\n    />\n  );\n}\n\nexport function ServerError() {\n  return (\n    <div className=\"not-found\">\n      <h3>Server Error</h3>\n      <p>\n        <img alt=\"Skull\" src={skullImage} />\n      </p>\n      <p>\n        Most likely a <b>temporary problem</b> which will go away if you{\" \"}\n        <b>reload this page soon</b>.\n      </p>\n      <p>\n        <Link to=\"/\">Back to the home page</Link>\n      </p>\n    </div>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}