{"ast":null,"code":"import _slicedToArray from \"/home/mandeep/Downloads/Song-sorch work/site/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _objectSpread from \"/home/mandeep/Downloads/Song-sorch work/site/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\nimport _regeneratorRuntime from \"/home/mandeep/Downloads/Song-sorch work/site/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/home/mandeep/Downloads/Song-sorch work/site/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/home/mandeep/Downloads/Song-sorch work/site/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/mandeep/Downloads/Song-sorch work/site/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _inherits from \"/home/mandeep/Downloads/Song-sorch work/site/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _createSuper from \"/home/mandeep/Downloads/Song-sorch work/site/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";\n\nvar _jsxFileName = \"/home/mandeep/Downloads/Song-sorch work/site/src/Comments.js\",\n    _s3 = $RefreshSig$();\n\nimport React, { useEffect, useState } from \"react\";\nimport { cachedFetch } from \"./Cache\";\nimport { CustomTimeAgo, isServer } from \"./Common\";\nimport \"./Comments.css\";\nimport { Helmet } from \"react-helmet\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nvar SUBMITTED_COMMENTS_STORAGE_KEY = \"submittedComments\";\nexport var SongComments = /*#__PURE__*/function (_React$PureComponent) {\n  _inherits(SongComments, _React$PureComponent);\n\n  var _super = _createSuper(SongComments);\n\n  function SongComments() {\n    var _this;\n\n    _classCallCheck(this, SongComments);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _super.call.apply(_super, [this].concat(args));\n    _this.state = {\n      loadingComments: false,\n      savingComment: false,\n      serverError: null,\n      submissionError: null,\n      comments: _this.props.comments || null,\n      commentsCount: _this.props.commentsCount || null,\n      submittedComments: [],\n      commentSubmitted: null,\n      commentEdited: null,\n      commentDeleted: null,\n      searchedId: _this.props.searchedId,\n      replyComment: null,\n      editComment: null,\n      csrfToken: null,\n      highlightComment: null,\n      highlitComment: null,\n      hasCommented: false\n    };\n\n    _this.loadCSRFToken = function () {\n      var url = \"/api/comments?csrftoken=1\";\n      fetch(url).then(function (r) {\n        if (_this.dismounted) return;\n\n        if (r.ok) {\n          return r.json().then(function (result) {\n            _this.setState({\n              csrfToken: result.csrf_token\n            });\n          });\n        } else {\n          _this.setState({\n            serverError: r\n          });\n        }\n      }).catch(function (error) {\n        if (_this.dismounted) return;\n\n        _this.setState({\n          serverError: error\n        });\n      });\n    };\n\n    _this.loadComments = function () {\n      var _this$props = _this.props,\n          song = _this$props.song,\n          search = _this$props.search;\n      var _this$state = _this.state,\n          submittedComments = _this$state.submittedComments,\n          commentEdited = _this$state.commentEdited;\n      var submittedCommentIds = [];\n      var url = \"/api/comments\";\n\n      if (song) {\n        url += \"?song=\".concat(song.id);\n      } else if (search) {\n        url += \"?search=\".concat(search.id);\n      } else {// throw new Error(\"Don't know how to do this outside of song\");\n      }\n\n      if (submittedComments.length) {\n        submittedCommentIds = submittedComments.filter(function (submission) {\n          if (song) {\n            return submission.song === song.id;\n          } else if (search) {\n            return submission.search === search.id;\n          } else {\n            return !submission.song && !submission.search;\n          }\n        }).map(function (submission) {\n          return submission.id;\n        });\n      }\n\n      submittedCommentIds.forEach(function (id) {\n        url += url.includes(\"?\") ? \"&\" : \"?\";\n        url += \"submitted=\".concat(id);\n      });\n\n      if (commentEdited) {\n        // Just to extra-bust the cache\n        url += url.includes(\"?\") ? \"&\" : \"?\";\n        url += \"edited=\".concat(commentEdited.id);\n      }\n\n      var fetchFunc;\n\n      if (commentEdited && submittedCommentIds.length) {\n        // Don't use the caching one\n        fetchFunc = fetch;\n      } else {\n        fetchFunc = cachedFetch;\n      }\n\n      fetchFunc(url).then(function (r) {\n        if (_this.dismounted) return;\n\n        _this.setState({\n          loadingComments: false\n        });\n\n        if (r.ok) {\n          return r.json().then(function (result) {\n            _this.setState({\n              csrfToken: result.csrf_token,\n              comments: result.comments,\n              commentsCount: result.comments_count,\n              loadingComments: false\n            }, _this.consolidateSubmittedComments);\n          });\n        } else {\n          _this.setState({\n            serverError: r,\n            loadingComments: false\n          });\n        }\n      }).catch(function (error) {\n        if (_this.dismounted) return;\n\n        _this.setState({\n          serverError: error,\n          loadingComments: false\n        });\n      });\n    };\n\n    _this.consolidateSubmittedComments = function () {\n      var comments = _this.state.comments;\n      var submittedComments = _this.state.submittedComments;\n\n      if (submittedComments.length && comments[\"\"] && comments[\"\"].length) {\n        var recurse = function recurse(comments) {\n          comments.forEach(function (comment) {\n            if (!comment.not_approved) {\n              // Add to removeSubmittedComments only if this is one of the ones\n              // you submitted.\n              submittedComments.forEach(function (submittedComment) {\n                if (submittedComment.id === comment.id) {\n                  removeSubmittedComments.push(submittedComment.id);\n                }\n              });\n            }\n\n            if (comments[comment.id]) {\n              recurse(comments[comment.id]);\n            }\n          });\n        };\n\n        // If any of your submitted comments is now approved, we need to remove\n        // it from sessionStorage.\n        var removeSubmittedComments = [];\n        recurse(comments[\"\"]);\n\n        if (removeSubmittedComments.length) {\n          var newSubmittedComments = submittedComments.filter(function (submittedComment) {\n            return !removeSubmittedComments.includes(submittedComment.id);\n          });\n\n          _this.setState({\n            submittedComments: newSubmittedComments\n          }, function () {\n            if (_this.state.submittedComments.length) {\n              // Update\n              try {\n                sessionStorage.setItem(SUBMITTED_COMMENTS_STORAGE_KEY, JSON.stringify(_this.state.submittedComments));\n              } catch (ex) {\n                console.warn(\"'sessionStorage.setItem(SUBMITTED_COMMENTS_STORAGE_KEY)' did't work\");\n              }\n            } else {\n              // Reset\n              try {\n                sessionStorage.removeItem(SUBMITTED_COMMENTS_STORAGE_KEY);\n              } catch (ex) {}\n            }\n          });\n        }\n      }\n    };\n\n    _this.highlightComment = function (id) {\n      var highlitComment = _this.state.highlitComment;\n\n      if (highlitComment && highlitComment === id) {\n        highlitComment = null;\n      } else {\n        highlitComment = id;\n      }\n\n      _this.setState({\n        highlitComment: highlitComment\n      }, function () {\n        window.setTimeout(function () {\n          if (!_this.dismounted && _this.state.highlitComment === id) {\n            _this.setState({\n              highlitComment: null\n            });\n          }\n        }, 10 * 1000);\n      });\n    };\n\n    _this.submitCommentHandler = function (data) {\n      _this.setState({\n        savingComment: true\n      }, function () {\n        _this._submitCommentHandler(data).then(function () {\n          _this.setState({\n            savingComment: false\n          });\n        });\n      });\n    };\n\n    _this._submitCommentHandler = /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(data) {\n        var response, _this$props2, song, search, _this$state2, submittedComments, csrfToken, formData, result;\n\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _this$props2 = _this.props, song = _this$props2.song, search = _this$props2.search;\n                _this$state2 = _this.state, submittedComments = _this$state2.submittedComments, csrfToken = _this$state2.csrfToken;\n\n                if (csrfToken) {\n                  _context.next = 4;\n                  break;\n                }\n\n                throw new Error(\"No csrfToken prepared\");\n\n              case 4:\n                formData = new FormData();\n                formData.append(\"csrfmiddlewaretoken\", csrfToken);\n                formData.append(\"text\", data.comment);\n                formData.append(\"name\", data.name);\n                formData.append(\"email\", data.email);\n\n                if (submittedComments.length) {\n                  submittedComments.filter(function (submission) {\n                    if (song) {\n                      return submission.song === song.id;\n                    } else if (search) {\n                      return submission.search === search.id;\n                    } else {\n                      return !submission.song && !submission.search;\n                    }\n                  }).forEach(function (submission) {\n                    formData.append(\"submitted\", submission.id);\n                  });\n                }\n\n                if (!data.editComment) {\n                  _context.next = 15;\n                  break;\n                }\n\n                formData.append(\"id\", data.editComment.id);\n\n                if (data.editComment.oid) {\n                  _context.next = 14;\n                  break;\n                }\n\n                throw new Error(\"Can't edit if you don't have the oid\");\n\n              case 14:\n                formData.append(\"oid\", data.editComment.oid);\n\n              case 15:\n                if (data.replyComment) {\n                  formData.append(\"parent\", data.replyComment.id);\n                }\n\n                if (data.askedWasSearchedFor) {\n                  formData.append(\"was_searched_for\", data.wasSearchedFor || false);\n                }\n\n                if (_this.state.searchedId) {\n                  formData.append(\"search\", _this.state.searchedId || null);\n                }\n\n                if (data.parent) {\n                  formData.append(\"parent\", data.parent || null);\n                }\n\n                formData.append(\"experiment\", data.experiment || {});\n\n                if (song) {\n                  formData.append(\"song\", song.id);\n                } else if (search) {\n                  formData.append(\"search\", search.id);\n                } else {// throw new Error(\"Don't know how to do this outside of song\");\n                }\n\n                _context.prev = 21;\n                _context.next = 24;\n                return fetch(\"/api/comments\", {\n                  method: \"POST\",\n                  body: formData\n                });\n\n              case 24:\n                response = _context.sent;\n\n                if (!response.ok) {\n                  _context.next = 37;\n                  break;\n                }\n\n                // If posted a comment because this *was* the song you\n                // searched for, let's kill that not to stop asking that question.\n                if (_this.state.searchedId) {\n                  try {\n                    localStorage.removeItem(\"searched\");\n                  } catch (ex) {\n                    console.warn(\"'localStorage.removeItem(\\\"searched\\\")' didn't work\");\n                  }\n                }\n\n                _context.next = 29;\n                return response.json();\n\n              case 29:\n                result = _context.sent;\n\n                if (!data.editComment) {\n                  _context.next = 34;\n                  break;\n                }\n\n                return _context.abrupt(\"return\", _this.setState({\n                  searchedId: null,\n                  commentEdited: result.submitted,\n                  submissionError: null,\n                  commentSubmitted: null,\n                  editComment: null,\n                  replyComment: null,\n                  comments: result.comments,\n                  commentsCount: result.comments_count\n                }));\n\n              case 34:\n                return _context.abrupt(\"return\", _this.setState({\n                  searchedId: null,\n                  submissionError: null,\n                  commentEdited: null,\n                  commentSubmitted: result.submitted,\n                  commentDeleted: null,\n                  replyComment: null,\n                  comments: result.comments,\n                  commentsCount: result.comments_count\n                }, function () {\n                  // Only do this if there is only exactly 1 of these in the DOM.\n                  // The reason why is that when repeatedly injecting the <SongComments>\n                  // components in multiple places, you might have different ones\n                  // for different expanded songs.\n                  if (document.querySelectorAll(\".alert-comment\").length === 1) {\n                    document.querySelector(\".alert-comment.alert-success\").scrollIntoView({\n                      behavior: \"smooth\"\n                    });\n                  }\n\n                  var commentSubmitted = _this.state.commentSubmitted;\n                  var _this$props3 = _this.props,\n                      song = _this$props3.song,\n                      search = _this$props3.search;\n\n                  _this.highlightComment(commentSubmitted.id);\n\n                  var submittedComments = _this.state.submittedComments.slice(0); // If you accidentally double-clicked to submit twice.\n                  // Or, just wrote the exact same comment twice, the server\n                  // won't create another record but it will respond as if it worked\n                  // so we need to check first that we don't already have\n                  // this 'commentSubmitted.id` already.\n\n\n                  // If you accidentally double-clicked to submit twice.\n                  // Or, just wrote the exact same comment twice, the server\n                  // won't create another record but it will respond as if it worked\n                  // so we need to check first that we don't already have\n                  // this 'commentSubmitted.id` already.\n                  if (!submittedComments.map(function (o) {\n                    return o.id;\n                  }).filter(function (id) {\n                    return id === commentSubmitted.id;\n                  }).length) {\n                    var toPush = {\n                      id: commentSubmitted.id,\n                      oid: commentSubmitted.oid\n                    };\n\n                    if (song) {\n                      toPush.song = song.id;\n                    } else if (search) {\n                      toPush.search = search.id;\n                    }\n\n                    submittedComments.push(toPush);\n                  }\n\n                  _this.setState({\n                    submittedComments: submittedComments,\n                    submissionError: null\n                  }, function () {\n                    _this.loadComments();\n\n                    try {\n                      sessionStorage.setItem(SUBMITTED_COMMENTS_STORAGE_KEY, JSON.stringify(_this.state.submittedComments));\n                    } catch (ex) {}\n                  });\n                }));\n\n              case 35:\n                _context.next = 38;\n                break;\n\n              case 37:\n                return _context.abrupt(\"return\", _this.setState({\n                  submissionError: response\n                }));\n\n              case 38:\n                _context.next = 44;\n                break;\n\n              case 40:\n                _context.prev = 40;\n                _context.t0 = _context[\"catch\"](21);\n                console.warn(\"Submission failed:\", _context.t0);\n                return _context.abrupt(\"return\", _this.setState({\n                  submissionError: _context.t0\n                }));\n\n              case 44:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, null, [[21, 40]]);\n      }));\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }();\n\n    _this.deleteCommentHandler = function (comment) {\n      _this.setState({\n        savingComment: true\n      }, function () {\n        _this._deleteCommentHandler(comment).then(function () {\n          _this.setState({\n            savingComment: false\n          });\n        });\n      });\n    };\n\n    _this._deleteCommentHandler = /*#__PURE__*/function () {\n      var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(comment) {\n        var response, formData, url;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                formData = new FormData();\n\n                if (comment.oid) {\n                  _context2.next = 3;\n                  break;\n                }\n\n                throw new Error(\"Can't edit if you don't have the oid\");\n\n              case 3:\n                formData.append(\"id\", comment.id);\n                formData.append(\"oid\", comment.oid);\n                url = \"/api/comments/delete\";\n                _context2.prev = 6;\n                _context2.next = 9;\n                return fetch(url, {\n                  method: \"POST\",\n                  body: formData\n                });\n\n              case 9:\n                response = _context2.sent;\n                _context2.next = 15;\n                break;\n\n              case 12:\n                _context2.prev = 12;\n                _context2.t0 = _context2[\"catch\"](6);\n                return _context2.abrupt(\"return\", _this.setState({\n                  submissionError: _context2.t0\n                }));\n\n              case 15:\n                if (response.ok) {\n                  _context2.next = 17;\n                  break;\n                }\n\n                return _context2.abrupt(\"return\", _this.setState({\n                  submissionError: response\n                }));\n\n              case 17:\n                return _context2.abrupt(\"return\", _this.setState({\n                  commentDeleted: comment,\n                  commentEdited: null,\n                  editComment: null,\n                  submissionError: null\n                }, function () {\n                  // Before we load comments, remove this one from localStorage\n                  var submittedComments = _this.state.submittedComments;\n                  var filteredSubmittedComments = submittedComments.filter(function (submission) {\n                    return submission.id !== comment.id;\n                  });\n\n                  _this.setState({\n                    submittedComments: filteredSubmittedComments\n                  }, function () {\n                    _this.loadComments();\n\n                    try {\n                      sessionStorage.setItem(SUBMITTED_COMMENTS_STORAGE_KEY, JSON.stringify(_this.state.submittedComments));\n                    } catch (ex) {}\n                  });\n                }));\n\n              case 18:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, null, [[6, 12]]);\n      }));\n\n      return function (_x2) {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n\n    _this.setEditComment = function (comment) {\n      _this.setState({\n        editComment: comment\n      });\n    };\n\n    _this.setReplyComment = function (comment) {\n      if (_this.state.replyComment && _this.state.replyComment.id === comment.id) {\n        _this.setState({\n          replyComment: null,\n          highlitComment: null,\n          commentEdited: null\n        });\n      } else {\n        _this.setState({\n          replyComment: comment,\n          highlitComment: comment.id,\n          commentEdited: null\n        });\n      }\n    };\n\n    _this.clearCommentSubmitted = function () {\n      _this.setState({\n        commentSubmitted: null\n      });\n    };\n\n    _this.clearCommentEdited = function () {\n      _this.setState({\n        commentEdited: null\n      });\n    };\n\n    _this.clearCommentDeleted = function () {\n      _this.setState({\n        commentDeleted: null\n      });\n    };\n\n    return _this;\n  }\n\n  _createClass(SongComments, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      // If you're here, you're a browser and no a server rendering.\n      var submittedCommentStorage = \"[]\";\n\n      try {\n        submittedCommentStorage = sessionStorage.getItem(SUBMITTED_COMMENTS_STORAGE_KEY) || \"[]\";\n      } catch (ex) {\n        console.warn(\"'sessionStorage.getItem(SUBMITTED_COMMENTS_STORAGE_KEY)' didn't work\");\n      }\n\n      var submittedComments = JSON.parse(submittedCommentStorage);\n\n      if (submittedComments.length) {\n        // Definitely load comments. Even if you arrived here with the comments\n        // already server-side rendered.\n        // Because, this call to loadingComments might be potentially different.\n        // If you have commented on this song before, update that in state.\n        var hasCommented = false;\n        var song = this.props.song;\n\n        if (song) {\n          hasCommented = submittedComments.some(function (comment) {\n            return comment.song && comment.song === song.id;\n          });\n        }\n\n        this.setState({\n          submittedComments: submittedComments,\n          hasCommented: hasCommented,\n          loadingComments: !this.state.comments\n        }, this.loadComments);\n      } else {\n        // If the comments were already loaded, we only need the csrfToken.\n        if (!this.state.comments) {\n          this.setState({\n            loadingComments: true\n          }, this.loadComments);\n        } else {\n          // We just need a new csrfToken\n          this.loadCSRFToken();\n        }\n      }\n\n      if (window.location.hash) {\n        var re = /c(\\d+)$/;\n\n        if (window.location.hash.match(re)) {\n          var id = parseInt(window.location.hash.match(re)[1], 10);\n          this.setState({\n            highlitComment: id\n          }, function () {\n            window.setTimeout(function () {\n              if (!_this2.dismounted) {\n                var element = document.querySelector(\"#c\".concat(_this2.state.highlitComment));\n\n                if (element && element.scrollIntoView) {\n                  element.scrollIntoView({\n                    behavior: \"smooth\"\n                  });\n                }\n              }\n            }, 1000);\n            window.setTimeout(function () {\n              if (!_this2.dismounted && _this2.state.highlitComment === id) {\n                _this2.setState({\n                  highlitComment: null\n                });\n              }\n            }, 10 * 1000);\n          });\n        }\n      }\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps) {\n      if (prevProps.song !== this.props.song) {\n        this.setState({\n          loadingComments: true,\n          comments: null,\n          commentsCount: null\n        }, this.loadComments);\n      }\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      this.dismounted = true;\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _s = $RefreshSig$(),\n          _this3 = this,\n          _s2 = $RefreshSig$();\n\n      var song = this.props.song;\n      var _this$state3 = this.state,\n          comments = _this$state3.comments,\n          commentsCount = _this$state3.commentsCount,\n          submissionError = _this$state3.submissionError,\n          commentSubmitted = _this$state3.commentSubmitted,\n          commentEdited = _this$state3.commentEdited,\n          commentDeleted = _this$state3.commentDeleted,\n          submittedComments = _this$state3.submittedComments,\n          searchedId = _this$state3.searchedId,\n          editComment = _this$state3.editComment,\n          replyComment = _this$state3.replyComment,\n          savingComment = _this$state3.savingComment,\n          highlitComment = _this$state3.highlitComment,\n          hasCommented = _this$state3.hasCommented,\n          csrfToken = _this$state3.csrfToken;\n\n      function App() {\n        _s();\n\n        useEffect(function () {\n          var script = document.createElement(\"script\");\n          script.src = \"https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js\";\n          script.async = true;\n          script.integrity = \"sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p\";\n          script.crossOrigin = \"anonymous\";\n          document.body.appendChild(script);\n          return function () {\n            // clean up the script when the component in unmounted\n            document.body.removeChild(script);\n          };\n        }, []);\n        return /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"App\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 575,\n          columnNumber: 14\n        }, this);\n      }\n\n      _s(App, \"OD7bBpZva5O2jO+Puf00hKivP7c=\");\n\n      var Vdtag = function Vdtag() {\n        _s2();\n\n        useEffect(function () {\n          var script = document.createElement(\"script\");\n          script.src = \"https://live.primis.tech/live/liveView.php?s=113482s\";\n          script.async = true;\n          document.body.appendChild(script);\n          return function () {\n            // clean up the script when the component in unmounted\n            document.body.removeChild(script);\n          };\n        }, []);\n        return /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"vdtag_divs\",\n            children: /*#__PURE__*/_jsxDEV(Helmet, {\n              children: /*#__PURE__*/_jsxDEV(\"script\", {\n                type: \"text/javascript\",\n                language: \"javascript\",\n                src: \"https://live.primis.tech/live/liveView.php?s=113482\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 595,\n                columnNumber: 11\n              }, _this3)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 594,\n              columnNumber: 10\n            }, _this3)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 593,\n            columnNumber: 10\n          }, _this3)\n        }, void 0, false);\n      };\n\n      _s2(Vdtag, \"OD7bBpZva5O2jO+Puf00hKivP7c=\");\n\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"comments masters song-comments\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"application\",\n          children: /*#__PURE__*/_jsxDEV(Vdtag, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 607,\n            columnNumber: 17\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 606,\n          columnNumber: 14\n        }, this), /*#__PURE__*/_jsxDEV(\"h3\", {\n          children: [\"Song Comments \", commentsCount ? /*#__PURE__*/_jsxDEV(\"span\", {\n            children: [\"(\", commentsCount, \")\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 611,\n            columnNumber: 42\n          }, this) : null, /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 612,\n            columnNumber: 11\n          }, this), /*#__PURE__*/_jsxDEV(\"small\", {\n            children: [\"On \", /*#__PURE__*/_jsxDEV(\"b\", {\n              children: song.name\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 614,\n              columnNumber: 16\n            }, this), \" \", /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"by\",\n              children: \"by\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 614,\n              columnNumber: 35\n            }, this), \" \", song.artist.name]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 613,\n            columnNumber: 11\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 610,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(ShowCommentDeleted, {\n          commentDeleted: commentDeleted,\n          clearCommentDeleted: this.clearCommentDeleted\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 619,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(ShowComments, _objectSpread(_objectSpread({}, this.props), {}, {\n          submissionError: submissionError,\n          comments: comments,\n          editComment: editComment,\n          replyComment: replyComment,\n          searchedId: searchedId,\n          setEditComment: this.setEditComment,\n          setReplyComment: this.setReplyComment,\n          submitCommentHandler: this.submitCommentHandler,\n          deleteCommentHandler: this.deleteCommentHandler,\n          commentSubmitted: commentSubmitted,\n          commentEdited: commentEdited,\n          submittedComments: submittedComments,\n          savingComment: savingComment,\n          highlitComment: highlitComment,\n          highlightComment: this.highlightComment,\n          clearCommentSubmitted: this.clearCommentSubmitted,\n          clearCommentEdited: this.clearCommentEdited,\n          csrfToken: csrfToken,\n          hasCommented: hasCommented\n        }), void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 624,\n          columnNumber: 9\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 605,\n        columnNumber: 7\n      }, this);\n    }\n  }]);\n\n  return SongComments;\n}(React.PureComponent);\n\nfunction ShowCommentSubmitted(_ref3) {\n  var commentSubmitted = _ref3.commentSubmitted,\n      clearCommentSubmitted = _ref3.clearCommentSubmitted;\n  if (!commentSubmitted) return null;\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"alert-comment alert-comment alert alert-success alert-dismissible\",\n    role: \"alert\",\n    children: [/*#__PURE__*/_jsxDEV(\"button\", {\n      type: \"button\",\n      className: \"close\",\n      \"data-dismiss\": \"alert\",\n      \"aria-label\": \"Close\",\n      onClick: function onClick(event) {\n        clearCommentSubmitted();\n      },\n      children: /*#__PURE__*/_jsxDEV(\"span\", {\n        \"aria-hidden\": \"true\",\n        children: \"\\xD7\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 667,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 658,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n      children: /*#__PURE__*/_jsxDEV(\"b\", {\n        children: \"Comment submitted. Thank you!\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 670,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 669,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n      children: \"It needs to be moderated before publishing.\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 672,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 654,\n    columnNumber: 5\n  }, this);\n}\n\n_c = ShowCommentSubmitted;\n\nfunction ShowCommentEdited(_ref4) {\n  var commentEdited = _ref4.commentEdited,\n      clearCommentEdited = _ref4.clearCommentEdited;\n  if (!commentEdited) return null;\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"alert-comment alert alert-success alert-dismissible\",\n    role: \"alert\",\n    children: [/*#__PURE__*/_jsxDEV(\"button\", {\n      type: \"button\",\n      className: \"close\",\n      \"data-dismiss\": \"alert\",\n      \"aria-label\": \"Close\",\n      onClick: function onClick(event) {\n        clearCommentEdited();\n      },\n      children: /*#__PURE__*/_jsxDEV(\"span\", {\n        \"aria-hidden\": \"true\",\n        children: \"\\xD7\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 693,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 684,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n      children: /*#__PURE__*/_jsxDEV(\"b\", {\n        children: \"Comment edited.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 696,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 695,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n      children: \"You can keep editing it until it gets approved.\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 698,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 680,\n    columnNumber: 5\n  }, this);\n}\n\n_c2 = ShowCommentEdited;\n\nfunction ShowCommentDeleted(_ref5) {\n  var commentDeleted = _ref5.commentDeleted,\n      clearCommentDeleted = _ref5.clearCommentDeleted;\n  if (!commentDeleted) return null;\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"alert-comment alert alert-success alert-dismissible\",\n    role: \"alert\",\n    children: [/*#__PURE__*/_jsxDEV(\"button\", {\n      type: \"button\",\n      className: \"close\",\n      \"data-dismiss\": \"alert\",\n      \"aria-label\": \"Close\",\n      onClick: function onClick(event) {\n        clearCommentDeleted();\n      },\n      children: /*#__PURE__*/_jsxDEV(\"span\", {\n        \"aria-hidden\": \"true\",\n        children: \"\\xD7\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 719,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 710,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n      children: /*#__PURE__*/_jsxDEV(\"b\", {\n        children: \"Comment removed.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 722,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 721,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n      children: \"Feel free to write a new comment.\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 724,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 706,\n    columnNumber: 5\n  }, this);\n}\n\n_c3 = ShowCommentDeleted;\n\nfunction ShowSubmissionError(_ref6) {\n  _s3();\n\n  var _this4 = this;\n\n  var submissionError = _ref6.submissionError;\n\n  var _useState = useState({}),\n      _useState2 = _slicedToArray(_useState, 2),\n      validationErrors = _useState2[0],\n      setValidationErrors = _useState2[1];\n\n  var isErrorResponse = false;\n\n  if (!isServer) {\n    try {\n      isErrorResponse = submissionError instanceof window.Response;\n    } catch (err) {\n      // Old browsers. E.g. Firefox 38.\n      console.log(\"instanceof window.Response did not work:\", err);\n    }\n  }\n\n  useEffect(function () {\n    if (!isServer && isErrorResponse && submissionError.status === 400) {\n      submissionError.json().then(function (data) {\n        setValidationErrors(data.errors);\n      });\n    }\n  }, [submissionError, isErrorResponse]);\n  if (!submissionError) return null;\n  var errorMessage;\n\n  if (!isServer && isErrorResponse) {\n    if (submissionError.status === 400) {\n      errorMessage = /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"p\", {\n          children: /*#__PURE__*/_jsxDEV(\"b\", {\n            children: \"Something's not right with the submission\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 758,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 757,\n          columnNumber: 11\n        }, this), Object.keys(validationErrors).map(function (key) {\n          return /*#__PURE__*/_jsxDEV(\"p\", {\n            children: [/*#__PURE__*/_jsxDEV(\"b\", {\n              children: [key, \":\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 763,\n              columnNumber: 17\n            }, _this4), \" \", validationErrors[key].map(function (err) {\n              return /*#__PURE__*/_jsxDEV(\"span\", {\n                children: [/*#__PURE__*/_jsxDEV(\"i\", {\n                  children: err.message\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 766,\n                  columnNumber: 21\n                }, _this4), \" \", err.code ? /*#__PURE__*/_jsxDEV(\"span\", {\n                  children: [\"(\", /*#__PURE__*/_jsxDEV(\"code\", {\n                    children: err.code\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 769,\n                    columnNumber: 26\n                  }, _this4), \")\"]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 768,\n                  columnNumber: 23\n                }, _this4) : null]\n              }, err.message + err.code, true, {\n                fileName: _jsxFileName,\n                lineNumber: 765,\n                columnNumber: 19\n              }, _this4);\n            })]\n          }, key, true, {\n            fileName: _jsxFileName,\n            lineNumber: 762,\n            columnNumber: 15\n          }, _this4);\n        })]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 756,\n        columnNumber: 9\n      }, this);\n    } else if (submissionError.status >= 500) {\n      errorMessage = /*#__PURE__*/_jsxDEV(\"p\", {\n        children: \"Server error. Perhaps simply try again a little later.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 781,\n        columnNumber: 9\n      }, this);\n    } else {\n      errorMessage = /*#__PURE__*/_jsxDEV(\"p\", {\n        children: \"The server basically failed to process the submission.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 785,\n        columnNumber: 9\n      }, this);\n    }\n  } else {\n    errorMessage = /*#__PURE__*/_jsxDEV(\"p\", {\n      children: /*#__PURE__*/_jsxDEV(\"code\", {\n        children: submissionError.toString()\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 791,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 790,\n      columnNumber: 7\n    }, this);\n  }\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"search-error\",\n    children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n      children: \"Sorry, an error occured\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 798,\n      columnNumber: 7\n    }, this), errorMessage]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 797,\n    columnNumber: 5\n  }, this);\n}\n\n_s3(ShowSubmissionError, \"rMCIp9YKXv3AWoeGZmj5VPfITQc=\");\n\n_c4 = ShowSubmissionError;\n\nvar ShowComments = /*#__PURE__*/function (_React$PureComponent2) {\n  _inherits(ShowComments, _React$PureComponent2);\n\n  var _super2 = _createSuper(ShowComments);\n\n  function ShowComments() {\n    _classCallCheck(this, ShowComments);\n\n    return _super2.apply(this, arguments);\n  }\n\n  _createClass(ShowComments, [{\n    key: \"render\",\n    value: function render() {\n      var _this$props4 = this.props,\n          comments = _this$props4.comments,\n          replyComment = _this$props4.replyComment,\n          editComment = _this$props4.editComment;\n      return /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [comments && comments[\"\"] && /*#__PURE__*/_jsxDEV(ShowCommentsRecursive, _objectSpread(_objectSpread({}, this.props), {}, {\n          allComments: comments,\n          comments: comments[\"\"]\n        }), void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 810,\n          columnNumber: 11\n        }, this), !replyComment && !editComment && /*#__PURE__*/_jsxDEV(CommentForm, _objectSpread({\n          replyingComment: false\n        }, this.props), void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 817,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true);\n    }\n  }]);\n\n  return ShowComments;\n}(React.PureComponent);\n\nvar ShowCommentsRecursive = /*#__PURE__*/function (_React$PureComponent3) {\n  _inherits(ShowCommentsRecursive, _React$PureComponent3);\n\n  var _super3 = _createSuper(ShowCommentsRecursive);\n\n  function ShowCommentsRecursive() {\n    var _this5;\n\n    _classCallCheck(this, ShowCommentsRecursive);\n\n    for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n      args[_key2] = arguments[_key2];\n    }\n\n    _this5 = _super3.call.apply(_super3, [this].concat(args));\n    _this5.state = {\n      confirmDelete: false\n    };\n    return _this5;\n  }\n\n  _createClass(ShowCommentsRecursive, [{\n    key: \"render\",\n    value: function render() {\n      var _this6 = this;\n\n      var confirmDelete = this.state.confirmDelete;\n      var _this$props5 = this.props,\n          replyComment = _this$props5.replyComment,\n          editComment = _this$props5.editComment,\n          setEditComment = _this$props5.setEditComment,\n          setReplyComment = _this$props5.setReplyComment,\n          comments = _this$props5.comments,\n          allComments = _this$props5.allComments,\n          submittedComments = _this$props5.submittedComments,\n          deleteCommentHandler = _this$props5.deleteCommentHandler,\n          highlightComment = _this$props5.highlightComment,\n          highlitComment = _this$props5.highlitComment,\n          commentSubmitted = _this$props5.commentSubmitted,\n          clearCommentSubmitted = _this$props5.clearCommentSubmitted,\n          commentEdited = _this$props5.commentEdited,\n          clearCommentEdited = _this$props5.clearCommentEdited,\n          csrfToken = _this$props5.csrfToken;\n      if (!comments.length) return null;\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"comments\",\n        children: comments.map(function (comment) {\n          // You're allowed to edit it if it was yours and it's not approved yet.\n          var canEdit = false;\n\n          if (comment.not_approved) {\n            // Take 'editComment' into account\n            if (submittedComments.filter(function (c) {\n              return c.id === comment.id;\n            }).length) {\n              canEdit = true;\n            }\n          }\n\n          var canReply = !canEdit && csrfToken;\n          var replies = allComments[comment.id];\n          var editingComment = !!(canEdit && editComment && editComment.id === comment.id);\n          var replyingComment = !!(canReply && replyComment && replyComment.id === comment.id);\n          return /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"comment\",\n            id: \"c\".concat(comment.id),\n            children: [commentSubmitted && commentSubmitted.id === comment.id && /*#__PURE__*/_jsxDEV(ShowCommentSubmitted, {\n              commentSubmitted: commentSubmitted,\n              clearCommentSubmitted: clearCommentSubmitted\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 880,\n              columnNumber: 17\n            }, _this6), commentEdited && commentEdited.id === comment.id && /*#__PURE__*/_jsxDEV(ShowCommentEdited, {\n              commentEdited: commentEdited,\n              clearCommentEdited: clearCommentEdited\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 887,\n              columnNumber: 17\n            }, _this6), canEdit && !(editComment && editComment.id === comment.id) && /*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"buttons\",\n              children: /*#__PURE__*/_jsxDEV(\"button\", {\n                type: \"button\",\n                className: \"btn btn-info btn-sm\",\n                onClick: function onClick(event) {\n                  event.preventDefault();\n                  setEditComment(comment);\n                },\n                children: \"Edit your comment\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 895,\n                columnNumber: 19\n              }, _this6)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 894,\n              columnNumber: 17\n            }, _this6), confirmDelete && editComment && editComment.id === comment.id && /*#__PURE__*/_jsxDEV(\"p\", {\n              style: {\n                margin: 20,\n                textAlign: \"center\"\n              },\n              children: [/*#__PURE__*/_jsxDEV(\"b\", {\n                children: \"Are you sure?\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 910,\n                columnNumber: 19\n              }, _this6), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 911,\n                columnNumber: 19\n              }, _this6), /*#__PURE__*/_jsxDEV(\"button\", {\n                type: \"button\",\n                className: \"btn btn-danger\",\n                onClick: function onClick(event) {\n                  event.preventDefault();\n                  deleteCommentHandler(comment);\n                },\n                children: \"Yes\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 912,\n                columnNumber: 19\n              }, _this6), \" \", /*#__PURE__*/_jsxDEV(\"button\", {\n                type: \"button\",\n                className: \"btn btn-info\",\n                onClick: function onClick(event) {\n                  event.preventDefault();\n\n                  _this6.setState({\n                    confirmDelete: false\n                  });\n                },\n                children: \"No\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 922,\n                columnNumber: 19\n              }, _this6)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 909,\n              columnNumber: 17\n            }, _this6), canEdit && editComment && editComment.id === comment.id && /*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"buttons\",\n              children: [!confirmDelete && /*#__PURE__*/_jsxDEV(\"button\", {\n                type: \"button\",\n                className: \"btn btn-warning btn-sm\",\n                onClick: function onClick(event) {\n                  event.preventDefault();\n\n                  _this6.setState({\n                    confirmDelete: true\n                  });\n                },\n                children: \"Remove your comment\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 938,\n                columnNumber: 21\n              }, _this6), \" \", /*#__PURE__*/_jsxDEV(\"button\", {\n                type: \"button\",\n                className: \"btn btn-info btn-sm\",\n                onClick: function onClick(event) {\n                  event.preventDefault();\n\n                  if (confirmDelete) {\n                    _this6.setState({\n                      confirmDelete: false\n                    }, function () {\n                      setEditComment(null);\n                    });\n                  } else {\n                    setEditComment(null);\n                  }\n                },\n                children: \"Close edit\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 949,\n                columnNumber: 19\n              }, _this6)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 936,\n              columnNumber: 17\n            }, _this6), editComment && editComment.id === comment.id ? /*#__PURE__*/_jsxDEV(CommentForm, _objectSpread({\n              focusOnMount: true,\n              editingComment: editingComment,\n              replyingComment: false\n            }, _this6.props), void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 969,\n              columnNumber: 17\n            }, _this6) : /*#__PURE__*/_jsxDEV(DisplayComment, {\n              highlightComment: highlightComment,\n              canReply: canReply,\n              replyingComment: replyingComment,\n              setReplyComment: setReplyComment,\n              comment: comment,\n              highlit: highlitComment && highlitComment === comment.id\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 976,\n              columnNumber: 17\n            }, _this6), replyComment && comment.id === replyComment.id && /*#__PURE__*/_jsxDEV(CommentForm, _objectSpread(_objectSpread({}, _this6.props), {}, {\n              replyingComment: replyingComment,\n              focusOnMount: true\n            }), void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 987,\n              columnNumber: 17\n            }, _this6), replies && /*#__PURE__*/_jsxDEV(ShowCommentsRecursive, _objectSpread(_objectSpread({}, _this6.props), {}, {\n              comments: replies\n            }), void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 994,\n              columnNumber: 17\n            }, _this6)]\n          }, comment.id, true, {\n            fileName: _jsxFileName,\n            lineNumber: 878,\n            columnNumber: 13\n          }, _this6);\n        })\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 851,\n        columnNumber: 7\n      }, this);\n    }\n  }]);\n\n  return ShowCommentsRecursive;\n}(React.PureComponent);\n\nvar CommentForm = /*#__PURE__*/function (_React$PureComponent4) {\n  _inherits(CommentForm, _React$PureComponent4);\n\n  var _super4 = _createSuper(CommentForm);\n\n  function CommentForm() {\n    var _this7;\n\n    _classCallCheck(this, CommentForm);\n\n    for (var _len3 = arguments.length, args = new Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {\n      args[_key3] = arguments[_key3];\n    }\n\n    _this7 = _super4.call.apply(_super4, [this].concat(args));\n    _this7.state = {\n      comment: _this7.props.editComment ? _this7.props.editComment.text : \"\",\n      name: \"\",\n      email: \"\",\n      showNameEmailInputs: true,\n      wasSearchedFor: false,\n      canSubmit: false,\n      warnAboutName: false\n    };\n    _this7.textareaRef = /*#__PURE__*/React.createRef();\n\n    _this7.clearComment = function () {\n      _this7.setState({\n        comment: \"\",\n        preview: false\n      });\n    };\n\n    _this7.submitHandler = function (event) {\n      event.preventDefault();\n      var _this7$state = _this7.state,\n          comment = _this7$state.comment,\n          name = _this7$state.name,\n          email = _this7$state.email,\n          warnAboutName = _this7$state.warnAboutName,\n          wasSearchedFor = _this7$state.wasSearchedFor;\n      var _this7$props = _this7.props,\n          submitCommentHandler = _this7$props.submitCommentHandler,\n          editComment = _this7$props.editComment,\n          replyComment = _this7$props.replyComment;\n\n      if (!comment.trim()) {\n        return;\n      }\n\n      try {\n        if (name && name.trim()) {\n          localStorage.setItem(\"commentName\", name.trim());\n        }\n\n        if (email && email.trim()) {\n          localStorage.setItem(\"commentEmail\", email.trim());\n        }\n      } catch (ex) {\n        console.warn(\"'localStorage.stItem(\\\"commentName\\\")' didn't work\");\n      }\n\n      if ((!name || !email) && !warnAboutName) {\n        _this7.setState({\n          warnAboutName: true\n        });\n      } else {\n        if (warnAboutName) {\n          _this7.setState({\n            warnAboutName: false\n          });\n        }\n\n        submitCommentHandler({\n          comment: comment,\n          email: email,\n          name: name,\n          wasSearchedFor: wasSearchedFor,\n          editComment: editComment,\n          replyComment: replyComment,\n          askedWasSearchedFor: _this7.askWasSearchedFor()\n        });\n      }\n    };\n\n    _this7.getTextareaRows = function (text) {\n      var minimum = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 4;\n      var maximum = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 16;\n      var linebreaks = (text.match(/\\n/g) || []).length;\n      return Math.min(maximum, Math.max(minimum, linebreaks + 2));\n    };\n\n    _this7.askWasSearchedFor = function () {\n      var _this7$props2 = _this7.props,\n          searchedId = _this7$props2.searchedId,\n          replyingComment = _this7$props2.replyingComment,\n          hasCommented = _this7$props2.hasCommented,\n          editingComment = _this7$props2.editingComment;\n      return !!(searchedId && !replyingComment && !editingComment && !hasCommented);\n    };\n\n    return _this7;\n  }\n\n  _createClass(CommentForm, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var update = {};\n      var _this$state4 = this.state,\n          canSubmit = _this$state4.canSubmit,\n          name = _this$state4.name,\n          email = _this$state4.email,\n          showNameEmailInputs = _this$state4.showNameEmailInputs;\n\n      try {\n        name = localStorage.getItem(\"commentName\") || \"\";\n        email = localStorage.getItem(\"commentEmail\") || \"\";\n      } catch (ex) {\n        console.warn(\"'localStorage.getItem(\\\"commentName\\\")' didn't work\");\n      }\n\n      if (name || email) {\n        update.name = name;\n        update.email = email;\n      }\n\n      if (!canSubmit && (name || email)) {\n        update.canSubmit = true;\n      }\n\n      if (name && email && showNameEmailInputs && !this.props.editComment) {\n        update.showNameEmailInputs = false;\n      }\n\n      if (Object.keys(update).length) {\n        this.setState(update);\n      }\n\n      if (this.props.focusOnMount) {\n        // Usually true when doing an edit\n        this.textareaRef.current.focus();\n      }\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      this.dismounted = true;\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps) {\n      if (prevProps.commentSubmitted !== this.props.commentSubmitted) {\n        this.setState({\n          comment: \"\"\n        });\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this8 = this;\n\n      var _this$state5 = this.state,\n          comment = _this$state5.comment,\n          name = _this$state5.name,\n          email = _this$state5.email,\n          warnAboutName = _this$state5.warnAboutName,\n          showNameEmailInputs = _this$state5.showNameEmailInputs;\n      var _this$props6 = this.props,\n          editComment = _this$props6.editComment,\n          savingComment = _this$props6.savingComment,\n          submissionError = _this$props6.submissionError,\n          editingComment = _this$props6.editingComment,\n          csrfToken = _this$props6.csrfToken;\n\n      if (!csrfToken) {\n        if (isServer) {\n          return /*#__PURE__*/_jsxDEV(\"i\", {\n            children: \"Must have JavaScript enabled to comment.\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1133,\n            columnNumber: 16\n          }, this);\n        } else {\n          return null;\n        }\n      }\n\n      return /*#__PURE__*/_jsxDEV(\"form\", {\n        onSubmit: this.submitHandler,\n        children: [/*#__PURE__*/_jsxDEV(ShowSubmissionError, {\n          submissionError: submissionError\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1141,\n          columnNumber: 9\n        }, this), editingComment && /*#__PURE__*/_jsxDEV(\"i\", {\n          children: [\"You can edit \", /*#__PURE__*/_jsxDEV(\"b\", {\n            children: \"your\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1145,\n            columnNumber: 26\n          }, this), \" recently added, but not yet approved comments.\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1144,\n          columnNumber: 11\n        }, this), savingComment && /*#__PURE__*/_jsxDEV(ShowSavingStatus, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1150,\n          columnNumber: 27\n        }, this), this.askWasSearchedFor() && /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            textAlign: \"center\",\n            marginBottom: 20\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n            children: \"Was this the song you were looking for?\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1154,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n            className: \"radio-inline\",\n            children: [/*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"radio\",\n              name: \"wasSearchedFor\",\n              value: \"yes\",\n              disabled: savingComment,\n              onChange: function onChange(e) {\n                _this8.setState({\n                  wasSearchedFor: true\n                }, function () {\n                  if (_this8.textareaRef.current) {\n                    _this8.textareaRef.current.focus();\n                  }\n                });\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1157,\n              columnNumber: 15\n            }, this), \" \", \"Yes!\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1156,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n            className: \"radio-inline\",\n            children: [/*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"radio\",\n              name: \"wasSearchedFor\",\n              id: \"inlineRadio2\",\n              value: \"no\",\n              disabled: savingComment,\n              onChange: function onChange(e) {\n                _this8.setState({\n                  wasSearchedFor: false\n                }, function () {\n                  if (_this8.textareaRef.current) {\n                    _this8.textareaRef.current.focus();\n                  }\n                });\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1173,\n              columnNumber: 15\n            }, this), \" \", \"No :(\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1172,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1153,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"form-group\",\n          children: /*#__PURE__*/_jsxDEV(\"textarea\", {\n            className: \"form-control\",\n            rows: this.getTextareaRows(this.state.comment),\n            ref: this.textareaRef,\n            value: comment,\n            disabled: savingComment,\n            onChange: function onChange(e) {\n              return _this8.setState({\n                comment: e.target.value\n              });\n            },\n            onBlur: function onBlur(event) {\n              if (_this8.state.comment.trim()) {\n                setTimeout(function () {\n                  if (!_this8.dismounted) {\n                    if (!_this8.state.canSubmit) {\n                      _this8.setState({\n                        canSubmit: true\n                      });\n                    }\n                  }\n                }, 100);\n              }\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1192,\n            columnNumber: 11\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1191,\n          columnNumber: 9\n        }, this), showNameEmailInputs && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"form-inlinexxx\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"form-group\",\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              htmlFor: \"_name\",\n              className: \"sr-only\",\n              children: \"Your name\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1215,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"text\",\n              className: \"form-control\",\n              id: \"_name\",\n              placeholder: \"Your name...\",\n              disabled: savingComment,\n              value: name,\n              onChange: function onChange(e) {\n                return _this8.setState({\n                  name: e.target.value\n                });\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1218,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1214,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"form-group\",\n            style: {\n              marginBottom: 3\n            },\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              htmlFor: \"_email\",\n              className: \"sr-only\",\n              children: \"Email address\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1230,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"email\",\n              className: \"form-control\",\n              id: \"_email\",\n              placeholder: \"Your email address...\",\n              disabled: savingComment,\n              value: email,\n              onChange: function onChange(e) {\n                return _this8.setState({\n                  email: e.target.value\n                });\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1233,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1229,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: /*#__PURE__*/_jsxDEV(\"small\", {\n              children: [\"Your email will \", /*#__PURE__*/_jsxDEV(\"b\", {\n                children: \"never be published\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1245,\n                columnNumber: 33\n              }, this), \" and\", \" \", /*#__PURE__*/_jsxDEV(\"b\", {\n                children: \"never be shared\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1246,\n                columnNumber: 17\n              }, this), \". Useful to receive reply comments.\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1244,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1243,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1213,\n          columnNumber: 11\n        }, this), warnAboutName && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"alert-comment alert alert-warning alert-dismissible\",\n          role: \"alert\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"button\",\n            className: \"close\",\n            \"data-dismiss\": \"alert\",\n            \"aria-label\": \"Close\",\n            onClick: function onClick(event) {\n              _this8.setState({\n                warnAboutName: false\n              });\n            },\n            children: /*#__PURE__*/_jsxDEV(\"span\", {\n              \"aria-hidden\": \"true\",\n              children: \"\\xD7\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1265,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1256,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: name ? /*#__PURE__*/_jsxDEV(\"b\", {\n              children: \"Please enter your email\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1269,\n              columnNumber: 17\n            }, this) : /*#__PURE__*/_jsxDEV(\"b\", {\n              children: \"Please enter your name\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1271,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1267,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: [\"A real name and email helps the comment be approved.\", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1276,\n              columnNumber: 15\n            }, this), \"An email address makes it possible to receive notification on replies to your comment.\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1274,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1252,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"row\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"col-md-8\",\n            children: name && email && !showNameEmailInputs && /*#__PURE__*/_jsxDEV(_Fragment, {\n              children: [/*#__PURE__*/_jsxDEV(\"p\", {\n                children: [\"Commenting as \", /*#__PURE__*/_jsxDEV(\"b\", {\n                  children: name\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1287,\n                  columnNumber: 33\n                }, this), \". Replies sent to \", /*#__PURE__*/_jsxDEV(\"b\", {\n                  children: email\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1287,\n                  columnNumber: 64\n                }, this), \".\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1286,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                children: /*#__PURE__*/_jsxDEV(\"button\", {\n                  type: \"button\",\n                  className: \"btn btn-info btn-sm\",\n                  onClick: function onClick(event) {\n                    event.preventDefault();\n\n                    _this8.setState({\n                      showNameEmailInputs: true\n                    });\n                  },\n                  children: \"Change name\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1290,\n                  columnNumber: 19\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1289,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1283,\n            columnNumber: 11\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"col-md-4\",\n            style: {\n              textAlign: \"right\"\n            },\n            children: /*#__PURE__*/_jsxDEV(\"button\", {\n              type: \"submit\",\n              className: \"btn btn-primary\",\n              disabled: !comment.trim() || savingComment,\n              children: editComment ? \"Save Changes\" : \"Post Comment\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1306,\n              columnNumber: 13\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1305,\n            columnNumber: 11\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1282,\n          columnNumber: 9\n        }, this), !this.state.wasSearchedFor && /*#__PURE__*/_jsxDEV(\"p\", {\n          style: {\n            margin: \"20px 0\"\n          },\n          children: /*#__PURE__*/_jsxDEV(\"small\", {\n            children: [\"Can't find the song you're looking for?\", \" \", /*#__PURE__*/_jsxDEV(\"a\", {\n              href: \"https://www.peterbe.com/plog/blogitem-040601-1\",\n              children: [\"Try posting on \", /*#__PURE__*/_jsxDEV(\"b\", {\n                children: \"Find song by lyrics\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1321,\n                columnNumber: 32\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1320,\n              columnNumber: 15\n            }, this), \".\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1318,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1317,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1140,\n        columnNumber: 7\n      }, this);\n    }\n  }]);\n\n  return CommentForm;\n}(React.PureComponent);\n\nfunction ShowSavingStatus() {\n  return /*#__PURE__*/_jsxDEV(\"p\", {\n    children: /*#__PURE__*/_jsxDEV(\"i\", {\n      children: \"Please wait....\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1335,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 1334,\n    columnNumber: 5\n  }, this);\n}\n\n_c5 = ShowSavingStatus;\n\nvar DisplayComment = /*#__PURE__*/function (_React$PureComponent5) {\n  _inherits(DisplayComment, _React$PureComponent5);\n\n  var _super5 = _createSuper(DisplayComment);\n\n  function DisplayComment() {\n    _classCallCheck(this, DisplayComment);\n\n    return _super5.apply(this, arguments);\n  }\n\n  _createClass(DisplayComment, [{\n    key: \"render\",\n    value: function render() {\n      var _this$props7 = this.props,\n          highlit = _this$props7.highlit,\n          highlightComment = _this$props7.highlightComment,\n          canReply = _this$props7.canReply,\n          replyingComment = _this$props7.replyingComment,\n          setReplyComment = _this$props7.setReplyComment,\n          comment = _this$props7.comment;\n      var id = comment.id,\n          name = comment.name,\n          created = comment.created;\n      var notApproved = comment.not_approved;\n      var text = comment.text_rendered;\n\n      function getRandomCelebration() {\n        var emojis = [\"🎉\", \"🎊\", \"🥳\", \"✨\", \"👍🏼\", \"🥰\", \"😍\", \"🍾\"];\n        var emoji = emojis[Math.floor(Math.random() * emojis.length)];\n        return /*#__PURE__*/_jsxDEV(\"span\", {\n          role: \"img\",\n          \"aria-label\": \"muted\",\n          children: emoji\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1358,\n          columnNumber: 9\n        }, this);\n      }\n\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        className: highlit ? \"display highlit\" : \"display\",\n        children: [canReply && /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"buttons\",\n          children: /*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"button\",\n            className: replyingComment ? \"btn btn-warning btn-sm\" : \"btn btn-info btn-sm\",\n            onClick: function onClick(event) {\n              event.preventDefault();\n              setReplyComment(comment);\n            },\n            children: replyingComment ? \"Close\" : \"Reply\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1368,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1367,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"h5\", {\n          children: [\"By \", /*#__PURE__*/_jsxDEV(\"b\", {\n            children: name ? name : /*#__PURE__*/_jsxDEV(\"i\", {\n              children: \"Anonymous\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1385,\n              columnNumber: 32\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1385,\n            columnNumber: 14\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1384,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"meta\",\n          children: [/*#__PURE__*/_jsxDEV(\"a\", {\n            href: \"#c\".concat(id),\n            title: created,\n            onClick: function onClick(event) {\n              highlightComment(id);\n            },\n            children: [\"Posted \", /*#__PURE__*/_jsxDEV(CustomTimeAgo, {\n              date: created,\n              title: created\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1395,\n              columnNumber: 20\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1388,\n            columnNumber: 11\n          }, this), notApproved && /*#__PURE__*/_jsxDEV(\"small\", {\n            children: \"Not yet approved!\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1397,\n            columnNumber: 27\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1387,\n          columnNumber: 9\n        }, this), comment.hasOwnProperty(\"was_searched_for\") && /*#__PURE__*/_jsxDEV(\"p\", {\n          children: [/*#__PURE__*/_jsxDEV(\"i\", {\n            children: \"Was it the song you were looking for?\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1401,\n            columnNumber: 13\n          }, this), \" \", /*#__PURE__*/_jsxDEV(\"b\", {\n            children: comment.was_searched_for ? \"Yes\" : \"No\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1402,\n            columnNumber: 13\n          }, this), \" \", comment.was_searched_for && getRandomCelebration()]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1400,\n          columnNumber: 11\n        }, this), typeof text === \"string\" ? /*#__PURE__*/_jsxDEV(\"blockquote\", {\n          dangerouslySetInnerHTML: {\n            __html: text\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1408,\n          columnNumber: 11\n        }, this) : /*#__PURE__*/_jsxDEV(\"blockquote\", {\n          children: text\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1410,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1365,\n        columnNumber: 7\n      }, this);\n    }\n  }]);\n\n  return DisplayComment;\n}(React.PureComponent);\n\nvar _c, _c2, _c3, _c4, _c5;\n\n$RefreshReg$(_c, \"ShowCommentSubmitted\");\n$RefreshReg$(_c2, \"ShowCommentEdited\");\n$RefreshReg$(_c3, \"ShowCommentDeleted\");\n$RefreshReg$(_c4, \"ShowSubmissionError\");\n$RefreshReg$(_c5, \"ShowSavingStatus\");","map":{"version":3,"sources":["/home/mandeep/Downloads/Song-sorch work/site/src/Comments.js"],"names":["React","useEffect","useState","cachedFetch","CustomTimeAgo","isServer","Helmet","SUBMITTED_COMMENTS_STORAGE_KEY","SongComments","state","loadingComments","savingComment","serverError","submissionError","comments","props","commentsCount","submittedComments","commentSubmitted","commentEdited","commentDeleted","searchedId","replyComment","editComment","csrfToken","highlightComment","highlitComment","hasCommented","loadCSRFToken","url","fetch","then","r","dismounted","ok","json","result","setState","csrf_token","catch","error","loadComments","song","search","submittedCommentIds","id","length","filter","submission","map","forEach","includes","fetchFunc","comments_count","consolidateSubmittedComments","recurse","comment","not_approved","submittedComment","removeSubmittedComments","push","newSubmittedComments","sessionStorage","setItem","JSON","stringify","ex","console","warn","removeItem","window","setTimeout","submitCommentHandler","data","_submitCommentHandler","Error","formData","FormData","append","name","email","oid","askedWasSearchedFor","wasSearchedFor","parent","experiment","method","body","response","localStorage","submitted","document","querySelectorAll","querySelector","scrollIntoView","behavior","slice","o","toPush","deleteCommentHandler","_deleteCommentHandler","filteredSubmittedComments","setEditComment","setReplyComment","clearCommentSubmitted","clearCommentEdited","clearCommentDeleted","submittedCommentStorage","getItem","parse","some","location","hash","re","match","parseInt","element","prevProps","App","script","createElement","src","async","integrity","crossOrigin","appendChild","removeChild","Vdtag","artist","PureComponent","ShowCommentSubmitted","event","ShowCommentEdited","ShowCommentDeleted","ShowSubmissionError","validationErrors","setValidationErrors","isErrorResponse","Response","err","log","status","errors","errorMessage","Object","keys","key","message","code","toString","ShowComments","ShowCommentsRecursive","confirmDelete","allComments","canEdit","c","canReply","replies","editingComment","replyingComment","preventDefault","margin","textAlign","CommentForm","text","showNameEmailInputs","canSubmit","warnAboutName","textareaRef","createRef","clearComment","preview","submitHandler","trim","askWasSearchedFor","getTextareaRows","minimum","maximum","linebreaks","Math","min","max","update","focusOnMount","current","focus","marginBottom","e","target","value","ShowSavingStatus","DisplayComment","highlit","created","notApproved","text_rendered","getRandomCelebration","emojis","emoji","floor","random","hasOwnProperty","was_searched_for","__html"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport { cachedFetch } from \"./Cache\";\nimport { CustomTimeAgo, isServer } from \"./Common\";\nimport \"./Comments.css\";\nimport { Helmet } from \"react-helmet\";  \n\n\nconst SUBMITTED_COMMENTS_STORAGE_KEY = \"submittedComments\";\n\nexport class SongComments extends React.PureComponent {\n  state = {\n    loadingComments: false,\n    savingComment: false,\n    serverError: null,\n    submissionError: null,\n    comments: this.props.comments || null,\n    commentsCount: this.props.commentsCount || null,\n    submittedComments: [],\n    commentSubmitted: null,\n    commentEdited: null,\n    commentDeleted: null,\n    searchedId: this.props.searchedId,\n    replyComment: null,\n    editComment: null,\n    csrfToken: null,\n    highlightComment: null,\n    highlitComment: null,\n    hasCommented: false\n  };\n\n  componentDidMount() {\n    // If you're here, you're a browser and no a server rendering.\n    let submittedCommentStorage = \"[]\";\n    try {\n      submittedCommentStorage =\n        sessionStorage.getItem(SUBMITTED_COMMENTS_STORAGE_KEY) || \"[]\";\n    } catch (ex) {\n      console.warn(\n        \"'sessionStorage.getItem(SUBMITTED_COMMENTS_STORAGE_KEY)' didn't work\"\n      );\n    }\n    const submittedComments = JSON.parse(submittedCommentStorage);\n    if (submittedComments.length) {\n      // Definitely load comments. Even if you arrived here with the comments\n      // already server-side rendered.\n      // Because, this call to loadingComments might be potentially different.\n\n      // If you have commented on this song before, update that in state.\n      let hasCommented = false;\n      const { song } = this.props;\n      if (song) {\n        hasCommented = submittedComments.some(\n          (comment) => comment.song && comment.song === song.id\n        );\n      }\n\n      this.setState(\n        {\n          submittedComments,\n          hasCommented,\n          loadingComments: !this.state.comments\n        },\n        this.loadComments\n      );\n    } else {\n      // If the comments were already loaded, we only need the csrfToken.\n      if (!this.state.comments) {\n        this.setState({ loadingComments: true }, this.loadComments);\n      } else {\n        // We just need a new csrfToken\n        this.loadCSRFToken();\n      }\n    }\n\n    if (window.location.hash) {\n      const re = /c(\\d+)$/;\n      if (window.location.hash.match(re)) {\n        const id = parseInt(window.location.hash.match(re)[1], 10);\n        this.setState({ highlitComment: id }, () => {\n          window.setTimeout(() => {\n            if (!this.dismounted) {\n              const element = document.querySelector(\n                `#c${this.state.highlitComment}`\n              );\n              if (element && element.scrollIntoView) {\n                element.scrollIntoView({\n                  behavior: \"smooth\"\n                });\n              }\n            }\n          }, 1000);\n\n          window.setTimeout(() => {\n            if (!this.dismounted && this.state.highlitComment === id) {\n              this.setState({ highlitComment: null });\n            }\n          }, 10 * 1000);\n        });\n      }\n    }\n  }\n\n  componentDidUpdate(prevProps) {\n    if (prevProps.song !== this.props.song) {\n      this.setState(\n        { loadingComments: true, comments: null, commentsCount: null },\n        this.loadComments\n      );\n    }\n  }\n\n  componentWillUnmount() {\n    this.dismounted = true;\n  }\n\n  loadCSRFToken = () => {\n    let url = \"/api/comments?csrftoken=1\";\n    fetch(url)\n      .then((r) => {\n        if (this.dismounted) return;\n        if (r.ok) {\n          return r.json().then((result) => {\n            this.setState({\n              csrfToken: result.csrf_token\n            });\n          });\n        } else {\n          this.setState({ serverError: r });\n        }\n      })\n      .catch((error) => {\n        if (this.dismounted) return;\n        this.setState({ serverError: error });\n      });\n  };\n\n  loadComments = () => {\n    const { song, search } = this.props;\n    const { submittedComments, commentEdited } = this.state;\n    let submittedCommentIds = [];\n    let url = \"/api/comments\";\n    if (song) {\n      url += `?song=${song.id}`;\n    } else if (search) {\n      url += `?search=${search.id}`;\n    } else {\n      // throw new Error(\"Don't know how to do this outside of song\");\n    }\n\n    if (submittedComments.length) {\n      submittedCommentIds = submittedComments\n        .filter((submission) => {\n          if (song) {\n            return submission.song === song.id;\n          } else if (search) {\n            return submission.search === search.id;\n          } else {\n            return !submission.song && !submission.search;\n          }\n        })\n        .map((submission) => submission.id);\n    }\n\n    submittedCommentIds.forEach((id) => {\n      url += url.includes(\"?\") ? \"&\" : \"?\";\n      url += `submitted=${id}`;\n    });\n\n    if (commentEdited) {\n      // Just to extra-bust the cache\n      url += url.includes(\"?\") ? \"&\" : \"?\";\n      url += `edited=${commentEdited.id}`;\n    }\n\n    let fetchFunc;\n    if (commentEdited && submittedCommentIds.length) {\n      // Don't use the caching one\n      fetchFunc = fetch;\n    } else {\n      fetchFunc = cachedFetch;\n    }\n\n    fetchFunc(url)\n      .then((r) => {\n        if (this.dismounted) return;\n        this.setState({ loadingComments: false });\n        if (r.ok) {\n          return r.json().then((result) => {\n            this.setState(\n              {\n                csrfToken: result.csrf_token,\n                comments: result.comments,\n                commentsCount: result.comments_count,\n                loadingComments: false\n              },\n              this.consolidateSubmittedComments\n            );\n          });\n        } else {\n          this.setState({ serverError: r, loadingComments: false });\n        }\n      })\n      .catch((error) => {\n        if (this.dismounted) return;\n        this.setState({ serverError: error, loadingComments: false });\n      });\n  };\n\n  consolidateSubmittedComments = () => {\n    const { comments } = this.state;\n    let { submittedComments } = this.state;\n    if (submittedComments.length && comments[\"\"] && comments[\"\"].length) {\n      // If any of your submitted comments is now approved, we need to remove\n      // it from sessionStorage.\n      const removeSubmittedComments = [];\n      function recurse(comments) {\n        comments.forEach((comment) => {\n          if (!comment.not_approved) {\n            // Add to removeSubmittedComments only if this is one of the ones\n            // you submitted.\n            submittedComments.forEach((submittedComment) => {\n              if (submittedComment.id === comment.id) {\n                removeSubmittedComments.push(submittedComment.id);\n              }\n            });\n          }\n          if (comments[comment.id]) {\n            recurse(comments[comment.id]);\n          }\n        });\n      }\n      recurse(comments[\"\"]);\n\n      if (removeSubmittedComments.length) {\n        const newSubmittedComments = submittedComments.filter(\n          (submittedComment) => {\n            return !removeSubmittedComments.includes(submittedComment.id);\n          }\n        );\n        this.setState({ submittedComments: newSubmittedComments }, () => {\n          if (this.state.submittedComments.length) {\n            // Update\n            try {\n              sessionStorage.setItem(\n                SUBMITTED_COMMENTS_STORAGE_KEY,\n                JSON.stringify(this.state.submittedComments)\n              );\n            } catch (ex) {\n              console.warn(\n                \"'sessionStorage.setItem(SUBMITTED_COMMENTS_STORAGE_KEY)' did't work\"\n              );\n            }\n          } else {\n            // Reset\n            try {\n              sessionStorage.removeItem(SUBMITTED_COMMENTS_STORAGE_KEY);\n            } catch (ex) {}\n          }\n        });\n      }\n    }\n  };\n\n  highlightComment = (id) => {\n    let { highlitComment } = this.state;\n    if (highlitComment && highlitComment === id) {\n      highlitComment = null;\n    } else {\n      highlitComment = id;\n    }\n    this.setState({ highlitComment }, () => {\n      window.setTimeout(() => {\n        if (!this.dismounted && this.state.highlitComment === id) {\n          this.setState({ highlitComment: null });\n        }\n      }, 10 * 1000);\n    });\n  };\n\n  submitCommentHandler = (data) => {\n    this.setState({ savingComment: true }, () => {\n      this._submitCommentHandler(data).then(() => {\n        this.setState({ savingComment: false });\n      });\n    });\n  };\n  _submitCommentHandler = async (data) => {\n    let response;\n    const { song, search } = this.props;\n    const { submittedComments, csrfToken } = this.state;\n    if (!csrfToken) {\n      throw new Error(\"No csrfToken prepared\");\n    }\n    const formData = new FormData();\n    formData.append(\"csrfmiddlewaretoken\", csrfToken);\n    formData.append(\"text\", data.comment);\n    formData.append(\"name\", data.name);\n    formData.append(\"email\", data.email);\n\n    if (submittedComments.length) {\n      submittedComments\n        .filter((submission) => {\n          if (song) {\n            return submission.song === song.id;\n          } else if (search) {\n            return submission.search === search.id;\n          } else {\n            return !submission.song && !submission.search;\n          }\n        })\n        .forEach((submission) => {\n          formData.append(\"submitted\", submission.id);\n        });\n    }\n\n    if (data.editComment) {\n      formData.append(\"id\", data.editComment.id);\n      if (!data.editComment.oid) {\n        throw new Error(\"Can't edit if you don't have the oid\");\n      }\n      formData.append(\"oid\", data.editComment.oid);\n    }\n    if (data.replyComment) {\n      formData.append(\"parent\", data.replyComment.id);\n    }\n    if (data.askedWasSearchedFor) {\n      formData.append(\"was_searched_for\", data.wasSearchedFor || false);\n    }\n    if (this.state.searchedId) {\n      formData.append(\"search\", this.state.searchedId || null);\n    }\n    if (data.parent) {\n      formData.append(\"parent\", data.parent || null);\n    }\n    formData.append(\"experiment\", data.experiment || {});\n\n    if (song) {\n      formData.append(\"song\", song.id);\n    } else if (search) {\n      formData.append(\"search\", search.id);\n    } else {\n      // throw new Error(\"Don't know how to do this outside of song\");\n    }\n\n    try {\n      response = await fetch(\"/api/comments\", {\n        method: \"POST\",\n        body: formData\n      });\n      if (response.ok) {\n        // If posted a comment because this *was* the song you\n        // searched for, let's kill that not to stop asking that question.\n        if (this.state.searchedId) {\n          try {\n            localStorage.removeItem(\"searched\");\n          } catch (ex) {\n            console.warn(\"'localStorage.removeItem(\\\"searched\\\")' didn't work\");\n          }\n        }\n\n        const result = await response.json();\n\n        if (data.editComment) {\n          return this.setState({\n            searchedId: null,\n            commentEdited: result.submitted,\n            submissionError: null,\n            commentSubmitted: null,\n            editComment: null,\n            replyComment: null,\n            comments: result.comments,\n            commentsCount: result.comments_count\n          });\n        } else {\n          return this.setState(\n            {\n              searchedId: null,\n              submissionError: null,\n              commentEdited: null,\n              commentSubmitted: result.submitted,\n              commentDeleted: null,\n              replyComment: null,\n              comments: result.comments,\n              commentsCount: result.comments_count\n            },\n            () => {\n              // Only do this if there is only exactly 1 of these in the DOM.\n              // The reason why is that when repeatedly injecting the <SongComments>\n              // components in multiple places, you might have different ones\n              // for different expanded songs.\n              if (document.querySelectorAll(\".alert-comment\").length === 1) {\n                document\n                  .querySelector(\".alert-comment.alert-success\")\n                  .scrollIntoView({ behavior: \"smooth\" });\n              }\n\n              const { commentSubmitted } = this.state;\n              const { song, search } = this.props;\n\n              this.highlightComment(commentSubmitted.id);\n\n              const submittedComments = this.state.submittedComments.slice(0);\n              // If you accidentally double-clicked to submit twice.\n              // Or, just wrote the exact same comment twice, the server\n              // won't create another record but it will respond as if it worked\n              // so we need to check first that we don't already have\n              // this 'commentSubmitted.id` already.\n              if (\n                !submittedComments\n                  .map((o) => o.id)\n                  .filter((id) => id === commentSubmitted.id).length\n              ) {\n                const toPush = {\n                  id: commentSubmitted.id,\n                  oid: commentSubmitted.oid\n                };\n                if (song) {\n                  toPush.song = song.id;\n                } else if (search) {\n                  toPush.search = search.id;\n                }\n                submittedComments.push(toPush);\n              }\n              this.setState(\n                { submittedComments, submissionError: null },\n                () => {\n                  this.loadComments();\n                  try {\n                    sessionStorage.setItem(\n                      SUBMITTED_COMMENTS_STORAGE_KEY,\n                      JSON.stringify(this.state.submittedComments)\n                    );\n                  } catch (ex) {}\n                }\n              );\n            }\n          );\n        }\n      } else {\n        return this.setState({ submissionError: response });\n      }\n    } catch (error) {\n      console.warn(\"Submission failed:\", error);\n      return this.setState({ submissionError: error });\n    }\n  };\n\n  deleteCommentHandler = (comment) => {\n    this.setState({ savingComment: true }, () => {\n      this._deleteCommentHandler(comment).then(() => {\n        this.setState({ savingComment: false });\n      });\n    });\n  };\n\n  _deleteCommentHandler = async (comment) => {\n    let response;\n    const formData = new FormData();\n    if (!comment.oid) {\n      throw new Error(\"Can't edit if you don't have the oid\");\n    }\n    formData.append(\"id\", comment.id);\n    formData.append(\"oid\", comment.oid);\n    const url = \"/api/comments/delete\";\n    try {\n      response = await fetch(url, {\n        method: \"POST\",\n        body: formData\n      });\n    } catch (ex) {\n      return this.setState({ submissionError: ex });\n    }\n    if (!response.ok) {\n      return this.setState({ submissionError: response });\n    }\n    return this.setState(\n      {\n        commentDeleted: comment,\n        commentEdited: null,\n        editComment: null,\n        submissionError: null\n      },\n      () => {\n        // Before we load comments, remove this one from localStorage\n        const submittedComments = this.state.submittedComments;\n        const filteredSubmittedComments = submittedComments.filter(\n          (submission) => submission.id !== comment.id\n        );\n        this.setState({ submittedComments: filteredSubmittedComments }, () => {\n          this.loadComments();\n          try {\n            sessionStorage.setItem(\n              SUBMITTED_COMMENTS_STORAGE_KEY,\n              JSON.stringify(this.state.submittedComments)\n            );\n          } catch (ex) {}\n        });\n      }\n    );\n  };\n\n  setEditComment = (comment) => {\n    this.setState({ editComment: comment });\n  };\n\n  setReplyComment = (comment) => {\n    if (this.state.replyComment && this.state.replyComment.id === comment.id) {\n      this.setState({\n        replyComment: null,\n        highlitComment: null,\n        commentEdited: null\n      });\n    } else {\n      this.setState({\n        replyComment: comment,\n        highlitComment: comment.id,\n        commentEdited: null\n      });\n    }\n  };\n\n  clearCommentSubmitted = () => {\n    this.setState({ commentSubmitted: null });\n  };\n\n  clearCommentEdited = () => {\n    this.setState({ commentEdited: null });\n  };\n\n  clearCommentDeleted = () => {\n    this.setState({ commentDeleted: null });\n  };\n\n  render() {\n    const { song } = this.props;\n    const {\n      comments,\n      commentsCount,\n      submissionError,\n      commentSubmitted,\n      commentEdited,\n      commentDeleted,\n      submittedComments,\n      searchedId,\n      editComment,\n      replyComment,\n      savingComment,\n      highlitComment,\n      hasCommented,\n      csrfToken\n    } = this.state;\n\n    function App() {\n      useEffect(() => {\n        const script = document.createElement(\"script\")\n    \n        script.src =\n          \"https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js\"\n    \n        script.async = true\n    \n        script.integrity =\n          \"sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p\"\n    \n        script.crossOrigin = \"anonymous\"\n    \n        document.body.appendChild(script)\n    \n        return () => {\n          // clean up the script when the component in unmounted\n          document.body.removeChild(script)\n        }\n      }, [])\n    \n      return <div className=\"App\"></div>\n    }\n\n    const Vdtag = () =>{\n      useEffect(() => {\n        const script = document.createElement(\"script\");\n        script.src = \"https://live.primis.tech/live/liveView.php?s=113482s\";\n        script.async = true;\n        document.body.appendChild(script);\n        return () => {\n          // clean up the script when the component in unmounted\n          document.body.removeChild(script)\n        }\n      }, [])\n    \n      return (\n        <>\n        \n         <div className=\"vdtag_divs\">\n         <Helmet>\n          <script type=\"text/javascript\" language=\"javascript\" src=\"https://live.primis.tech/live/liveView.php?s=113482\"></script>\n          </Helmet>\n          </div>\n          \n        </>\n      );\n    };\n\n    return (\n      \n      <div className=\"comments masters song-comments\">\n             <div className=\"application\">\n                <Vdtag /> \n             </div> \n             \n        <h3>\n          Song Comments {commentsCount ? <span>({commentsCount})</span> : null}\n          <br />\n          <small>\n            On <b>{song.name}</b> <span className=\"by\">by</span>{\" \"}\n            {song.artist.name}\n          </small>\n        </h3>\n\n        <ShowCommentDeleted\n          commentDeleted={commentDeleted}\n          clearCommentDeleted={this.clearCommentDeleted}\n        />\n\n        <ShowComments\n          {...this.props}\n          submissionError={submissionError}\n          comments={comments}\n          editComment={editComment}\n          replyComment={replyComment}\n          searchedId={searchedId}\n          setEditComment={this.setEditComment}\n          setReplyComment={this.setReplyComment}\n          submitCommentHandler={this.submitCommentHandler}\n          deleteCommentHandler={this.deleteCommentHandler}\n          commentSubmitted={commentSubmitted}\n          commentEdited={commentEdited}\n          submittedComments={submittedComments}\n          savingComment={savingComment}\n          highlitComment={highlitComment}\n          highlightComment={this.highlightComment}\n          clearCommentSubmitted={this.clearCommentSubmitted}\n          clearCommentEdited={this.clearCommentEdited}\n          csrfToken={csrfToken}\n          hasCommented={hasCommented}\n        />\n      </div>\n    );\n  }\n}\n\nfunction ShowCommentSubmitted({ commentSubmitted, clearCommentSubmitted }) {\n  if (!commentSubmitted) return null;\n  return (\n    <div\n      className=\"alert-comment alert-comment alert alert-success alert-dismissible\"\n      role=\"alert\"\n    >\n      <button\n        type=\"button\"\n        className=\"close\"\n        data-dismiss=\"alert\"\n        aria-label=\"Close\"\n        onClick={(event) => {\n          clearCommentSubmitted();\n        }}\n      >\n        <span aria-hidden=\"true\">&times;</span>\n      </button>\n      <p>\n        <b>Comment submitted. Thank you!</b>\n      </p>\n      <p>It needs to be moderated before publishing.</p>\n    </div>\n  );\n}\n\nfunction ShowCommentEdited({ commentEdited, clearCommentEdited }) {\n  if (!commentEdited) return null;\n  return (\n    <div\n      className=\"alert-comment alert alert-success alert-dismissible\"\n      role=\"alert\"\n    >\n      <button\n        type=\"button\"\n        className=\"close\"\n        data-dismiss=\"alert\"\n        aria-label=\"Close\"\n        onClick={(event) => {\n          clearCommentEdited();\n        }}\n      >\n        <span aria-hidden=\"true\">&times;</span>\n      </button>\n      <p>\n        <b>Comment edited.</b>\n      </p>\n      <p>You can keep editing it until it gets approved.</p>\n    </div>\n  );\n}\n\nfunction ShowCommentDeleted({ commentDeleted, clearCommentDeleted }) {\n  if (!commentDeleted) return null;\n  return (\n    <div\n      className=\"alert-comment alert alert-success alert-dismissible\"\n      role=\"alert\"\n    >\n      <button\n        type=\"button\"\n        className=\"close\"\n        data-dismiss=\"alert\"\n        aria-label=\"Close\"\n        onClick={(event) => {\n          clearCommentDeleted();\n        }}\n      >\n        <span aria-hidden=\"true\">&times;</span>\n      </button>\n      <p>\n        <b>Comment removed.</b>\n      </p>\n      <p>Feel free to write a new comment.</p>\n    </div>\n  );\n}\n\nfunction ShowSubmissionError({ submissionError }) {\n  const [validationErrors, setValidationErrors] = useState({});\n\n  let isErrorResponse = false;\n  if (!isServer) {\n    try {\n      isErrorResponse = submissionError instanceof window.Response;\n    } catch (err) {\n      // Old browsers. E.g. Firefox 38.\n      console.log(\"instanceof window.Response did not work:\", err);\n    }\n  }\n\n  useEffect(() => {\n    if (!isServer && isErrorResponse && submissionError.status === 400) {\n      submissionError.json().then((data) => {\n        setValidationErrors(data.errors);\n      });\n    }\n  }, [submissionError, isErrorResponse]);\n\n  if (!submissionError) return null;\n\n  let errorMessage;\n  if (!isServer && isErrorResponse) {\n    if (submissionError.status === 400) {\n      errorMessage = (\n        <div>\n          <p>\n            <b>Something's not right with the submission</b>\n          </p>\n          {Object.keys(validationErrors).map((key) => {\n            return (\n              <p key={key}>\n                <b>{key}:</b>{\" \"}\n                {validationErrors[key].map((err) => (\n                  <span key={err.message + err.code}>\n                    <i>{err.message}</i>{\" \"}\n                    {err.code ? (\n                      <span>\n                        (<code>{err.code}</code>)\n                      </span>\n                    ) : null}\n                  </span>\n                ))}\n              </p>\n            );\n          })}\n        </div>\n      );\n    } else if (submissionError.status >= 500) {\n      errorMessage = (\n        <p>Server error. Perhaps simply try again a little later.</p>\n      );\n    } else {\n      errorMessage = (\n        <p>The server basically failed to process the submission.</p>\n      );\n    }\n  } else {\n    errorMessage = (\n      <p>\n        <code>{submissionError.toString()}</code>\n      </p>\n    );\n  }\n\n  return (\n    <div className=\"search-error\">\n      <h4>Sorry, an error occured</h4>\n      {errorMessage}\n    </div>\n  );\n}\n\nclass ShowComments extends React.PureComponent {\n  render() {\n    const { comments, replyComment, editComment } = this.props;\n    return (\n      <>\n        {comments && comments[\"\"] && (\n          <ShowCommentsRecursive\n            {...this.props}\n            allComments={comments}\n            comments={comments[\"\"]}\n          />\n        )}\n        {!replyComment && !editComment && (\n          <CommentForm replyingComment={false} {...this.props} />\n        )}\n      </>\n    );\n  }\n}\n\nclass ShowCommentsRecursive extends React.PureComponent {\n  state = {\n    confirmDelete: false\n  };\n\n  render() {\n    const { confirmDelete } = this.state;\n    const {\n      replyComment,\n      editComment,\n      setEditComment,\n      setReplyComment,\n      comments,\n      allComments,\n      submittedComments,\n      deleteCommentHandler,\n      highlightComment,\n      highlitComment,\n      commentSubmitted,\n      clearCommentSubmitted,\n      commentEdited,\n      clearCommentEdited,\n      csrfToken\n    } = this.props;\n    if (!comments.length) return null;\n\n    return (\n      <div className=\"comments\">\n        {comments.map((comment) => {\n          // You're allowed to edit it if it was yours and it's not approved yet.\n          let canEdit = false;\n          if (comment.not_approved) {\n            // Take 'editComment' into account\n            if (submittedComments.filter((c) => c.id === comment.id).length) {\n              canEdit = true;\n            }\n          }\n          let canReply = !canEdit && csrfToken;\n\n          const replies = allComments[comment.id];\n\n          const editingComment = !!(\n            canEdit &&\n            editComment &&\n            editComment.id === comment.id\n          );\n\n          const replyingComment = !!(\n            canReply &&\n            replyComment &&\n            replyComment.id === comment.id\n          );\n\n          return (\n            <div className=\"comment\" key={comment.id} id={`c${comment.id}`}>\n              {commentSubmitted && commentSubmitted.id === comment.id && (\n                <ShowCommentSubmitted\n                  commentSubmitted={commentSubmitted}\n                  clearCommentSubmitted={clearCommentSubmitted}\n                />\n              )}\n\n              {commentEdited && commentEdited.id === comment.id && (\n                <ShowCommentEdited\n                  commentEdited={commentEdited}\n                  clearCommentEdited={clearCommentEdited}\n                />\n              )}\n\n              {canEdit && !(editComment && editComment.id === comment.id) && (\n                <p className=\"buttons\">\n                  <button\n                    type=\"button\"\n                    className=\"btn btn-info btn-sm\"\n                    onClick={(event) => {\n                      event.preventDefault();\n                      setEditComment(comment);\n                    }}\n                  >\n                    Edit your comment\n                  </button>\n                </p>\n              )}\n\n              {confirmDelete && editComment && editComment.id === comment.id && (\n                <p style={{ margin: 20, textAlign: \"center\" }}>\n                  <b>Are you sure?</b>\n                  <br />\n                  <button\n                    type=\"button\"\n                    className=\"btn btn-danger\"\n                    onClick={(event) => {\n                      event.preventDefault();\n                      deleteCommentHandler(comment);\n                    }}\n                  >\n                    Yes\n                  </button>{\" \"}\n                  <button\n                    type=\"button\"\n                    className=\"btn btn-info\"\n                    onClick={(event) => {\n                      event.preventDefault();\n                      this.setState({ confirmDelete: false });\n                    }}\n                  >\n                    No\n                  </button>\n                </p>\n              )}\n\n              {canEdit && editComment && editComment.id === comment.id && (\n                <p className=\"buttons\">\n                  {!confirmDelete && (\n                    <button\n                      type=\"button\"\n                      className=\"btn btn-warning btn-sm\"\n                      onClick={(event) => {\n                        event.preventDefault();\n                        this.setState({ confirmDelete: true });\n                      }}\n                    >\n                      Remove your comment\n                    </button>\n                  )}{\" \"}\n                  <button\n                    type=\"button\"\n                    className=\"btn btn-info btn-sm\"\n                    onClick={(event) => {\n                      event.preventDefault();\n                      if (confirmDelete) {\n                        this.setState({ confirmDelete: false }, () => {\n                          setEditComment(null);\n                        });\n                      } else {\n                        setEditComment(null);\n                      }\n                    }}\n                  >\n                    Close edit\n                  </button>\n                </p>\n              )}\n\n              {editComment && editComment.id === comment.id ? (\n                <CommentForm\n                  focusOnMount={true}\n                  editingComment={editingComment}\n                  replyingComment={false}\n                  {...this.props}\n                />\n              ) : (\n                <DisplayComment\n                  highlightComment={highlightComment}\n                  canReply={canReply}\n                  replyingComment={replyingComment}\n                  setReplyComment={setReplyComment}\n                  comment={comment}\n                  highlit={highlitComment && highlitComment === comment.id}\n                />\n              )}\n\n              {replyComment && comment.id === replyComment.id && (\n                <CommentForm\n                  {...this.props}\n                  replyingComment={replyingComment}\n                  focusOnMount={true}\n                />\n              )}\n              {replies && (\n                <ShowCommentsRecursive {...this.props} comments={replies} />\n              )}\n            </div>\n          );\n        })}\n      </div>\n    );\n  }\n}\n\nclass CommentForm extends React.PureComponent {\n  state = {\n    comment: this.props.editComment ? this.props.editComment.text : \"\",\n    name: \"\",\n    email: \"\",\n    showNameEmailInputs: true,\n    wasSearchedFor: false,\n    canSubmit: false,\n    warnAboutName: false\n  };\n\n  textareaRef = React.createRef();\n\n  componentDidMount() {\n    const update = {};\n\n    let { canSubmit, name, email, showNameEmailInputs } = this.state;\n\n    try {\n      name = localStorage.getItem(\"commentName\") || \"\";\n      email = localStorage.getItem(\"commentEmail\") || \"\";\n    } catch (ex) {\n      console.warn(\"'localStorage.getItem(\\\"commentName\\\")' didn't work\");\n    }\n\n    if (name || email) {\n      update.name = name;\n      update.email = email;\n    }\n\n    if (!canSubmit && (name || email)) {\n      update.canSubmit = true;\n    }\n    if (name && email && showNameEmailInputs && !this.props.editComment) {\n      update.showNameEmailInputs = false;\n    }\n\n    if (Object.keys(update).length) {\n      this.setState(update);\n    }\n\n    if (this.props.focusOnMount) {\n      // Usually true when doing an edit\n      this.textareaRef.current.focus();\n    }\n  }\n  componentWillUnmount() {\n    this.dismounted = true;\n  }\n\n  componentDidUpdate(prevProps) {\n    if (prevProps.commentSubmitted !== this.props.commentSubmitted) {\n      this.setState({ comment: \"\" });\n    }\n  }\n\n  clearComment = () => {\n    this.setState({\n      comment: \"\",\n      preview: false\n    });\n  };\n\n  submitHandler = (event) => {\n    event.preventDefault();\n    const { comment, name, email, warnAboutName, wasSearchedFor } = this.state;\n    const { submitCommentHandler, editComment, replyComment } = this.props;\n\n    if (!comment.trim()) {\n      return;\n    }\n    try {\n      if (name && name.trim()) {\n        localStorage.setItem(\"commentName\", name.trim());\n      }\n      if (email && email.trim()) {\n        localStorage.setItem(\"commentEmail\", email.trim());\n      }\n    } catch (ex) {\n      console.warn(\"'localStorage.stItem(\\\"commentName\\\")' didn't work\");\n    }\n\n    if ((!name || !email) && !warnAboutName) {\n      this.setState({ warnAboutName: true });\n    } else {\n      if (warnAboutName) {\n        this.setState({ warnAboutName: false });\n      }\n      submitCommentHandler({\n        comment,\n        email,\n        name,\n        wasSearchedFor,\n        editComment,\n        replyComment,\n        askedWasSearchedFor: this.askWasSearchedFor()\n      });\n    }\n  };\n\n  getTextareaRows = (text, minimum = 4, maximum = 16) => {\n    const linebreaks = (text.match(/\\n/g) || []).length;\n    return Math.min(maximum, Math.max(minimum, linebreaks + 2));\n  };\n\n  askWasSearchedFor = () => {\n    const { searchedId, replyingComment, hasCommented, editingComment } =\n      this.props;\n    return !!(\n      searchedId &&\n      !replyingComment &&\n      !editingComment &&\n      !hasCommented\n    );\n  };\n\n  render() {\n    const { comment, name, email, warnAboutName, showNameEmailInputs } =\n      this.state;\n    const {\n      editComment,\n      savingComment,\n      submissionError,\n      editingComment,\n      csrfToken\n    } = this.props;\n\n    if (!csrfToken) {\n      if (isServer) {\n        return <i>Must have JavaScript enabled to comment.</i>;\n      } else {\n        return null;\n      }\n    }\n\n    return (\n      <form onSubmit={this.submitHandler}>\n        <ShowSubmissionError submissionError={submissionError} />\n\n        {editingComment && (\n          <i>\n            You can edit <b>your</b> recently added, but not yet approved\n            comments.\n          </i>\n        )}\n\n        {savingComment && <ShowSavingStatus />}\n\n        {this.askWasSearchedFor() && (\n          <div style={{ textAlign: \"center\", marginBottom: 20 }}>\n            <h4>Was this the song you were looking for?</h4>\n\n            <label className=\"radio-inline\">\n              <input\n                type=\"radio\"\n                name=\"wasSearchedFor\"\n                value=\"yes\"\n                disabled={savingComment}\n                onChange={(e) => {\n                  this.setState({ wasSearchedFor: true }, () => {\n                    if (this.textareaRef.current) {\n                      this.textareaRef.current.focus();\n                    }\n                  });\n                }}\n              />{\" \"}\n              Yes!\n            </label>\n            <label className=\"radio-inline\">\n              <input\n                type=\"radio\"\n                name=\"wasSearchedFor\"\n                id=\"inlineRadio2\"\n                value=\"no\"\n                disabled={savingComment}\n                onChange={(e) => {\n                  this.setState({ wasSearchedFor: false }, () => {\n                    if (this.textareaRef.current) {\n                      this.textareaRef.current.focus();\n                    }\n                  });\n                }}\n              />{\" \"}\n              No :(\n            </label>\n          </div>\n        )}\n        <div className=\"form-group\">\n          <textarea\n            className=\"form-control\"\n            rows={this.getTextareaRows(this.state.comment)}\n            ref={this.textareaRef}\n            value={comment}\n            disabled={savingComment}\n            onChange={(e) => this.setState({ comment: e.target.value })}\n            onBlur={(event) => {\n              if (this.state.comment.trim()) {\n                setTimeout(() => {\n                  if (!this.dismounted) {\n                    if (!this.state.canSubmit) {\n                      this.setState({ canSubmit: true });\n                    }\n                  }\n                }, 100);\n              }\n            }}\n          />\n        </div>\n        {showNameEmailInputs && (\n          <div className=\"form-inlinexxx\">\n            <div className=\"form-group\">\n              <label htmlFor=\"_name\" className=\"sr-only\">\n                Your name\n              </label>\n              <input\n                type=\"text\"\n                className=\"form-control\"\n                id=\"_name\"\n                placeholder=\"Your name...\"\n                disabled={savingComment}\n                value={name}\n                onChange={(e) => this.setState({ name: e.target.value })}\n              />\n            </div>\n\n            <div className=\"form-group\" style={{ marginBottom: 3 }}>\n              <label htmlFor=\"_email\" className=\"sr-only\">\n                Email address\n              </label>\n              <input\n                type=\"email\"\n                className=\"form-control\"\n                id=\"_email\"\n                placeholder=\"Your email address...\"\n                disabled={savingComment}\n                value={email}\n                onChange={(e) => this.setState({ email: e.target.value })}\n              />\n            </div>\n            <p>\n              <small>\n                Your email will <b>never be published</b> and{\" \"}\n                <b>never be shared</b>. Useful to receive reply comments.\n              </small>\n            </p>\n          </div>\n        )}\n        {warnAboutName && (\n          <div\n            className=\"alert-comment alert alert-warning alert-dismissible\"\n            role=\"alert\"\n          >\n            <button\n              type=\"button\"\n              className=\"close\"\n              data-dismiss=\"alert\"\n              aria-label=\"Close\"\n              onClick={(event) => {\n                this.setState({ warnAboutName: false });\n              }}\n            >\n              <span aria-hidden=\"true\">&times;</span>\n            </button>\n            <p>\n              {name ? (\n                <b>Please enter your email</b>\n              ) : (\n                <b>Please enter your name</b>\n              )}\n            </p>\n            <p>\n              A real name and email helps the comment be approved.\n              <br />\n              An email address makes it possible to receive notification on\n              replies to your comment.\n            </p>\n          </div>\n        )}\n        <div className=\"row\">\n          <div className=\"col-md-8\">\n            {name && email && !showNameEmailInputs && (\n              <>\n                <p>\n                  Commenting as <b>{name}</b>. Replies sent to <b>{email}</b>.\n                </p>\n                <p>\n                  <button\n                    type=\"button\"\n                    className=\"btn btn-info btn-sm\"\n                    onClick={(event) => {\n                      event.preventDefault();\n                      this.setState({ showNameEmailInputs: true });\n                    }}\n                  >\n                    Change name\n                  </button>\n                </p>\n              </>\n            )}\n          </div>\n\n          <div className=\"col-md-4\" style={{ textAlign: \"right\" }}>\n            <button\n              type=\"submit\"\n              className=\"btn btn-primary\"\n              disabled={!comment.trim() || savingComment}\n            >\n              {editComment ? \"Save Changes\" : \"Post Comment\"}\n            </button>\n          </div>\n        </div>\n\n        {!this.state.wasSearchedFor && (\n          <p style={{ margin: \"20px 0\" }}>\n            <small>\n              Can't find the song you're looking for?{\" \"}\n              <a href=\"https://www.peterbe.com/plog/blogitem-040601-1\">\n                Try posting on <b>Find song by lyrics</b>\n              </a>\n              .\n            </small>\n          </p>\n        )}\n      </form>\n    );\n  }\n}\n\nfunction ShowSavingStatus() {\n  return (\n    <p>\n      <i>Please wait....</i>\n    </p>\n  );\n}\n\nclass DisplayComment extends React.PureComponent {\n  render() {\n    const {\n      highlit,\n      highlightComment,\n      canReply,\n      replyingComment,\n      setReplyComment,\n      comment\n    } = this.props;\n    const { id, name, created } = comment;\n    const notApproved = comment.not_approved;\n    const text = comment.text_rendered;\n\n    function getRandomCelebration() {\n      const emojis = [\"🎉\", \"🎊\", \"🥳\", \"✨\", \"👍🏼\", \"🥰\", \"😍\", \"🍾\"];\n      const emoji = emojis[Math.floor(Math.random() * emojis.length)];\n      return (\n        <span role=\"img\" aria-label=\"muted\">\n          {emoji}\n        </span>\n      );\n    }\n\n    return (\n      <div className={highlit ? \"display highlit\" : \"display\"}>\n        {canReply && (\n          <p className=\"buttons\">\n            <button\n              type=\"button\"\n              className={\n                replyingComment\n                  ? \"btn btn-warning btn-sm\"\n                  : \"btn btn-info btn-sm\"\n              }\n              onClick={(event) => {\n                event.preventDefault();\n                setReplyComment(comment);\n              }}\n            >\n              {replyingComment ? \"Close\" : \"Reply\"}\n            </button>\n          </p>\n        )}\n        <h5>\n          By <b>{name ? name : <i>Anonymous</i>}</b>\n        </h5>\n        <p className=\"meta\">\n          <a\n            href={`#c${id}`}\n            title={created}\n            onClick={(event) => {\n              highlightComment(id);\n            }}\n          >\n            Posted <CustomTimeAgo date={created} title={created} />\n          </a>\n          {notApproved && <small>Not yet approved!</small>}\n        </p>\n        {comment.hasOwnProperty(\"was_searched_for\") && (\n          <p>\n            <i>Was it the song you were looking for?</i>{\" \"}\n            <b>{comment.was_searched_for ? \"Yes\" : \"No\"}</b>{\" \"}\n            {comment.was_searched_for && getRandomCelebration()}\n          </p>\n        )}\n\n        {typeof text === \"string\" ? (\n          <blockquote dangerouslySetInnerHTML={{ __html: text }} />\n        ) : (\n          <blockquote>{text}</blockquote>\n        )}\n      </div>\n    );\n  }\n}\n"]},"metadata":{},"sourceType":"module"}