{"ast":null,"code":"import _slicedToArray from\"/home/mandeep/Downloads/Song-sorch work/site/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _classCallCheck from\"/home/mandeep/Downloads/Song-sorch work/site/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/mandeep/Downloads/Song-sorch work/site/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/home/mandeep/Downloads/Song-sorch work/site/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/mandeep/Downloads/Song-sorch work/site/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{useState,useEffect}from\"react\";import{Link,Redirect}from\"react-router-dom\";import{throttle,debounce}from\"throttle-debounce\";// import { Waypoint } from \"react-waypoint\";\nimport copy from\"copy-to-clipboard\";import{cachedFetch}from\"./Cache\";import Countdown from\"react-countdown\";import CountdownTimer from\"./CountdownTimer\";import Bannertop from\"./Bannertop\";import pics from\"./songs_desktop.png\";import mobileimgs from\"./songs_mobile.png\";import{Loading,SetHTMLHeaders,ResetHTMLHeaders,isServer,// YouTubeSnippetIntersectionLazy,\nloadCarbonScript,AmazonRelatedProducts,RenderParagraphs}from\"./Common\";import{SongComments}from\"./Comments\";import{ShowRecentComments}from\"./RecentComments\";// if (process.env.PUBLIC_URL === undefined) {\n//   // console.error(\"process.env.PUBLIC_URL should not be undefined\");\n//   throw new Error(\"process.env.PUBLIC_URL should not be undefined\");\n// }\nimport{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var PUBLIC_URL=process.env.PUBLIC_URL||\"\";var lazyloadThumbnailImage=PUBLIC_URL+\"/static/lazyload-thumbnail.png\";var placeholderImage=PUBLIC_URL+\"/static/placeholder.png\";var NO_ADS=process.env.REACT_APP_NO_ADS===\"true\";var samplePlaceholders=[\"Born to be wild\",\"No one ever told me life was kind\",\"But here it comes again, straight thru the heart\",\"I'm an alligator\",\"My mouth, it moves\"];samplePlaceholders.sort(function(){return 0.5-Math.random();});var appendSuggestion=function appendSuggestion(text,append){var split=text.split(/\\s+/);split.pop();split.push(append);return split.join(\" \");};var Completionist=function Completionist(){return/*#__PURE__*/_jsx(\"span\",{children:\"You are good to go!\"});};var THREE_DAYS_IN_MS=3*24*60*60*1000;var NOW_IN_MS=new Date().getTime();var dateTimeAfterThreeDays=NOW_IN_MS+THREE_DAYS_IN_MS;var Home=/*#__PURE__*/function(_React$Component){_inherits(Home,_React$Component);var _super=_createSuper(Home);function Home(_props){var _this;_classCallCheck(this,Home);_this=_super.call(this,_props);_this.artistRef=/*#__PURE__*/React.createRef();_this.languageRef=/*#__PURE__*/React.createRef();_this.searchRef=/*#__PURE__*/React.createRef();_this.startSearchFromLocation=function(props){var match=props.match;var q=decodeURIComponent(match.params.q);var sp=new URLSearchParams(props.location.search||\"\");var artist=sp.get(\"artist\");var language=sp.get(\"language\");var year=sp.get(\"year\");var searchExample=sp.get(\"example\");// XXX should this compare artist and language too?\nif(_this.state.q!==q){var stateUpdate={q:q};if(q.length>_this.searchRef.current.maxLength-10){stateUpdate.searchMaxLength=[q.length,_this.searchRef.current.maxLength];}if(language||year){_this.loadSearchAggregates();stateUpdate.advancedSearch=true;}if(language){stateUpdate.searchLanguage=language;}if(year){stateUpdate.searchYear=year;}if(artist){stateUpdate.artistName=artist;stateUpdate.advancedSearch=true;}if(searchExample){stateUpdate.searchExample=searchExample;}_this.setState(stateUpdate,function(){_this.startSearch(q,language,year,artist,_this.state.resultsPageIndex,_this.state.searchExample);});}else{SetHTMLHeaders({title:\"\".concat(q,\" - Song Search\")});}};_this.onFocusSearch=function(){_this.searchRef.current.placeholder=\"\";clearInterval(_this.placeholderSampleInterval);if(_this.fillerInterval){clearInterval(_this.fillerInterval);}if(!_this.state.showAutocompleteSuggestions){_this.setState({showAutocompleteSuggestions:true});}if(_this.state.shareSearch){_this.setState({shareSearch:false});}if(!_this._firstFocusSearch){_this._firstFocusSearch=true;// If you're on a small screen this is the first time you've focused,\n// the scroll the top of the search input into view.\nif(window.innerHeight&&window.innerHeight<600){_this.searchRef.current.scrollIntoView();}}};_this.onBlurSearch=function(event){if(!_this.state.q){_this.setNextSamplePlaceholder();_this.startSamplePlaceholderInterval();}setTimeout(function(){if(!_this.dismounted){_this.setState({showAutocompleteSuggestions:false});}},300);};_this.onFocusArtist=function(event){if(!_this.state.showAutocompleteArtistSuggestions){_this.setState({showAutocompleteArtistSuggestions:true});}};_this.onBlurArtist=function(event){setTimeout(function(){if(!_this.dismounted){_this.setState({showAutocompleteArtistSuggestions:false});}},300);};_this.sampleSearch=function(event,search){event.preventDefault();var stateUpdate={q:search.term,searchExample:search.id};if(search.language||search.year){if(!_this.state.searchLanguages.length||!_this.state.searchYears.length){_this.loadSearchAggregates();}}if(search.language){stateUpdate.searchLanguage=search.language;stateUpdate.advancedSearch=true;}else if(_this.state.searchLanguage){stateUpdate.searchLanguage=\"\";}if(search.year){stateUpdate.searchYear=search.year;stateUpdate.advancedSearch=true;}else if(_this.state.searchYear){stateUpdate.searchYear=\"\";}if(search.artist){stateUpdate.artistName=search.artist;stateUpdate.advancedSearch=true;}else if(_this.state.artistName){stateUpdate.artistName=\"\";}_this.setState(stateUpdate,function(){_this.submitSearch();});};_this.onSubmit=function(event){event.preventDefault();_this.submitSearch();};_this._fetchSearchAlternatives=function(){var url=\"/api/search/alternatives?searched=\".concat(_this.state.parentSearch);return cachedFetch(url).then(function(r){if(r.status===200){return r.json().then(function(results){if(_this.dismounted){return;}if(!results){return;}_this.setState({keyPhrases:results.key_phrases});});}});};_this.onChangeSearch=function(event){var q=event.target.value;_this.setState({q:q},function(){if(_this.state.desperateSearch){_this.setState({desperateSearch:false});}if(_this.state.originalQ){_this.setState({originalQ:\"\"});}var length=q.length;if(length>_this.searchRef.current.maxLength-10){_this.setState({searchMaxLength:[length,_this.searchRef.current.maxLength],showAutocompleteSuggestions:false});}else if(_this.state.searchMaxLength){_this.setState({searchMaxLength:null,showAutocompleteSuggestions:true});}if(_this.state.q.trim()){if(_this.autocompleteWaitingFor){if(q.trim()===_this.autocompleteWaitingFor){return;}}if((length<4||q.endsWith(\" \"))&&length<24){// the impatient one\n_this.fetchAutocompleteSuggestionsThrottled(q,_this.state.searchLanguage);}else if(length>24){// When what you've typed is really long use the really\n// delayed throttle.\n_this.fetchAutocompleteSuggestionsDebouncedLong(q,_this.state.searchLanguage);}else if(length){_this.fetchAutocompleteSuggestionsDebounced(q,_this.state.searchLanguage);}else{_this.setState({autocompleteSuggestions:null,autocompleteSearchSuggestions:null,autocompleteHighlight:-1,showAutocompleteSuggestions:true});}}else{_this.setState({autocompleteSuggestions:null,autocompleteSearchSuggestions:null,autocompleteHighlight:-1,showAutocompleteSuggestions:true});}});};_this.onKeyDownSearch=function(event){var suggestions=_this.state.autocompleteSuggestions;if(suggestions){var highlight=_this.state.autocompleteHighlight;if(event.key===\"Tab\"){event.preventDefault();var suggestion=highlight>-1?suggestions[highlight]:suggestions[0];if(!suggestion._url){_this.setState({q:suggestion.text+\" \"});_this.fetchAutocompleteSuggestions(suggestion.text,_this.state.searchLanguage);}}else if(event.key===\"ArrowDown\"&&highlight<suggestions.length){event.preventDefault();_this.setState({autocompleteHighlight:highlight+1});}else if(event.key===\"ArrowUp\"&&highlight>-1){_this.setState({autocompleteHighlight:highlight-1});}else if(event.key===\"Enter\"){if(highlight>-1){event.preventDefault();var searchSuggestions=_this.state.autocompleteSearchSuggestions;if(highlight===0&&searchSuggestions&&searchSuggestions.total){_this.submitSearch();return;}highlight--;if(!suggestions[highlight]){// Not sure how this can happen\nconsole.warn(\"SUGGESTIONS\",suggestions);console.warn(\"HIGHLIGHT\",highlight);// But bail!\n_this.setState({autocompleteSuggestions:null,autocompleteHighlight:-1},function(){return _this.submitSearch();});return;}if(suggestions[highlight]._url){_this.setState({redirectTo:{pathname:suggestions[highlight]._url}});}else{_this.setState({q:suggestions[highlight].text,autocompleteSuggestions:null,autocompleteHighlight:-1},function(){return _this.submitSearch();});}}}}};_this.onKeyDownArtistSearch=function(event){var suggestions=_this.state.autocompleteArtistSuggestions;if(suggestions){var highlight=_this.state.autocompleteArtistHighlight;if(event.key===\"Tab\"){event.preventDefault();if(highlight>-1){_this.setState({artistName:suggestions[highlight].text});_this.fetchAutocompleteArtistSuggestions(suggestions[highlight].text);}else if(suggestions.length){_this.setState({artistName:suggestions[0].text});_this.fetchAutocompleteArtistSuggestions(suggestions[0].text);}}else if(event.key===\"ArrowDown\"&&highlight<suggestions.length){event.preventDefault();_this.setState({autocompleteArtistHighlight:highlight+1});}else if(event.key===\"ArrowUp\"&&highlight>-1){_this.setState({autocompleteArtistHighlight:highlight-1});}else if(event.key===\"Enter\"){if(highlight>-1){event.preventDefault();_this.setState({artistName:suggestions[highlight].text,autocompleteArtistSuggestions:null,autocompleteArtistHighlight:-1});}}}};_this.toggleShareSearch=function(event){event.preventDefault();_this.setState({shareSearch:!_this.state.shareSearch,advancedSearch:false});};_this.toggleAdvancedSearch=function(event){event.preventDefault();if(!_this.state.advancedSearch){// it was not enabled before\nvar withCountsLanguages=_this.state.searchLanguages.filter(function(x){return x.count;});var withCountsYears=_this.state.searchYears.filter(function(x){return x.count;});if(!withCountsLanguages.length||!withCountsYears.length){_this.loadSearchAggregates();}}_this.setState({advancedSearch:!_this.state.advancedSearch,shareSearch:false});};_this.onChangeLanguage=function(event){event.preventDefault();var searchLanguage=event.target.value;_this.setState({searchLanguage:searchLanguage});};_this.onChangeYear=function(event){event.preventDefault();var searchYear=event.target.value;_this.setState({searchYear:searchYear});};_this.onChangeArtistName=function(event){event.preventDefault();var artistName=event.target.value;_this.setState({artistName:artistName},function(){if(artistName.length){_this.fetchAutocompleteArtistSuggestions(_this.state.artistName.trim());}else{_this.setState({autocompleteArtistSuggestions:null,autocompleteArtistHighlight:-1});}});};_this.onSelectSuggestion=function(event,suggestion){event.preventDefault();if(suggestion._url){return _this.setState({redirectTo:suggestion._url});}var newText=suggestion.text;if(suggestion.append){newText=appendSuggestion(_this.state.q,newText);}_this.setState({q:newText,autocompleteSuggestions:null,autocompleteHighlight:-1},function(){_this.submitSearch();});};_this.onSelectSuggestionAll=function(event){event.preventDefault();_this.submitSearch();};_this.onSelectArtistSuggestion=function(event,suggestion){event.preventDefault();_this.setState({artistName:suggestion.text,autocompleteArtistSuggestions:null,autocompleteArtistHighlight:-1},function(){_this.submitSearch();});};_this.onLoadMore=function(event){event.preventDefault();_this.setState({resultsPageIndex:_this.state.resultsPageIndex+1},function(){_this.startSearch(_this.state.q,_this.state.searchLanguage,_this.state.searchYear,_this.state.artistName,_this.state.resultsPageIndex,_this.state.searchExample);});};_this.submitPhrase=function(event,keyPhrase){event.preventDefault();var stateUpdate={q:keyPhrase.phrase,originalQ:_this.state.q};if(keyPhrase.year){stateUpdate.searchYear=keyPhrase.year;}if(keyPhrase.language){stateUpdate.searchLanguage=keyPhrase.language;}_this.setState(stateUpdate,function(){_this.submitSearch();});};_this.reloadSearch=function(event){event.preventDefault();window.location.reload();};_this.loadMoreByName=function(event){var previousByNameLimit=_this.state.by_name_limit;_this.setState({by_name_total:0,by_name_limit:0},function(){var url=\"/api/search?q=\".concat(encodeURIComponent(_this.state.q),\"&by_name=\").concat(previousByNameLimit);fetch(url).then(function(r){if(_this.dismounted){return;}if(r.status===200){r.json().then(function(results){if(results){_this.setState({by_name:results.by_name,by_name_total:results.by_name_total,by_name_limit:results.by_name_limit});}});}});});};_this.displayYears=function(year){var yearEnd=year+9;var currentYear=new Date().getFullYear();if(yearEnd>currentYear){yearEnd=currentYear;}return\"\".concat(year,\"\\u2026\").concat(yearEnd);};var _q=\"\";var originalQ=\"\";var _artistName=\"\";var total=0;var searchResults=null;var desperate=false;var missing=null;// let suggestions = null;\nvar by_name=null;var by_name_total=null;var by_name_limit=null;var _searchLanguage=\"\";var _searchYear=\"\";var parentSearch=null;var keyPhrases=null;var popularityFactor=null;var _searchExample=null;var _results=_this.props.results;if(_results){_this.searched=_results.searched;_q=_results.search;total=_results.total;searchResults=_results.results;desperate=_results.desperate;missing=_results.missing;by_name=_results.by_name||null;by_name_total=_results.by_name_total||null;by_name_limit=_results.by_name_limit||null;_artistName=_results.artist;originalQ=_results.original||\"\";_searchLanguage=_results.language||\"\";_searchYear=_results.year||\"\";parentSearch=_results.searched||null;keyPhrases=_results.key_phrases||null;popularityFactor=_results.popularityFactor||null;_searchExample=_results.search_example||null;}var advancedSearch=Boolean(_artistName||_searchLanguage||_searchYear);var searchExamples=null;var showExamples=false;if(_props.searchExamples&&_props.searchExamples.examples){searchExamples=_props.searchExamples.examples;showExamples=true;}var recentComments=null;var showRecentComments=false;if(_props.recentComments&&_props.recentComments.comments&&_props.recentComments.comments.length){recentComments=_props.recentComments;showRecentComments=true;}_this.state={q:_q,originalQ:originalQ,artistName:_artistName,searching:false,searchError:null,total:total,results:searchResults,resultsPageIndex:0,by_name:by_name,by_name_total:by_name_total,by_name_limit:by_name_limit,placeholder:samplePlaceholders[0],slowSearch:null,showExamples:showExamples,searchExamples:searchExamples,parentSearch:parentSearch,desperateSearch:desperate,missing:missing,keyPhrases:keyPhrases,popularityFactor:popularityFactor,searchExample:_searchExample,showRecentComments:showRecentComments,recentComments:recentComments,onlyResults:null,searchMaxLength:null,autocompleteSuggestions:null,autocompleteSearchSuggestions:null,autocompleteHighlight:-1,showAutocompleteSuggestions:true,autocompleteArtistSuggestions:null,autocompleteArtistHighlight:-1,showAutocompleteArtistSuggestions:true,advancedSearch:advancedSearch,searchLanguage:_searchLanguage,searchLanguages:[],searchYear:_searchYear,searchYears:[],redirectTo:null,shareSearch:false};// When you've typed something longer.\n// If you steadily type something every 100ms for a long time\n// without pausing, this won't fire till you stop.\n_this.fetchAutocompleteSuggestionsDebounced=debounce(800,_this.fetchAutocompleteSuggestions);_this.fetchAutocompleteSuggestionsDebouncedLong=debounce(1800,_this.fetchAutocompleteSuggestions);// When you've started typing.\n// Will basically fire without being postponed.\n_this.fetchAutocompleteSuggestionsThrottled=throttle(1100,_this.fetchAutocompleteSuggestions);_this._autocompleteSuggestionsCache={};return _this;}_createClass(Home,[{key:\"componentDidMount\",value:function componentDidMount(){ResetHTMLHeaders();if(this.props.match.params.q){this.startSearchFromLocation(this.props);}else{this.startSamplePlaceholderInterval();if(!this.state.searchExamples){this.fetchSearchExamples();}if(!this.state.recentComments){this.fetchRecentComments();}}if(this.state.results){if((this.state.desperateSearch||!this.state.total)&&this.state.q.length>10){this._fetchSearchAlternatives();}}}},{key:\"componentDidUpdate\",value:function componentDidUpdate(prevProps){if(this.props.match.params.q!==prevProps.match.params.q){if(!this.props.match.params.q){ResetHTMLHeaders();this.setState({q:\"\",originalQ:\"\",artistName:\"\",searching:false,total:null,results:null,resultsPageIndex:0,slowSearch:null,showExamples:false,searchExamples:null,showRecentComments:false,parentSearch:null,desperateSearch:false,searchExample:null,missing:null,searchError:null,by_name:null,by_name_total:null,by_name_limit:null,autocompleteSuggestions:null,autocompleteSearchSuggestions:null,autocompleteHighlight:-1,autocompleteArtistSuggestions:null,autocompleteArtistHighlight:-1,redirectTo:null,shareSearch:false});// this.refs.q.value = \"\";\nthis.fetchSearchExamples();}else if(decodeURIComponent(this.props.match.params.q)!==this.state.q){this.startSearchFromLocation(this.props);}}}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){this.dismounted=true;this.stopSamplePlaceholderInterval();if(this.fillerInterval){window.clearInterval(this.fillerInterval);}if(this.slowSearchTimer){window.clearTimeout(this.slowSearchTimer);}}},{key:\"fetchSearchExamples\",value:function fetchSearchExamples(){var _this2=this;var url=\"/api/search/examples\";return fetch(url).then(function(r){if(r.status===200){return r.json().then(function(results){if(_this2.dismounted){return;}if(results){if(!_this2.state.results&&!_this2.state.searching){_this2.setState({searchExamples:results.examples,showExamples:true});}}});}});}},{key:\"fetchRecentComments\",value:function fetchRecentComments(){var _this3=this;var url=\"/api/comments/recent/home\";return fetch(url).then(function(r){if(r.status===200){return r.json().then(function(results){if(_this3.dismounted){return;}if(results){if(!_this3.state.results&&!_this3.state.searching){_this3.setState({recentComments:results,showRecentComments:true});}}});}});}},{key:\"stopSamplePlaceholderInterval\",value:function stopSamplePlaceholderInterval(){if(this.placeholderSampleInterval){window.clearInterval(this.placeholderSampleInterval);}}},{key:\"startSamplePlaceholderInterval\",value:function startSamplePlaceholderInterval(){var _this4=this;if(this.state.q){return;}// let el = document.querySelector('input[type=\"search\"]')\n// if (!el || el.value) return\nthis.currentPlaceholder=0;if(this.placeholderSampleInterval){window.clearInterval(this.placeholderSampleInterval);}this.placeholderSampleInterval=window.setInterval(function(){_this4.setNextSamplePlaceholder();},3000);}},{key:\"setNextSamplePlaceholder\",value:function setNextSamplePlaceholder(){var _this5=this;if(this.fillerInterval){window.clearInterval(this.fillerInterval);}var placeholder=samplePlaceholders[++this.currentPlaceholder%samplePlaceholders.length];var el=this.searchRef.current;if(!el)return;var slice=0;this.fillerInterval=setInterval(function(){if(!placeholder){// something's gone wrong\nreturn;}el.placeholder=placeholder.substring(0,++slice);if(slice>=placeholder.length){clearInterval(_this5.fillerInterval);el.placeholder+=\"...\";}},10);}},{key:\"submitSearch\",value:function submitSearch(){var q=this.state.q.trim();// let language = this.languageRef.current && this.languageRef.current.value;\n// if (!language && this.state.searchLanguage) {\n//   language = this.state.searchLanguage;\n// }\nvar language=this.state.searchLanguage;var year=this.state.searchYear;var artistName=this.artistRef.current&&this.artistRef.current.value.trim();if(!artistName&&this.state.artistName){if(!this.state.advancedSearch){artistName=this.state.artistName;}}else if(artistName&&!this.state.artistName){this.setState({artistName:artistName});}if(q){var newURL=\"/q/\".concat(encodeURIComponent(q));// only include the language= if it's set and not 'en'\nif(language&&language!==\"en\"){newURL+=\"?language=\".concat(language);}if(year){newURL+=newURL.includes(\"?\")?\"&\":\"?\";newURL+=\"year=\".concat(year);}if(artistName){newURL+=newURL.includes(\"?\")?\"&\":\"?\";newURL+=\"artist=\".concat(encodeURIComponent(artistName));}var currentURL=this.props.location.pathname;if(this.props.location.search){currentURL+=this.props.location.search;}if(newURL===currentURL){// get out of here\nreturn;}this.props.history.push(newURL);this.startSearch(q,language,year,artistName);// XXX this.searchRef.current.blur()????\ndocument.querySelector('input[type=\"search\"]').blur();if(this.state.autocompleteSuggestions){this.setState({autocompleteSuggestions:null,autocompleteSearchSuggestions:null,autocompleteHighlight:-1,showAutocompleteSuggestions:true});}if(this.state.autocompleteArtistSuggestions){this.setState({autocompleteArtistSuggestions:null,autocompleteArtistHighlight:-1});}}}},{key:\"startSearch\",value:function startSearch(q){var _this6=this;var language=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var year=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var artist=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;var page=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var searchExample=arguments.length>5&&arguments[5]!==undefined?arguments[5]:null;SetHTMLHeaders({title:\"Searching... - Song Search\"});// The state change is quite differnet depend on it being\n// the first page or a subsequent page.\nif(page){this.setState({searching:true,searchError:null},function(){_this6.sendSearch(q,language,year,artist,page,searchExample);});}else{this.setState({searching:true,searchError:null,// suggestions: null,\nresults:null,by_name:null,showExamples:false,showRecentComments:false,parentSearch:null},function(){_this6.sendSearch(q,language,year,artist,page,searchExample);_this6.slowSearchTimer=window.setTimeout(function(){if(!_this6.state.searchError&&!_this6.state.results){_this6.setState({slowSearch:true});}},5*1000);});}}},{key:\"sendSearch\",value:function sendSearch(q){var _this7=this;var language=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var year=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var artist=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;var page=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var searchExample=arguments.length>5&&arguments[5]!==undefined?arguments[5]:null;var url=\"/api/search?q=\".concat(encodeURIComponent(q));if(language){url+=\"&language=\".concat(language);}if(year){url+=\"&year=\".concat(year);}if(artist){url+=\"&artist=\".concat(encodeURIComponent(artist));}if(page){url+=\"&page=\".concat(page+1);url+=\"&searched=\".concat(this.searched);}else if(this.state.originalQ){url+=\"&original=\".concat(this.searched);}if(this.state.desperateSearch&&!this.state.originalQ){url+=\"&desperate=true\";}if(searchExample){url+=\"&example=\".concat(searchExample);}return cachedFetch(url).then(function(r){if(r.status===200){return r.json().then(function(results){if(_this7.slowSearchTimer){window.clearTimeout(_this7.slowSearchTimer);}if(_this7.dismounted){return;}if(!results){return;}if(results.error){_this7.setState({searchError:results.error,searching:false,slowSearch:null});SetHTMLHeaders({title:\"Sorry, search error\"});return;}else if(_this7.state.searchError){_this7.setState({searchError:null});}SetHTMLHeaders({title:\"\".concat(q,\" - Song Search\")});// This is the first time sendSearch is called for\n// this q (and this offset).\n// Decide whether to get suggestions searches...\n// console.log(\n//   'Results:', results.results.length,\n//   'Total:', results.total,\n//   'Limit:', results.limit,\n// )\n// set this so that the onExpandClick can use it\nif(!page){_this7.searched=results.searched;}// set in localStorage for the sake \"Open in a new tab\"\ntry{localStorage.setItem(\"searched\",\"\".concat(results.searched,\",\").concat(new Date().getTime()));}catch(ex){console.warn(\"'localStorage.setItem(\\\"searched\\\")' didn't work\");}var allResults;if(page){allResults=[];_this7.state.results.forEach(function(r){return allResults.push(r);});results.results.forEach(function(r){return allResults.push(r);});}else{allResults=results.results;}_this7.setState({desperateSearch:results.desperate,missing:results.missing,popularityFactor:results.popularity_factor,parentSearch:results.searched,searching:false,results:allResults,keyPhrases:null,by_name:results.by_name,by_name_total:results.by_name_total,by_name_limit:results.by_name_limit,total:results.total,searchError:null,slowSearch:null},function(){if((_this7.state.desperateSearch||!_this7.state.total)&&_this7.state.q.length>10){_this7._fetchSearchAlternatives();}});});}else{r.text().then(function(text){SetHTMLHeaders({title:\"Search Error\"});_this7.setState({searching:false,searchError:{status:r.status,text:text},slowSearch:false});});}});}},{key:\"fetchAutocompleteSuggestions\",value:function fetchAutocompleteSuggestions(q){var _this8=this;var language=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var cacheHash=q.trim();var url=\"/api/search/autocomplete?q=\".concat(encodeURIComponent(q));if(language){cacheHash+=language.trim();url+=\"&language=\".concat(language);}var cached=this._autocompleteSuggestionsCache[cacheHash];if(cached){return Promise.resolve(cached).then(function(results){_this8.setState({autocompleteSuggestions:results.matches,autocompleteSearchSuggestions:results.search_suggestions,autocompleteHighlight:-1,missing:results.missing});});}// Store a \"global\" of what the latest q was.\nthis.autocompleteWaitingFor=q;return fetch(url).then(function(r){if(r.status===200){return r.json().then(function(results){if(_this8.dismounted){return;}if(q.startsWith(_this8.autocompleteWaitingFor)){_this8._autocompleteSuggestionsCache[cacheHash]=results;if(_this8.state.q){_this8.setState({autocompleteSuggestions:results.matches,autocompleteSearchSuggestions:results.search_suggestions,autocompleteHighlight:-1});}}});}});}},{key:\"fetchAutocompleteArtistSuggestions\",value:function fetchAutocompleteArtistSuggestions(q){var _this9=this;var url=\"/api/search/autocomplete?q=\".concat(q,\"&artist=true\");return fetch(url).then(function(r){if(r.status===200){return r.json();}}).then(function(results){if(_this9.dismounted){return;}if(results){_this9.setState({autocompleteArtistSuggestions:results.matches,autocompleteArtistHighlight:-1});}});}},{key:\"loadSearchAggregates\",value:// loadSearchLanguages() {\n//   return fetch(\"/api/search/languages\").then(r => {\n//     if (r.status === 200) {\n//       r.json().then(r => {\n//         this.setState({ searchLanguages: r.languages });\n//       });\n//     }\n//   });\n// }\nfunction loadSearchAggregates(){var _this10=this;return fetch(\"/api/search/aggregates\").then(function(r){if(r.status===200){r.json().then(function(r){_this10.setState({searchLanguages:r.languages,searchYears:r.years});});}});}},{key:\"render\",value:function render(){var _this11=this;var _this$state=this.state,redirectTo=_this$state.redirectTo,searchYear=_this$state.searchYear;if(redirectTo){return/*#__PURE__*/_jsx(Redirect,{to:redirectTo,push:true});}var results=null;var pagination=null;if(this.state.results){var rows=this.state.results;if(this.state.onlyResults){var onlyIds=this.state.onlyResults.map(function(r){return r.id;});rows=rows.filter(function(row){return onlyIds.includes(row.id);});}results=/*#__PURE__*/_jsx(Results,{results:rows,searched:this.searched,popularityFactor:this.state.popularityFactor,showYear:Boolean(searchYear)});if(this.state.results.length<this.state.total){pagination=/*#__PURE__*/_jsx(Pagination,{location:this.props.location,page:this.state.resultsPageIndex,onLoadMore:this.onLoadMore});}}var byName=null;if(this.state.by_name&&this.state.by_name.length){byName=/*#__PURE__*/_jsx(SongsByName,{results:this.state.by_name,total:this.state.by_name_total,limit:this.state.by_name_limit,loadMoreByName:this.loadMoreByName});}var searchToggles=/*#__PURE__*/_jsxs(\"span\",{className:\"help-block toggles\",children:[this.state.results&&this.state.results.length?/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:this.state.shareSearch?\"btn btn-default btn-sm active\":\"btn btn-default btn-sm\",onClick:this.toggleShareSearch,children:this.state.shareSearch?\"Hide share search\":\"Share search results\"}):null,/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:this.state.advancedSearch?\"btn btn-default btn-sm active\":\"btn btn-default btn-sm\",onClick:this.toggleAdvancedSearch,children:this.state.advancedSearch?\"Hide search options\":\"Search options\"})]});var advancedSearchStatus=null;if(!this.state.advancedSearch){var parts=[];// if you currently don't have the advanced search options open,\n// show what's currently selected.\nif(this.state.searchLanguage&&this.state.searchLanguage!==\"en\"){var language=this.state.searchLanguages.filter(function(e){return e.code===_this11.state.searchLanguage;})[0].language;parts.push(\"Language: \".concat(language));}if(this.state.searchYear){parts.push(\"Years: \".concat(this.displayYears(parseInt(this.state.searchYear))));}if(this.state.artistName){parts.push(\"Artist: \".concat(this.state.artistName));}if(parts.length){advancedSearchStatus=/*#__PURE__*/_jsxs(\"span\",{className:\"help-block advanced-search-status\",children:[/*#__PURE__*/_jsx(\"b\",{children:\"Search options:\"}),\" \",parts.join(\", \")]});}}var advancedInput=null;if(this.state.advancedSearch){advancedInput=/*#__PURE__*/_jsxs(\"div\",{className:\"advanced\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",style:{position:\"relative\"},children:[/*#__PURE__*/_jsx(\"input\",{type:\"search\",ref:this.artistRef,value:this.state.artistName,className:\"form-control input-lg\",maxLength:100,onFocus:this.onFocusArtist,onBlur:this.onBlurArtist,onChange:this.onChangeArtistName,onKeyDown:this.onKeyDownArtistSearch,\"aria-label\":\"Artist search\",placeholder:\"Artist or band name\"}),this.state.autocompleteArtistSuggestions&&this.state.showAutocompleteArtistSuggestions?/*#__PURE__*/_jsx(ShowAutocompleteArtistSuggestions,{onSelectSuggestion:this.onSelectArtistSuggestion,highlight:this.state.autocompleteArtistHighlight,suggestions:this.state.autocompleteArtistSuggestions}):null]}),/*#__PURE__*/_jsx(\"div\",{className:\"form-group\",children:/*#__PURE__*/_jsxs(\"select\",{ref:this.languageRef,onChange:this.onChangeLanguage,value:this.state.searchLanguage,className:\"form-control\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Any language\"}),this.state.searchLanguages.map(function(each){var text=each.language;if(each.count===1){text+=\" (1 song)\";}else if(each.count){text+=\" (\".concat(each.count.toLocaleString(),\" songs)\");}return/*#__PURE__*/_jsx(\"option\",{value:each.code,children:text},each.code);})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"form-group\",children:/*#__PURE__*/_jsxs(\"select\",{// ref={this.yearRef}\nonChange:this.onChangeYear,value:this.state.searchYear,className:\"form-control\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Any year\"}),this.state.searchYears.map(function(each){var text=_this11.displayYears(each.year);if(each.count===1){text+=\" (1 song)\";}else if(each.count){text+=\" (\".concat(each.count.toLocaleString(),\" songs)\");}return/*#__PURE__*/_jsx(\"option\",{value:each.year,children:text},text);})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"form-group text-right\",children:/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"btn btn-primary\",children:\"Search Now\"})})]});}var keyPhrases=null;if(this.state.results&&// !this.state.results.length &&\nthis.state.keyPhrases&&this.state.keyPhrases.length){keyPhrases=/*#__PURE__*/_jsx(ShowKeyPhrases,{nothingFound:!this.state.results.length,phrases:this.state.keyPhrases,submitPhrase:this.submitPhrase});}return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"form\",{onSubmit:this.onSubmit,action:\"/api/search/redirect\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",style:{position:\"relative\"},children:[/*#__PURE__*/_jsxs(\"div\",{className:\"input-group input-group-lg\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"search\",ref:this.searchRef,name:\"q\",autoComplete:\"off\",value:this.state.q,onFocus:this.onFocusSearch,onBlur:this.onBlurSearch,onChange:this.onChangeSearch,onKeyDown:this.onKeyDownSearch,className:\"form-control\",maxLength:150,\"aria-label\":\"Lyrics search\",placeholder:this.state.placeholder}),/*#__PURE__*/_jsx(\"span\",{className:\"input-group-btn\",children:/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-default btn-lg\",type:\"submit\",title:\"Click to search\",children:\"Search\"})})]}),this.state.searchMaxLength?/*#__PURE__*/_jsx(ShowMaxlengthWarning,{length:this.state.searchMaxLength[0],maxLength:this.state.searchMaxLength[1]}):null,this.state.desperateSearch&&this.state.results&&this.state.results.length&&!(this.state.showAutocompleteSuggestions&&this.state.autocompleteSuggestions)?/*#__PURE__*/_jsx(ShowDesperateSearchWarning,{}):null,!this.state.desperateSearch&&this.state.missing&&this.state.results&&this.state.results.length&&!(this.state.showAutocompleteSuggestions&&this.state.autocompleteSuggestions)?/*#__PURE__*/_jsx(ShowMissingSearchWarning,{missing:this.state.missing}):null,this.state.autocompleteSuggestions&&this.state.showAutocompleteSuggestions?/*#__PURE__*/_jsx(ShowAutocompleteSuggestions,{q:this.state.q,onSelectSuggestion:this.onSelectSuggestion,onSelectSuggestionAll:this.onSelectSuggestionAll,highlight:this.state.autocompleteHighlight,suggestions:this.state.autocompleteSuggestions,searchSuggestions:this.state.autocompleteSearchSuggestions}):null]}),/*#__PURE__*/_jsx(ShowResultCount,{results:this.state.results,total:this.state.total,byName:this.state.by_name,onlyResults:this.state.onlyResults}),searchToggles,advancedSearchStatus,this.state.shareSearch?/*#__PURE__*/_jsx(ShareInput,{searched:this.searched}):null,advancedInput]}),/*#__PURE__*/_jsx(\"div\",{id:\"waldo-tag-11815\",children:/*#__PURE__*/_jsxs(\"script\",{children:[\"googletag.cmd.push(function() {\\n              googletag.display = \\\"waldo-tag-11815\\\";\\n            })\",\";\"]})}),this.state.searchError?/*#__PURE__*/_jsx(SearchError,{error:this.state.searchError}):null,this.state.showExamples?/*#__PURE__*/_jsx(ShowExamples,{sampleSearch:this.sampleSearch,examples:this.state.searchExamples}):null,this.state.showRecentComments&&this.state.recentComments?/*#__PURE__*/_jsx(ShowRecentCommentsWrapper,{comments:this.state.recentComments.comments}):null,byName,keyPhrases,results,this.state.searching?/*#__PURE__*/_jsx(Loading,{text:\"Searching...\"}):null,pagination,this.state.slowSearch?/*#__PURE__*/_jsx(SlowSearch,{reloadSearch:this.reloadSearch}):null]});}}]);return Home;}(React.Component);export default Home;var ShowRecentCommentsWrapper=/*#__PURE__*/function(_React$PureComponent){_inherits(ShowRecentCommentsWrapper,_React$PureComponent);var _super2=_createSuper(ShowRecentCommentsWrapper);function ShowRecentCommentsWrapper(){_classCallCheck(this,ShowRecentCommentsWrapper);return _super2.apply(this,arguments);}_createClass(ShowRecentCommentsWrapper,[{key:\"render\",value:function render(){var comments=this.props.comments;return/*#__PURE__*/_jsxs(\"div\",{className:\"recent-comments\",style:{marginTop:50},children:[/*#__PURE__*/_jsxs(\"h4\",{children:[\"Recent Comments (\",/*#__PURE__*/_jsx(Link,{to:\"/comments\",children:\"All\"}),\")\"]}),/*#__PURE__*/_jsx(ShowRecentComments,{comments:comments,isRoot:true}),/*#__PURE__*/_jsx(\"div\",{className:\"load-more\",children:/*#__PURE__*/_jsx(Link,{to:\"/comments\",children:\"More recent comments\"})})]});}}]);return ShowRecentCommentsWrapper;}(React.PureComponent);var ShowResultCount=/*#__PURE__*/React.memo(function(_ref){var results=_ref.results,total=_ref.total,onlyResults=_ref.onlyResults,byName=_ref.byName;if(!results){return null;}var countResults=null;if(results){var byNameCount=byName?byName.length:0;if(onlyResults){countResults=onlyResults.length+byNameCount;}else{countResults=results.length+byNameCount;}}return/*#__PURE__*/_jsxs(\"p\",{className:\"result-metadata text-right\",children:[/*#__PURE__*/_jsxs(\"b\",{children:[total>=10000?\"More than \":\"\",total.toLocaleString(),\" \",total===1?\"song found\":\"songs found\"]}),\" \",countResults&&countResults<total?\"(showing \".concat(countResults,\")\"):null]});});var ShareInput=/*#__PURE__*/function(_React$PureComponent2){_inherits(ShareInput,_React$PureComponent2);var _super3=_createSuper(ShareInput);function ShareInput(){var _this12;_classCallCheck(this,ShareInput);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this12=_super3.call.apply(_super3,[this].concat(args));_this12.state={copied:false,failed:false,hasFocused:false};_this12.absurlRef=/*#__PURE__*/React.createRef();return _this12;}_createClass(ShareInput,[{key:\"render\",value:function render(){var _this13=this;var absoluteUrl=window.location.href;return/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",style:{marginTop:30},children:[/*#__PURE__*/_jsxs(\"div\",{className:\"input-group\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"sr-only\",children:\"URL:\"}),/*#__PURE__*/_jsx(\"input\",{ref:this.absurlRef,type:\"text\",className:\"form-control\",readOnly:true,value:absoluteUrl,onFocus:function onFocus(){if(!_this13.state.hasFocused){_this13.absurlRef.current.select();_this13.setState({hasFocused:true});}}}),/*#__PURE__*/_jsx(\"span\",{className:\"input-group-btn\",children:/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:this.state.copied?\"btn btn-success\":\"btn btn-primary\",title:\"Click to copy to clipboard\",onClick:function onClick(event){event.preventDefault();_this13.absurlRef.current.select();if(copy(absoluteUrl)){_this13.setState({copied:true,failed:false},function(){if(_this13.props.searched&&!_this13.copied){_this13.copied=_this13.props.searched;fetch(\"/api/search/copied/\".concat(_this13.props.searched),{method:\"POST\"});}});}else{_this13.setState({copied:false,failed:true});}},children:this.state.copied?\"Copied to clipboard\":\"Copy to clipboard\"})})]}),this.state.copied?/*#__PURE__*/_jsx(\"p\",{children:\"The URL to this search has now been copied to your clipboard so you can paste it anywhere. Thanks!\"}):null]});}}]);return ShareInput;}(React.PureComponent);var ShowKeyPhrases=/*#__PURE__*/React.memo(function(_ref2){var phrases=_ref2.phrases,submitPhrase=_ref2.submitPhrase,nothingFound=_ref2.nothingFound;var subTitle=null;if(nothingFound){if(phrases.length===1){subTitle=/*#__PURE__*/_jsx(\"h4\",{children:\"But, try this...\"});}else{subTitle=/*#__PURE__*/_jsx(\"h4\",{children:\"But, try these...\"});}}return/*#__PURE__*/_jsxs(\"div\",{className:\"key-phrases\",children:[nothingFound?/*#__PURE__*/_jsx(\"h3\",{children:\"Nothing found\"}):/*#__PURE__*/_jsx(\"h3\",{children:\"Fuzzy results. Try breaking it up...\"}),subTitle,/*#__PURE__*/_jsx(\"table\",{className:\"table suggestions table-condensed\",children:/*#__PURE__*/_jsx(\"tbody\",{children:phrases.map(function(phrase){var url=\"/q/\".concat(phrase.phrase);if(phrase.year){url+=\"?year=\".concat(phrase.year);}return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"a\",{href:url,onClick:function onClick(e){return submitPhrase(e,phrase);},children:phrase.diff_html?/*#__PURE__*/_jsx(\"span\",{dangerouslySetInnerHTML:{__html:phrase.diff_html}}):phrase.phrase})}),/*#__PURE__*/_jsxs(\"td\",{children:[/*#__PURE__*/_jsx(\"b\",{children:phrase.total}),\" \",phrase.total===1?\"song\":\"songs\"]})]},phrase.phrase);})})})]});});var ShowAutocompleteSuggestions=/*#__PURE__*/React.memo(function(_ref3){var q=_ref3.q,highlight=_ref3.highlight,suggestions=_ref3.suggestions,searchSuggestions=_ref3.searchSuggestions,onSelectSuggestion=_ref3.onSelectSuggestion,onSelectSuggestionAll=_ref3.onSelectSuggestionAll;if(!suggestions.length){return null;}return/*#__PURE__*/_jsx(\"div\",{className:\"autocomplete\",children:/*#__PURE__*/_jsxs(\"ul\",{children:[searchSuggestions&&q&&searchSuggestions.total?/*#__PURE__*/_jsxs(\"li\",{onClick:onSelectSuggestionAll,className:highlight===0?\"active search-suggestion\":\"search-suggestion\",children:[searchSuggestions.capped?/*#__PURE__*/_jsxs(\"a\",{style:{float:\"right\"},href:\"/q/\"+encodeURIComponent(searchSuggestions.term),children:[searchSuggestions.total.toLocaleString(),\" \",searchSuggestions.desperate?\"approximate matches\":\"good matches\"]}):null,/*#__PURE__*/_jsxs(\"a\",{href:\"/q/\"+encodeURIComponent(searchSuggestions.term),children:[\"Search for \",/*#__PURE__*/_jsx(\"i\",{children:q})]})]}):null,suggestions.map(function(s,index){var className=index+1===highlight?\"active\":\"\";return/*#__PURE__*/_jsx(\"li\",{className:className,onClick:function onClick(e){return onSelectSuggestion(e,s);},children:s.id?/*#__PURE__*/_jsx(ShowAutocompleteSuggestionSong,{song:s}):/*#__PURE__*/_jsx(ShowAutocompleteSuggestion,{text:s.text,html:s.html,found:s.found})},s.id?s.id:s.text);})]})});});var ShowAutocompleteSuggestion=/*#__PURE__*/React.memo(function(_ref4){var found=_ref4.found,html=_ref4.html;if(found){return/*#__PURE__*/_jsxs(\"p\",{className:\"search\",children:[/*#__PURE__*/_jsx(\"small\",{children:found}),/*#__PURE__*/_jsx(\"span\",{dangerouslySetInnerHTML:{__html:html}})]});}else{return/*#__PURE__*/_jsx(\"p\",{className:\"search\",dangerouslySetInnerHTML:{__html:html}});}});var ShowAutocompleteSuggestionSong=/*#__PURE__*/React.memo(function(_ref5){var song=_ref5.song;var imageUrl=placeholderImage;if(song.image){if(song.image.thumbnail100){imageUrl=song.image.thumbnail100;}else{imageUrl=song.image.url;}}return/*#__PURE__*/_jsxs(\"div\",{className:\"media autocomplete-suggestion-song\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"media-left\",children:/*#__PURE__*/_jsx(AutocompleteImage,{url:imageUrl,name:song.name})}),/*#__PURE__*/_jsxs(\"div\",{className:\"media-body\",children:[/*#__PURE__*/_jsxs(\"h5\",{className:\"artist-name\",children:[/*#__PURE__*/_jsx(\"b\",{children:song.name}),/*#__PURE__*/_jsx(\"span\",{className:\"by\",children:\" by \"}),song.artist.name]}),song.fragments.map(function(fragment,i){return/*#__PURE__*/_jsx(\"p\",{dangerouslySetInnerHTML:{__html:fragment}},\"\".concat(song.id,\":\").concat(i));})]})]});});var ShowAutocompleteArtistSuggestions=/*#__PURE__*/React.memo(function(_ref6){var highlight=_ref6.highlight,suggestions=_ref6.suggestions,onSelectSuggestion=_ref6.onSelectSuggestion;if(!suggestions.length){return null;}return/*#__PURE__*/_jsx(\"div\",{className:\"autocomplete\",children:/*#__PURE__*/_jsx(\"ul\",{children:suggestions.map(function(s,index){var className=index===highlight?\"active\":\"\";return/*#__PURE__*/_jsx(\"li\",{className:className,onClick:function onClick(e){return onSelectSuggestion(e,s);},children:/*#__PURE__*/_jsxs(\"div\",{className:\"media\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"media-left\",children:/*#__PURE__*/_jsx(AutocompleteImage,{url:s.thumbnail100||s.image||placeholderImage,name:s.text})}),/*#__PURE__*/_jsxs(\"div\",{className:\"media-body\",children:[/*#__PURE__*/_jsx(\"h5\",{className:\"artist-name\",dangerouslySetInnerHTML:{__html:s.html}}),/*#__PURE__*/_jsxs(\"span\",{className:\"artist-metadata\",children:[s.songs?s.songs:\"0\",\" songs\"]})]})]})},\"\".concat(s.text).concat(index));})})});});function ShowMaxlengthWarning(_ref7){var length=_ref7.length,maxLength=_ref7.maxLength;var className=\"help-block maxlength\";if(length===maxLength){className+=\" danger\";}return/*#__PURE__*/_jsxs(\"span\",{className:className,children:[length,\" of max \",maxLength,\" characters!\"]});}function ShowDesperateSearchWarning(){return/*#__PURE__*/_jsxs(\"span\",{className:\"help-block warning\",children:[/*#__PURE__*/_jsx(\"b\",{children:\"Note!\"}),\" Nothing could be found with that exact search. Showing fuzzy matches.\"]});}function ShowMissingSearchWarning(_ref8){var missing=_ref8.missing;return/*#__PURE__*/_jsxs(\"span\",{className:\"help-block warning\",children:[/*#__PURE__*/_jsx(\"b\",{children:\"Note!\"}),\" Results found by discarding\",\" \",/*#__PURE__*/_jsx(\"i\",{style:{textDecoration:\"line-through\"},children:missing}),\".\"]});}var ShowExamples=/*#__PURE__*/React.memo(function(_ref9){var sampleSearch=_ref9.sampleSearch,examples=_ref9.examples;return/*#__PURE__*/_jsxs(\"div\",{className:\"examples\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"Successful searches for songs by lyrics\"}),/*#__PURE__*/_jsx(\"ul\",{children:examples.map(function(search){var link=\"/q/\"+encodeURIComponent(search.term);link+=\"?example=\".concat(search.id);if(search.artist){link+=\"&artist=\".concat(encodeURIComponent(search.artist));}if(search.language){link+=\"&language=\".concat(encodeURIComponent(search.language));}if(search.year){link+=\"&year=\".concat(search.year);}var searchMeta=null;var searchMetaStrings=[];if(search.artist){searchMetaStrings.push([\"artist\",search.artist]);}if(search.language){searchMetaStrings.push([\"language\",search.language_human]);}if(search.year){searchMetaStrings.push([\"year\",search.year]);}if(searchMetaStrings.length){searchMeta=/*#__PURE__*/_jsxs(\"span\",{children:[\"(\",searchMetaStrings.map(function(n,i){return/*#__PURE__*/_jsxs(React.Fragment,{children:[n[0],\" \",/*#__PURE__*/_jsx(\"b\",{children:n[1]}),i+1<searchMetaStrings.length?\", \":\"\"]},n[0]);}),\")\"]});}return/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsx(Link,{to:link,onClick:function onClick(e){return sampleSearch(e,search);},children:/*#__PURE__*/_jsx(\"b\",{children:search.term})}),\" \",searchMeta,\" \",/*#__PURE__*/_jsxs(\"i\",{children:[search.total_found,\" found\"]}),/*#__PURE__*/_jsx(\"br\",{}),search.opened.map(function(song){return/*#__PURE__*/_jsxs(\"span\",{className:\"opened\",children:[\"clicked on\",\" \",/*#__PURE__*/_jsxs(Link,{to:song._url,children:[/*#__PURE__*/_jsx(\"b\",{children:song.name}),\" by \",/*#__PURE__*/_jsx(\"b\",{children:song.artist.name})]})]},song.id);})]},search.id);})})]});});function SlowSearch(_ref10){var reloadSearch=_ref10.reloadSearch;return/*#__PURE__*/_jsxs(\"div\",{className:\"slow-search\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"Sorry, search seems to take longer than normal!\"}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Perhaps it got stuck? \",/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn btn-default btn-sm\",onClick:reloadSearch,children:\"Reload search\"})]})]});}function SearchError(_ref11){var error=_ref11.error;return/*#__PURE__*/_jsxs(\"div\",{className:\"search-error\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"Sorry, an error occured\"}),error.status===400?/*#__PURE__*/_jsxs(\"p\",{children:[\"The query was invalid \",/*#__PURE__*/_jsx(\"code\",{children:error.text})]}):/*#__PURE__*/_jsx(\"p\",{children:\"The server basically failed to compute the search\"}),error.status>=500&&/*#__PURE__*/_jsx(\"p\",{children:\"Perhaps simply try again a little later.\"}),error.status>=500&&/*#__PURE__*/_jsx(\"p\",{children:/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn btn-default\",onClick:function onClick(event){window.location.reload(true);},children:\"Reload to try again\"})})]});}var Results=/*#__PURE__*/function(_React$PureComponent3){_inherits(Results,_React$PureComponent3);var _super4=_createSuper(Results);function Results(){var _this14;_classCallCheck(this,Results);for(var _len2=arguments.length,args=new Array(_len2),_key2=0;_key2<_len2;_key2++){args[_key2]=arguments[_key2];}_this14=_super4.call.apply(_super4,[this].concat(args));_this14.firstLoad=true;return _this14;}_createClass(Results,[{key:\"componentDidMount\",value:function componentDidMount(){if(!isServer){loadCarbonScript();}this.firstLoad=false;}},{key:\"componentDidUpdate\",value:function componentDidUpdate(prevProps){// Is this if-statement necessary? I mean, isn't componentDidUpdate\n// something that *only* happens with non-SSR rendering??\nif(!isServer&&prevProps.results!==this.props.results){loadCarbonScript();}}},{key:\"render\",value:function render(){var _this15=this;var _this$props=this.props,results=_this$props.results,searched=_this$props.searched,popularityFactor=_this$props.popularityFactor,showYear=_this$props.showYear;return/*#__PURE__*/_jsxs(\"div\",{children:[!NO_ADS?/*#__PURE__*/_jsx(\"div\",{id:\"carbonadsouter\"}):/*#__PURE__*/_jsx(\"span\",{id:\"_nocardonads\"}),/*#__PURE__*/_jsx(\"div\",{className:\"results\",children:results.map(function(result,index){return/*#__PURE__*/_jsx(Result,{result:result,searched:searched,expandedByDefault:results.length===1,firstResult:index===0,popularityFactor:popularityFactor,firstLoad:_this15.firstLoad,showYear:showYear},result.id);})})]});}}]);return Results;}(React.PureComponent);var Result=/*#__PURE__*/function(_React$PureComponent4){_inherits(Result,_React$PureComponent4);var _super5=_createSuper(Result);function Result(){var _this16;_classCallCheck(this,Result);for(var _len3=arguments.length,args=new Array(_len3),_key3=0;_key3<_len3;_key3++){args[_key3]=arguments[_key3];}_this16=_super5.call.apply(_super5,[this].concat(args));_this16.state={collapsed:true,itunes:null,amazon:null,textHtml:_this16.props.result.text_html};_this16.affiliateLookupStarted=[];_this16.onExpandClick=function(event){event.preventDefault();_this16.expand();};return _this16;}_createClass(Result,[{key:\"componentDidMount\",value:function componentDidMount(){if(this.props.expandedByDefault){this.expand();}}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){this.dismounted=true;}},{key:\"expand\",value:function expand(){var _this17=this;var wasCollapsed=this.state.collapsed;this.setState({collapsed:false});this.fetchTextHTML().then(function(){if(wasCollapsed){if(_this17.props.searched){var recordURL=\"/api/song/\".concat(_this17.props.result.id,\"/\");recordURL+=\"expand/\".concat(_this17.props.searched);fetch(recordURL,{method:\"POST\"}).then(function(r){return r.json();}).then(function(result){// nothing to do\n});}}});}},{key:\"fetchTextHTML\",value:function fetchTextHTML(){var _this18=this;if(this.state.textHtml){return Promise.resolve();}else{var url=\"/api/song/\".concat(this.props.result.id,\"?text_only=true\");return fetch(url).then(function(r){return r.json();}).then(function(result){if(_this18.dismounted){return;}_this18.setState({textHtml:result.song.text_html});});}}},{key:\"render\",value:function render(){var _this$props2=this.props,result=_this$props2.result,popularityFactor=_this$props2.popularityFactor,firstResult=_this$props2.firstResult,firstLoad=_this$props2.firstLoad,showYear=_this$props2.showYear;var className=\"result\";if(this.state.collapsed){className+=\" collapsed\";}var songURL=result._url;var image;if(result.image){image=/*#__PURE__*/_jsx(SongImage,{url:result.image.url,className:\"pull-right img-thumbnail album\",name:result.image.name,forceLoad:firstResult||!firstLoad});}else{image=/*#__PURE__*/_jsx(SongImage,{url:null,className:\"pull-right img-thumbnail\",name:result.artist.name,forceLoad:firstResult||!firstLoad});}var rest=/*#__PURE__*/_jsxs(\"p\",{className:\"read-more\",children:[/*#__PURE__*/_jsx(Link,{to:songURL,children:\"VIEW SONG\"}),\" \",/*#__PURE__*/_jsx(Link,{to:songURL,onClick:this.onExpandClick,children:\"EXPAND SONG\"})]});if(!this.state.collapsed){var searchedId=null;var searched=null;try{searched=localStorage.getItem(\"searched\");}catch(ex){console.warn(\"'localStorage.getItem(\\\"searched\\\")' didn't work\");}if(searched){if(searched.includes(\",\")){// The new way\nsearchedId=parseInt(searched.split(\",\")[0],10);}else{// The old way!\nsearchedId=parseInt(searched,10);}}rest=/*#__PURE__*/_jsx(\"div\",{className:\"rest\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Full Text\"}),this.state.textHtml?/*#__PURE__*/_jsx(RenderParagraphs,{text:this.state.textHtml}):/*#__PURE__*/_jsx(\"i\",{children:\"Loading full text...\"}),/*#__PURE__*/_jsx(SongComments,{comments:null,commentsCount:null,song:result,searchedId:searchedId}),/*#__PURE__*/_jsx(AmazonRelatedProducts,{song:result}),/*#__PURE__*/_jsx(\"p\",{className:\"load-more\",children:/*#__PURE__*/_jsx(Link,{to:songURL,children:\"GO TO SONG PAGE\"})})]})});}var artistName=/*#__PURE__*/_jsx(\"b\",{children:result.artist.name});if(result.artist.fragment){artistName=/*#__PURE__*/_jsx(\"b\",{dangerouslySetInnerHTML:{__html:result.artist.fragment}});}var tooltipTitle;if(process.env.NODE_ENV===\"development\"){var score=result.score.toFixed(4);tooltipTitle=\"Score \".concat(score);if(result.popularity){tooltipTitle+=\" Popularity: \".concat(result.popularity.toFixed(6));}}else{tooltipTitle=\"Click to view just this song\";}return/*#__PURE__*/_jsxs(\"div\",{className:className,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"head\",children:[/*#__PURE__*/_jsx(Link,{to:songURL,children:image}),/*#__PURE__*/_jsxs(\"h2\",{title:tooltipTitle,children:[/*#__PURE__*/_jsx(Link,{to:songURL,children:result.name}),showYear&&result.year&&/*#__PURE__*/_jsxs(\"span\",{className:\"year\",children:[\" \",result.year]}),process.env.NODE_ENV===\"development\"?/*#__PURE__*/_jsx(ShowSongScore,{song:result,factor:popularityFactor}):null]}),/*#__PURE__*/_jsxs(\"h3\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"by\",children:\"by\"}),\" \",artistName]}),result.albums.length?/*#__PURE__*/_jsx(Albums,{albums:result.albums}):null]}),/*#__PURE__*/_jsx(\"div\",{className:\"fragments\",children:result.fragments.map(function(fragment,i){return/*#__PURE__*/_jsx(\"p\",{dangerouslySetInnerHTML:{__html:fragment}},\"\".concat(result.id).concat(i));})}),rest]});}}]);return Result;}(React.PureComponent);var SongImage=/*#__PURE__*/React.memo(function(_ref12){var url=_ref12.url,name=_ref12.name,forceLoad=_ref12.forceLoad,className=_ref12.className;// If the song doesn't haven an image, no point messing around.\nif(!url){return/*#__PURE__*/_jsx(\"img\",{src:placeholderImage,className:className,title:name,alt:name});}return/*#__PURE__*/_jsx(\"img\",{src:url,className:className,title:name,alt:name,loading:forceLoad?undefined:\"lazy\"});});// This assumes that we'll sooner or later need the lazyloadThumbnailImage image\nif(!isServer){new Image().src=lazyloadThumbnailImage;}// Module level \"cache\" of which image URLs have been successfully inserted\n// into the DOM at least once.\n// By knowing these, we can, on repeat URLs, avoid the whole lazy-load\n// image swapping trick.\nvar loadedOnce=new Set();function AutocompleteImage(_ref13){var url=_ref13.url,name=_ref13.name;var _useState=useState(loadedOnce.has(url)?url:lazyloadThumbnailImage),_useState2=_slicedToArray(_useState,2),src=_useState2[0],setSrc=_useState2[1];useEffect(function(){var preloadImg=null;var dismounted=false;if(src===lazyloadThumbnailImage){var cb=function cb(){if(!dismounted){setSrc(url);}loadedOnce.add(url);};// This must come before .decode() otherwise Safari will\n// raise an EncodingError.\n// We need to preload the eventually needed image.\npreloadImg=new Image();preloadImg.src=url;// https://html.spec.whatwg.org/multipage/embedded-content.html#dom-img-decode\n// https://developer.mozilla.org/en-US/docs/Web/API/HTMLImageElement/decode#Browser_compatibility\npreloadImg.decode?preloadImg.decode().then(cb,cb):preloadImg.onload=cb;// https://developer.mozilla.org/en-US/docs/Web/API/HTMLImageElement/decoding\npreloadImg.decoding=\"sync\";}return function(){if(preloadImg){// Immediately undo the preloading since we might not need this image.\n// See https://jsfiddle.net/nw34gLgt/ for demo of this technique.\npreloadImg.src=\"\";}dismounted=true;};},[url,src]);if(!url){// Don't even bother with lazy loading.\nreturn/*#__PURE__*/_jsx(\"img\",{className:\"img-rounded\",src:lazyloadThumbnailImage,alt:name,title:name});}return/*#__PURE__*/_jsx(\"img\",{className:\"img-rounded\",src:src,alt:name,title:name});}function ShowSongScore(_ref14){var song=_ref14.song,_ref14$factor=_ref14.factor,factor=_ref14$factor===void 0?20:_ref14$factor;var s=song.score-factor*song.popularity;return/*#__PURE__*/_jsxs(\"code\",{children:[song.score.toFixed(3),\" = \",s.toFixed(3),\" + \",factor,\"\\xD7\",song.popularity.toFixed(4)]});}var SongsByName=/*#__PURE__*/React.memo(function(_ref15){var results=_ref15.results,total=_ref15.total,limit=_ref15.limit,loadMoreByName=_ref15.loadMoreByName;return/*#__PURE__*/_jsxs(\"div\",{className:\"by-name\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"Songs by name\"}),/*#__PURE__*/_jsx(\"ul\",{children:results.map(function(s){return/*#__PURE__*/_jsx(\"li\",{children:/*#__PURE__*/_jsxs(Link,{to:s._url,children:[/*#__PURE__*/_jsx(\"b\",{dangerouslySetInnerHTML:{__html:s.fragment}}),\" by\",\" \",/*#__PURE__*/_jsx(\"b\",{children:s.artist.name})]})},s.id);})}),total>limit?/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-default btn-sm\",onClick:loadMoreByName,children:total>20?\"Show more songs by name\":\"Show all (\".concat(total,\") songs by name\")}):null]});});var Albums=/*#__PURE__*/React.memo(function(_ref16){var albums=_ref16.albums;return/*#__PURE__*/_jsx(\"p\",{className:\"albums\",children:albums.map(function(album,i){var parts=[/*#__PURE__*/_jsx(\"b\",{children:album.name},album.id)];if(album.year){parts.push(\" (\".concat(album.year,\")\"));}if(i+1<albums.length){parts.push(\", \");}return parts;})});});var Pagination=/*#__PURE__*/React.memo(function(_ref17){var location=_ref17.location,onLoadMore=_ref17.onLoadMore;var currentURL=location.pathname+location.search;return/*#__PURE__*/_jsx(\"div\",{className:\"load-more\",children:/*#__PURE__*/_jsx(\"a\",{href:currentURL,onClick:onLoadMore,children:\"LOAD MORE RESULTS\"})});});","map":{"version":3,"sources":["/home/mandeep/Downloads/Song-sorch work/site/src/Home.js"],"names":["React","useState","useEffect","Link","Redirect","throttle","debounce","copy","cachedFetch","Countdown","CountdownTimer","Bannertop","pics","mobileimgs","Loading","SetHTMLHeaders","ResetHTMLHeaders","isServer","loadCarbonScript","AmazonRelatedProducts","RenderParagraphs","SongComments","ShowRecentComments","PUBLIC_URL","process","env","lazyloadThumbnailImage","placeholderImage","NO_ADS","REACT_APP_NO_ADS","samplePlaceholders","sort","Math","random","appendSuggestion","text","append","split","pop","push","join","Completionist","THREE_DAYS_IN_MS","NOW_IN_MS","Date","getTime","dateTimeAfterThreeDays","Home","props","artistRef","createRef","languageRef","searchRef","startSearchFromLocation","match","q","decodeURIComponent","params","sp","URLSearchParams","location","search","artist","get","language","year","searchExample","state","stateUpdate","length","current","maxLength","searchMaxLength","loadSearchAggregates","advancedSearch","searchLanguage","searchYear","artistName","setState","startSearch","resultsPageIndex","title","onFocusSearch","placeholder","clearInterval","placeholderSampleInterval","fillerInterval","showAutocompleteSuggestions","shareSearch","_firstFocusSearch","window","innerHeight","scrollIntoView","onBlurSearch","event","setNextSamplePlaceholder","startSamplePlaceholderInterval","setTimeout","dismounted","onFocusArtist","showAutocompleteArtistSuggestions","onBlurArtist","sampleSearch","preventDefault","term","id","searchLanguages","searchYears","submitSearch","onSubmit","_fetchSearchAlternatives","url","parentSearch","then","r","status","json","results","keyPhrases","key_phrases","onChangeSearch","target","value","desperateSearch","originalQ","trim","autocompleteWaitingFor","endsWith","fetchAutocompleteSuggestionsThrottled","fetchAutocompleteSuggestionsDebouncedLong","fetchAutocompleteSuggestionsDebounced","autocompleteSuggestions","autocompleteSearchSuggestions","autocompleteHighlight","onKeyDownSearch","suggestions","highlight","key","suggestion","_url","fetchAutocompleteSuggestions","searchSuggestions","total","console","warn","redirectTo","pathname","onKeyDownArtistSearch","autocompleteArtistSuggestions","autocompleteArtistHighlight","fetchAutocompleteArtistSuggestions","toggleShareSearch","toggleAdvancedSearch","withCountsLanguages","filter","x","count","withCountsYears","onChangeLanguage","onChangeYear","onChangeArtistName","onSelectSuggestion","newText","onSelectSuggestionAll","onSelectArtistSuggestion","onLoadMore","submitPhrase","keyPhrase","phrase","reloadSearch","reload","loadMoreByName","previousByNameLimit","by_name_limit","by_name_total","encodeURIComponent","fetch","by_name","displayYears","yearEnd","currentYear","getFullYear","searchResults","desperate","missing","popularityFactor","searched","original","search_example","Boolean","searchExamples","showExamples","examples","recentComments","showRecentComments","comments","searching","searchError","slowSearch","onlyResults","_autocompleteSuggestionsCache","fetchSearchExamples","fetchRecentComments","prevProps","stopSamplePlaceholderInterval","slowSearchTimer","clearTimeout","currentPlaceholder","setInterval","el","slice","substring","newURL","includes","currentURL","history","document","querySelector","blur","page","sendSearch","error","localStorage","setItem","ex","allResults","forEach","popularity_factor","cacheHash","cached","Promise","resolve","matches","search_suggestions","startsWith","languages","years","pagination","rows","onlyIds","map","row","byName","searchToggles","advancedSearchStatus","parts","e","code","parseInt","advancedInput","position","each","toLocaleString","Component","ShowRecentCommentsWrapper","marginTop","PureComponent","ShowResultCount","memo","countResults","byNameCount","ShareInput","copied","failed","hasFocused","absurlRef","absoluteUrl","href","select","method","ShowKeyPhrases","phrases","nothingFound","subTitle","diff_html","__html","ShowAutocompleteSuggestions","capped","float","s","index","className","html","found","ShowAutocompleteSuggestion","ShowAutocompleteSuggestionSong","song","imageUrl","image","thumbnail100","name","fragments","fragment","i","ShowAutocompleteArtistSuggestions","songs","ShowMaxlengthWarning","ShowDesperateSearchWarning","ShowMissingSearchWarning","textDecoration","ShowExamples","link","searchMeta","searchMetaStrings","language_human","n","total_found","opened","SlowSearch","SearchError","Results","firstLoad","showYear","result","Result","collapsed","itunes","amazon","textHtml","text_html","affiliateLookupStarted","onExpandClick","expand","expandedByDefault","wasCollapsed","fetchTextHTML","recordURL","firstResult","songURL","rest","searchedId","getItem","tooltipTitle","NODE_ENV","score","toFixed","popularity","albums","SongImage","forceLoad","undefined","Image","src","loadedOnce","Set","AutocompleteImage","has","setSrc","preloadImg","cb","add","decode","onload","decoding","ShowSongScore","factor","SongsByName","limit","Albums","album","Pagination"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport { Link, Redirect } from \"react-router-dom\";\nimport { throttle, debounce } from \"throttle-debounce\";\n// import { Waypoint } from \"react-waypoint\";\nimport copy from \"copy-to-clipboard\";\nimport { cachedFetch } from \"./Cache\";\nimport Countdown from \"react-countdown\";\nimport CountdownTimer from \"./CountdownTimer\";\nimport Bannertop from \"./Bannertop\";\nimport pics from \"./songs_desktop.png\";\nimport mobileimgs from \"./songs_mobile.png\";\nimport {\n  Loading,\n  SetHTMLHeaders,\n  ResetHTMLHeaders,\n  isServer,\n  // YouTubeSnippetIntersectionLazy,\n  loadCarbonScript,\n  AmazonRelatedProducts,\n  RenderParagraphs\n} from \"./Common\";\nimport { SongComments } from \"./Comments\";\nimport { ShowRecentComments } from \"./RecentComments\";\n\n// if (process.env.PUBLIC_URL === undefined) {\n//   // console.error(\"process.env.PUBLIC_URL should not be undefined\");\n//   throw new Error(\"process.env.PUBLIC_URL should not be undefined\");\n// }\nconst PUBLIC_URL = process.env.PUBLIC_URL || \"\";\nconst lazyloadThumbnailImage = PUBLIC_URL + \"/static/lazyload-thumbnail.png\";\nconst placeholderImage = PUBLIC_URL + \"/static/placeholder.png\";\n\nconst NO_ADS = process.env.REACT_APP_NO_ADS === \"true\";\n\nconst samplePlaceholders = [\n  \"Born to be wild\",\n  \"No one ever told me life was kind\",\n  \"But here it comes again, straight thru the heart\",\n  \"I'm an alligator\",\n  \"My mouth, it moves\"\n];\nsamplePlaceholders.sort(() => 0.5 - Math.random());\n\nconst appendSuggestion = (text, append) => {\n  let split = text.split(/\\s+/);\n  split.pop();\n  split.push(append);\n  return split.join(\" \");\n};\n\nconst Completionist = () => <span>You are good to go!</span>;\nconst THREE_DAYS_IN_MS = 3 * 24 * 60 * 60 * 1000;\nconst NOW_IN_MS = new Date().getTime();\n\nconst dateTimeAfterThreeDays = NOW_IN_MS + THREE_DAYS_IN_MS;\n\nclass Home extends React.Component {\n  constructor(props) {\n    super(props);\n\n    let q = \"\";\n    let originalQ = \"\";\n    let artistName = \"\";\n    let total = 0;\n    let searchResults = null;\n    let desperate = false;\n    let missing = null;\n    // let suggestions = null;\n    let by_name = null;\n    let by_name_total = null;\n    let by_name_limit = null;\n    let searchLanguage = \"\";\n    let searchYear = \"\";\n    let parentSearch = null;\n    let keyPhrases = null;\n    let popularityFactor = null;\n    let searchExample = null;\n\n    const { results } = this.props;\n\n    if (results) {\n      this.searched = results.searched;\n\n      q = results.search;\n      total = results.total;\n      searchResults = results.results;\n      desperate = results.desperate;\n      missing = results.missing;\n      by_name = results.by_name || null;\n      by_name_total = results.by_name_total || null;\n      by_name_limit = results.by_name_limit || null;\n      artistName = results.artist;\n      originalQ = results.original || \"\";\n      searchLanguage = results.language || \"\";\n      searchYear = results.year || \"\";\n      parentSearch = results.searched || null;\n      keyPhrases = results.key_phrases || null;\n      popularityFactor = results.popularityFactor || null;\n      searchExample = results.search_example || null;\n    }\n    let advancedSearch = Boolean(artistName || searchLanguage || searchYear);\n\n    let searchExamples = null;\n    let showExamples = false;\n    if (props.searchExamples && props.searchExamples.examples) {\n      searchExamples = props.searchExamples.examples;\n      showExamples = true;\n    }\n\n    let recentComments = null;\n    let showRecentComments = false;\n    if (\n      props.recentComments &&\n      props.recentComments.comments &&\n      props.recentComments.comments.length\n    ) {\n      recentComments = props.recentComments;\n      showRecentComments = true;\n    }\n\n    this.state = {\n      q,\n      originalQ,\n      artistName,\n      searching: false,\n      searchError: null,\n      total,\n      results: searchResults,\n      resultsPageIndex: 0,\n      by_name,\n      by_name_total,\n      by_name_limit,\n      placeholder: samplePlaceholders[0],\n      slowSearch: null,\n      showExamples,\n      searchExamples,\n      parentSearch,\n      desperateSearch: desperate,\n      missing,\n      keyPhrases,\n      popularityFactor,\n      searchExample,\n      showRecentComments,\n      recentComments,\n\n      onlyResults: null,\n\n      searchMaxLength: null,\n\n      autocompleteSuggestions: null,\n      autocompleteSearchSuggestions: null,\n      autocompleteHighlight: -1,\n      showAutocompleteSuggestions: true,\n\n      autocompleteArtistSuggestions: null,\n      autocompleteArtistHighlight: -1,\n      showAutocompleteArtistSuggestions: true,\n\n      advancedSearch,\n      searchLanguage,\n      searchLanguages: [],\n      searchYear,\n      searchYears: [],\n\n      redirectTo: null,\n      shareSearch: false\n    };\n\n    // When you've typed something longer.\n    // If you steadily type something every 100ms for a long time\n    // without pausing, this won't fire till you stop.\n    this.fetchAutocompleteSuggestionsDebounced = debounce(\n      800,\n      this.fetchAutocompleteSuggestions\n    );\n    this.fetchAutocompleteSuggestionsDebouncedLong = debounce(\n      1800,\n      this.fetchAutocompleteSuggestions\n    );\n\n    // When you've started typing.\n    // Will basically fire without being postponed.\n    this.fetchAutocompleteSuggestionsThrottled = throttle(\n      1100,\n      this.fetchAutocompleteSuggestions\n    );\n\n    this._autocompleteSuggestionsCache = {};\n  }\n\n  artistRef = React.createRef();\n  languageRef = React.createRef();\n  searchRef = React.createRef();\n\n  componentDidMount() {\n    ResetHTMLHeaders();\n    if (this.props.match.params.q) {\n      this.startSearchFromLocation(this.props);\n    } else {\n      this.startSamplePlaceholderInterval();\n      if (!this.state.searchExamples) {\n        this.fetchSearchExamples();\n      }\n      if (!this.state.recentComments) {\n        this.fetchRecentComments();\n      }\n    }\n    if (this.state.results) {\n      if (\n        (this.state.desperateSearch || !this.state.total) &&\n        this.state.q.length > 10\n      ) {\n        this._fetchSearchAlternatives();\n      }\n    }\n  }\n\n  startSearchFromLocation = (props) => {\n    const { match } = props;\n    const q = decodeURIComponent(match.params.q);\n\n    const sp = new URLSearchParams(props.location.search || \"\");\n    let artist = sp.get(\"artist\");\n    let language = sp.get(\"language\");\n    let year = sp.get(\"year\");\n    let searchExample = sp.get(\"example\");\n\n    // XXX should this compare artist and language too?\n    if (this.state.q !== q) {\n      const stateUpdate = {\n        q\n      };\n      if (q.length > this.searchRef.current.maxLength - 10) {\n        stateUpdate.searchMaxLength = [\n          q.length,\n          this.searchRef.current.maxLength\n        ];\n      }\n\n      if (language || year) {\n        this.loadSearchAggregates();\n        stateUpdate.advancedSearch = true;\n      }\n      if (language) {\n        stateUpdate.searchLanguage = language;\n      }\n      if (year) {\n        stateUpdate.searchYear = year;\n      }\n      if (artist) {\n        stateUpdate.artistName = artist;\n        stateUpdate.advancedSearch = true;\n      }\n      if (searchExample) {\n        stateUpdate.searchExample = searchExample;\n      }\n      this.setState(stateUpdate, () => {\n        this.startSearch(\n          q,\n          language,\n          year,\n          artist,\n          this.state.resultsPageIndex,\n          this.state.searchExample\n        );\n      });\n    } else {\n      SetHTMLHeaders({\n        title: `${q} - Song Search`\n      });\n    }\n  };\n\n  componentDidUpdate(prevProps) {\n    if (this.props.match.params.q !== prevProps.match.params.q) {\n      if (!this.props.match.params.q) {\n        ResetHTMLHeaders();\n        this.setState({\n          q: \"\",\n          originalQ: \"\",\n          artistName: \"\",\n          searching: false,\n          total: null,\n          results: null,\n          resultsPageIndex: 0,\n          slowSearch: null,\n          showExamples: false,\n          searchExamples: null,\n          showRecentComments: false,\n          parentSearch: null,\n          desperateSearch: false,\n          searchExample: null,\n          missing: null,\n          searchError: null,\n          by_name: null,\n          by_name_total: null,\n          by_name_limit: null,\n          autocompleteSuggestions: null,\n          autocompleteSearchSuggestions: null,\n          autocompleteHighlight: -1,\n          autocompleteArtistSuggestions: null,\n          autocompleteArtistHighlight: -1,\n          redirectTo: null,\n          shareSearch: false\n        });\n        // this.refs.q.value = \"\";\n        this.fetchSearchExamples();\n      } else if (\n        decodeURIComponent(this.props.match.params.q) !== this.state.q\n      ) {\n        this.startSearchFromLocation(this.props);\n      }\n    }\n  }\n\n  componentWillUnmount() {\n    this.dismounted = true;\n    this.stopSamplePlaceholderInterval();\n    if (this.fillerInterval) {\n      window.clearInterval(this.fillerInterval);\n    }\n    if (this.slowSearchTimer) {\n      window.clearTimeout(this.slowSearchTimer);\n    }\n  }\n\n  fetchSearchExamples() {\n    let url = \"/api/search/examples\";\n    return fetch(url).then((r) => {\n      if (r.status === 200) {\n        return r.json().then((results) => {\n          if (this.dismounted) {\n            return;\n          }\n          if (results) {\n            if (!this.state.results && !this.state.searching) {\n              this.setState({\n                searchExamples: results.examples,\n                showExamples: true\n              });\n            }\n          }\n        });\n      }\n    });\n  }\n\n  fetchRecentComments() {\n    let url = \"/api/comments/recent/home\";\n    return fetch(url).then((r) => {\n      if (r.status === 200) {\n        return r.json().then((results) => {\n          if (this.dismounted) {\n            return;\n          }\n          if (results) {\n            if (!this.state.results && !this.state.searching) {\n              this.setState({\n                recentComments: results,\n                showRecentComments: true\n              });\n            }\n          }\n        });\n      }\n    });\n  }\n\n  stopSamplePlaceholderInterval() {\n    if (this.placeholderSampleInterval) {\n      window.clearInterval(this.placeholderSampleInterval);\n    }\n  }\n\n  startSamplePlaceholderInterval() {\n    if (this.state.q) {\n      return;\n    }\n    // let el = document.querySelector('input[type=\"search\"]')\n    // if (!el || el.value) return\n    this.currentPlaceholder = 0;\n    if (this.placeholderSampleInterval) {\n      window.clearInterval(this.placeholderSampleInterval);\n    }\n    this.placeholderSampleInterval = window.setInterval(() => {\n      this.setNextSamplePlaceholder();\n    }, 3000);\n  }\n\n  setNextSamplePlaceholder() {\n    if (this.fillerInterval) {\n      window.clearInterval(this.fillerInterval);\n    }\n    const placeholder =\n      samplePlaceholders[++this.currentPlaceholder % samplePlaceholders.length];\n    const el = this.searchRef.current;\n    if (!el) return;\n    let slice = 0;\n    this.fillerInterval = setInterval(() => {\n      if (!placeholder) {\n        // something's gone wrong\n        return;\n      }\n      el.placeholder = placeholder.substring(0, ++slice);\n      if (slice >= placeholder.length) {\n        clearInterval(this.fillerInterval);\n        el.placeholder += \"...\";\n      }\n    }, 10);\n  }\n\n  onFocusSearch = () => {\n    this.searchRef.current.placeholder = \"\";\n    clearInterval(this.placeholderSampleInterval);\n    if (this.fillerInterval) {\n      clearInterval(this.fillerInterval);\n    }\n    if (!this.state.showAutocompleteSuggestions) {\n      this.setState({ showAutocompleteSuggestions: true });\n    }\n    if (this.state.shareSearch) {\n      this.setState({ shareSearch: false });\n    }\n\n    if (!this._firstFocusSearch) {\n      this._firstFocusSearch = true;\n      // If you're on a small screen this is the first time you've focused,\n      // the scroll the top of the search input into view.\n      if (window.innerHeight && window.innerHeight < 600) {\n        this.searchRef.current.scrollIntoView();\n      }\n    }\n  };\n\n  onBlurSearch = (event) => {\n    if (!this.state.q) {\n      this.setNextSamplePlaceholder();\n      this.startSamplePlaceholderInterval();\n    }\n    setTimeout(() => {\n      if (!this.dismounted) {\n        this.setState({\n          showAutocompleteSuggestions: false\n        });\n      }\n    }, 300);\n  };\n\n  onFocusArtist = (event) => {\n    if (!this.state.showAutocompleteArtistSuggestions) {\n      this.setState({ showAutocompleteArtistSuggestions: true });\n    }\n  };\n\n  onBlurArtist = (event) => {\n    setTimeout(() => {\n      if (!this.dismounted) {\n        this.setState({\n          showAutocompleteArtistSuggestions: false\n        });\n      }\n    }, 300);\n  };\n\n  sampleSearch = (event, search) => {\n    event.preventDefault();\n    const stateUpdate = { q: search.term, searchExample: search.id };\n\n    if (search.language || search.year) {\n      if (\n        !this.state.searchLanguages.length ||\n        !this.state.searchYears.length\n      ) {\n        this.loadSearchAggregates();\n      }\n    }\n\n    if (search.language) {\n      stateUpdate.searchLanguage = search.language;\n      stateUpdate.advancedSearch = true;\n    } else if (this.state.searchLanguage) {\n      stateUpdate.searchLanguage = \"\";\n    }\n\n    if (search.year) {\n      stateUpdate.searchYear = search.year;\n      stateUpdate.advancedSearch = true;\n    } else if (this.state.searchYear) {\n      stateUpdate.searchYear = \"\";\n    }\n\n    if (search.artist) {\n      stateUpdate.artistName = search.artist;\n      stateUpdate.advancedSearch = true;\n    } else if (this.state.artistName) {\n      stateUpdate.artistName = \"\";\n    }\n\n    this.setState(stateUpdate, () => {\n      this.submitSearch();\n    });\n  };\n\n  onSubmit = (event) => {\n    event.preventDefault();\n    this.submitSearch();\n  };\n\n  submitSearch() {\n    let q = this.state.q.trim();\n    // let language = this.languageRef.current && this.languageRef.current.value;\n    // if (!language && this.state.searchLanguage) {\n    //   language = this.state.searchLanguage;\n    // }\n    const language = this.state.searchLanguage;\n    const year = this.state.searchYear;\n\n    let artistName =\n      this.artistRef.current && this.artistRef.current.value.trim();\n    if (!artistName && this.state.artistName) {\n      if (!this.state.advancedSearch) {\n        artistName = this.state.artistName;\n      }\n    } else if (artistName && !this.state.artistName) {\n      this.setState({ artistName });\n    }\n    if (q) {\n      let newURL = `/q/${encodeURIComponent(q)}`;\n      // only include the language= if it's set and not 'en'\n      if (language && language !== \"en\") {\n        newURL += `?language=${language}`;\n      }\n      if (year) {\n        newURL += newURL.includes(\"?\") ? \"&\" : \"?\";\n        newURL += `year=${year}`;\n      }\n      if (artistName) {\n        newURL += newURL.includes(\"?\") ? \"&\" : \"?\";\n        newURL += `artist=${encodeURIComponent(artistName)}`;\n      }\n      let currentURL = this.props.location.pathname;\n      if (this.props.location.search) {\n        currentURL += this.props.location.search;\n      }\n      if (newURL === currentURL) {\n        // get out of here\n        return;\n      }\n      this.props.history.push(newURL);\n      this.startSearch(q, language, year, artistName);\n\n      // XXX this.searchRef.current.blur()????\n      document.querySelector('input[type=\"search\"]').blur();\n      if (this.state.autocompleteSuggestions) {\n        this.setState({\n          autocompleteSuggestions: null,\n          autocompleteSearchSuggestions: null,\n          autocompleteHighlight: -1,\n          showAutocompleteSuggestions: true\n        });\n      }\n      if (this.state.autocompleteArtistSuggestions) {\n        this.setState({\n          autocompleteArtistSuggestions: null,\n          autocompleteArtistHighlight: -1\n        });\n      }\n    }\n  }\n\n  startSearch(\n    q,\n    language = null,\n    year = null,\n    artist = null,\n\n    page = 0,\n    searchExample = null\n  ) {\n    SetHTMLHeaders({\n      title: \"Searching... - Song Search\"\n    });\n    // The state change is quite differnet depend on it being\n    // the first page or a subsequent page.\n    if (page) {\n      this.setState(\n        {\n          searching: true,\n          searchError: null\n        },\n        () => {\n          this.sendSearch(q, language, year, artist, page, searchExample);\n        }\n      );\n    } else {\n      this.setState(\n        {\n          searching: true,\n          searchError: null,\n          // suggestions: null,\n          results: null,\n          by_name: null,\n          showExamples: false,\n          showRecentComments: false,\n          parentSearch: null\n        },\n        () => {\n          this.sendSearch(q, language, year, artist, page, searchExample);\n          this.slowSearchTimer = window.setTimeout(() => {\n            if (!this.state.searchError && !this.state.results) {\n              this.setState({ slowSearch: true });\n            }\n          }, 5 * 1000);\n        }\n      );\n    }\n  }\n\n  sendSearch(\n    q,\n    language = null,\n    year = null,\n    artist = null,\n    page = 0,\n    searchExample = null\n  ) {\n    let url = `/api/search?q=${encodeURIComponent(q)}`;\n    if (language) {\n      url += `&language=${language}`;\n    }\n    if (year) {\n      url += `&year=${year}`;\n    }\n    if (artist) {\n      url += `&artist=${encodeURIComponent(artist)}`;\n    }\n    if (page) {\n      url += `&page=${page + 1}`;\n      url += `&searched=${this.searched}`;\n    } else if (this.state.originalQ) {\n      url += `&original=${this.searched}`;\n    }\n    if (this.state.desperateSearch && !this.state.originalQ) {\n      url += `&desperate=true`;\n    }\n    if (searchExample) {\n      url += `&example=${searchExample}`;\n    }\n    return cachedFetch(url).then((r) => {\n      if (r.status === 200) {\n        return r.json().then((results) => {\n          if (this.slowSearchTimer) {\n            window.clearTimeout(this.slowSearchTimer);\n          }\n          if (this.dismounted) {\n            return;\n          }\n          if (!results) {\n            return;\n          }\n          if (results.error) {\n            this.setState({\n              searchError: results.error,\n              searching: false,\n              slowSearch: null\n            });\n            SetHTMLHeaders({\n              title: \"Sorry, search error\"\n            });\n            return;\n          } else if (this.state.searchError) {\n            this.setState({ searchError: null });\n          }\n\n          SetHTMLHeaders({\n            title: `${q} - Song Search`\n          });\n\n          // This is the first time sendSearch is called for\n          // this q (and this offset).\n          // Decide whether to get suggestions searches...\n          // console.log(\n          //   'Results:', results.results.length,\n          //   'Total:', results.total,\n          //   'Limit:', results.limit,\n          // )\n\n          // set this so that the onExpandClick can use it\n          if (!page) {\n            this.searched = results.searched;\n          }\n          // set in localStorage for the sake \"Open in a new tab\"\n          try {\n            localStorage.setItem(\n              \"searched\",\n              `${results.searched},${new Date().getTime()}`\n            );\n          } catch (ex) {\n            console.warn(\"'localStorage.setItem(\\\"searched\\\")' didn't work\");\n          }\n\n          let allResults;\n          if (page) {\n            allResults = [];\n            this.state.results.forEach((r) => allResults.push(r));\n            results.results.forEach((r) => allResults.push(r));\n          } else {\n            allResults = results.results;\n          }\n          this.setState(\n            {\n              desperateSearch: results.desperate,\n              missing: results.missing,\n              popularityFactor: results.popularity_factor,\n              parentSearch: results.searched,\n              searching: false,\n              results: allResults,\n              keyPhrases: null,\n              by_name: results.by_name,\n              by_name_total: results.by_name_total,\n              by_name_limit: results.by_name_limit,\n              total: results.total,\n              searchError: null,\n              slowSearch: null\n            },\n            () => {\n              if (\n                (this.state.desperateSearch || !this.state.total) &&\n                this.state.q.length > 10\n              ) {\n                this._fetchSearchAlternatives();\n              }\n            }\n          );\n        });\n      } else {\n        r.text().then((text) => {\n          SetHTMLHeaders({\n            title: \"Search Error\"\n          });\n          this.setState({\n            searching: false,\n            searchError: { status: r.status, text: text },\n            slowSearch: false\n          });\n        });\n      }\n    });\n  }\n\n  _fetchSearchAlternatives = () => {\n    const url = `/api/search/alternatives?searched=${this.state.parentSearch}`;\n    return cachedFetch(url).then((r) => {\n      if (r.status === 200) {\n        return r.json().then((results) => {\n          if (this.dismounted) {\n            return;\n          }\n          if (!results) {\n            return;\n          }\n          this.setState({ keyPhrases: results.key_phrases });\n        });\n      }\n    });\n  };\n\n  onChangeSearch = (event) => {\n    const q = event.target.value;\n    this.setState({ q }, () => {\n      if (this.state.desperateSearch) {\n        this.setState({ desperateSearch: false });\n      }\n      if (this.state.originalQ) {\n        this.setState({ originalQ: \"\" });\n      }\n\n      let length = q.length;\n      if (length > this.searchRef.current.maxLength - 10) {\n        this.setState({\n          searchMaxLength: [length, this.searchRef.current.maxLength],\n          showAutocompleteSuggestions: false\n        });\n      } else if (this.state.searchMaxLength) {\n        this.setState({\n          searchMaxLength: null,\n          showAutocompleteSuggestions: true\n        });\n      }\n\n      if (this.state.q.trim()) {\n        if (this.autocompleteWaitingFor) {\n          if (q.trim() === this.autocompleteWaitingFor) {\n            return;\n          }\n        }\n        if ((length < 4 || q.endsWith(\" \")) && length < 24) {\n          // the impatient one\n          this.fetchAutocompleteSuggestionsThrottled(\n            q,\n            this.state.searchLanguage\n          );\n        } else if (length > 24) {\n          // When what you've typed is really long use the really\n          // delayed throttle.\n          this.fetchAutocompleteSuggestionsDebouncedLong(\n            q,\n            this.state.searchLanguage\n          );\n        } else if (length) {\n          this.fetchAutocompleteSuggestionsDebounced(\n            q,\n            this.state.searchLanguage\n          );\n        } else {\n          this.setState({\n            autocompleteSuggestions: null,\n            autocompleteSearchSuggestions: null,\n            autocompleteHighlight: -1,\n            showAutocompleteSuggestions: true\n          });\n        }\n      } else {\n        this.setState({\n          autocompleteSuggestions: null,\n          autocompleteSearchSuggestions: null,\n          autocompleteHighlight: -1,\n          showAutocompleteSuggestions: true\n        });\n      }\n    });\n  };\n\n  fetchAutocompleteSuggestions(q, language = null) {\n    let cacheHash = q.trim();\n    let url = `/api/search/autocomplete?q=${encodeURIComponent(q)}`;\n    if (language) {\n      cacheHash += language.trim();\n      url += `&language=${language}`;\n    }\n    const cached = this._autocompleteSuggestionsCache[cacheHash];\n    if (cached) {\n      return Promise.resolve(cached).then((results) => {\n        this.setState({\n          autocompleteSuggestions: results.matches,\n          autocompleteSearchSuggestions: results.search_suggestions,\n          autocompleteHighlight: -1,\n          missing: results.missing\n        });\n      });\n    }\n\n    // Store a \"global\" of what the latest q was.\n    this.autocompleteWaitingFor = q;\n    return fetch(url).then((r) => {\n      if (r.status === 200) {\n        return r.json().then((results) => {\n          if (this.dismounted) {\n            return;\n          }\n          if (q.startsWith(this.autocompleteWaitingFor)) {\n            this._autocompleteSuggestionsCache[cacheHash] = results;\n            if (this.state.q) {\n              this.setState({\n                autocompleteSuggestions: results.matches,\n                autocompleteSearchSuggestions: results.search_suggestions,\n                autocompleteHighlight: -1\n              });\n            }\n          }\n        });\n      }\n    });\n  }\n\n  fetchAutocompleteArtistSuggestions(q) {\n    const url = `/api/search/autocomplete?q=${q}&artist=true`;\n    return fetch(url)\n      .then((r) => {\n        if (r.status === 200) {\n          return r.json();\n        }\n      })\n      .then((results) => {\n        if (this.dismounted) {\n          return;\n        }\n        if (results) {\n          this.setState({\n            autocompleteArtistSuggestions: results.matches,\n            autocompleteArtistHighlight: -1\n          });\n        }\n      });\n  }\n\n  onKeyDownSearch = (event) => {\n    let suggestions = this.state.autocompleteSuggestions;\n    if (suggestions) {\n      let highlight = this.state.autocompleteHighlight;\n      if (event.key === \"Tab\") {\n        event.preventDefault();\n        let suggestion =\n          highlight > -1 ? suggestions[highlight] : suggestions[0];\n        if (!suggestion._url) {\n          this.setState({\n            q: suggestion.text + \" \"\n          });\n          this.fetchAutocompleteSuggestions(\n            suggestion.text,\n            this.state.searchLanguage\n          );\n        }\n      } else if (event.key === \"ArrowDown\" && highlight < suggestions.length) {\n        event.preventDefault();\n        this.setState({ autocompleteHighlight: highlight + 1 });\n      } else if (event.key === \"ArrowUp\" && highlight > -1) {\n        this.setState({ autocompleteHighlight: highlight - 1 });\n      } else if (event.key === \"Enter\") {\n        if (highlight > -1) {\n          event.preventDefault();\n          const searchSuggestions = this.state.autocompleteSearchSuggestions;\n          if (highlight === 0 && searchSuggestions && searchSuggestions.total) {\n            this.submitSearch();\n            return;\n          }\n          highlight--;\n          if (!suggestions[highlight]) {\n            // Not sure how this can happen\n            console.warn(\"SUGGESTIONS\", suggestions);\n            console.warn(\"HIGHLIGHT\", highlight);\n            // But bail!\n            this.setState(\n              {\n                autocompleteSuggestions: null,\n                autocompleteHighlight: -1\n              },\n              () => this.submitSearch()\n            );\n            return;\n          }\n          if (suggestions[highlight]._url) {\n            this.setState({\n              redirectTo: {\n                pathname: suggestions[highlight]._url\n              }\n            });\n          } else {\n            this.setState(\n              {\n                q: suggestions[highlight].text,\n                autocompleteSuggestions: null,\n                autocompleteHighlight: -1\n              },\n              () => this.submitSearch()\n            );\n          }\n        }\n      }\n    }\n  };\n\n  onKeyDownArtistSearch = (event) => {\n    let suggestions = this.state.autocompleteArtistSuggestions;\n    if (suggestions) {\n      let highlight = this.state.autocompleteArtistHighlight;\n      if (event.key === \"Tab\") {\n        event.preventDefault();\n        if (highlight > -1) {\n          this.setState({\n            artistName: suggestions[highlight].text\n          });\n          this.fetchAutocompleteArtistSuggestions(suggestions[highlight].text);\n        } else if (suggestions.length) {\n          this.setState({\n            artistName: suggestions[0].text\n          });\n          this.fetchAutocompleteArtistSuggestions(suggestions[0].text);\n        }\n      } else if (event.key === \"ArrowDown\" && highlight < suggestions.length) {\n        event.preventDefault();\n        this.setState({ autocompleteArtistHighlight: highlight + 1 });\n      } else if (event.key === \"ArrowUp\" && highlight > -1) {\n        this.setState({ autocompleteArtistHighlight: highlight - 1 });\n      } else if (event.key === \"Enter\") {\n        if (highlight > -1) {\n          event.preventDefault();\n          this.setState({\n            artistName: suggestions[highlight].text,\n            autocompleteArtistSuggestions: null,\n            autocompleteArtistHighlight: -1\n          });\n        }\n      }\n    }\n  };\n\n  toggleShareSearch = (event) => {\n    event.preventDefault();\n    this.setState({\n      shareSearch: !this.state.shareSearch,\n      advancedSearch: false\n    });\n  };\n\n  toggleAdvancedSearch = (event) => {\n    event.preventDefault();\n    if (!this.state.advancedSearch) {\n      // it was not enabled before\n      const withCountsLanguages = this.state.searchLanguages.filter(\n        (x) => x.count\n      );\n      const withCountsYears = this.state.searchYears.filter((x) => x.count);\n      if (!withCountsLanguages.length || !withCountsYears.length) {\n        this.loadSearchAggregates();\n      }\n    }\n    this.setState({\n      advancedSearch: !this.state.advancedSearch,\n      shareSearch: false\n    });\n  };\n\n  // loadSearchLanguages() {\n  //   return fetch(\"/api/search/languages\").then(r => {\n  //     if (r.status === 200) {\n  //       r.json().then(r => {\n  //         this.setState({ searchLanguages: r.languages });\n  //       });\n  //     }\n  //   });\n  // }\n  loadSearchAggregates() {\n    return fetch(\"/api/search/aggregates\").then((r) => {\n      if (r.status === 200) {\n        r.json().then((r) => {\n          this.setState({ searchLanguages: r.languages, searchYears: r.years });\n        });\n      }\n    });\n  }\n\n  onChangeLanguage = (event) => {\n    event.preventDefault();\n    const searchLanguage = event.target.value;\n    this.setState({ searchLanguage });\n  };\n\n  onChangeYear = (event) => {\n    event.preventDefault();\n    const searchYear = event.target.value;\n    this.setState({ searchYear });\n  };\n\n  onChangeArtistName = (event) => {\n    event.preventDefault();\n    const artistName = event.target.value;\n    this.setState({ artistName }, () => {\n      if (artistName.length) {\n        this.fetchAutocompleteArtistSuggestions(this.state.artistName.trim());\n      } else {\n        this.setState({\n          autocompleteArtistSuggestions: null,\n          autocompleteArtistHighlight: -1\n        });\n      }\n    });\n  };\n\n  onSelectSuggestion = (event, suggestion) => {\n    event.preventDefault();\n    if (suggestion._url) {\n      return this.setState({ redirectTo: suggestion._url });\n    }\n    let newText = suggestion.text;\n    if (suggestion.append) {\n      newText = appendSuggestion(this.state.q, newText);\n    }\n    this.setState(\n      {\n        q: newText,\n        autocompleteSuggestions: null,\n        autocompleteHighlight: -1\n      },\n      () => {\n        this.submitSearch();\n      }\n    );\n  };\n\n  onSelectSuggestionAll = (event) => {\n    event.preventDefault();\n    this.submitSearch();\n  };\n\n  onSelectArtistSuggestion = (event, suggestion) => {\n    event.preventDefault();\n    this.setState(\n      {\n        artistName: suggestion.text,\n        autocompleteArtistSuggestions: null,\n        autocompleteArtistHighlight: -1\n      },\n      () => {\n        this.submitSearch();\n      }\n    );\n  };\n\n  onLoadMore = (event) => {\n    event.preventDefault();\n    this.setState(\n      {\n        resultsPageIndex: this.state.resultsPageIndex + 1\n      },\n      () => {\n        this.startSearch(\n          this.state.q,\n          this.state.searchLanguage,\n          this.state.searchYear,\n          this.state.artistName,\n          this.state.resultsPageIndex,\n          this.state.searchExample\n        );\n      }\n    );\n  };\n\n  submitPhrase = (event, keyPhrase) => {\n    event.preventDefault();\n    const stateUpdate = { q: keyPhrase.phrase, originalQ: this.state.q };\n    if (keyPhrase.year) {\n      stateUpdate.searchYear = keyPhrase.year;\n    }\n    if (keyPhrase.language) {\n      stateUpdate.searchLanguage = keyPhrase.language;\n    }\n    this.setState(stateUpdate, () => {\n      this.submitSearch();\n    });\n  };\n\n  reloadSearch = (event) => {\n    event.preventDefault();\n    window.location.reload();\n  };\n\n  loadMoreByName = (event) => {\n    const previousByNameLimit = this.state.by_name_limit;\n    this.setState(\n      {\n        by_name_total: 0,\n        by_name_limit: 0\n      },\n      () => {\n        const url = `/api/search?q=${encodeURIComponent(\n          this.state.q\n        )}&by_name=${previousByNameLimit}`;\n        fetch(url).then((r) => {\n          if (this.dismounted) {\n            return;\n          }\n          if (r.status === 200) {\n            r.json().then((results) => {\n              if (results) {\n                this.setState({\n                  by_name: results.by_name,\n                  by_name_total: results.by_name_total,\n                  by_name_limit: results.by_name_limit\n                });\n              }\n            });\n          }\n        });\n      }\n    );\n  };\n\n  displayYears = (year) => {\n    let yearEnd = year + 9;\n    const currentYear = new Date().getFullYear();\n    if (yearEnd > currentYear) {\n      yearEnd = currentYear;\n    }\n    return `${year}…${yearEnd}`;\n  };\n\n  render() {\n    const { redirectTo, searchYear } = this.state;\n    if (redirectTo) {\n      return <Redirect to={redirectTo} push={true} />;\n    }\n    let results = null;\n    let pagination = null;\n    if (this.state.results) {\n      let rows = this.state.results;\n      if (this.state.onlyResults) {\n        let onlyIds = this.state.onlyResults.map((r) => r.id);\n        rows = rows.filter((row) => onlyIds.includes(row.id));\n      }\n      results = (\n        <Results\n          results={rows}\n          searched={this.searched}\n          popularityFactor={this.state.popularityFactor}\n          showYear={Boolean(searchYear)}\n        />\n      );\n      if (this.state.results.length < this.state.total) {\n        pagination = (\n          <Pagination\n            location={this.props.location}\n            page={this.state.resultsPageIndex}\n            onLoadMore={this.onLoadMore}\n          />\n        );\n      }\n    }\n\n    let byName = null;\n    if (this.state.by_name && this.state.by_name.length) {\n      byName = (\n        <SongsByName\n          results={this.state.by_name}\n          total={this.state.by_name_total}\n          limit={this.state.by_name_limit}\n          loadMoreByName={this.loadMoreByName}\n        />\n      );\n    }\n\n    let searchToggles = (\n      <span className=\"help-block toggles\">\n        {this.state.results && this.state.results.length ? (\n          <button\n            type=\"button\"\n            className={\n              this.state.shareSearch\n                ? \"btn btn-default btn-sm active\"\n                : \"btn btn-default btn-sm\"\n            }\n            onClick={this.toggleShareSearch}\n          >\n            {this.state.shareSearch\n              ? \"Hide share search\"\n              : \"Share search results\"}\n          </button>\n        ) : null}\n        <button\n          type=\"button\"\n          className={\n            this.state.advancedSearch\n              ? \"btn btn-default btn-sm active\"\n              : \"btn btn-default btn-sm\"\n          }\n          onClick={this.toggleAdvancedSearch}\n        >\n          {this.state.advancedSearch ? \"Hide search options\" : \"Search options\"}\n        </button>\n      </span>\n    );\n    let advancedSearchStatus = null;\n    if (!this.state.advancedSearch) {\n      let parts = [];\n      // if you currently don't have the advanced search options open,\n      // show what's currently selected.\n      if (this.state.searchLanguage && this.state.searchLanguage !== \"en\") {\n        const language = this.state.searchLanguages.filter((e) => {\n          return e.code === this.state.searchLanguage;\n        })[0].language;\n        parts.push(`Language: ${language}`);\n      }\n\n      if (this.state.searchYear) {\n        parts.push(\n          `Years: ${this.displayYears(parseInt(this.state.searchYear))}`\n        );\n      }\n\n      if (this.state.artistName) {\n        parts.push(`Artist: ${this.state.artistName}`);\n      }\n      if (parts.length) {\n        advancedSearchStatus = (\n          <span className=\"help-block advanced-search-status\">\n            <b>Search options:</b> {parts.join(\", \")}\n          </span>\n        );\n      }\n    }\n\n    let advancedInput = null;\n    if (this.state.advancedSearch) {\n      advancedInput = (\n        <div className=\"advanced\">\n          <div className=\"form-group\" style={{ position: \"relative\" }}>\n            <input\n              type=\"search\"\n              ref={this.artistRef}\n              value={this.state.artistName}\n              className=\"form-control input-lg\"\n              maxLength={100}\n              onFocus={this.onFocusArtist}\n              onBlur={this.onBlurArtist}\n              onChange={this.onChangeArtistName}\n              onKeyDown={this.onKeyDownArtistSearch}\n              aria-label=\"Artist search\"\n              placeholder=\"Artist or band name\"\n            />\n            {this.state.autocompleteArtistSuggestions &&\n            this.state.showAutocompleteArtistSuggestions ? (\n              <ShowAutocompleteArtistSuggestions\n                onSelectSuggestion={this.onSelectArtistSuggestion}\n                highlight={this.state.autocompleteArtistHighlight}\n                suggestions={this.state.autocompleteArtistSuggestions}\n              />\n            ) : null}\n          </div>\n          <div className=\"form-group\">\n            <select\n              ref={this.languageRef}\n              onChange={this.onChangeLanguage}\n              value={this.state.searchLanguage}\n              className=\"form-control\"\n            >\n              <option value=\"\">Any language</option>\n              {this.state.searchLanguages.map((each) => {\n                let text = each.language;\n                if (each.count === 1) {\n                  text += \" (1 song)\";\n                } else if (each.count) {\n                  text += ` (${each.count.toLocaleString()} songs)`;\n                }\n                return (\n                  <option key={each.code} value={each.code}>\n                    {text}\n                  </option>\n                );\n              })}\n            </select>\n          </div>\n          <div className=\"form-group\">\n            <select\n              // ref={this.yearRef}\n              onChange={this.onChangeYear}\n              value={this.state.searchYear}\n              className=\"form-control\"\n            >\n              <option value=\"\">Any year</option>\n              {this.state.searchYears.map((each) => {\n                let text = this.displayYears(each.year);\n                if (each.count === 1) {\n                  text += \" (1 song)\";\n                } else if (each.count) {\n                  text += ` (${each.count.toLocaleString()} songs)`;\n                }\n                return (\n                  <option key={text} value={each.year}>\n                    {text}\n                  </option>\n                );\n              })}\n            </select>\n          </div>\n          <div className=\"form-group text-right\">\n            <button type=\"submit\" className=\"btn btn-primary\">\n              Search Now\n            </button>\n          </div>\n        </div>\n      );\n    }\n\n    let keyPhrases = null;\n    if (\n      this.state.results &&\n      // !this.state.results.length &&\n      this.state.keyPhrases &&\n      this.state.keyPhrases.length\n    ) {\n      keyPhrases = (\n        <ShowKeyPhrases\n          nothingFound={!this.state.results.length}\n          phrases={this.state.keyPhrases}\n          submitPhrase={this.submitPhrase}\n        />\n      );\n    }\n\n    return (\n      <div>\n        <form onSubmit={this.onSubmit} action=\"/api/search/redirect\">\n          <div className=\"form-group\" style={{ position: \"relative\" }}>\n            <div className=\"input-group input-group-lg\">\n              <input\n                type=\"search\"\n                ref={this.searchRef}\n                name=\"q\"\n                autoComplete=\"off\"\n                value={this.state.q}\n                onFocus={this.onFocusSearch}\n                onBlur={this.onBlurSearch}\n                onChange={this.onChangeSearch}\n                onKeyDown={this.onKeyDownSearch}\n                className=\"form-control\"\n                maxLength={150}\n                aria-label=\"Lyrics search\"\n                placeholder={this.state.placeholder}\n              />\n              <span className=\"input-group-btn\">\n                <button\n                  className=\"btn btn-default btn-lg\"\n                  type=\"submit\"\n                  title=\"Click to search\"\n                >\n                  Search\n                </button>\n              </span>\n            </div>\n            {this.state.searchMaxLength ? (\n              <ShowMaxlengthWarning\n                length={this.state.searchMaxLength[0]}\n                maxLength={this.state.searchMaxLength[1]}\n              />\n            ) : null}\n            {this.state.desperateSearch &&\n            this.state.results &&\n            this.state.results.length &&\n            !(\n              this.state.showAutocompleteSuggestions &&\n              this.state.autocompleteSuggestions\n            ) ? (\n              <ShowDesperateSearchWarning />\n            ) : null}\n            {!this.state.desperateSearch &&\n            this.state.missing &&\n            this.state.results &&\n            this.state.results.length &&\n            !(\n              this.state.showAutocompleteSuggestions &&\n              this.state.autocompleteSuggestions\n            ) ? (\n              <ShowMissingSearchWarning missing={this.state.missing} />\n            ) : null}\n            {this.state.autocompleteSuggestions &&\n            this.state.showAutocompleteSuggestions ? (\n              <ShowAutocompleteSuggestions\n                q={this.state.q}\n                onSelectSuggestion={this.onSelectSuggestion}\n                onSelectSuggestionAll={this.onSelectSuggestionAll}\n                highlight={this.state.autocompleteHighlight}\n                suggestions={this.state.autocompleteSuggestions}\n                searchSuggestions={this.state.autocompleteSearchSuggestions}\n              />\n            ) : null}\n          </div>\n          <ShowResultCount\n            results={this.state.results}\n            total={this.state.total}\n            byName={this.state.by_name}\n            onlyResults={this.state.onlyResults}\n          />\n\n          {searchToggles}\n          {advancedSearchStatus}\n          {this.state.shareSearch ? (\n            <ShareInput searched={this.searched} />\n          ) : null}\n          {advancedInput}\n        </form>\n \n      <div id=\"waldo-tag-11815\">\n          <script>\n            {`googletag.cmd.push(function() {\n              googletag.display = \"waldo-tag-11815\";\n            })`};\n          </script>\n        </div>\n\n        \n        {/* <CountdownTimer targetDate={dateTimeAfterThreeDays} /> */}\n        \n\n        {this.state.searchError ? (\n          <SearchError error={this.state.searchError} />\n        ) : null}\n        {this.state.showExamples ? (\n          <ShowExamples\n            sampleSearch={this.sampleSearch}\n            examples={this.state.searchExamples}\n          />\n        ) : null}\n        {this.state.showRecentComments && this.state.recentComments ? (\n          <ShowRecentCommentsWrapper\n            comments={this.state.recentComments.comments}\n          />\n        ) : null}\n        {/* {suggestions} */}\n        {byName}\n        {keyPhrases}\n        {results}\n        {this.state.searching ? <Loading text=\"Searching...\" /> : null}\n        {pagination}\n        {this.state.slowSearch ? (\n          <SlowSearch reloadSearch={this.reloadSearch} />\n        ) : null}\n      </div>\n    );\n  }\n}\n\nexport default Home;\n\nclass ShowRecentCommentsWrapper extends React.PureComponent {\n  render() {\n    const { comments } = this.props;\n    return (\n      <div className=\"recent-comments\" style={{ marginTop: 50 }}>\n        <h4>\n          Recent Comments (<Link to=\"/comments\">All</Link>)\n        </h4>\n        <ShowRecentComments comments={comments} isRoot={true} />\n        <div className=\"load-more\">\n          <Link to=\"/comments\">More recent comments</Link>\n        </div>\n      </div>\n    );\n  }\n}\n\nconst ShowResultCount = React.memo(\n  ({ results, total, onlyResults, byName }) => {\n    if (!results) {\n      return null;\n    }\n    let countResults = null;\n    if (results) {\n      const byNameCount = byName ? byName.length : 0;\n      if (onlyResults) {\n        countResults = onlyResults.length + byNameCount;\n      } else {\n        countResults = results.length + byNameCount;\n      }\n    }\n    return (\n      <p className=\"result-metadata text-right\">\n        <b>\n          {total >= 10000 ? \"More than \" : \"\"}\n          {total.toLocaleString()} {total === 1 ? \"song found\" : \"songs found\"}\n        </b>{\" \"}\n        {countResults && countResults < total\n          ? `(showing ${countResults})`\n          : null}\n      </p>\n    );\n  }\n);\n\nclass ShareInput extends React.PureComponent {\n  state = {\n    copied: false,\n    failed: false,\n    hasFocused: false\n  };\n\n  absurlRef = React.createRef();\n\n  render() {\n    const absoluteUrl = window.location.href;\n    return (\n      <div className=\"form-group\" style={{ marginTop: 30 }}>\n        <div className=\"input-group\">\n          <label className=\"sr-only\">URL:</label>\n          <input\n            ref={this.absurlRef}\n            type=\"text\"\n            className=\"form-control\"\n            readOnly\n            value={absoluteUrl}\n            onFocus={() => {\n              if (!this.state.hasFocused) {\n                this.absurlRef.current.select();\n                this.setState({ hasFocused: true });\n              }\n            }}\n          />\n          <span className=\"input-group-btn\">\n            <button\n              type=\"button\"\n              className={\n                this.state.copied ? \"btn btn-success\" : \"btn btn-primary\"\n              }\n              title=\"Click to copy to clipboard\"\n              onClick={(event) => {\n                event.preventDefault();\n                this.absurlRef.current.select();\n                if (copy(absoluteUrl)) {\n                  this.setState({ copied: true, failed: false }, () => {\n                    if (this.props.searched && !this.copied) {\n                      this.copied = this.props.searched;\n                      fetch(`/api/search/copied/${this.props.searched}`, {\n                        method: \"POST\"\n                      });\n                    }\n                  });\n                } else {\n                  this.setState({ copied: false, failed: true });\n                }\n              }}\n            >\n              {this.state.copied ? \"Copied to clipboard\" : \"Copy to clipboard\"}\n            </button>\n          </span>\n        </div>\n        {this.state.copied ? (\n          <p>\n            The URL to this search has now been copied to your clipboard so you\n            can paste it anywhere. Thanks!\n          </p>\n        ) : null}\n      </div>\n    );\n  }\n}\n\nconst ShowKeyPhrases = React.memo(({ phrases, submitPhrase, nothingFound }) => {\n  let subTitle = null;\n  if (nothingFound) {\n    if (phrases.length === 1) {\n      subTitle = <h4>But, try this...</h4>;\n    } else {\n      subTitle = <h4>But, try these...</h4>;\n    }\n  }\n  return (\n    <div className=\"key-phrases\">\n      {nothingFound ? (\n        <h3>Nothing found</h3>\n      ) : (\n        <h3>Fuzzy results. Try breaking it up...</h3>\n      )}\n      {subTitle}\n      <table className=\"table suggestions table-condensed\">\n        <tbody>\n          {phrases.map((phrase) => {\n            let url = `/q/${phrase.phrase}`;\n            if (phrase.year) {\n              url += `?year=${phrase.year}`;\n            }\n            return (\n              <tr key={phrase.phrase}>\n                <td>\n                  <a href={url} onClick={(e) => submitPhrase(e, phrase)}>\n                    {phrase.diff_html ? (\n                      <span\n                        dangerouslySetInnerHTML={{ __html: phrase.diff_html }}\n                      />\n                    ) : (\n                      phrase.phrase\n                    )}\n                  </a>\n                </td>\n                <td>\n                  <b>{phrase.total}</b> {phrase.total === 1 ? \"song\" : \"songs\"}\n                </td>\n              </tr>\n            );\n          })}\n        </tbody>\n      </table>\n    </div>\n  );\n});\n\nconst ShowAutocompleteSuggestions = React.memo(\n  ({\n    q,\n    highlight,\n    suggestions,\n    searchSuggestions,\n    onSelectSuggestion,\n    onSelectSuggestionAll\n  }) => {\n    if (!suggestions.length) {\n      return null;\n    }\n    return (\n      <div className=\"autocomplete\">\n        <ul>\n          {searchSuggestions && q && searchSuggestions.total ? (\n            <li\n              onClick={onSelectSuggestionAll}\n              className={\n                highlight === 0\n                  ? \"active search-suggestion\"\n                  : \"search-suggestion\"\n              }\n            >\n              {searchSuggestions.capped ? (\n                <a\n                  style={{ float: \"right\" }}\n                  href={\"/q/\" + encodeURIComponent(searchSuggestions.term)}\n                >\n                  {searchSuggestions.total.toLocaleString()}{\" \"}\n                  {searchSuggestions.desperate\n                    ? \"approximate matches\"\n                    : \"good matches\"}\n                </a>\n              ) : null}\n              <a href={\"/q/\" + encodeURIComponent(searchSuggestions.term)}>\n                Search for <i>{q}</i>\n              </a>\n            </li>\n          ) : null}\n\n          {suggestions.map((s, index) => {\n            const className = index + 1 === highlight ? \"active\" : \"\";\n            return (\n              <li\n                key={s.id ? s.id : s.text}\n                className={className}\n                onClick={(e) => onSelectSuggestion(e, s)}\n              >\n                {s.id ? (\n                  <ShowAutocompleteSuggestionSong song={s} />\n                ) : (\n                  <ShowAutocompleteSuggestion\n                    text={s.text}\n                    html={s.html}\n                    found={s.found}\n                  />\n                )}\n              </li>\n            );\n          })}\n        </ul>\n      </div>\n    );\n  }\n);\n\nconst ShowAutocompleteSuggestion = React.memo(({ found, html }) => {\n  if (found) {\n    return (\n      <p className=\"search\">\n        <small>{found}</small>\n        <span dangerouslySetInnerHTML={{ __html: html }} />\n      </p>\n    );\n  } else {\n    return <p className=\"search\" dangerouslySetInnerHTML={{ __html: html }} />;\n  }\n});\n\nconst ShowAutocompleteSuggestionSong = React.memo(({ song }) => {\n  let imageUrl = placeholderImage;\n  if (song.image) {\n    if (song.image.thumbnail100) {\n      imageUrl = song.image.thumbnail100;\n    } else {\n      imageUrl = song.image.url;\n    }\n  }\n  return (\n    <div className=\"media autocomplete-suggestion-song\">\n      <div className=\"media-left\">\n        <AutocompleteImage url={imageUrl} name={song.name} />\n      </div>\n      <div className=\"media-body\">\n        <h5 className=\"artist-name\">\n          <b>{song.name}</b>\n          <span className=\"by\">{\" by \"}</span>\n          {song.artist.name}\n        </h5>\n        {song.fragments.map((fragment, i) => {\n          return (\n            <p\n              key={`${song.id}:${i}`}\n              dangerouslySetInnerHTML={{ __html: fragment }}\n            />\n          );\n        })}\n      </div>\n    </div>\n  );\n});\n\nconst ShowAutocompleteArtistSuggestions = React.memo(\n  ({ highlight, suggestions, onSelectSuggestion }) => {\n    if (!suggestions.length) {\n      return null;\n    }\n    return (\n      <div className=\"autocomplete\">\n        <ul>\n          {suggestions.map((s, index) => {\n            let className = index === highlight ? \"active\" : \"\";\n            return (\n              <li\n                key={`${s.text}${index}`}\n                className={className}\n                onClick={(e) => onSelectSuggestion(e, s)}\n              >\n                <div className=\"media\">\n                  <div className=\"media-left\">\n                    <AutocompleteImage\n                      url={s.thumbnail100 || s.image || placeholderImage}\n                      name={s.text}\n                    />\n                  </div>\n                  <div className=\"media-body\">\n                    <h5\n                      className=\"artist-name\"\n                      dangerouslySetInnerHTML={{ __html: s.html }}\n                    />\n                    <span className=\"artist-metadata\">\n                      {s.songs ? s.songs : \"0\"} songs\n                    </span>\n                  </div>\n                </div>\n              </li>\n            );\n          })}\n        </ul>\n      </div>\n    );\n  }\n);\n\nfunction ShowMaxlengthWarning({ length, maxLength }) {\n  let className = \"help-block maxlength\";\n  if (length === maxLength) {\n    className += \" danger\";\n  }\n  return (\n    <span className={className}>\n      {length} of max {maxLength} characters!\n    </span>\n  );\n}\n\nfunction ShowDesperateSearchWarning() {\n  return (\n    <span className=\"help-block warning\">\n      <b>Note!</b> Nothing could be found with that exact search. Showing fuzzy\n      matches.\n    </span>\n  );\n}\n\nfunction ShowMissingSearchWarning({ missing }) {\n  return (\n    <span className=\"help-block warning\">\n      <b>Note!</b> Results found by discarding{\" \"}\n      <i style={{ textDecoration: \"line-through\" }}>{missing}</i>.\n    </span>\n  );\n}\n\nconst ShowExamples = React.memo(({ sampleSearch, examples }) => {\n  return (\n    <div className=\"examples\">\n      <h4>Successful searches for songs by lyrics</h4>\n      <ul>\n        {examples.map((search) => {\n          let link = \"/q/\" + encodeURIComponent(search.term);\n          link += `?example=${search.id}`;\n          if (search.artist) {\n            link += `&artist=${encodeURIComponent(search.artist)}`;\n          }\n          if (search.language) {\n            link += `&language=${encodeURIComponent(search.language)}`;\n          }\n          if (search.year) {\n            link += `&year=${search.year}`;\n          }\n          let searchMeta = null;\n          const searchMetaStrings = [];\n\n          if (search.artist) {\n            searchMetaStrings.push([\"artist\", search.artist]);\n          }\n          if (search.language) {\n            searchMetaStrings.push([\"language\", search.language_human]);\n          }\n          if (search.year) {\n            searchMetaStrings.push([\"year\", search.year]);\n          }\n          if (searchMetaStrings.length) {\n            searchMeta = (\n              <span>\n                (\n                {searchMetaStrings.map((n, i) => {\n                  return (\n                    <React.Fragment key={n[0]}>\n                      {n[0]} <b>{n[1]}</b>\n                      {i + 1 < searchMetaStrings.length ? \", \" : \"\"}\n                    </React.Fragment>\n                  );\n                })}\n                )\n              </span>\n            );\n          }\n\n          return (\n            <li key={search.id}>\n              <Link to={link} onClick={(e) => sampleSearch(e, search)}>\n                <b>{search.term}</b>\n              </Link>{\" \"}\n              {searchMeta} <i>{search.total_found} found</i>\n              <br />\n              {search.opened.map((song) => {\n                return (\n                  <span className=\"opened\" key={song.id}>\n                    clicked on{\" \"}\n                    <Link to={song._url}>\n                      <b>{song.name}</b> by <b>{song.artist.name}</b>\n                    </Link>\n                  </span>\n                );\n              })}\n            </li>\n          );\n        })}\n      </ul>\n    </div>\n  );\n});\n\nfunction SlowSearch({ reloadSearch }) {\n  return (\n    <div className=\"slow-search\">\n      <h4>Sorry, search seems to take longer than normal!</h4>\n      <p>\n        Perhaps it got stuck? <br />\n        <button\n          type=\"button\"\n          className=\"btn btn-default btn-sm\"\n          onClick={reloadSearch}\n        >\n          Reload search\n        </button>\n      </p>\n    </div>\n  );\n}\n\nfunction SearchError({ error }) {\n  return (\n    <div className=\"search-error\">\n      <h4>Sorry, an error occured</h4>\n      {error.status === 400 ? (\n        <p>\n          The query was invalid <code>{error.text}</code>\n        </p>\n      ) : (\n        <p>The server basically failed to compute the search</p>\n      )}\n      {error.status >= 500 && <p>Perhaps simply try again a little later.</p>}\n      {error.status >= 500 && (\n        <p>\n          <button\n            type=\"button\"\n            className=\"btn btn-default\"\n            onClick={(event) => {\n              window.location.reload(true);\n            }}\n          >\n            Reload to try again\n          </button>\n        </p>\n      )}\n    </div>\n  );\n}\n\nclass Results extends React.PureComponent {\n  firstLoad = true;\n  componentDidMount() {\n    if (!isServer) {\n      loadCarbonScript();\n    }\n    this.firstLoad = false;\n  }\n  componentDidUpdate(prevProps) {\n    // Is this if-statement necessary? I mean, isn't componentDidUpdate\n    // something that *only* happens with non-SSR rendering??\n    if (!isServer && prevProps.results !== this.props.results) {\n      loadCarbonScript();\n    }\n  }\n  render() {\n    const { results, searched, popularityFactor, showYear } = this.props;\n    return (\n      <div>\n        {/* This extra span exists to debug if ads are enabled or not */}\n        {!NO_ADS ? <div id=\"carbonadsouter\" /> : <span id=\"_nocardonads\" />}\n\n        <div className=\"results\">\n          {results.map((result, index) => {\n            return (\n              <Result\n                key={result.id}\n                result={result}\n                searched={searched}\n                expandedByDefault={results.length === 1}\n                firstResult={index === 0}\n                popularityFactor={popularityFactor}\n                firstLoad={this.firstLoad}\n                showYear={showYear}\n              />\n            );\n          })}\n        </div>\n      </div>\n    );\n  }\n}\n\nclass Result extends React.PureComponent {\n  state = {\n    collapsed: true,\n    itunes: null,\n    amazon: null,\n    textHtml: this.props.result.text_html\n  };\n  affiliateLookupStarted = [];\n\n  componentDidMount() {\n    if (this.props.expandedByDefault) {\n      this.expand();\n    }\n  }\n\n  componentWillUnmount() {\n    this.dismounted = true;\n  }\n\n  onExpandClick = (event) => {\n    event.preventDefault();\n    this.expand();\n  };\n\n  expand() {\n    const wasCollapsed = this.state.collapsed;\n    this.setState({ collapsed: false });\n    this.fetchTextHTML().then(() => {\n      if (wasCollapsed) {\n        if (this.props.searched) {\n          let recordURL = `/api/song/${this.props.result.id}/`;\n          recordURL += `expand/${this.props.searched}`;\n          fetch(recordURL, { method: \"POST\" })\n            .then((r) => r.json())\n            .then((result) => {\n              // nothing to do\n            });\n        }\n      }\n    });\n  }\n\n  fetchTextHTML() {\n    if (this.state.textHtml) {\n      return Promise.resolve();\n    } else {\n      const url = `/api/song/${this.props.result.id}?text_only=true`;\n      return fetch(url)\n        .then((r) => r.json())\n        .then((result) => {\n          if (this.dismounted) {\n            return;\n          }\n          this.setState({\n            textHtml: result.song.text_html\n          });\n        });\n    }\n  }\n\n  render() {\n    const { result, popularityFactor, firstResult, firstLoad, showYear } =\n      this.props;\n    let className = \"result\";\n    if (this.state.collapsed) {\n      className += \" collapsed\";\n    }\n    let songURL = result._url;\n    let image;\n\n    if (result.image) {\n      image = (\n        <SongImage\n          url={result.image.url}\n          className=\"pull-right img-thumbnail album\"\n          name={result.image.name}\n          forceLoad={firstResult || !firstLoad}\n        />\n      );\n    } else {\n      image = (\n        <SongImage\n          url={null}\n          className=\"pull-right img-thumbnail\"\n          name={result.artist.name}\n          forceLoad={firstResult || !firstLoad}\n        />\n      );\n    }\n\n    let rest = (\n      <p className=\"read-more\">\n        <Link to={songURL}>VIEW SONG</Link>{\" \"}\n        <Link to={songURL} onClick={this.onExpandClick}>\n          EXPAND SONG\n        </Link>\n      </p>\n    );\n    if (!this.state.collapsed) {\n      let searchedId = null;\n      let searched = null;\n      try {\n        searched = localStorage.getItem(\"searched\");\n      } catch (ex) {\n        console.warn(\"'localStorage.getItem(\\\"searched\\\")' didn't work\");\n      }\n      if (searched) {\n        if (searched.includes(\",\")) {\n          // The new way\n          searchedId = parseInt(searched.split(\",\")[0], 10);\n        } else {\n          // The old way!\n          searchedId = parseInt(searched, 10);\n        }\n      }\n      rest = (\n        <div className=\"rest\">\n          <div className=\"text\">\n            <h3>Full Text</h3>\n            {this.state.textHtml ? (\n              <RenderParagraphs text={this.state.textHtml} />\n            ) : (\n              <i>Loading full text...</i>\n            )}\n            <SongComments\n              comments={null}\n              commentsCount={null}\n              song={result}\n              searchedId={searchedId}\n            />\n            <AmazonRelatedProducts song={result} />\n\n            {/* {this.state.textHtml && (\n              <YouTubeSnippetIntersectionLazy song={result} />\n            )} */}\n            <p className=\"load-more\">\n              <Link to={songURL}>GO TO SONG PAGE</Link>\n            </p>\n          </div>\n        </div>\n      );\n    }\n\n    let artistName = <b>{result.artist.name}</b>;\n    if (result.artist.fragment) {\n      artistName = (\n        <b dangerouslySetInnerHTML={{ __html: result.artist.fragment }} />\n      );\n    }\n\n    let tooltipTitle;\n    if (process.env.NODE_ENV === \"development\") {\n      let score = result.score.toFixed(4);\n      tooltipTitle = `Score ${score}`;\n      if (result.popularity) {\n        tooltipTitle += ` Popularity: ${result.popularity.toFixed(6)}`;\n      }\n    } else {\n      tooltipTitle = \"Click to view just this song\";\n    }\n\n    return (\n      <div className={className}>\n        <div className=\"head\">\n          <Link to={songURL}>{image}</Link>\n          <h2 title={tooltipTitle}>\n            <Link to={songURL}>{result.name}</Link>\n            {showYear && result.year && (\n              <span className=\"year\"> {result.year}</span>\n            )}\n            {process.env.NODE_ENV === \"development\" ? (\n              <ShowSongScore song={result} factor={popularityFactor} />\n            ) : null}\n          </h2>\n          <h3>\n            <span className=\"by\">by</span> {artistName}\n          </h3>\n\n          {result.albums.length ? <Albums albums={result.albums} /> : null}\n        </div>\n        <div className=\"fragments\">\n          {result.fragments.map((fragment, i) => {\n            return (\n              <p\n                key={`${result.id}${i}`}\n                dangerouslySetInnerHTML={{ __html: fragment }}\n              />\n            );\n          })}\n        </div>\n        {rest}\n      </div>\n    );\n  }\n}\n\nconst SongImage = React.memo(({ url, name, forceLoad, className }) => {\n  // If the song doesn't haven an image, no point messing around.\n  if (!url) {\n    return (\n      <img\n        src={placeholderImage}\n        className={className}\n        title={name}\n        alt={name}\n      />\n    );\n  }\n  return (\n    <img\n      src={url}\n      className={className}\n      title={name}\n      alt={name}\n      loading={forceLoad ? undefined : \"lazy\"}\n    />\n  );\n});\n\n// This assumes that we'll sooner or later need the lazyloadThumbnailImage image\nif (!isServer) {\n  new Image().src = lazyloadThumbnailImage;\n}\n\n// Module level \"cache\" of which image URLs have been successfully inserted\n// into the DOM at least once.\n// By knowing these, we can, on repeat URLs, avoid the whole lazy-load\n// image swapping trick.\nconst loadedOnce = new Set();\n\nfunction AutocompleteImage({ url, name }) {\n  const [src, setSrc] = useState(\n    loadedOnce.has(url) ? url : lazyloadThumbnailImage\n  );\n\n  useEffect(() => {\n    let preloadImg = null;\n    let dismounted = false;\n\n    if (src === lazyloadThumbnailImage) {\n      // We need to preload the eventually needed image.\n      preloadImg = new Image();\n\n      function cb() {\n        if (!dismounted) {\n          setSrc(url);\n        }\n        loadedOnce.add(url);\n      }\n      // This must come before .decode() otherwise Safari will\n      // raise an EncodingError.\n      preloadImg.src = url;\n      // https://html.spec.whatwg.org/multipage/embedded-content.html#dom-img-decode\n      // https://developer.mozilla.org/en-US/docs/Web/API/HTMLImageElement/decode#Browser_compatibility\n      preloadImg.decode\n        ? preloadImg.decode().then(cb, cb)\n        : (preloadImg.onload = cb);\n      // https://developer.mozilla.org/en-US/docs/Web/API/HTMLImageElement/decoding\n      preloadImg.decoding = \"sync\";\n    }\n\n    return () => {\n      if (preloadImg) {\n        // Immediately undo the preloading since we might not need this image.\n        // See https://jsfiddle.net/nw34gLgt/ for demo of this technique.\n        preloadImg.src = \"\";\n      }\n      dismounted = true;\n    };\n  }, [url, src]);\n\n  if (!url) {\n    // Don't even bother with lazy loading.\n    return (\n      <img\n        className=\"img-rounded\"\n        src={lazyloadThumbnailImage}\n        alt={name}\n        title={name}\n      />\n    );\n  }\n\n  return <img className=\"img-rounded\" src={src} alt={name} title={name} />;\n}\n\nfunction ShowSongScore({ song, factor = 20 }) {\n  const s = song.score - factor * song.popularity;\n  return (\n    <code>\n      {song.score.toFixed(3)} = {s.toFixed(3)} + {factor}\n      &times;\n      {song.popularity.toFixed(4)}\n    </code>\n  );\n}\n\nconst SongsByName = React.memo(({ results, total, limit, loadMoreByName }) => {\n  return (\n    <div className=\"by-name\">\n      <h4>Songs by name</h4>\n      <ul>\n        {results.map((s) => {\n          return (\n            <li key={s.id}>\n              <Link to={s._url}>\n                <b dangerouslySetInnerHTML={{ __html: s.fragment }} /> by{\" \"}\n                <b>{s.artist.name}</b>\n              </Link>\n            </li>\n          );\n        })}\n      </ul>\n      {total > limit ? (\n        <button className=\"btn btn-default btn-sm\" onClick={loadMoreByName}>\n          {total > 20\n            ? \"Show more songs by name\"\n            : `Show all (${total}) songs by name`}\n        </button>\n      ) : null}\n    </div>\n  );\n});\n\nconst Albums = React.memo(({ albums }) => {\n  return (\n    <p className=\"albums\">\n      {albums.map((album, i) => {\n        const parts = [<b key={album.id}>{album.name}</b>];\n        if (album.year) {\n          parts.push(` (${album.year})`);\n        }\n        if (i + 1 < albums.length) {\n          parts.push(\", \");\n        }\n        return parts;\n      })}\n    </p>\n  );\n});\n\nconst Pagination = React.memo(({ location, onLoadMore }) => {\n  const currentURL = location.pathname + location.search;\n  return (\n    <div className=\"load-more\">\n      <a href={currentURL} onClick={onLoadMore}>\n        LOAD MORE RESULTS\n      </a>\n    </div>\n  );\n});\n"]},"metadata":{},"sourceType":"module"}