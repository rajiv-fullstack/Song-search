{"ast":null,"code":"import _slicedToArray from \"/home/mandeep/Downloads/Song-sorch work/site/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _classCallCheck from \"/home/mandeep/Downloads/Song-sorch work/site/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/mandeep/Downloads/Song-sorch work/site/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _inherits from \"/home/mandeep/Downloads/Song-sorch work/site/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _createSuper from \"/home/mandeep/Downloads/Song-sorch work/site/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";\n\nvar _jsxFileName = \"/home/mandeep/Downloads/Song-sorch work/site/src/Home.js\",\n    _this = this,\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect } from \"react\";\nimport { Link, Redirect } from \"react-router-dom\";\nimport { throttle, debounce } from \"throttle-debounce\"; // import { Waypoint } from \"react-waypoint\";\n\nimport copy from \"copy-to-clipboard\";\nimport { cachedFetch } from \"./Cache\";\nimport Countdown from \"react-countdown\";\nimport CountdownTimer from \"./CountdownTimer\";\nimport Bannertop from \"./Bannertop\";\nimport pics from \"./songs_desktop.png\";\nimport mobileimgs from \"./songs_mobile.png\";\nimport { Loading, SetHTMLHeaders, ResetHTMLHeaders, isServer, // YouTubeSnippetIntersectionLazy,\nloadCarbonScript, AmazonRelatedProducts, RenderParagraphs } from \"./Common\";\nimport { SongComments } from \"./Comments\";\nimport { ShowRecentComments } from \"./RecentComments\"; // if (process.env.PUBLIC_URL === undefined) {\n//   // console.error(\"process.env.PUBLIC_URL should not be undefined\");\n//   throw new Error(\"process.env.PUBLIC_URL should not be undefined\");\n// }\n\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar PUBLIC_URL = process.env.PUBLIC_URL || \"\";\nvar lazyloadThumbnailImage = PUBLIC_URL + \"/static/lazyload-thumbnail.png\";\nvar placeholderImage = PUBLIC_URL + \"/static/placeholder.png\";\nvar NO_ADS = process.env.REACT_APP_NO_ADS === \"true\";\nvar samplePlaceholders = [\"Born to be wild\", \"No one ever told me life was kind\", \"But here it comes again, straight thru the heart\", \"I'm an alligator\", \"My mouth, it moves\"];\nsamplePlaceholders.sort(function () {\n  return 0.5 - Math.random();\n});\n\nvar appendSuggestion = function appendSuggestion(text, append) {\n  var split = text.split(/\\s+/);\n  split.pop();\n  split.push(append);\n  return split.join(\" \");\n};\n\nvar Completionist = function Completionist() {\n  return /*#__PURE__*/_jsxDEV(\"span\", {\n    children: \"You are good to go!\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 51,\n    columnNumber: 29\n  }, _this);\n};\n\n_c = Completionist;\nvar THREE_DAYS_IN_MS = 3 * 24 * 60 * 60 * 1000;\nvar NOW_IN_MS = new Date().getTime();\nvar dateTimeAfterThreeDays = NOW_IN_MS + THREE_DAYS_IN_MS;\n\nvar Home = /*#__PURE__*/function (_React$Component) {\n  _inherits(Home, _React$Component);\n\n  var _super = _createSuper(Home);\n\n  function Home(_props) {\n    var _this2;\n\n    _classCallCheck(this, Home);\n\n    _this2 = _super.call(this, _props);\n    _this2.artistRef = /*#__PURE__*/React.createRef();\n    _this2.languageRef = /*#__PURE__*/React.createRef();\n    _this2.searchRef = /*#__PURE__*/React.createRef();\n\n    _this2.startSearchFromLocation = function (props) {\n      var match = props.match;\n      var q = decodeURIComponent(match.params.q);\n      var sp = new URLSearchParams(props.location.search || \"\");\n      var artist = sp.get(\"artist\");\n      var language = sp.get(\"language\");\n      var year = sp.get(\"year\");\n      var searchExample = sp.get(\"example\"); // XXX should this compare artist and language too?\n\n      if (_this2.state.q !== q) {\n        var stateUpdate = {\n          q: q\n        };\n\n        if (q.length > _this2.searchRef.current.maxLength - 10) {\n          stateUpdate.searchMaxLength = [q.length, _this2.searchRef.current.maxLength];\n        }\n\n        if (language || year) {\n          _this2.loadSearchAggregates();\n\n          stateUpdate.advancedSearch = true;\n        }\n\n        if (language) {\n          stateUpdate.searchLanguage = language;\n        }\n\n        if (year) {\n          stateUpdate.searchYear = year;\n        }\n\n        if (artist) {\n          stateUpdate.artistName = artist;\n          stateUpdate.advancedSearch = true;\n        }\n\n        if (searchExample) {\n          stateUpdate.searchExample = searchExample;\n        }\n\n        _this2.setState(stateUpdate, function () {\n          _this2.startSearch(q, language, year, artist, _this2.state.resultsPageIndex, _this2.state.searchExample);\n        });\n      } else {\n        SetHTMLHeaders({\n          title: \"\".concat(q, \" - Song Search\")\n        });\n      }\n    };\n\n    _this2.onFocusSearch = function () {\n      _this2.searchRef.current.placeholder = \"\";\n      clearInterval(_this2.placeholderSampleInterval);\n\n      if (_this2.fillerInterval) {\n        clearInterval(_this2.fillerInterval);\n      }\n\n      if (!_this2.state.showAutocompleteSuggestions) {\n        _this2.setState({\n          showAutocompleteSuggestions: true\n        });\n      }\n\n      if (_this2.state.shareSearch) {\n        _this2.setState({\n          shareSearch: false\n        });\n      }\n\n      if (!_this2._firstFocusSearch) {\n        _this2._firstFocusSearch = true; // If you're on a small screen this is the first time you've focused,\n        // the scroll the top of the search input into view.\n\n        if (window.innerHeight && window.innerHeight < 600) {\n          _this2.searchRef.current.scrollIntoView();\n        }\n      }\n    };\n\n    _this2.onBlurSearch = function (event) {\n      if (!_this2.state.q) {\n        _this2.setNextSamplePlaceholder();\n\n        _this2.startSamplePlaceholderInterval();\n      }\n\n      setTimeout(function () {\n        if (!_this2.dismounted) {\n          _this2.setState({\n            showAutocompleteSuggestions: false\n          });\n        }\n      }, 300);\n    };\n\n    _this2.onFocusArtist = function (event) {\n      if (!_this2.state.showAutocompleteArtistSuggestions) {\n        _this2.setState({\n          showAutocompleteArtistSuggestions: true\n        });\n      }\n    };\n\n    _this2.onBlurArtist = function (event) {\n      setTimeout(function () {\n        if (!_this2.dismounted) {\n          _this2.setState({\n            showAutocompleteArtistSuggestions: false\n          });\n        }\n      }, 300);\n    };\n\n    _this2.sampleSearch = function (event, search) {\n      event.preventDefault();\n      var stateUpdate = {\n        q: search.term,\n        searchExample: search.id\n      };\n\n      if (search.language || search.year) {\n        if (!_this2.state.searchLanguages.length || !_this2.state.searchYears.length) {\n          _this2.loadSearchAggregates();\n        }\n      }\n\n      if (search.language) {\n        stateUpdate.searchLanguage = search.language;\n        stateUpdate.advancedSearch = true;\n      } else if (_this2.state.searchLanguage) {\n        stateUpdate.searchLanguage = \"\";\n      }\n\n      if (search.year) {\n        stateUpdate.searchYear = search.year;\n        stateUpdate.advancedSearch = true;\n      } else if (_this2.state.searchYear) {\n        stateUpdate.searchYear = \"\";\n      }\n\n      if (search.artist) {\n        stateUpdate.artistName = search.artist;\n        stateUpdate.advancedSearch = true;\n      } else if (_this2.state.artistName) {\n        stateUpdate.artistName = \"\";\n      }\n\n      _this2.setState(stateUpdate, function () {\n        _this2.submitSearch();\n      });\n    };\n\n    _this2.onSubmit = function (event) {\n      event.preventDefault();\n\n      _this2.submitSearch();\n    };\n\n    _this2._fetchSearchAlternatives = function () {\n      var url = \"/api/search/alternatives?searched=\".concat(_this2.state.parentSearch);\n      return cachedFetch(url).then(function (r) {\n        if (r.status === 200) {\n          return r.json().then(function (results) {\n            if (_this2.dismounted) {\n              return;\n            }\n\n            if (!results) {\n              return;\n            }\n\n            _this2.setState({\n              keyPhrases: results.key_phrases\n            });\n          });\n        }\n      });\n    };\n\n    _this2.onChangeSearch = function (event) {\n      var q = event.target.value;\n\n      _this2.setState({\n        q: q\n      }, function () {\n        if (_this2.state.desperateSearch) {\n          _this2.setState({\n            desperateSearch: false\n          });\n        }\n\n        if (_this2.state.originalQ) {\n          _this2.setState({\n            originalQ: \"\"\n          });\n        }\n\n        var length = q.length;\n\n        if (length > _this2.searchRef.current.maxLength - 10) {\n          _this2.setState({\n            searchMaxLength: [length, _this2.searchRef.current.maxLength],\n            showAutocompleteSuggestions: false\n          });\n        } else if (_this2.state.searchMaxLength) {\n          _this2.setState({\n            searchMaxLength: null,\n            showAutocompleteSuggestions: true\n          });\n        }\n\n        if (_this2.state.q.trim()) {\n          if (_this2.autocompleteWaitingFor) {\n            if (q.trim() === _this2.autocompleteWaitingFor) {\n              return;\n            }\n          }\n\n          if ((length < 4 || q.endsWith(\" \")) && length < 24) {\n            // the impatient one\n            _this2.fetchAutocompleteSuggestionsThrottled(q, _this2.state.searchLanguage);\n          } else if (length > 24) {\n            // When what you've typed is really long use the really\n            // delayed throttle.\n            _this2.fetchAutocompleteSuggestionsDebouncedLong(q, _this2.state.searchLanguage);\n          } else if (length) {\n            _this2.fetchAutocompleteSuggestionsDebounced(q, _this2.state.searchLanguage);\n          } else {\n            _this2.setState({\n              autocompleteSuggestions: null,\n              autocompleteSearchSuggestions: null,\n              autocompleteHighlight: -1,\n              showAutocompleteSuggestions: true\n            });\n          }\n        } else {\n          _this2.setState({\n            autocompleteSuggestions: null,\n            autocompleteSearchSuggestions: null,\n            autocompleteHighlight: -1,\n            showAutocompleteSuggestions: true\n          });\n        }\n      });\n    };\n\n    _this2.onKeyDownSearch = function (event) {\n      var suggestions = _this2.state.autocompleteSuggestions;\n\n      if (suggestions) {\n        var highlight = _this2.state.autocompleteHighlight;\n\n        if (event.key === \"Tab\") {\n          event.preventDefault();\n          var suggestion = highlight > -1 ? suggestions[highlight] : suggestions[0];\n\n          if (!suggestion._url) {\n            _this2.setState({\n              q: suggestion.text + \" \"\n            });\n\n            _this2.fetchAutocompleteSuggestions(suggestion.text, _this2.state.searchLanguage);\n          }\n        } else if (event.key === \"ArrowDown\" && highlight < suggestions.length) {\n          event.preventDefault();\n\n          _this2.setState({\n            autocompleteHighlight: highlight + 1\n          });\n        } else if (event.key === \"ArrowUp\" && highlight > -1) {\n          _this2.setState({\n            autocompleteHighlight: highlight - 1\n          });\n        } else if (event.key === \"Enter\") {\n          if (highlight > -1) {\n            event.preventDefault();\n            var searchSuggestions = _this2.state.autocompleteSearchSuggestions;\n\n            if (highlight === 0 && searchSuggestions && searchSuggestions.total) {\n              _this2.submitSearch();\n\n              return;\n            }\n\n            highlight--;\n\n            if (!suggestions[highlight]) {\n              // Not sure how this can happen\n              console.warn(\"SUGGESTIONS\", suggestions);\n              console.warn(\"HIGHLIGHT\", highlight); // But bail!\n\n              _this2.setState({\n                autocompleteSuggestions: null,\n                autocompleteHighlight: -1\n              }, function () {\n                return _this2.submitSearch();\n              });\n\n              return;\n            }\n\n            if (suggestions[highlight]._url) {\n              _this2.setState({\n                redirectTo: {\n                  pathname: suggestions[highlight]._url\n                }\n              });\n            } else {\n              _this2.setState({\n                q: suggestions[highlight].text,\n                autocompleteSuggestions: null,\n                autocompleteHighlight: -1\n              }, function () {\n                return _this2.submitSearch();\n              });\n            }\n          }\n        }\n      }\n    };\n\n    _this2.onKeyDownArtistSearch = function (event) {\n      var suggestions = _this2.state.autocompleteArtistSuggestions;\n\n      if (suggestions) {\n        var highlight = _this2.state.autocompleteArtistHighlight;\n\n        if (event.key === \"Tab\") {\n          event.preventDefault();\n\n          if (highlight > -1) {\n            _this2.setState({\n              artistName: suggestions[highlight].text\n            });\n\n            _this2.fetchAutocompleteArtistSuggestions(suggestions[highlight].text);\n          } else if (suggestions.length) {\n            _this2.setState({\n              artistName: suggestions[0].text\n            });\n\n            _this2.fetchAutocompleteArtistSuggestions(suggestions[0].text);\n          }\n        } else if (event.key === \"ArrowDown\" && highlight < suggestions.length) {\n          event.preventDefault();\n\n          _this2.setState({\n            autocompleteArtistHighlight: highlight + 1\n          });\n        } else if (event.key === \"ArrowUp\" && highlight > -1) {\n          _this2.setState({\n            autocompleteArtistHighlight: highlight - 1\n          });\n        } else if (event.key === \"Enter\") {\n          if (highlight > -1) {\n            event.preventDefault();\n\n            _this2.setState({\n              artistName: suggestions[highlight].text,\n              autocompleteArtistSuggestions: null,\n              autocompleteArtistHighlight: -1\n            });\n          }\n        }\n      }\n    };\n\n    _this2.toggleShareSearch = function (event) {\n      event.preventDefault();\n\n      _this2.setState({\n        shareSearch: !_this2.state.shareSearch,\n        advancedSearch: false\n      });\n    };\n\n    _this2.toggleAdvancedSearch = function (event) {\n      event.preventDefault();\n\n      if (!_this2.state.advancedSearch) {\n        // it was not enabled before\n        var withCountsLanguages = _this2.state.searchLanguages.filter(function (x) {\n          return x.count;\n        });\n\n        var withCountsYears = _this2.state.searchYears.filter(function (x) {\n          return x.count;\n        });\n\n        if (!withCountsLanguages.length || !withCountsYears.length) {\n          _this2.loadSearchAggregates();\n        }\n      }\n\n      _this2.setState({\n        advancedSearch: !_this2.state.advancedSearch,\n        shareSearch: false\n      });\n    };\n\n    _this2.onChangeLanguage = function (event) {\n      event.preventDefault();\n      var searchLanguage = event.target.value;\n\n      _this2.setState({\n        searchLanguage: searchLanguage\n      });\n    };\n\n    _this2.onChangeYear = function (event) {\n      event.preventDefault();\n      var searchYear = event.target.value;\n\n      _this2.setState({\n        searchYear: searchYear\n      });\n    };\n\n    _this2.onChangeArtistName = function (event) {\n      event.preventDefault();\n      var artistName = event.target.value;\n\n      _this2.setState({\n        artistName: artistName\n      }, function () {\n        if (artistName.length) {\n          _this2.fetchAutocompleteArtistSuggestions(_this2.state.artistName.trim());\n        } else {\n          _this2.setState({\n            autocompleteArtistSuggestions: null,\n            autocompleteArtistHighlight: -1\n          });\n        }\n      });\n    };\n\n    _this2.onSelectSuggestion = function (event, suggestion) {\n      event.preventDefault();\n\n      if (suggestion._url) {\n        return _this2.setState({\n          redirectTo: suggestion._url\n        });\n      }\n\n      var newText = suggestion.text;\n\n      if (suggestion.append) {\n        newText = appendSuggestion(_this2.state.q, newText);\n      }\n\n      _this2.setState({\n        q: newText,\n        autocompleteSuggestions: null,\n        autocompleteHighlight: -1\n      }, function () {\n        _this2.submitSearch();\n      });\n    };\n\n    _this2.onSelectSuggestionAll = function (event) {\n      event.preventDefault();\n\n      _this2.submitSearch();\n    };\n\n    _this2.onSelectArtistSuggestion = function (event, suggestion) {\n      event.preventDefault();\n\n      _this2.setState({\n        artistName: suggestion.text,\n        autocompleteArtistSuggestions: null,\n        autocompleteArtistHighlight: -1\n      }, function () {\n        _this2.submitSearch();\n      });\n    };\n\n    _this2.onLoadMore = function (event) {\n      event.preventDefault();\n\n      _this2.setState({\n        resultsPageIndex: _this2.state.resultsPageIndex + 1\n      }, function () {\n        _this2.startSearch(_this2.state.q, _this2.state.searchLanguage, _this2.state.searchYear, _this2.state.artistName, _this2.state.resultsPageIndex, _this2.state.searchExample);\n      });\n    };\n\n    _this2.submitPhrase = function (event, keyPhrase) {\n      event.preventDefault();\n      var stateUpdate = {\n        q: keyPhrase.phrase,\n        originalQ: _this2.state.q\n      };\n\n      if (keyPhrase.year) {\n        stateUpdate.searchYear = keyPhrase.year;\n      }\n\n      if (keyPhrase.language) {\n        stateUpdate.searchLanguage = keyPhrase.language;\n      }\n\n      _this2.setState(stateUpdate, function () {\n        _this2.submitSearch();\n      });\n    };\n\n    _this2.reloadSearch = function (event) {\n      event.preventDefault();\n      window.location.reload();\n    };\n\n    _this2.loadMoreByName = function (event) {\n      var previousByNameLimit = _this2.state.by_name_limit;\n\n      _this2.setState({\n        by_name_total: 0,\n        by_name_limit: 0\n      }, function () {\n        var url = \"/api/search?q=\".concat(encodeURIComponent(_this2.state.q), \"&by_name=\").concat(previousByNameLimit);\n        fetch(url).then(function (r) {\n          if (_this2.dismounted) {\n            return;\n          }\n\n          if (r.status === 200) {\n            r.json().then(function (results) {\n              if (results) {\n                _this2.setState({\n                  by_name: results.by_name,\n                  by_name_total: results.by_name_total,\n                  by_name_limit: results.by_name_limit\n                });\n              }\n            });\n          }\n        });\n      });\n    };\n\n    _this2.displayYears = function (year) {\n      var yearEnd = year + 9;\n      var currentYear = new Date().getFullYear();\n\n      if (yearEnd > currentYear) {\n        yearEnd = currentYear;\n      }\n\n      return \"\".concat(year, \"\\u2026\").concat(yearEnd);\n    };\n\n    var _q = \"\";\n    var originalQ = \"\";\n    var _artistName = \"\";\n    var total = 0;\n    var searchResults = null;\n    var desperate = false;\n    var missing = null; // let suggestions = null;\n\n    var by_name = null;\n    var by_name_total = null;\n    var by_name_limit = null;\n    var _searchLanguage = \"\";\n    var _searchYear = \"\";\n    var parentSearch = null;\n    var keyPhrases = null;\n    var popularityFactor = null;\n    var _searchExample = null;\n    var _results = _this2.props.results;\n\n    if (_results) {\n      _this2.searched = _results.searched;\n      _q = _results.search;\n      total = _results.total;\n      searchResults = _results.results;\n      desperate = _results.desperate;\n      missing = _results.missing;\n      by_name = _results.by_name || null;\n      by_name_total = _results.by_name_total || null;\n      by_name_limit = _results.by_name_limit || null;\n      _artistName = _results.artist;\n      originalQ = _results.original || \"\";\n      _searchLanguage = _results.language || \"\";\n      _searchYear = _results.year || \"\";\n      parentSearch = _results.searched || null;\n      keyPhrases = _results.key_phrases || null;\n      popularityFactor = _results.popularityFactor || null;\n      _searchExample = _results.search_example || null;\n    }\n\n    var advancedSearch = Boolean(_artistName || _searchLanguage || _searchYear);\n    var searchExamples = null;\n    var showExamples = false;\n\n    if (_props.searchExamples && _props.searchExamples.examples) {\n      searchExamples = _props.searchExamples.examples;\n      showExamples = true;\n    }\n\n    var recentComments = null;\n    var showRecentComments = false;\n\n    if (_props.recentComments && _props.recentComments.comments && _props.recentComments.comments.length) {\n      recentComments = _props.recentComments;\n      showRecentComments = true;\n    }\n\n    _this2.state = {\n      q: _q,\n      originalQ: originalQ,\n      artistName: _artistName,\n      searching: false,\n      searchError: null,\n      total: total,\n      results: searchResults,\n      resultsPageIndex: 0,\n      by_name: by_name,\n      by_name_total: by_name_total,\n      by_name_limit: by_name_limit,\n      placeholder: samplePlaceholders[0],\n      slowSearch: null,\n      showExamples: showExamples,\n      searchExamples: searchExamples,\n      parentSearch: parentSearch,\n      desperateSearch: desperate,\n      missing: missing,\n      keyPhrases: keyPhrases,\n      popularityFactor: popularityFactor,\n      searchExample: _searchExample,\n      showRecentComments: showRecentComments,\n      recentComments: recentComments,\n      onlyResults: null,\n      searchMaxLength: null,\n      autocompleteSuggestions: null,\n      autocompleteSearchSuggestions: null,\n      autocompleteHighlight: -1,\n      showAutocompleteSuggestions: true,\n      autocompleteArtistSuggestions: null,\n      autocompleteArtistHighlight: -1,\n      showAutocompleteArtistSuggestions: true,\n      advancedSearch: advancedSearch,\n      searchLanguage: _searchLanguage,\n      searchLanguages: [],\n      searchYear: _searchYear,\n      searchYears: [],\n      redirectTo: null,\n      shareSearch: false\n    }; // When you've typed something longer.\n    // If you steadily type something every 100ms for a long time\n    // without pausing, this won't fire till you stop.\n\n    _this2.fetchAutocompleteSuggestionsDebounced = debounce(800, _this2.fetchAutocompleteSuggestions);\n    _this2.fetchAutocompleteSuggestionsDebouncedLong = debounce(1800, _this2.fetchAutocompleteSuggestions); // When you've started typing.\n    // Will basically fire without being postponed.\n\n    _this2.fetchAutocompleteSuggestionsThrottled = throttle(1100, _this2.fetchAutocompleteSuggestions);\n    _this2._autocompleteSuggestionsCache = {};\n    return _this2;\n  }\n\n  _createClass(Home, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      ResetHTMLHeaders();\n\n      if (this.props.match.params.q) {\n        this.startSearchFromLocation(this.props);\n      } else {\n        this.startSamplePlaceholderInterval();\n\n        if (!this.state.searchExamples) {\n          this.fetchSearchExamples();\n        }\n\n        if (!this.state.recentComments) {\n          this.fetchRecentComments();\n        }\n      }\n\n      if (this.state.results) {\n        if ((this.state.desperateSearch || !this.state.total) && this.state.q.length > 10) {\n          this._fetchSearchAlternatives();\n        }\n      }\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps) {\n      if (this.props.match.params.q !== prevProps.match.params.q) {\n        if (!this.props.match.params.q) {\n          ResetHTMLHeaders();\n          this.setState({\n            q: \"\",\n            originalQ: \"\",\n            artistName: \"\",\n            searching: false,\n            total: null,\n            results: null,\n            resultsPageIndex: 0,\n            slowSearch: null,\n            showExamples: false,\n            searchExamples: null,\n            showRecentComments: false,\n            parentSearch: null,\n            desperateSearch: false,\n            searchExample: null,\n            missing: null,\n            searchError: null,\n            by_name: null,\n            by_name_total: null,\n            by_name_limit: null,\n            autocompleteSuggestions: null,\n            autocompleteSearchSuggestions: null,\n            autocompleteHighlight: -1,\n            autocompleteArtistSuggestions: null,\n            autocompleteArtistHighlight: -1,\n            redirectTo: null,\n            shareSearch: false\n          }); // this.refs.q.value = \"\";\n\n          this.fetchSearchExamples();\n        } else if (decodeURIComponent(this.props.match.params.q) !== this.state.q) {\n          this.startSearchFromLocation(this.props);\n        }\n      }\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      this.dismounted = true;\n      this.stopSamplePlaceholderInterval();\n\n      if (this.fillerInterval) {\n        window.clearInterval(this.fillerInterval);\n      }\n\n      if (this.slowSearchTimer) {\n        window.clearTimeout(this.slowSearchTimer);\n      }\n    }\n  }, {\n    key: \"fetchSearchExamples\",\n    value: function fetchSearchExamples() {\n      var _this3 = this;\n\n      var url = \"/api/search/examples\";\n      return fetch(url).then(function (r) {\n        if (r.status === 200) {\n          return r.json().then(function (results) {\n            if (_this3.dismounted) {\n              return;\n            }\n\n            if (results) {\n              if (!_this3.state.results && !_this3.state.searching) {\n                _this3.setState({\n                  searchExamples: results.examples,\n                  showExamples: true\n                });\n              }\n            }\n          });\n        }\n      });\n    }\n  }, {\n    key: \"fetchRecentComments\",\n    value: function fetchRecentComments() {\n      var _this4 = this;\n\n      var url = \"/api/comments/recent/home\";\n      return fetch(url).then(function (r) {\n        if (r.status === 200) {\n          return r.json().then(function (results) {\n            if (_this4.dismounted) {\n              return;\n            }\n\n            if (results) {\n              if (!_this4.state.results && !_this4.state.searching) {\n                _this4.setState({\n                  recentComments: results,\n                  showRecentComments: true\n                });\n              }\n            }\n          });\n        }\n      });\n    }\n  }, {\n    key: \"stopSamplePlaceholderInterval\",\n    value: function stopSamplePlaceholderInterval() {\n      if (this.placeholderSampleInterval) {\n        window.clearInterval(this.placeholderSampleInterval);\n      }\n    }\n  }, {\n    key: \"startSamplePlaceholderInterval\",\n    value: function startSamplePlaceholderInterval() {\n      var _this5 = this;\n\n      if (this.state.q) {\n        return;\n      } // let el = document.querySelector('input[type=\"search\"]')\n      // if (!el || el.value) return\n\n\n      this.currentPlaceholder = 0;\n\n      if (this.placeholderSampleInterval) {\n        window.clearInterval(this.placeholderSampleInterval);\n      }\n\n      this.placeholderSampleInterval = window.setInterval(function () {\n        _this5.setNextSamplePlaceholder();\n      }, 3000);\n    }\n  }, {\n    key: \"setNextSamplePlaceholder\",\n    value: function setNextSamplePlaceholder() {\n      var _this6 = this;\n\n      if (this.fillerInterval) {\n        window.clearInterval(this.fillerInterval);\n      }\n\n      var placeholder = samplePlaceholders[++this.currentPlaceholder % samplePlaceholders.length];\n      var el = this.searchRef.current;\n      if (!el) return;\n      var slice = 0;\n      this.fillerInterval = setInterval(function () {\n        if (!placeholder) {\n          // something's gone wrong\n          return;\n        }\n\n        el.placeholder = placeholder.substring(0, ++slice);\n\n        if (slice >= placeholder.length) {\n          clearInterval(_this6.fillerInterval);\n          el.placeholder += \"...\";\n        }\n      }, 10);\n    }\n  }, {\n    key: \"submitSearch\",\n    value: function submitSearch() {\n      var q = this.state.q.trim(); // let language = this.languageRef.current && this.languageRef.current.value;\n      // if (!language && this.state.searchLanguage) {\n      //   language = this.state.searchLanguage;\n      // }\n\n      var language = this.state.searchLanguage;\n      var year = this.state.searchYear;\n      var artistName = this.artistRef.current && this.artistRef.current.value.trim();\n\n      if (!artistName && this.state.artistName) {\n        if (!this.state.advancedSearch) {\n          artistName = this.state.artistName;\n        }\n      } else if (artistName && !this.state.artistName) {\n        this.setState({\n          artistName: artistName\n        });\n      }\n\n      if (q) {\n        var newURL = \"/q/\".concat(encodeURIComponent(q)); // only include the language= if it's set and not 'en'\n\n        if (language && language !== \"en\") {\n          newURL += \"?language=\".concat(language);\n        }\n\n        if (year) {\n          newURL += newURL.includes(\"?\") ? \"&\" : \"?\";\n          newURL += \"year=\".concat(year);\n        }\n\n        if (artistName) {\n          newURL += newURL.includes(\"?\") ? \"&\" : \"?\";\n          newURL += \"artist=\".concat(encodeURIComponent(artistName));\n        }\n\n        var currentURL = this.props.location.pathname;\n\n        if (this.props.location.search) {\n          currentURL += this.props.location.search;\n        }\n\n        if (newURL === currentURL) {\n          // get out of here\n          return;\n        }\n\n        this.props.history.push(newURL);\n        this.startSearch(q, language, year, artistName); // XXX this.searchRef.current.blur()????\n\n        document.querySelector('input[type=\"search\"]').blur();\n\n        if (this.state.autocompleteSuggestions) {\n          this.setState({\n            autocompleteSuggestions: null,\n            autocompleteSearchSuggestions: null,\n            autocompleteHighlight: -1,\n            showAutocompleteSuggestions: true\n          });\n        }\n\n        if (this.state.autocompleteArtistSuggestions) {\n          this.setState({\n            autocompleteArtistSuggestions: null,\n            autocompleteArtistHighlight: -1\n          });\n        }\n      }\n    }\n  }, {\n    key: \"startSearch\",\n    value: function startSearch(q) {\n      var _this7 = this;\n\n      var language = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n      var year = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n      var artist = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;\n      var page = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 0;\n      var searchExample = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : null;\n      SetHTMLHeaders({\n        title: \"Searching... - Song Search\"\n      }); // The state change is quite differnet depend on it being\n      // the first page or a subsequent page.\n\n      if (page) {\n        this.setState({\n          searching: true,\n          searchError: null\n        }, function () {\n          _this7.sendSearch(q, language, year, artist, page, searchExample);\n        });\n      } else {\n        this.setState({\n          searching: true,\n          searchError: null,\n          // suggestions: null,\n          results: null,\n          by_name: null,\n          showExamples: false,\n          showRecentComments: false,\n          parentSearch: null\n        }, function () {\n          _this7.sendSearch(q, language, year, artist, page, searchExample);\n\n          _this7.slowSearchTimer = window.setTimeout(function () {\n            if (!_this7.state.searchError && !_this7.state.results) {\n              _this7.setState({\n                slowSearch: true\n              });\n            }\n          }, 5 * 1000);\n        });\n      }\n    }\n  }, {\n    key: \"sendSearch\",\n    value: function sendSearch(q) {\n      var _this8 = this;\n\n      var language = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n      var year = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n      var artist = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;\n      var page = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 0;\n      var searchExample = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : null;\n      var url = \"/api/search?q=\".concat(encodeURIComponent(q));\n\n      if (language) {\n        url += \"&language=\".concat(language);\n      }\n\n      if (year) {\n        url += \"&year=\".concat(year);\n      }\n\n      if (artist) {\n        url += \"&artist=\".concat(encodeURIComponent(artist));\n      }\n\n      if (page) {\n        url += \"&page=\".concat(page + 1);\n        url += \"&searched=\".concat(this.searched);\n      } else if (this.state.originalQ) {\n        url += \"&original=\".concat(this.searched);\n      }\n\n      if (this.state.desperateSearch && !this.state.originalQ) {\n        url += \"&desperate=true\";\n      }\n\n      if (searchExample) {\n        url += \"&example=\".concat(searchExample);\n      }\n\n      return cachedFetch(url).then(function (r) {\n        if (r.status === 200) {\n          return r.json().then(function (results) {\n            if (_this8.slowSearchTimer) {\n              window.clearTimeout(_this8.slowSearchTimer);\n            }\n\n            if (_this8.dismounted) {\n              return;\n            }\n\n            if (!results) {\n              return;\n            }\n\n            if (results.error) {\n              _this8.setState({\n                searchError: results.error,\n                searching: false,\n                slowSearch: null\n              });\n\n              SetHTMLHeaders({\n                title: \"Sorry, search error\"\n              });\n              return;\n            } else if (_this8.state.searchError) {\n              _this8.setState({\n                searchError: null\n              });\n            }\n\n            SetHTMLHeaders({\n              title: \"\".concat(q, \" - Song Search\")\n            }); // This is the first time sendSearch is called for\n            // this q (and this offset).\n            // Decide whether to get suggestions searches...\n            // console.log(\n            //   'Results:', results.results.length,\n            //   'Total:', results.total,\n            //   'Limit:', results.limit,\n            // )\n            // set this so that the onExpandClick can use it\n\n            if (!page) {\n              _this8.searched = results.searched;\n            } // set in localStorage for the sake \"Open in a new tab\"\n\n\n            try {\n              localStorage.setItem(\"searched\", \"\".concat(results.searched, \",\").concat(new Date().getTime()));\n            } catch (ex) {\n              console.warn(\"'localStorage.setItem(\\\"searched\\\")' didn't work\");\n            }\n\n            var allResults;\n\n            if (page) {\n              allResults = [];\n\n              _this8.state.results.forEach(function (r) {\n                return allResults.push(r);\n              });\n\n              results.results.forEach(function (r) {\n                return allResults.push(r);\n              });\n            } else {\n              allResults = results.results;\n            }\n\n            _this8.setState({\n              desperateSearch: results.desperate,\n              missing: results.missing,\n              popularityFactor: results.popularity_factor,\n              parentSearch: results.searched,\n              searching: false,\n              results: allResults,\n              keyPhrases: null,\n              by_name: results.by_name,\n              by_name_total: results.by_name_total,\n              by_name_limit: results.by_name_limit,\n              total: results.total,\n              searchError: null,\n              slowSearch: null\n            }, function () {\n              if ((_this8.state.desperateSearch || !_this8.state.total) && _this8.state.q.length > 10) {\n                _this8._fetchSearchAlternatives();\n              }\n            });\n          });\n        } else {\n          r.text().then(function (text) {\n            SetHTMLHeaders({\n              title: \"Search Error\"\n            });\n\n            _this8.setState({\n              searching: false,\n              searchError: {\n                status: r.status,\n                text: text\n              },\n              slowSearch: false\n            });\n          });\n        }\n      });\n    }\n  }, {\n    key: \"fetchAutocompleteSuggestions\",\n    value: function fetchAutocompleteSuggestions(q) {\n      var _this9 = this;\n\n      var language = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n      var cacheHash = q.trim();\n      var url = \"/api/search/autocomplete?q=\".concat(encodeURIComponent(q));\n\n      if (language) {\n        cacheHash += language.trim();\n        url += \"&language=\".concat(language);\n      }\n\n      var cached = this._autocompleteSuggestionsCache[cacheHash];\n\n      if (cached) {\n        return Promise.resolve(cached).then(function (results) {\n          _this9.setState({\n            autocompleteSuggestions: results.matches,\n            autocompleteSearchSuggestions: results.search_suggestions,\n            autocompleteHighlight: -1,\n            missing: results.missing\n          });\n        });\n      } // Store a \"global\" of what the latest q was.\n\n\n      this.autocompleteWaitingFor = q;\n      return fetch(url).then(function (r) {\n        if (r.status === 200) {\n          return r.json().then(function (results) {\n            if (_this9.dismounted) {\n              return;\n            }\n\n            if (q.startsWith(_this9.autocompleteWaitingFor)) {\n              _this9._autocompleteSuggestionsCache[cacheHash] = results;\n\n              if (_this9.state.q) {\n                _this9.setState({\n                  autocompleteSuggestions: results.matches,\n                  autocompleteSearchSuggestions: results.search_suggestions,\n                  autocompleteHighlight: -1\n                });\n              }\n            }\n          });\n        }\n      });\n    }\n  }, {\n    key: \"fetchAutocompleteArtistSuggestions\",\n    value: function fetchAutocompleteArtistSuggestions(q) {\n      var _this10 = this;\n\n      var url = \"/api/search/autocomplete?q=\".concat(q, \"&artist=true\");\n      return fetch(url).then(function (r) {\n        if (r.status === 200) {\n          return r.json();\n        }\n      }).then(function (results) {\n        if (_this10.dismounted) {\n          return;\n        }\n\n        if (results) {\n          _this10.setState({\n            autocompleteArtistSuggestions: results.matches,\n            autocompleteArtistHighlight: -1\n          });\n        }\n      });\n    }\n  }, {\n    key: \"loadSearchAggregates\",\n    value: // loadSearchLanguages() {\n    //   return fetch(\"/api/search/languages\").then(r => {\n    //     if (r.status === 200) {\n    //       r.json().then(r => {\n    //         this.setState({ searchLanguages: r.languages });\n    //       });\n    //     }\n    //   });\n    // }\n    function loadSearchAggregates() {\n      var _this11 = this;\n\n      return fetch(\"/api/search/aggregates\").then(function (r) {\n        if (r.status === 200) {\n          r.json().then(function (r) {\n            _this11.setState({\n              searchLanguages: r.languages,\n              searchYears: r.years\n            });\n          });\n        }\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this12 = this;\n\n      var _this$state = this.state,\n          redirectTo = _this$state.redirectTo,\n          searchYear = _this$state.searchYear;\n\n      if (redirectTo) {\n        return /*#__PURE__*/_jsxDEV(Redirect, {\n          to: redirectTo,\n          push: true\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1191,\n          columnNumber: 14\n        }, this);\n      }\n\n      var results = null;\n      var pagination = null;\n\n      if (this.state.results) {\n        var rows = this.state.results;\n\n        if (this.state.onlyResults) {\n          var onlyIds = this.state.onlyResults.map(function (r) {\n            return r.id;\n          });\n          rows = rows.filter(function (row) {\n            return onlyIds.includes(row.id);\n          });\n        }\n\n        results = /*#__PURE__*/_jsxDEV(Results, {\n          results: rows,\n          searched: this.searched,\n          popularityFactor: this.state.popularityFactor,\n          showYear: Boolean(searchYear)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1202,\n          columnNumber: 9\n        }, this);\n\n        if (this.state.results.length < this.state.total) {\n          pagination = /*#__PURE__*/_jsxDEV(Pagination, {\n            location: this.props.location,\n            page: this.state.resultsPageIndex,\n            onLoadMore: this.onLoadMore\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1211,\n            columnNumber: 11\n          }, this);\n        }\n      }\n\n      var byName = null;\n\n      if (this.state.by_name && this.state.by_name.length) {\n        byName = /*#__PURE__*/_jsxDEV(SongsByName, {\n          results: this.state.by_name,\n          total: this.state.by_name_total,\n          limit: this.state.by_name_limit,\n          loadMoreByName: this.loadMoreByName\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1223,\n          columnNumber: 9\n        }, this);\n      }\n\n      var searchToggles = /*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"help-block toggles\",\n        children: [this.state.results && this.state.results.length ? /*#__PURE__*/_jsxDEV(\"button\", {\n          type: \"button\",\n          className: this.state.shareSearch ? \"btn btn-default btn-sm active\" : \"btn btn-default btn-sm\",\n          onClick: this.toggleShareSearch,\n          children: this.state.shareSearch ? \"Hide share search\" : \"Share search results\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1235,\n          columnNumber: 11\n        }, this) : null, /*#__PURE__*/_jsxDEV(\"button\", {\n          type: \"button\",\n          className: this.state.advancedSearch ? \"btn btn-default btn-sm active\" : \"btn btn-default btn-sm\",\n          onClick: this.toggleAdvancedSearch,\n          children: this.state.advancedSearch ? \"Hide search options\" : \"Search options\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1249,\n          columnNumber: 9\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1233,\n        columnNumber: 7\n      }, this);\n\n      var advancedSearchStatus = null;\n\n      if (!this.state.advancedSearch) {\n        var parts = []; // if you currently don't have the advanced search options open,\n        // show what's currently selected.\n\n        if (this.state.searchLanguage && this.state.searchLanguage !== \"en\") {\n          var language = this.state.searchLanguages.filter(function (e) {\n            return e.code === _this12.state.searchLanguage;\n          })[0].language;\n          parts.push(\"Language: \".concat(language));\n        }\n\n        if (this.state.searchYear) {\n          parts.push(\"Years: \".concat(this.displayYears(parseInt(this.state.searchYear))));\n        }\n\n        if (this.state.artistName) {\n          parts.push(\"Artist: \".concat(this.state.artistName));\n        }\n\n        if (parts.length) {\n          advancedSearchStatus = /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"help-block advanced-search-status\",\n            children: [/*#__PURE__*/_jsxDEV(\"b\", {\n              children: \"Search options:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1286,\n              columnNumber: 13\n            }, this), \" \", parts.join(\", \")]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1285,\n            columnNumber: 11\n          }, this);\n        }\n      }\n\n      var advancedInput = null;\n\n      if (this.state.advancedSearch) {\n        advancedInput = /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"advanced\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"form-group\",\n            style: {\n              position: \"relative\"\n            },\n            children: [/*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"search\",\n              ref: this.artistRef,\n              value: this.state.artistName,\n              className: \"form-control input-lg\",\n              maxLength: 100,\n              onFocus: this.onFocusArtist,\n              onBlur: this.onBlurArtist,\n              onChange: this.onChangeArtistName,\n              onKeyDown: this.onKeyDownArtistSearch,\n              \"aria-label\": \"Artist search\",\n              placeholder: \"Artist or band name\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1297,\n              columnNumber: 13\n            }, this), this.state.autocompleteArtistSuggestions && this.state.showAutocompleteArtistSuggestions ? /*#__PURE__*/_jsxDEV(ShowAutocompleteArtistSuggestions, {\n              onSelectSuggestion: this.onSelectArtistSuggestion,\n              highlight: this.state.autocompleteArtistHighlight,\n              suggestions: this.state.autocompleteArtistSuggestions\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1312,\n              columnNumber: 15\n            }, this) : null]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1296,\n            columnNumber: 11\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"form-group\",\n            children: /*#__PURE__*/_jsxDEV(\"select\", {\n              ref: this.languageRef,\n              onChange: this.onChangeLanguage,\n              value: this.state.searchLanguage,\n              className: \"form-control\",\n              children: [/*#__PURE__*/_jsxDEV(\"option\", {\n                value: \"\",\n                children: \"Any language\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1326,\n                columnNumber: 15\n              }, this), this.state.searchLanguages.map(function (each) {\n                var text = each.language;\n\n                if (each.count === 1) {\n                  text += \" (1 song)\";\n                } else if (each.count) {\n                  text += \" (\".concat(each.count.toLocaleString(), \" songs)\");\n                }\n\n                return /*#__PURE__*/_jsxDEV(\"option\", {\n                  value: each.code,\n                  children: text\n                }, each.code, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1335,\n                  columnNumber: 19\n                }, _this12);\n              })]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1320,\n              columnNumber: 13\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1319,\n            columnNumber: 11\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"form-group\",\n            children: /*#__PURE__*/_jsxDEV(\"select\", {\n              // ref={this.yearRef}\n              onChange: this.onChangeYear,\n              value: this.state.searchYear,\n              className: \"form-control\",\n              children: [/*#__PURE__*/_jsxDEV(\"option\", {\n                value: \"\",\n                children: \"Any year\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1349,\n                columnNumber: 15\n              }, this), this.state.searchYears.map(function (each) {\n                var text = _this12.displayYears(each.year);\n\n                if (each.count === 1) {\n                  text += \" (1 song)\";\n                } else if (each.count) {\n                  text += \" (\".concat(each.count.toLocaleString(), \" songs)\");\n                }\n\n                return /*#__PURE__*/_jsxDEV(\"option\", {\n                  value: each.year,\n                  children: text\n                }, text, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1358,\n                  columnNumber: 19\n                }, _this12);\n              })]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1343,\n              columnNumber: 13\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1342,\n            columnNumber: 11\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"form-group text-right\",\n            children: /*#__PURE__*/_jsxDEV(\"button\", {\n              type: \"submit\",\n              className: \"btn btn-primary\",\n              children: \"Search Now\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1366,\n              columnNumber: 13\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1365,\n            columnNumber: 11\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1295,\n          columnNumber: 9\n        }, this);\n      }\n\n      var keyPhrases = null;\n\n      if (this.state.results && // !this.state.results.length &&\n      this.state.keyPhrases && this.state.keyPhrases.length) {\n        keyPhrases = /*#__PURE__*/_jsxDEV(ShowKeyPhrases, {\n          nothingFound: !this.state.results.length,\n          phrases: this.state.keyPhrases,\n          submitPhrase: this.submitPhrase\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1382,\n          columnNumber: 9\n        }, this);\n      }\n\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"form\", {\n          onSubmit: this.onSubmit,\n          action: \"/api/search/redirect\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"form-group\",\n            style: {\n              position: \"relative\"\n            },\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"input-group input-group-lg\",\n              children: [/*#__PURE__*/_jsxDEV(\"input\", {\n                type: \"search\",\n                ref: this.searchRef,\n                name: \"q\",\n                autoComplete: \"off\",\n                value: this.state.q,\n                onFocus: this.onFocusSearch,\n                onBlur: this.onBlurSearch,\n                onChange: this.onChangeSearch,\n                onKeyDown: this.onKeyDownSearch,\n                className: \"form-control\",\n                maxLength: 150,\n                \"aria-label\": \"Lyrics search\",\n                placeholder: this.state.placeholder\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1395,\n                columnNumber: 15\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"input-group-btn\",\n                children: /*#__PURE__*/_jsxDEV(\"button\", {\n                  className: \"btn btn-default btn-lg\",\n                  type: \"submit\",\n                  title: \"Click to search\",\n                  children: \"Search\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1411,\n                  columnNumber: 17\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1410,\n                columnNumber: 15\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1394,\n              columnNumber: 13\n            }, this), this.state.searchMaxLength ? /*#__PURE__*/_jsxDEV(ShowMaxlengthWarning, {\n              length: this.state.searchMaxLength[0],\n              maxLength: this.state.searchMaxLength[1]\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1421,\n              columnNumber: 15\n            }, this) : null, this.state.desperateSearch && this.state.results && this.state.results.length && !(this.state.showAutocompleteSuggestions && this.state.autocompleteSuggestions) ? /*#__PURE__*/_jsxDEV(ShowDesperateSearchWarning, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1433,\n              columnNumber: 15\n            }, this) : null, !this.state.desperateSearch && this.state.missing && this.state.results && this.state.results.length && !(this.state.showAutocompleteSuggestions && this.state.autocompleteSuggestions) ? /*#__PURE__*/_jsxDEV(ShowMissingSearchWarning, {\n              missing: this.state.missing\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1443,\n              columnNumber: 15\n            }, this) : null, this.state.autocompleteSuggestions && this.state.showAutocompleteSuggestions ? /*#__PURE__*/_jsxDEV(ShowAutocompleteSuggestions, {\n              q: this.state.q,\n              onSelectSuggestion: this.onSelectSuggestion,\n              onSelectSuggestionAll: this.onSelectSuggestionAll,\n              highlight: this.state.autocompleteHighlight,\n              suggestions: this.state.autocompleteSuggestions,\n              searchSuggestions: this.state.autocompleteSearchSuggestions\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1447,\n              columnNumber: 15\n            }, this) : null]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1393,\n            columnNumber: 11\n          }, this), /*#__PURE__*/_jsxDEV(ShowResultCount, {\n            results: this.state.results,\n            total: this.state.total,\n            byName: this.state.by_name,\n            onlyResults: this.state.onlyResults\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1457,\n            columnNumber: 11\n          }, this), searchToggles, advancedSearchStatus, this.state.shareSearch ? /*#__PURE__*/_jsxDEV(ShareInput, {\n            searched: this.searched\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1467,\n            columnNumber: 13\n          }, this) : null, advancedInput]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1392,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          id: \"waldo-tag-11815\",\n          children: /*#__PURE__*/_jsxDEV(\"script\", {\n            children: [\"googletag.cmd.push(function() {\\n              googletag.display = \\\"waldo-tag-11815\\\";\\n            })\", \";\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1473,\n            columnNumber: 11\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1472,\n          columnNumber: 7\n        }, this), this.state.searchError ? /*#__PURE__*/_jsxDEV(SearchError, {\n          error: this.state.searchError\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1485,\n          columnNumber: 11\n        }, this) : null, this.state.showExamples ? /*#__PURE__*/_jsxDEV(ShowExamples, {\n          sampleSearch: this.sampleSearch,\n          examples: this.state.searchExamples\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1488,\n          columnNumber: 11\n        }, this) : null, this.state.showRecentComments && this.state.recentComments ? /*#__PURE__*/_jsxDEV(ShowRecentCommentsWrapper, {\n          comments: this.state.recentComments.comments\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1494,\n          columnNumber: 11\n        }, this) : null, byName, keyPhrases, results, this.state.searching ? /*#__PURE__*/_jsxDEV(Loading, {\n          text: \"Searching...\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1502,\n          columnNumber: 33\n        }, this) : null, pagination, this.state.slowSearch ? /*#__PURE__*/_jsxDEV(SlowSearch, {\n          reloadSearch: this.reloadSearch\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1505,\n          columnNumber: 11\n        }, this) : null]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1391,\n        columnNumber: 7\n      }, this);\n    }\n  }]);\n\n  return Home;\n}(React.Component);\n\nexport default Home;\n\nvar ShowRecentCommentsWrapper = /*#__PURE__*/function (_React$PureComponent) {\n  _inherits(ShowRecentCommentsWrapper, _React$PureComponent);\n\n  var _super2 = _createSuper(ShowRecentCommentsWrapper);\n\n  function ShowRecentCommentsWrapper() {\n    _classCallCheck(this, ShowRecentCommentsWrapper);\n\n    return _super2.apply(this, arguments);\n  }\n\n  _createClass(ShowRecentCommentsWrapper, [{\n    key: \"render\",\n    value: function render() {\n      var comments = this.props.comments;\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"recent-comments\",\n        style: {\n          marginTop: 50\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n          children: [\"Recent Comments (\", /*#__PURE__*/_jsxDEV(Link, {\n            to: \"/comments\",\n            children: \"All\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1520,\n            columnNumber: 28\n          }, this), \")\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1519,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(ShowRecentComments, {\n          comments: comments,\n          isRoot: true\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1522,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"load-more\",\n          children: /*#__PURE__*/_jsxDEV(Link, {\n            to: \"/comments\",\n            children: \"More recent comments\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1524,\n            columnNumber: 11\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1523,\n          columnNumber: 9\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1518,\n        columnNumber: 7\n      }, this);\n    }\n  }]);\n\n  return ShowRecentCommentsWrapper;\n}(React.PureComponent);\n\nvar ShowResultCount = /*#__PURE__*/React.memo(_c2 = function _c2(_ref) {\n  var results = _ref.results,\n      total = _ref.total,\n      onlyResults = _ref.onlyResults,\n      byName = _ref.byName;\n\n  if (!results) {\n    return null;\n  }\n\n  var countResults = null;\n\n  if (results) {\n    var byNameCount = byName ? byName.length : 0;\n\n    if (onlyResults) {\n      countResults = onlyResults.length + byNameCount;\n    } else {\n      countResults = results.length + byNameCount;\n    }\n  }\n\n  return /*#__PURE__*/_jsxDEV(\"p\", {\n    className: \"result-metadata text-right\",\n    children: [/*#__PURE__*/_jsxDEV(\"b\", {\n      children: [total >= 10000 ? \"More than \" : \"\", total.toLocaleString(), \" \", total === 1 ? \"song found\" : \"songs found\"]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1547,\n      columnNumber: 9\n    }, _this), \" \", countResults && countResults < total ? \"(showing \".concat(countResults, \")\") : null]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 1546,\n    columnNumber: 7\n  }, _this);\n});\n_c3 = ShowResultCount;\n\nvar ShareInput = /*#__PURE__*/function (_React$PureComponent2) {\n  _inherits(ShareInput, _React$PureComponent2);\n\n  var _super3 = _createSuper(ShareInput);\n\n  function ShareInput() {\n    var _this13;\n\n    _classCallCheck(this, ShareInput);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this13 = _super3.call.apply(_super3, [this].concat(args));\n    _this13.state = {\n      copied: false,\n      failed: false,\n      hasFocused: false\n    };\n    _this13.absurlRef = /*#__PURE__*/React.createRef();\n    return _this13;\n  }\n\n  _createClass(ShareInput, [{\n    key: \"render\",\n    value: function render() {\n      var _this14 = this;\n\n      var absoluteUrl = window.location.href;\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"form-group\",\n        style: {\n          marginTop: 30\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"input-group\",\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            className: \"sr-only\",\n            children: \"URL:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1573,\n            columnNumber: 11\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            ref: this.absurlRef,\n            type: \"text\",\n            className: \"form-control\",\n            readOnly: true,\n            value: absoluteUrl,\n            onFocus: function onFocus() {\n              if (!_this14.state.hasFocused) {\n                _this14.absurlRef.current.select();\n\n                _this14.setState({\n                  hasFocused: true\n                });\n              }\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1574,\n            columnNumber: 11\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"input-group-btn\",\n            children: /*#__PURE__*/_jsxDEV(\"button\", {\n              type: \"button\",\n              className: this.state.copied ? \"btn btn-success\" : \"btn btn-primary\",\n              title: \"Click to copy to clipboard\",\n              onClick: function onClick(event) {\n                event.preventDefault();\n\n                _this14.absurlRef.current.select();\n\n                if (copy(absoluteUrl)) {\n                  _this14.setState({\n                    copied: true,\n                    failed: false\n                  }, function () {\n                    if (_this14.props.searched && !_this14.copied) {\n                      _this14.copied = _this14.props.searched;\n                      fetch(\"/api/search/copied/\".concat(_this14.props.searched), {\n                        method: \"POST\"\n                      });\n                    }\n                  });\n                } else {\n                  _this14.setState({\n                    copied: false,\n                    failed: true\n                  });\n                }\n              },\n              children: this.state.copied ? \"Copied to clipboard\" : \"Copy to clipboard\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1588,\n              columnNumber: 13\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1587,\n            columnNumber: 11\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1572,\n          columnNumber: 9\n        }, this), this.state.copied ? /*#__PURE__*/_jsxDEV(\"p\", {\n          children: \"The URL to this search has now been copied to your clipboard so you can paste it anywhere. Thanks!\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1616,\n          columnNumber: 11\n        }, this) : null]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1571,\n        columnNumber: 7\n      }, this);\n    }\n  }]);\n\n  return ShareInput;\n}(React.PureComponent);\n\nvar ShowKeyPhrases = /*#__PURE__*/React.memo(_c4 = function _c4(_ref2) {\n  var phrases = _ref2.phrases,\n      submitPhrase = _ref2.submitPhrase,\n      nothingFound = _ref2.nothingFound;\n  var subTitle = null;\n\n  if (nothingFound) {\n    if (phrases.length === 1) {\n      subTitle = /*#__PURE__*/_jsxDEV(\"h4\", {\n        children: \"But, try this...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1630,\n        columnNumber: 18\n      }, _this);\n    } else {\n      subTitle = /*#__PURE__*/_jsxDEV(\"h4\", {\n        children: \"But, try these...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1632,\n        columnNumber: 18\n      }, _this);\n    }\n  }\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"key-phrases\",\n    children: [nothingFound ? /*#__PURE__*/_jsxDEV(\"h3\", {\n      children: \"Nothing found\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1638,\n      columnNumber: 9\n    }, _this) : /*#__PURE__*/_jsxDEV(\"h3\", {\n      children: \"Fuzzy results. Try breaking it up...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1640,\n      columnNumber: 9\n    }, _this), subTitle, /*#__PURE__*/_jsxDEV(\"table\", {\n      className: \"table suggestions table-condensed\",\n      children: /*#__PURE__*/_jsxDEV(\"tbody\", {\n        children: phrases.map(function (phrase) {\n          var url = \"/q/\".concat(phrase.phrase);\n\n          if (phrase.year) {\n            url += \"?year=\".concat(phrase.year);\n          }\n\n          return /*#__PURE__*/_jsxDEV(\"tr\", {\n            children: [/*#__PURE__*/_jsxDEV(\"td\", {\n              children: /*#__PURE__*/_jsxDEV(\"a\", {\n                href: url,\n                onClick: function onClick(e) {\n                  return submitPhrase(e, phrase);\n                },\n                children: phrase.diff_html ? /*#__PURE__*/_jsxDEV(\"span\", {\n                  dangerouslySetInnerHTML: {\n                    __html: phrase.diff_html\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1655,\n                  columnNumber: 23\n                }, _this) : phrase.phrase\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1653,\n                columnNumber: 19\n              }, _this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1652,\n              columnNumber: 17\n            }, _this), /*#__PURE__*/_jsxDEV(\"td\", {\n              children: [/*#__PURE__*/_jsxDEV(\"b\", {\n                children: phrase.total\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1664,\n                columnNumber: 19\n              }, _this), \" \", phrase.total === 1 ? \"song\" : \"songs\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1663,\n              columnNumber: 17\n            }, _this)]\n          }, phrase.phrase, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1651,\n            columnNumber: 15\n          }, _this);\n        })\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1644,\n        columnNumber: 9\n      }, _this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1643,\n      columnNumber: 7\n    }, _this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 1636,\n    columnNumber: 5\n  }, _this);\n});\n_c5 = ShowKeyPhrases;\nvar ShowAutocompleteSuggestions = /*#__PURE__*/React.memo(_c6 = function _c6(_ref3) {\n  var q = _ref3.q,\n      highlight = _ref3.highlight,\n      suggestions = _ref3.suggestions,\n      searchSuggestions = _ref3.searchSuggestions,\n      onSelectSuggestion = _ref3.onSelectSuggestion,\n      onSelectSuggestionAll = _ref3.onSelectSuggestionAll;\n\n  if (!suggestions.length) {\n    return null;\n  }\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"autocomplete\",\n    children: /*#__PURE__*/_jsxDEV(\"ul\", {\n      children: [searchSuggestions && q && searchSuggestions.total ? /*#__PURE__*/_jsxDEV(\"li\", {\n        onClick: onSelectSuggestionAll,\n        className: highlight === 0 ? \"active search-suggestion\" : \"search-suggestion\",\n        children: [searchSuggestions.capped ? /*#__PURE__*/_jsxDEV(\"a\", {\n          style: {\n            float: \"right\"\n          },\n          href: \"/q/\" + encodeURIComponent(searchSuggestions.term),\n          children: [searchSuggestions.total.toLocaleString(), \" \", searchSuggestions.desperate ? \"approximate matches\" : \"good matches\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1700,\n          columnNumber: 17\n        }, _this) : null, /*#__PURE__*/_jsxDEV(\"a\", {\n          href: \"/q/\" + encodeURIComponent(searchSuggestions.term),\n          children: [\"Search for \", /*#__PURE__*/_jsxDEV(\"i\", {\n            children: q\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1711,\n            columnNumber: 28\n          }, _this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1710,\n          columnNumber: 15\n        }, _this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1691,\n        columnNumber: 13\n      }, _this) : null, suggestions.map(function (s, index) {\n        var className = index + 1 === highlight ? \"active\" : \"\";\n        return /*#__PURE__*/_jsxDEV(\"li\", {\n          className: className,\n          onClick: function onClick(e) {\n            return onSelectSuggestion(e, s);\n          },\n          children: s.id ? /*#__PURE__*/_jsxDEV(ShowAutocompleteSuggestionSong, {\n            song: s\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1725,\n            columnNumber: 19\n          }, _this) : /*#__PURE__*/_jsxDEV(ShowAutocompleteSuggestion, {\n            text: s.text,\n            html: s.html,\n            found: s.found\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1727,\n            columnNumber: 19\n          }, _this)\n        }, s.id ? s.id : s.text, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1719,\n          columnNumber: 15\n        }, _this);\n      })]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1689,\n      columnNumber: 9\n    }, _this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 1688,\n    columnNumber: 7\n  }, _this);\n});\n_c7 = ShowAutocompleteSuggestions;\nvar ShowAutocompleteSuggestion = /*#__PURE__*/React.memo(_c8 = function _c8(_ref4) {\n  var found = _ref4.found,\n      html = _ref4.html;\n\n  if (found) {\n    return /*#__PURE__*/_jsxDEV(\"p\", {\n      className: \"search\",\n      children: [/*#__PURE__*/_jsxDEV(\"small\", {\n        children: found\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1746,\n        columnNumber: 9\n      }, _this), /*#__PURE__*/_jsxDEV(\"span\", {\n        dangerouslySetInnerHTML: {\n          __html: html\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1747,\n        columnNumber: 9\n      }, _this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1745,\n      columnNumber: 7\n    }, _this);\n  } else {\n    return /*#__PURE__*/_jsxDEV(\"p\", {\n      className: \"search\",\n      dangerouslySetInnerHTML: {\n        __html: html\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1751,\n      columnNumber: 12\n    }, _this);\n  }\n});\n_c9 = ShowAutocompleteSuggestion;\nvar ShowAutocompleteSuggestionSong = /*#__PURE__*/React.memo(_c10 = function _c10(_ref5) {\n  var song = _ref5.song;\n  var imageUrl = placeholderImage;\n\n  if (song.image) {\n    if (song.image.thumbnail100) {\n      imageUrl = song.image.thumbnail100;\n    } else {\n      imageUrl = song.image.url;\n    }\n  }\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"media autocomplete-suggestion-song\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"media-left\",\n      children: /*#__PURE__*/_jsxDEV(AutocompleteImage, {\n        url: imageUrl,\n        name: song.name\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1767,\n        columnNumber: 9\n      }, _this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1766,\n      columnNumber: 7\n    }, _this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"media-body\",\n      children: [/*#__PURE__*/_jsxDEV(\"h5\", {\n        className: \"artist-name\",\n        children: [/*#__PURE__*/_jsxDEV(\"b\", {\n          children: song.name\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1771,\n          columnNumber: 11\n        }, _this), /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"by\",\n          children: \" by \"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1772,\n          columnNumber: 11\n        }, _this), song.artist.name]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1770,\n        columnNumber: 9\n      }, _this), song.fragments.map(function (fragment, i) {\n        return /*#__PURE__*/_jsxDEV(\"p\", {\n          dangerouslySetInnerHTML: {\n            __html: fragment\n          }\n        }, \"\".concat(song.id, \":\").concat(i), false, {\n          fileName: _jsxFileName,\n          lineNumber: 1777,\n          columnNumber: 13\n        }, _this);\n      })]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1769,\n      columnNumber: 7\n    }, _this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 1765,\n    columnNumber: 5\n  }, _this);\n});\n_c11 = ShowAutocompleteSuggestionSong;\nvar ShowAutocompleteArtistSuggestions = /*#__PURE__*/React.memo(_c12 = function _c12(_ref6) {\n  var highlight = _ref6.highlight,\n      suggestions = _ref6.suggestions,\n      onSelectSuggestion = _ref6.onSelectSuggestion;\n\n  if (!suggestions.length) {\n    return null;\n  }\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"autocomplete\",\n    children: /*#__PURE__*/_jsxDEV(\"ul\", {\n      children: suggestions.map(function (s, index) {\n        var className = index === highlight ? \"active\" : \"\";\n        return /*#__PURE__*/_jsxDEV(\"li\", {\n          className: className,\n          onClick: function onClick(e) {\n            return onSelectSuggestion(e, s);\n          },\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"media\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"media-left\",\n              children: /*#__PURE__*/_jsxDEV(AutocompleteImage, {\n                url: s.thumbnail100 || s.image || placeholderImage,\n                name: s.text\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1806,\n                columnNumber: 21\n              }, _this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1805,\n              columnNumber: 19\n            }, _this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"media-body\",\n              children: [/*#__PURE__*/_jsxDEV(\"h5\", {\n                className: \"artist-name\",\n                dangerouslySetInnerHTML: {\n                  __html: s.html\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1812,\n                columnNumber: 21\n              }, _this), /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"artist-metadata\",\n                children: [s.songs ? s.songs : \"0\", \" songs\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1816,\n                columnNumber: 21\n              }, _this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1811,\n              columnNumber: 19\n            }, _this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1804,\n            columnNumber: 17\n          }, _this)\n        }, \"\".concat(s.text).concat(index), false, {\n          fileName: _jsxFileName,\n          lineNumber: 1799,\n          columnNumber: 15\n        }, _this);\n      })\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1795,\n      columnNumber: 9\n    }, _this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 1794,\n    columnNumber: 7\n  }, _this);\n});\n_c13 = ShowAutocompleteArtistSuggestions;\n\nfunction ShowMaxlengthWarning(_ref7) {\n  var length = _ref7.length,\n      maxLength = _ref7.maxLength;\n  var className = \"help-block maxlength\";\n\n  if (length === maxLength) {\n    className += \" danger\";\n  }\n\n  return /*#__PURE__*/_jsxDEV(\"span\", {\n    className: className,\n    children: [length, \" of max \", maxLength, \" characters!\"]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 1836,\n    columnNumber: 5\n  }, this);\n}\n\n_c14 = ShowMaxlengthWarning;\n\nfunction ShowDesperateSearchWarning() {\n  return /*#__PURE__*/_jsxDEV(\"span\", {\n    className: \"help-block warning\",\n    children: [/*#__PURE__*/_jsxDEV(\"b\", {\n      children: \"Note!\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1845,\n      columnNumber: 7\n    }, this), \" Nothing could be found with that exact search. Showing fuzzy matches.\"]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 1844,\n    columnNumber: 5\n  }, this);\n}\n\n_c15 = ShowDesperateSearchWarning;\n\nfunction ShowMissingSearchWarning(_ref8) {\n  var missing = _ref8.missing;\n  return /*#__PURE__*/_jsxDEV(\"span\", {\n    className: \"help-block warning\",\n    children: [/*#__PURE__*/_jsxDEV(\"b\", {\n      children: \"Note!\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1854,\n      columnNumber: 7\n    }, this), \" Results found by discarding\", \" \", /*#__PURE__*/_jsxDEV(\"i\", {\n      style: {\n        textDecoration: \"line-through\"\n      },\n      children: missing\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1855,\n      columnNumber: 7\n    }, this), \".\"]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 1853,\n    columnNumber: 5\n  }, this);\n}\n\n_c16 = ShowMissingSearchWarning;\nvar ShowExamples = /*#__PURE__*/React.memo(_c17 = function _c17(_ref9) {\n  var sampleSearch = _ref9.sampleSearch,\n      examples = _ref9.examples;\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"examples\",\n    children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n      children: \"Successful searches for songs by lyrics\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1863,\n      columnNumber: 7\n    }, _this), /*#__PURE__*/_jsxDEV(\"ul\", {\n      children: examples.map(function (search) {\n        var link = \"/q/\" + encodeURIComponent(search.term);\n        link += \"?example=\".concat(search.id);\n\n        if (search.artist) {\n          link += \"&artist=\".concat(encodeURIComponent(search.artist));\n        }\n\n        if (search.language) {\n          link += \"&language=\".concat(encodeURIComponent(search.language));\n        }\n\n        if (search.year) {\n          link += \"&year=\".concat(search.year);\n        }\n\n        var searchMeta = null;\n        var searchMetaStrings = [];\n\n        if (search.artist) {\n          searchMetaStrings.push([\"artist\", search.artist]);\n        }\n\n        if (search.language) {\n          searchMetaStrings.push([\"language\", search.language_human]);\n        }\n\n        if (search.year) {\n          searchMetaStrings.push([\"year\", search.year]);\n        }\n\n        if (searchMetaStrings.length) {\n          searchMeta = /*#__PURE__*/_jsxDEV(\"span\", {\n            children: [\"(\", searchMetaStrings.map(function (n, i) {\n              return /*#__PURE__*/_jsxDEV(React.Fragment, {\n                children: [n[0], \" \", /*#__PURE__*/_jsxDEV(\"b\", {\n                  children: n[1]\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1896,\n                  columnNumber: 30\n                }, _this), i + 1 < searchMetaStrings.length ? \", \" : \"\"]\n              }, n[0], true, {\n                fileName: _jsxFileName,\n                lineNumber: 1895,\n                columnNumber: 21\n              }, _this);\n            }), \")\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1891,\n            columnNumber: 15\n          }, _this);\n        }\n\n        return /*#__PURE__*/_jsxDEV(\"li\", {\n          children: [/*#__PURE__*/_jsxDEV(Link, {\n            to: link,\n            onClick: function onClick(e) {\n              return sampleSearch(e, search);\n            },\n            children: /*#__PURE__*/_jsxDEV(\"b\", {\n              children: search.term\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1909,\n              columnNumber: 17\n            }, _this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1908,\n            columnNumber: 15\n          }, _this), \" \", searchMeta, \" \", /*#__PURE__*/_jsxDEV(\"i\", {\n            children: [search.total_found, \" found\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1911,\n            columnNumber: 28\n          }, _this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1912,\n            columnNumber: 15\n          }, _this), search.opened.map(function (song) {\n            return /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"opened\",\n              children: [\"clicked on\", \" \", /*#__PURE__*/_jsxDEV(Link, {\n                to: song._url,\n                children: [/*#__PURE__*/_jsxDEV(\"b\", {\n                  children: song.name\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1918,\n                  columnNumber: 23\n                }, _this), \" by \", /*#__PURE__*/_jsxDEV(\"b\", {\n                  children: song.artist.name\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1918,\n                  columnNumber: 45\n                }, _this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1917,\n                columnNumber: 21\n              }, _this)]\n            }, song.id, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1915,\n              columnNumber: 19\n            }, _this);\n          })]\n        }, search.id, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1907,\n          columnNumber: 13\n        }, _this);\n      })\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1864,\n      columnNumber: 7\n    }, _this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 1862,\n    columnNumber: 5\n  }, _this);\n});\n_c18 = ShowExamples;\n\nfunction SlowSearch(_ref10) {\n  var reloadSearch = _ref10.reloadSearch;\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"slow-search\",\n    children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n      children: \"Sorry, search seems to take longer than normal!\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1934,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n      children: [\"Perhaps it got stuck? \", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1936,\n        columnNumber: 31\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        type: \"button\",\n        className: \"btn btn-default btn-sm\",\n        onClick: reloadSearch,\n        children: \"Reload search\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1937,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1935,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 1933,\n    columnNumber: 5\n  }, this);\n}\n\n_c19 = SlowSearch;\n\nfunction SearchError(_ref11) {\n  var error = _ref11.error;\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"search-error\",\n    children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n      children: \"Sorry, an error occured\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1952,\n      columnNumber: 7\n    }, this), error.status === 400 ? /*#__PURE__*/_jsxDEV(\"p\", {\n      children: [\"The query was invalid \", /*#__PURE__*/_jsxDEV(\"code\", {\n        children: error.text\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1955,\n        columnNumber: 33\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1954,\n      columnNumber: 9\n    }, this) : /*#__PURE__*/_jsxDEV(\"p\", {\n      children: \"The server basically failed to compute the search\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1958,\n      columnNumber: 9\n    }, this), error.status >= 500 && /*#__PURE__*/_jsxDEV(\"p\", {\n      children: \"Perhaps simply try again a little later.\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1960,\n      columnNumber: 31\n    }, this), error.status >= 500 && /*#__PURE__*/_jsxDEV(\"p\", {\n      children: /*#__PURE__*/_jsxDEV(\"button\", {\n        type: \"button\",\n        className: \"btn btn-default\",\n        onClick: function onClick(event) {\n          window.location.reload(true);\n        },\n        children: \"Reload to try again\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1963,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1962,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 1951,\n    columnNumber: 5\n  }, this);\n}\n\n_c20 = SearchError;\n\nvar Results = /*#__PURE__*/function (_React$PureComponent3) {\n  _inherits(Results, _React$PureComponent3);\n\n  var _super4 = _createSuper(Results);\n\n  function Results() {\n    var _this15;\n\n    _classCallCheck(this, Results);\n\n    for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n      args[_key2] = arguments[_key2];\n    }\n\n    _this15 = _super4.call.apply(_super4, [this].concat(args));\n    _this15.firstLoad = true;\n    return _this15;\n  }\n\n  _createClass(Results, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      if (!isServer) {\n        loadCarbonScript();\n      }\n\n      this.firstLoad = false;\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps) {\n      // Is this if-statement necessary? I mean, isn't componentDidUpdate\n      // something that *only* happens with non-SSR rendering??\n      if (!isServer && prevProps.results !== this.props.results) {\n        loadCarbonScript();\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this16 = this;\n\n      var _this$props = this.props,\n          results = _this$props.results,\n          searched = _this$props.searched,\n          popularityFactor = _this$props.popularityFactor,\n          showYear = _this$props.showYear;\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [!NO_ADS ? /*#__PURE__*/_jsxDEV(\"div\", {\n          id: \"carbonadsouter\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1998,\n          columnNumber: 20\n        }, this) : /*#__PURE__*/_jsxDEV(\"span\", {\n          id: \"_nocardonads\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1998,\n          columnNumber: 50\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"results\",\n          children: results.map(function (result, index) {\n            return /*#__PURE__*/_jsxDEV(Result, {\n              result: result,\n              searched: searched,\n              expandedByDefault: results.length === 1,\n              firstResult: index === 0,\n              popularityFactor: popularityFactor,\n              firstLoad: _this16.firstLoad,\n              showYear: showYear\n            }, result.id, false, {\n              fileName: _jsxFileName,\n              lineNumber: 2003,\n              columnNumber: 15\n            }, _this16);\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 2000,\n          columnNumber: 9\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1996,\n        columnNumber: 7\n      }, this);\n    }\n  }]);\n\n  return Results;\n}(React.PureComponent);\n\nvar Result = /*#__PURE__*/function (_React$PureComponent4) {\n  _inherits(Result, _React$PureComponent4);\n\n  var _super5 = _createSuper(Result);\n\n  function Result() {\n    var _this17;\n\n    _classCallCheck(this, Result);\n\n    for (var _len3 = arguments.length, args = new Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {\n      args[_key3] = arguments[_key3];\n    }\n\n    _this17 = _super5.call.apply(_super5, [this].concat(args));\n    _this17.state = {\n      collapsed: true,\n      itunes: null,\n      amazon: null,\n      textHtml: _this17.props.result.text_html\n    };\n    _this17.affiliateLookupStarted = [];\n\n    _this17.onExpandClick = function (event) {\n      event.preventDefault();\n\n      _this17.expand();\n    };\n\n    return _this17;\n  }\n\n  _createClass(Result, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      if (this.props.expandedByDefault) {\n        this.expand();\n      }\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      this.dismounted = true;\n    }\n  }, {\n    key: \"expand\",\n    value: function expand() {\n      var _this18 = this;\n\n      var wasCollapsed = this.state.collapsed;\n      this.setState({\n        collapsed: false\n      });\n      this.fetchTextHTML().then(function () {\n        if (wasCollapsed) {\n          if (_this18.props.searched) {\n            var recordURL = \"/api/song/\".concat(_this18.props.result.id, \"/\");\n            recordURL += \"expand/\".concat(_this18.props.searched);\n            fetch(recordURL, {\n              method: \"POST\"\n            }).then(function (r) {\n              return r.json();\n            }).then(function (result) {// nothing to do\n            });\n          }\n        }\n      });\n    }\n  }, {\n    key: \"fetchTextHTML\",\n    value: function fetchTextHTML() {\n      var _this19 = this;\n\n      if (this.state.textHtml) {\n        return Promise.resolve();\n      } else {\n        var url = \"/api/song/\".concat(this.props.result.id, \"?text_only=true\");\n        return fetch(url).then(function (r) {\n          return r.json();\n        }).then(function (result) {\n          if (_this19.dismounted) {\n            return;\n          }\n\n          _this19.setState({\n            textHtml: result.song.text_html\n          });\n        });\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this20 = this;\n\n      var _this$props2 = this.props,\n          result = _this$props2.result,\n          popularityFactor = _this$props2.popularityFactor,\n          firstResult = _this$props2.firstResult,\n          firstLoad = _this$props2.firstLoad,\n          showYear = _this$props2.showYear;\n      var className = \"result\";\n\n      if (this.state.collapsed) {\n        className += \" collapsed\";\n      }\n\n      var songURL = result._url;\n      var image;\n\n      if (result.image) {\n        image = /*#__PURE__*/_jsxDEV(SongImage, {\n          url: result.image.url,\n          className: \"pull-right img-thumbnail album\",\n          name: result.image.name,\n          forceLoad: firstResult || !firstLoad\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 2093,\n          columnNumber: 9\n        }, this);\n      } else {\n        image = /*#__PURE__*/_jsxDEV(SongImage, {\n          url: null,\n          className: \"pull-right img-thumbnail\",\n          name: result.artist.name,\n          forceLoad: firstResult || !firstLoad\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 2102,\n          columnNumber: 9\n        }, this);\n      }\n\n      var rest = /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"read-more\",\n        children: [/*#__PURE__*/_jsxDEV(Link, {\n          to: songURL,\n          children: \"VIEW SONG\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 2113,\n          columnNumber: 9\n        }, this), \" \", /*#__PURE__*/_jsxDEV(Link, {\n          to: songURL,\n          onClick: this.onExpandClick,\n          children: \"EXPAND SONG\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 2114,\n          columnNumber: 9\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 2112,\n        columnNumber: 7\n      }, this);\n\n      if (!this.state.collapsed) {\n        var searchedId = null;\n        var searched = null;\n\n        try {\n          searched = localStorage.getItem(\"searched\");\n        } catch (ex) {\n          console.warn(\"'localStorage.getItem(\\\"searched\\\")' didn't work\");\n        }\n\n        if (searched) {\n          if (searched.includes(\",\")) {\n            // The new way\n            searchedId = parseInt(searched.split(\",\")[0], 10);\n          } else {\n            // The old way!\n            searchedId = parseInt(searched, 10);\n          }\n        }\n\n        rest = /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"rest\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"text\",\n            children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n              children: \"Full Text\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 2139,\n              columnNumber: 13\n            }, this), this.state.textHtml ? /*#__PURE__*/_jsxDEV(RenderParagraphs, {\n              text: this.state.textHtml\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 2141,\n              columnNumber: 15\n            }, this) : /*#__PURE__*/_jsxDEV(\"i\", {\n              children: \"Loading full text...\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 2143,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(SongComments, {\n              comments: null,\n              commentsCount: null,\n              song: result,\n              searchedId: searchedId\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 2145,\n              columnNumber: 13\n            }, this), /*#__PURE__*/_jsxDEV(AmazonRelatedProducts, {\n              song: result\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 2151,\n              columnNumber: 13\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"load-more\",\n              children: /*#__PURE__*/_jsxDEV(Link, {\n                to: songURL,\n                children: \"GO TO SONG PAGE\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 2157,\n                columnNumber: 15\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 2156,\n              columnNumber: 13\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 2138,\n            columnNumber: 11\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 2137,\n          columnNumber: 9\n        }, this);\n      }\n\n      var artistName = /*#__PURE__*/_jsxDEV(\"b\", {\n        children: result.artist.name\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 2164,\n        columnNumber: 22\n      }, this);\n\n      if (result.artist.fragment) {\n        artistName = /*#__PURE__*/_jsxDEV(\"b\", {\n          dangerouslySetInnerHTML: {\n            __html: result.artist.fragment\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 2167,\n          columnNumber: 9\n        }, this);\n      }\n\n      var tooltipTitle;\n\n      if (process.env.NODE_ENV === \"development\") {\n        var score = result.score.toFixed(4);\n        tooltipTitle = \"Score \".concat(score);\n\n        if (result.popularity) {\n          tooltipTitle += \" Popularity: \".concat(result.popularity.toFixed(6));\n        }\n      } else {\n        tooltipTitle = \"Click to view just this song\";\n      }\n\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        className: className,\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"head\",\n          children: [/*#__PURE__*/_jsxDEV(Link, {\n            to: songURL,\n            children: image\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 2185,\n            columnNumber: 11\n          }, this), /*#__PURE__*/_jsxDEV(\"h2\", {\n            title: tooltipTitle,\n            children: [/*#__PURE__*/_jsxDEV(Link, {\n              to: songURL,\n              children: result.name\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 2187,\n              columnNumber: 13\n            }, this), showYear && result.year && /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"year\",\n              children: [\" \", result.year]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 2189,\n              columnNumber: 15\n            }, this), process.env.NODE_ENV === \"development\" ? /*#__PURE__*/_jsxDEV(ShowSongScore, {\n              song: result,\n              factor: popularityFactor\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 2192,\n              columnNumber: 15\n            }, this) : null]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 2186,\n            columnNumber: 11\n          }, this), /*#__PURE__*/_jsxDEV(\"h3\", {\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"by\",\n              children: \"by\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 2196,\n              columnNumber: 13\n            }, this), \" \", artistName]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 2195,\n            columnNumber: 11\n          }, this), result.albums.length ? /*#__PURE__*/_jsxDEV(Albums, {\n            albums: result.albums\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 2199,\n            columnNumber: 35\n          }, this) : null]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 2184,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"fragments\",\n          children: result.fragments.map(function (fragment, i) {\n            return /*#__PURE__*/_jsxDEV(\"p\", {\n              dangerouslySetInnerHTML: {\n                __html: fragment\n              }\n            }, \"\".concat(result.id).concat(i), false, {\n              fileName: _jsxFileName,\n              lineNumber: 2204,\n              columnNumber: 15\n            }, _this20);\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 2201,\n          columnNumber: 9\n        }, this), rest]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 2183,\n        columnNumber: 7\n      }, this);\n    }\n  }]);\n\n  return Result;\n}(React.PureComponent);\n\nvar SongImage = /*#__PURE__*/React.memo(_c21 = function _c21(_ref12) {\n  var url = _ref12.url,\n      name = _ref12.name,\n      forceLoad = _ref12.forceLoad,\n      className = _ref12.className;\n\n  // If the song doesn't haven an image, no point messing around.\n  if (!url) {\n    return /*#__PURE__*/_jsxDEV(\"img\", {\n      src: placeholderImage,\n      className: className,\n      title: name,\n      alt: name\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 2221,\n      columnNumber: 7\n    }, _this);\n  }\n\n  return /*#__PURE__*/_jsxDEV(\"img\", {\n    src: url,\n    className: className,\n    title: name,\n    alt: name,\n    loading: forceLoad ? undefined : \"lazy\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 2230,\n    columnNumber: 5\n  }, _this);\n}); // This assumes that we'll sooner or later need the lazyloadThumbnailImage image\n\n_c22 = SongImage;\n\nif (!isServer) {\n  new Image().src = lazyloadThumbnailImage;\n} // Module level \"cache\" of which image URLs have been successfully inserted\n// into the DOM at least once.\n// By knowing these, we can, on repeat URLs, avoid the whole lazy-load\n// image swapping trick.\n\n\nvar loadedOnce = new Set();\n\nfunction AutocompleteImage(_ref13) {\n  _s();\n\n  var url = _ref13.url,\n      name = _ref13.name;\n\n  var _useState = useState(loadedOnce.has(url) ? url : lazyloadThumbnailImage),\n      _useState2 = _slicedToArray(_useState, 2),\n      src = _useState2[0],\n      setSrc = _useState2[1];\n\n  useEffect(function () {\n    var preloadImg = null;\n    var dismounted = false;\n\n    if (src === lazyloadThumbnailImage) {\n      var cb = function cb() {\n        if (!dismounted) {\n          setSrc(url);\n        }\n\n        loadedOnce.add(url);\n      }; // This must come before .decode() otherwise Safari will\n      // raise an EncodingError.\n\n\n      // We need to preload the eventually needed image.\n      preloadImg = new Image();\n      preloadImg.src = url; // https://html.spec.whatwg.org/multipage/embedded-content.html#dom-img-decode\n      // https://developer.mozilla.org/en-US/docs/Web/API/HTMLImageElement/decode#Browser_compatibility\n\n      preloadImg.decode ? preloadImg.decode().then(cb, cb) : preloadImg.onload = cb; // https://developer.mozilla.org/en-US/docs/Web/API/HTMLImageElement/decoding\n\n      preloadImg.decoding = \"sync\";\n    }\n\n    return function () {\n      if (preloadImg) {\n        // Immediately undo the preloading since we might not need this image.\n        // See https://jsfiddle.net/nw34gLgt/ for demo of this technique.\n        preloadImg.src = \"\";\n      }\n\n      dismounted = true;\n    };\n  }, [url, src]);\n\n  if (!url) {\n    // Don't even bother with lazy loading.\n    return /*#__PURE__*/_jsxDEV(\"img\", {\n      className: \"img-rounded\",\n      src: lazyloadThumbnailImage,\n      alt: name,\n      title: name\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 2295,\n      columnNumber: 7\n    }, this);\n  }\n\n  return /*#__PURE__*/_jsxDEV(\"img\", {\n    className: \"img-rounded\",\n    src: src,\n    alt: name,\n    title: name\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 2304,\n    columnNumber: 10\n  }, this);\n}\n\n_s(AutocompleteImage, \"/jbCGqvSt6hXglrpdxKnEeErtu4=\");\n\n_c23 = AutocompleteImage;\n\nfunction ShowSongScore(_ref14) {\n  var song = _ref14.song,\n      _ref14$factor = _ref14.factor,\n      factor = _ref14$factor === void 0 ? 20 : _ref14$factor;\n  var s = song.score - factor * song.popularity;\n  return /*#__PURE__*/_jsxDEV(\"code\", {\n    children: [song.score.toFixed(3), \" = \", s.toFixed(3), \" + \", factor, \"\\xD7\", song.popularity.toFixed(4)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 2310,\n    columnNumber: 5\n  }, this);\n}\n\n_c24 = ShowSongScore;\nvar SongsByName = /*#__PURE__*/React.memo(_c25 = function _c25(_ref15) {\n  var results = _ref15.results,\n      total = _ref15.total,\n      limit = _ref15.limit,\n      loadMoreByName = _ref15.loadMoreByName;\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"by-name\",\n    children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n      children: \"Songs by name\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 2321,\n      columnNumber: 7\n    }, _this), /*#__PURE__*/_jsxDEV(\"ul\", {\n      children: results.map(function (s) {\n        return /*#__PURE__*/_jsxDEV(\"li\", {\n          children: /*#__PURE__*/_jsxDEV(Link, {\n            to: s._url,\n            children: [/*#__PURE__*/_jsxDEV(\"b\", {\n              dangerouslySetInnerHTML: {\n                __html: s.fragment\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 2327,\n              columnNumber: 17\n            }, _this), \" by\", \" \", /*#__PURE__*/_jsxDEV(\"b\", {\n              children: s.artist.name\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 2328,\n              columnNumber: 17\n            }, _this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 2326,\n            columnNumber: 15\n          }, _this)\n        }, s.id, false, {\n          fileName: _jsxFileName,\n          lineNumber: 2325,\n          columnNumber: 13\n        }, _this);\n      })\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 2322,\n      columnNumber: 7\n    }, _this), total > limit ? /*#__PURE__*/_jsxDEV(\"button\", {\n      className: \"btn btn-default btn-sm\",\n      onClick: loadMoreByName,\n      children: total > 20 ? \"Show more songs by name\" : \"Show all (\".concat(total, \") songs by name\")\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 2335,\n      columnNumber: 9\n    }, _this) : null]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 2320,\n    columnNumber: 5\n  }, _this);\n});\n_c26 = SongsByName;\nvar Albums = /*#__PURE__*/React.memo(_c27 = function _c27(_ref16) {\n  var albums = _ref16.albums;\n  return /*#__PURE__*/_jsxDEV(\"p\", {\n    className: \"albums\",\n    children: albums.map(function (album, i) {\n      var parts = [/*#__PURE__*/_jsxDEV(\"b\", {\n        children: album.name\n      }, album.id, false, {\n        fileName: _jsxFileName,\n        lineNumber: 2349,\n        columnNumber: 24\n      }, _this)];\n\n      if (album.year) {\n        parts.push(\" (\".concat(album.year, \")\"));\n      }\n\n      if (i + 1 < albums.length) {\n        parts.push(\", \");\n      }\n\n      return parts;\n    })\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 2347,\n    columnNumber: 5\n  }, _this);\n});\n_c28 = Albums;\nvar Pagination = /*#__PURE__*/React.memo(_c29 = function _c29(_ref17) {\n  var location = _ref17.location,\n      onLoadMore = _ref17.onLoadMore;\n  var currentURL = location.pathname + location.search;\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"load-more\",\n    children: /*#__PURE__*/_jsxDEV(\"a\", {\n      href: currentURL,\n      onClick: onLoadMore,\n      children: \"LOAD MORE RESULTS\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 2366,\n      columnNumber: 7\n    }, _this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 2365,\n    columnNumber: 5\n  }, _this);\n});\n_c30 = Pagination;\n\nvar _c, _c2, _c3, _c4, _c5, _c6, _c7, _c8, _c9, _c10, _c11, _c12, _c13, _c14, _c15, _c16, _c17, _c18, _c19, _c20, _c21, _c22, _c23, _c24, _c25, _c26, _c27, _c28, _c29, _c30;\n\n$RefreshReg$(_c, \"Completionist\");\n$RefreshReg$(_c2, \"ShowResultCount$React.memo\");\n$RefreshReg$(_c3, \"ShowResultCount\");\n$RefreshReg$(_c4, \"ShowKeyPhrases$React.memo\");\n$RefreshReg$(_c5, \"ShowKeyPhrases\");\n$RefreshReg$(_c6, \"ShowAutocompleteSuggestions$React.memo\");\n$RefreshReg$(_c7, \"ShowAutocompleteSuggestions\");\n$RefreshReg$(_c8, \"ShowAutocompleteSuggestion$React.memo\");\n$RefreshReg$(_c9, \"ShowAutocompleteSuggestion\");\n$RefreshReg$(_c10, \"ShowAutocompleteSuggestionSong$React.memo\");\n$RefreshReg$(_c11, \"ShowAutocompleteSuggestionSong\");\n$RefreshReg$(_c12, \"ShowAutocompleteArtistSuggestions$React.memo\");\n$RefreshReg$(_c13, \"ShowAutocompleteArtistSuggestions\");\n$RefreshReg$(_c14, \"ShowMaxlengthWarning\");\n$RefreshReg$(_c15, \"ShowDesperateSearchWarning\");\n$RefreshReg$(_c16, \"ShowMissingSearchWarning\");\n$RefreshReg$(_c17, \"ShowExamples$React.memo\");\n$RefreshReg$(_c18, \"ShowExamples\");\n$RefreshReg$(_c19, \"SlowSearch\");\n$RefreshReg$(_c20, \"SearchError\");\n$RefreshReg$(_c21, \"SongImage$React.memo\");\n$RefreshReg$(_c22, \"SongImage\");\n$RefreshReg$(_c23, \"AutocompleteImage\");\n$RefreshReg$(_c24, \"ShowSongScore\");\n$RefreshReg$(_c25, \"SongsByName$React.memo\");\n$RefreshReg$(_c26, \"SongsByName\");\n$RefreshReg$(_c27, \"Albums$React.memo\");\n$RefreshReg$(_c28, \"Albums\");\n$RefreshReg$(_c29, \"Pagination$React.memo\");\n$RefreshReg$(_c30, \"Pagination\");","map":{"version":3,"sources":["/home/mandeep/Downloads/Song-sorch work/site/src/Home.js"],"names":["React","useState","useEffect","Link","Redirect","throttle","debounce","copy","cachedFetch","Countdown","CountdownTimer","Bannertop","pics","mobileimgs","Loading","SetHTMLHeaders","ResetHTMLHeaders","isServer","loadCarbonScript","AmazonRelatedProducts","RenderParagraphs","SongComments","ShowRecentComments","PUBLIC_URL","process","env","lazyloadThumbnailImage","placeholderImage","NO_ADS","REACT_APP_NO_ADS","samplePlaceholders","sort","Math","random","appendSuggestion","text","append","split","pop","push","join","Completionist","THREE_DAYS_IN_MS","NOW_IN_MS","Date","getTime","dateTimeAfterThreeDays","Home","props","artistRef","createRef","languageRef","searchRef","startSearchFromLocation","match","q","decodeURIComponent","params","sp","URLSearchParams","location","search","artist","get","language","year","searchExample","state","stateUpdate","length","current","maxLength","searchMaxLength","loadSearchAggregates","advancedSearch","searchLanguage","searchYear","artistName","setState","startSearch","resultsPageIndex","title","onFocusSearch","placeholder","clearInterval","placeholderSampleInterval","fillerInterval","showAutocompleteSuggestions","shareSearch","_firstFocusSearch","window","innerHeight","scrollIntoView","onBlurSearch","event","setNextSamplePlaceholder","startSamplePlaceholderInterval","setTimeout","dismounted","onFocusArtist","showAutocompleteArtistSuggestions","onBlurArtist","sampleSearch","preventDefault","term","id","searchLanguages","searchYears","submitSearch","onSubmit","_fetchSearchAlternatives","url","parentSearch","then","r","status","json","results","keyPhrases","key_phrases","onChangeSearch","target","value","desperateSearch","originalQ","trim","autocompleteWaitingFor","endsWith","fetchAutocompleteSuggestionsThrottled","fetchAutocompleteSuggestionsDebouncedLong","fetchAutocompleteSuggestionsDebounced","autocompleteSuggestions","autocompleteSearchSuggestions","autocompleteHighlight","onKeyDownSearch","suggestions","highlight","key","suggestion","_url","fetchAutocompleteSuggestions","searchSuggestions","total","console","warn","redirectTo","pathname","onKeyDownArtistSearch","autocompleteArtistSuggestions","autocompleteArtistHighlight","fetchAutocompleteArtistSuggestions","toggleShareSearch","toggleAdvancedSearch","withCountsLanguages","filter","x","count","withCountsYears","onChangeLanguage","onChangeYear","onChangeArtistName","onSelectSuggestion","newText","onSelectSuggestionAll","onSelectArtistSuggestion","onLoadMore","submitPhrase","keyPhrase","phrase","reloadSearch","reload","loadMoreByName","previousByNameLimit","by_name_limit","by_name_total","encodeURIComponent","fetch","by_name","displayYears","yearEnd","currentYear","getFullYear","searchResults","desperate","missing","popularityFactor","searched","original","search_example","Boolean","searchExamples","showExamples","examples","recentComments","showRecentComments","comments","searching","searchError","slowSearch","onlyResults","_autocompleteSuggestionsCache","fetchSearchExamples","fetchRecentComments","prevProps","stopSamplePlaceholderInterval","slowSearchTimer","clearTimeout","currentPlaceholder","setInterval","el","slice","substring","newURL","includes","currentURL","history","document","querySelector","blur","page","sendSearch","error","localStorage","setItem","ex","allResults","forEach","popularity_factor","cacheHash","cached","Promise","resolve","matches","search_suggestions","startsWith","languages","years","pagination","rows","onlyIds","map","row","byName","searchToggles","advancedSearchStatus","parts","e","code","parseInt","advancedInput","position","each","toLocaleString","Component","ShowRecentCommentsWrapper","marginTop","PureComponent","ShowResultCount","memo","countResults","byNameCount","ShareInput","copied","failed","hasFocused","absurlRef","absoluteUrl","href","select","method","ShowKeyPhrases","phrases","nothingFound","subTitle","diff_html","__html","ShowAutocompleteSuggestions","capped","float","s","index","className","html","found","ShowAutocompleteSuggestion","ShowAutocompleteSuggestionSong","song","imageUrl","image","thumbnail100","name","fragments","fragment","i","ShowAutocompleteArtistSuggestions","songs","ShowMaxlengthWarning","ShowDesperateSearchWarning","ShowMissingSearchWarning","textDecoration","ShowExamples","link","searchMeta","searchMetaStrings","language_human","n","total_found","opened","SlowSearch","SearchError","Results","firstLoad","showYear","result","Result","collapsed","itunes","amazon","textHtml","text_html","affiliateLookupStarted","onExpandClick","expand","expandedByDefault","wasCollapsed","fetchTextHTML","recordURL","firstResult","songURL","rest","searchedId","getItem","tooltipTitle","NODE_ENV","score","toFixed","popularity","albums","SongImage","forceLoad","undefined","Image","src","loadedOnce","Set","AutocompleteImage","has","setSrc","preloadImg","cb","add","decode","onload","decoding","ShowSongScore","factor","SongsByName","limit","Albums","album","Pagination"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport { Link, Redirect } from \"react-router-dom\";\nimport { throttle, debounce } from \"throttle-debounce\";\n// import { Waypoint } from \"react-waypoint\";\nimport copy from \"copy-to-clipboard\";\nimport { cachedFetch } from \"./Cache\";\nimport Countdown from \"react-countdown\";\nimport CountdownTimer from \"./CountdownTimer\";\nimport Bannertop from \"./Bannertop\";\nimport pics from \"./songs_desktop.png\";\nimport mobileimgs from \"./songs_mobile.png\";\nimport {\n  Loading,\n  SetHTMLHeaders,\n  ResetHTMLHeaders,\n  isServer,\n  // YouTubeSnippetIntersectionLazy,\n  loadCarbonScript,\n  AmazonRelatedProducts,\n  RenderParagraphs\n} from \"./Common\";\nimport { SongComments } from \"./Comments\";\nimport { ShowRecentComments } from \"./RecentComments\";\n\n// if (process.env.PUBLIC_URL === undefined) {\n//   // console.error(\"process.env.PUBLIC_URL should not be undefined\");\n//   throw new Error(\"process.env.PUBLIC_URL should not be undefined\");\n// }\nconst PUBLIC_URL = process.env.PUBLIC_URL || \"\";\nconst lazyloadThumbnailImage = PUBLIC_URL + \"/static/lazyload-thumbnail.png\";\nconst placeholderImage = PUBLIC_URL + \"/static/placeholder.png\";\n\nconst NO_ADS = process.env.REACT_APP_NO_ADS === \"true\";\n\nconst samplePlaceholders = [\n  \"Born to be wild\",\n  \"No one ever told me life was kind\",\n  \"But here it comes again, straight thru the heart\",\n  \"I'm an alligator\",\n  \"My mouth, it moves\"\n];\nsamplePlaceholders.sort(() => 0.5 - Math.random());\n\nconst appendSuggestion = (text, append) => {\n  let split = text.split(/\\s+/);\n  split.pop();\n  split.push(append);\n  return split.join(\" \");\n};\n\nconst Completionist = () => <span>You are good to go!</span>;\nconst THREE_DAYS_IN_MS = 3 * 24 * 60 * 60 * 1000;\nconst NOW_IN_MS = new Date().getTime();\n\nconst dateTimeAfterThreeDays = NOW_IN_MS + THREE_DAYS_IN_MS;\n\nclass Home extends React.Component {\n  constructor(props) {\n    super(props);\n\n    let q = \"\";\n    let originalQ = \"\";\n    let artistName = \"\";\n    let total = 0;\n    let searchResults = null;\n    let desperate = false;\n    let missing = null;\n    // let suggestions = null;\n    let by_name = null;\n    let by_name_total = null;\n    let by_name_limit = null;\n    let searchLanguage = \"\";\n    let searchYear = \"\";\n    let parentSearch = null;\n    let keyPhrases = null;\n    let popularityFactor = null;\n    let searchExample = null;\n\n    const { results } = this.props;\n\n    if (results) {\n      this.searched = results.searched;\n\n      q = results.search;\n      total = results.total;\n      searchResults = results.results;\n      desperate = results.desperate;\n      missing = results.missing;\n      by_name = results.by_name || null;\n      by_name_total = results.by_name_total || null;\n      by_name_limit = results.by_name_limit || null;\n      artistName = results.artist;\n      originalQ = results.original || \"\";\n      searchLanguage = results.language || \"\";\n      searchYear = results.year || \"\";\n      parentSearch = results.searched || null;\n      keyPhrases = results.key_phrases || null;\n      popularityFactor = results.popularityFactor || null;\n      searchExample = results.search_example || null;\n    }\n    let advancedSearch = Boolean(artistName || searchLanguage || searchYear);\n\n    let searchExamples = null;\n    let showExamples = false;\n    if (props.searchExamples && props.searchExamples.examples) {\n      searchExamples = props.searchExamples.examples;\n      showExamples = true;\n    }\n\n    let recentComments = null;\n    let showRecentComments = false;\n    if (\n      props.recentComments &&\n      props.recentComments.comments &&\n      props.recentComments.comments.length\n    ) {\n      recentComments = props.recentComments;\n      showRecentComments = true;\n    }\n\n    this.state = {\n      q,\n      originalQ,\n      artistName,\n      searching: false,\n      searchError: null,\n      total,\n      results: searchResults,\n      resultsPageIndex: 0,\n      by_name,\n      by_name_total,\n      by_name_limit,\n      placeholder: samplePlaceholders[0],\n      slowSearch: null,\n      showExamples,\n      searchExamples,\n      parentSearch,\n      desperateSearch: desperate,\n      missing,\n      keyPhrases,\n      popularityFactor,\n      searchExample,\n      showRecentComments,\n      recentComments,\n\n      onlyResults: null,\n\n      searchMaxLength: null,\n\n      autocompleteSuggestions: null,\n      autocompleteSearchSuggestions: null,\n      autocompleteHighlight: -1,\n      showAutocompleteSuggestions: true,\n\n      autocompleteArtistSuggestions: null,\n      autocompleteArtistHighlight: -1,\n      showAutocompleteArtistSuggestions: true,\n\n      advancedSearch,\n      searchLanguage,\n      searchLanguages: [],\n      searchYear,\n      searchYears: [],\n\n      redirectTo: null,\n      shareSearch: false\n    };\n\n    // When you've typed something longer.\n    // If you steadily type something every 100ms for a long time\n    // without pausing, this won't fire till you stop.\n    this.fetchAutocompleteSuggestionsDebounced = debounce(\n      800,\n      this.fetchAutocompleteSuggestions\n    );\n    this.fetchAutocompleteSuggestionsDebouncedLong = debounce(\n      1800,\n      this.fetchAutocompleteSuggestions\n    );\n\n    // When you've started typing.\n    // Will basically fire without being postponed.\n    this.fetchAutocompleteSuggestionsThrottled = throttle(\n      1100,\n      this.fetchAutocompleteSuggestions\n    );\n\n    this._autocompleteSuggestionsCache = {};\n  }\n\n  artistRef = React.createRef();\n  languageRef = React.createRef();\n  searchRef = React.createRef();\n\n  componentDidMount() {\n    ResetHTMLHeaders();\n    if (this.props.match.params.q) {\n      this.startSearchFromLocation(this.props);\n    } else {\n      this.startSamplePlaceholderInterval();\n      if (!this.state.searchExamples) {\n        this.fetchSearchExamples();\n      }\n      if (!this.state.recentComments) {\n        this.fetchRecentComments();\n      }\n    }\n    if (this.state.results) {\n      if (\n        (this.state.desperateSearch || !this.state.total) &&\n        this.state.q.length > 10\n      ) {\n        this._fetchSearchAlternatives();\n      }\n    }\n  }\n\n  startSearchFromLocation = (props) => {\n    const { match } = props;\n    const q = decodeURIComponent(match.params.q);\n\n    const sp = new URLSearchParams(props.location.search || \"\");\n    let artist = sp.get(\"artist\");\n    let language = sp.get(\"language\");\n    let year = sp.get(\"year\");\n    let searchExample = sp.get(\"example\");\n\n    // XXX should this compare artist and language too?\n    if (this.state.q !== q) {\n      const stateUpdate = {\n        q\n      };\n      if (q.length > this.searchRef.current.maxLength - 10) {\n        stateUpdate.searchMaxLength = [\n          q.length,\n          this.searchRef.current.maxLength\n        ];\n      }\n\n      if (language || year) {\n        this.loadSearchAggregates();\n        stateUpdate.advancedSearch = true;\n      }\n      if (language) {\n        stateUpdate.searchLanguage = language;\n      }\n      if (year) {\n        stateUpdate.searchYear = year;\n      }\n      if (artist) {\n        stateUpdate.artistName = artist;\n        stateUpdate.advancedSearch = true;\n      }\n      if (searchExample) {\n        stateUpdate.searchExample = searchExample;\n      }\n      this.setState(stateUpdate, () => {\n        this.startSearch(\n          q,\n          language,\n          year,\n          artist,\n          this.state.resultsPageIndex,\n          this.state.searchExample\n        );\n      });\n    } else {\n      SetHTMLHeaders({\n        title: `${q} - Song Search`\n      });\n    }\n  };\n\n  componentDidUpdate(prevProps) {\n    if (this.props.match.params.q !== prevProps.match.params.q) {\n      if (!this.props.match.params.q) {\n        ResetHTMLHeaders();\n        this.setState({\n          q: \"\",\n          originalQ: \"\",\n          artistName: \"\",\n          searching: false,\n          total: null,\n          results: null,\n          resultsPageIndex: 0,\n          slowSearch: null,\n          showExamples: false,\n          searchExamples: null,\n          showRecentComments: false,\n          parentSearch: null,\n          desperateSearch: false,\n          searchExample: null,\n          missing: null,\n          searchError: null,\n          by_name: null,\n          by_name_total: null,\n          by_name_limit: null,\n          autocompleteSuggestions: null,\n          autocompleteSearchSuggestions: null,\n          autocompleteHighlight: -1,\n          autocompleteArtistSuggestions: null,\n          autocompleteArtistHighlight: -1,\n          redirectTo: null,\n          shareSearch: false\n        });\n        // this.refs.q.value = \"\";\n        this.fetchSearchExamples();\n      } else if (\n        decodeURIComponent(this.props.match.params.q) !== this.state.q\n      ) {\n        this.startSearchFromLocation(this.props);\n      }\n    }\n  }\n\n  componentWillUnmount() {\n    this.dismounted = true;\n    this.stopSamplePlaceholderInterval();\n    if (this.fillerInterval) {\n      window.clearInterval(this.fillerInterval);\n    }\n    if (this.slowSearchTimer) {\n      window.clearTimeout(this.slowSearchTimer);\n    }\n  }\n\n  fetchSearchExamples() {\n    let url = \"/api/search/examples\";\n    return fetch(url).then((r) => {\n      if (r.status === 200) {\n        return r.json().then((results) => {\n          if (this.dismounted) {\n            return;\n          }\n          if (results) {\n            if (!this.state.results && !this.state.searching) {\n              this.setState({\n                searchExamples: results.examples,\n                showExamples: true\n              });\n            }\n          }\n        });\n      }\n    });\n  }\n\n  fetchRecentComments() {\n    let url = \"/api/comments/recent/home\";\n    return fetch(url).then((r) => {\n      if (r.status === 200) {\n        return r.json().then((results) => {\n          if (this.dismounted) {\n            return;\n          }\n          if (results) {\n            if (!this.state.results && !this.state.searching) {\n              this.setState({\n                recentComments: results,\n                showRecentComments: true\n              });\n            }\n          }\n        });\n      }\n    });\n  }\n\n  stopSamplePlaceholderInterval() {\n    if (this.placeholderSampleInterval) {\n      window.clearInterval(this.placeholderSampleInterval);\n    }\n  }\n\n  startSamplePlaceholderInterval() {\n    if (this.state.q) {\n      return;\n    }\n    // let el = document.querySelector('input[type=\"search\"]')\n    // if (!el || el.value) return\n    this.currentPlaceholder = 0;\n    if (this.placeholderSampleInterval) {\n      window.clearInterval(this.placeholderSampleInterval);\n    }\n    this.placeholderSampleInterval = window.setInterval(() => {\n      this.setNextSamplePlaceholder();\n    }, 3000);\n  }\n\n  setNextSamplePlaceholder() {\n    if (this.fillerInterval) {\n      window.clearInterval(this.fillerInterval);\n    }\n    const placeholder =\n      samplePlaceholders[++this.currentPlaceholder % samplePlaceholders.length];\n    const el = this.searchRef.current;\n    if (!el) return;\n    let slice = 0;\n    this.fillerInterval = setInterval(() => {\n      if (!placeholder) {\n        // something's gone wrong\n        return;\n      }\n      el.placeholder = placeholder.substring(0, ++slice);\n      if (slice >= placeholder.length) {\n        clearInterval(this.fillerInterval);\n        el.placeholder += \"...\";\n      }\n    }, 10);\n  }\n\n  onFocusSearch = () => {\n    this.searchRef.current.placeholder = \"\";\n    clearInterval(this.placeholderSampleInterval);\n    if (this.fillerInterval) {\n      clearInterval(this.fillerInterval);\n    }\n    if (!this.state.showAutocompleteSuggestions) {\n      this.setState({ showAutocompleteSuggestions: true });\n    }\n    if (this.state.shareSearch) {\n      this.setState({ shareSearch: false });\n    }\n\n    if (!this._firstFocusSearch) {\n      this._firstFocusSearch = true;\n      // If you're on a small screen this is the first time you've focused,\n      // the scroll the top of the search input into view.\n      if (window.innerHeight && window.innerHeight < 600) {\n        this.searchRef.current.scrollIntoView();\n      }\n    }\n  };\n\n  onBlurSearch = (event) => {\n    if (!this.state.q) {\n      this.setNextSamplePlaceholder();\n      this.startSamplePlaceholderInterval();\n    }\n    setTimeout(() => {\n      if (!this.dismounted) {\n        this.setState({\n          showAutocompleteSuggestions: false\n        });\n      }\n    }, 300);\n  };\n\n  onFocusArtist = (event) => {\n    if (!this.state.showAutocompleteArtistSuggestions) {\n      this.setState({ showAutocompleteArtistSuggestions: true });\n    }\n  };\n\n  onBlurArtist = (event) => {\n    setTimeout(() => {\n      if (!this.dismounted) {\n        this.setState({\n          showAutocompleteArtistSuggestions: false\n        });\n      }\n    }, 300);\n  };\n\n  sampleSearch = (event, search) => {\n    event.preventDefault();\n    const stateUpdate = { q: search.term, searchExample: search.id };\n\n    if (search.language || search.year) {\n      if (\n        !this.state.searchLanguages.length ||\n        !this.state.searchYears.length\n      ) {\n        this.loadSearchAggregates();\n      }\n    }\n\n    if (search.language) {\n      stateUpdate.searchLanguage = search.language;\n      stateUpdate.advancedSearch = true;\n    } else if (this.state.searchLanguage) {\n      stateUpdate.searchLanguage = \"\";\n    }\n\n    if (search.year) {\n      stateUpdate.searchYear = search.year;\n      stateUpdate.advancedSearch = true;\n    } else if (this.state.searchYear) {\n      stateUpdate.searchYear = \"\";\n    }\n\n    if (search.artist) {\n      stateUpdate.artistName = search.artist;\n      stateUpdate.advancedSearch = true;\n    } else if (this.state.artistName) {\n      stateUpdate.artistName = \"\";\n    }\n\n    this.setState(stateUpdate, () => {\n      this.submitSearch();\n    });\n  };\n\n  onSubmit = (event) => {\n    event.preventDefault();\n    this.submitSearch();\n  };\n\n  submitSearch() {\n    let q = this.state.q.trim();\n    // let language = this.languageRef.current && this.languageRef.current.value;\n    // if (!language && this.state.searchLanguage) {\n    //   language = this.state.searchLanguage;\n    // }\n    const language = this.state.searchLanguage;\n    const year = this.state.searchYear;\n\n    let artistName =\n      this.artistRef.current && this.artistRef.current.value.trim();\n    if (!artistName && this.state.artistName) {\n      if (!this.state.advancedSearch) {\n        artistName = this.state.artistName;\n      }\n    } else if (artistName && !this.state.artistName) {\n      this.setState({ artistName });\n    }\n    if (q) {\n      let newURL = `/q/${encodeURIComponent(q)}`;\n      // only include the language= if it's set and not 'en'\n      if (language && language !== \"en\") {\n        newURL += `?language=${language}`;\n      }\n      if (year) {\n        newURL += newURL.includes(\"?\") ? \"&\" : \"?\";\n        newURL += `year=${year}`;\n      }\n      if (artistName) {\n        newURL += newURL.includes(\"?\") ? \"&\" : \"?\";\n        newURL += `artist=${encodeURIComponent(artistName)}`;\n      }\n      let currentURL = this.props.location.pathname;\n      if (this.props.location.search) {\n        currentURL += this.props.location.search;\n      }\n      if (newURL === currentURL) {\n        // get out of here\n        return;\n      }\n      this.props.history.push(newURL);\n      this.startSearch(q, language, year, artistName);\n\n      // XXX this.searchRef.current.blur()????\n      document.querySelector('input[type=\"search\"]').blur();\n      if (this.state.autocompleteSuggestions) {\n        this.setState({\n          autocompleteSuggestions: null,\n          autocompleteSearchSuggestions: null,\n          autocompleteHighlight: -1,\n          showAutocompleteSuggestions: true\n        });\n      }\n      if (this.state.autocompleteArtistSuggestions) {\n        this.setState({\n          autocompleteArtistSuggestions: null,\n          autocompleteArtistHighlight: -1\n        });\n      }\n    }\n  }\n\n  startSearch(\n    q,\n    language = null,\n    year = null,\n    artist = null,\n\n    page = 0,\n    searchExample = null\n  ) {\n    SetHTMLHeaders({\n      title: \"Searching... - Song Search\"\n    });\n    // The state change is quite differnet depend on it being\n    // the first page or a subsequent page.\n    if (page) {\n      this.setState(\n        {\n          searching: true,\n          searchError: null\n        },\n        () => {\n          this.sendSearch(q, language, year, artist, page, searchExample);\n        }\n      );\n    } else {\n      this.setState(\n        {\n          searching: true,\n          searchError: null,\n          // suggestions: null,\n          results: null,\n          by_name: null,\n          showExamples: false,\n          showRecentComments: false,\n          parentSearch: null\n        },\n        () => {\n          this.sendSearch(q, language, year, artist, page, searchExample);\n          this.slowSearchTimer = window.setTimeout(() => {\n            if (!this.state.searchError && !this.state.results) {\n              this.setState({ slowSearch: true });\n            }\n          }, 5 * 1000);\n        }\n      );\n    }\n  }\n\n  sendSearch(\n    q,\n    language = null,\n    year = null,\n    artist = null,\n    page = 0,\n    searchExample = null\n  ) {\n    let url = `/api/search?q=${encodeURIComponent(q)}`;\n    if (language) {\n      url += `&language=${language}`;\n    }\n    if (year) {\n      url += `&year=${year}`;\n    }\n    if (artist) {\n      url += `&artist=${encodeURIComponent(artist)}`;\n    }\n    if (page) {\n      url += `&page=${page + 1}`;\n      url += `&searched=${this.searched}`;\n    } else if (this.state.originalQ) {\n      url += `&original=${this.searched}`;\n    }\n    if (this.state.desperateSearch && !this.state.originalQ) {\n      url += `&desperate=true`;\n    }\n    if (searchExample) {\n      url += `&example=${searchExample}`;\n    }\n    return cachedFetch(url).then((r) => {\n      if (r.status === 200) {\n        return r.json().then((results) => {\n          if (this.slowSearchTimer) {\n            window.clearTimeout(this.slowSearchTimer);\n          }\n          if (this.dismounted) {\n            return;\n          }\n          if (!results) {\n            return;\n          }\n          if (results.error) {\n            this.setState({\n              searchError: results.error,\n              searching: false,\n              slowSearch: null\n            });\n            SetHTMLHeaders({\n              title: \"Sorry, search error\"\n            });\n            return;\n          } else if (this.state.searchError) {\n            this.setState({ searchError: null });\n          }\n\n          SetHTMLHeaders({\n            title: `${q} - Song Search`\n          });\n\n          // This is the first time sendSearch is called for\n          // this q (and this offset).\n          // Decide whether to get suggestions searches...\n          // console.log(\n          //   'Results:', results.results.length,\n          //   'Total:', results.total,\n          //   'Limit:', results.limit,\n          // )\n\n          // set this so that the onExpandClick can use it\n          if (!page) {\n            this.searched = results.searched;\n          }\n          // set in localStorage for the sake \"Open in a new tab\"\n          try {\n            localStorage.setItem(\n              \"searched\",\n              `${results.searched},${new Date().getTime()}`\n            );\n          } catch (ex) {\n            console.warn(\"'localStorage.setItem(\\\"searched\\\")' didn't work\");\n          }\n\n          let allResults;\n          if (page) {\n            allResults = [];\n            this.state.results.forEach((r) => allResults.push(r));\n            results.results.forEach((r) => allResults.push(r));\n          } else {\n            allResults = results.results;\n          }\n          this.setState(\n            {\n              desperateSearch: results.desperate,\n              missing: results.missing,\n              popularityFactor: results.popularity_factor,\n              parentSearch: results.searched,\n              searching: false,\n              results: allResults,\n              keyPhrases: null,\n              by_name: results.by_name,\n              by_name_total: results.by_name_total,\n              by_name_limit: results.by_name_limit,\n              total: results.total,\n              searchError: null,\n              slowSearch: null\n            },\n            () => {\n              if (\n                (this.state.desperateSearch || !this.state.total) &&\n                this.state.q.length > 10\n              ) {\n                this._fetchSearchAlternatives();\n              }\n            }\n          );\n        });\n      } else {\n        r.text().then((text) => {\n          SetHTMLHeaders({\n            title: \"Search Error\"\n          });\n          this.setState({\n            searching: false,\n            searchError: { status: r.status, text: text },\n            slowSearch: false\n          });\n        });\n      }\n    });\n  }\n\n  _fetchSearchAlternatives = () => {\n    const url = `/api/search/alternatives?searched=${this.state.parentSearch}`;\n    return cachedFetch(url).then((r) => {\n      if (r.status === 200) {\n        return r.json().then((results) => {\n          if (this.dismounted) {\n            return;\n          }\n          if (!results) {\n            return;\n          }\n          this.setState({ keyPhrases: results.key_phrases });\n        });\n      }\n    });\n  };\n\n  onChangeSearch = (event) => {\n    const q = event.target.value;\n    this.setState({ q }, () => {\n      if (this.state.desperateSearch) {\n        this.setState({ desperateSearch: false });\n      }\n      if (this.state.originalQ) {\n        this.setState({ originalQ: \"\" });\n      }\n\n      let length = q.length;\n      if (length > this.searchRef.current.maxLength - 10) {\n        this.setState({\n          searchMaxLength: [length, this.searchRef.current.maxLength],\n          showAutocompleteSuggestions: false\n        });\n      } else if (this.state.searchMaxLength) {\n        this.setState({\n          searchMaxLength: null,\n          showAutocompleteSuggestions: true\n        });\n      }\n\n      if (this.state.q.trim()) {\n        if (this.autocompleteWaitingFor) {\n          if (q.trim() === this.autocompleteWaitingFor) {\n            return;\n          }\n        }\n        if ((length < 4 || q.endsWith(\" \")) && length < 24) {\n          // the impatient one\n          this.fetchAutocompleteSuggestionsThrottled(\n            q,\n            this.state.searchLanguage\n          );\n        } else if (length > 24) {\n          // When what you've typed is really long use the really\n          // delayed throttle.\n          this.fetchAutocompleteSuggestionsDebouncedLong(\n            q,\n            this.state.searchLanguage\n          );\n        } else if (length) {\n          this.fetchAutocompleteSuggestionsDebounced(\n            q,\n            this.state.searchLanguage\n          );\n        } else {\n          this.setState({\n            autocompleteSuggestions: null,\n            autocompleteSearchSuggestions: null,\n            autocompleteHighlight: -1,\n            showAutocompleteSuggestions: true\n          });\n        }\n      } else {\n        this.setState({\n          autocompleteSuggestions: null,\n          autocompleteSearchSuggestions: null,\n          autocompleteHighlight: -1,\n          showAutocompleteSuggestions: true\n        });\n      }\n    });\n  };\n\n  fetchAutocompleteSuggestions(q, language = null) {\n    let cacheHash = q.trim();\n    let url = `/api/search/autocomplete?q=${encodeURIComponent(q)}`;\n    if (language) {\n      cacheHash += language.trim();\n      url += `&language=${language}`;\n    }\n    const cached = this._autocompleteSuggestionsCache[cacheHash];\n    if (cached) {\n      return Promise.resolve(cached).then((results) => {\n        this.setState({\n          autocompleteSuggestions: results.matches,\n          autocompleteSearchSuggestions: results.search_suggestions,\n          autocompleteHighlight: -1,\n          missing: results.missing\n        });\n      });\n    }\n\n    // Store a \"global\" of what the latest q was.\n    this.autocompleteWaitingFor = q;\n    return fetch(url).then((r) => {\n      if (r.status === 200) {\n        return r.json().then((results) => {\n          if (this.dismounted) {\n            return;\n          }\n          if (q.startsWith(this.autocompleteWaitingFor)) {\n            this._autocompleteSuggestionsCache[cacheHash] = results;\n            if (this.state.q) {\n              this.setState({\n                autocompleteSuggestions: results.matches,\n                autocompleteSearchSuggestions: results.search_suggestions,\n                autocompleteHighlight: -1\n              });\n            }\n          }\n        });\n      }\n    });\n  }\n\n  fetchAutocompleteArtistSuggestions(q) {\n    const url = `/api/search/autocomplete?q=${q}&artist=true`;\n    return fetch(url)\n      .then((r) => {\n        if (r.status === 200) {\n          return r.json();\n        }\n      })\n      .then((results) => {\n        if (this.dismounted) {\n          return;\n        }\n        if (results) {\n          this.setState({\n            autocompleteArtistSuggestions: results.matches,\n            autocompleteArtistHighlight: -1\n          });\n        }\n      });\n  }\n\n  onKeyDownSearch = (event) => {\n    let suggestions = this.state.autocompleteSuggestions;\n    if (suggestions) {\n      let highlight = this.state.autocompleteHighlight;\n      if (event.key === \"Tab\") {\n        event.preventDefault();\n        let suggestion =\n          highlight > -1 ? suggestions[highlight] : suggestions[0];\n        if (!suggestion._url) {\n          this.setState({\n            q: suggestion.text + \" \"\n          });\n          this.fetchAutocompleteSuggestions(\n            suggestion.text,\n            this.state.searchLanguage\n          );\n        }\n      } else if (event.key === \"ArrowDown\" && highlight < suggestions.length) {\n        event.preventDefault();\n        this.setState({ autocompleteHighlight: highlight + 1 });\n      } else if (event.key === \"ArrowUp\" && highlight > -1) {\n        this.setState({ autocompleteHighlight: highlight - 1 });\n      } else if (event.key === \"Enter\") {\n        if (highlight > -1) {\n          event.preventDefault();\n          const searchSuggestions = this.state.autocompleteSearchSuggestions;\n          if (highlight === 0 && searchSuggestions && searchSuggestions.total) {\n            this.submitSearch();\n            return;\n          }\n          highlight--;\n          if (!suggestions[highlight]) {\n            // Not sure how this can happen\n            console.warn(\"SUGGESTIONS\", suggestions);\n            console.warn(\"HIGHLIGHT\", highlight);\n            // But bail!\n            this.setState(\n              {\n                autocompleteSuggestions: null,\n                autocompleteHighlight: -1\n              },\n              () => this.submitSearch()\n            );\n            return;\n          }\n          if (suggestions[highlight]._url) {\n            this.setState({\n              redirectTo: {\n                pathname: suggestions[highlight]._url\n              }\n            });\n          } else {\n            this.setState(\n              {\n                q: suggestions[highlight].text,\n                autocompleteSuggestions: null,\n                autocompleteHighlight: -1\n              },\n              () => this.submitSearch()\n            );\n          }\n        }\n      }\n    }\n  };\n\n  onKeyDownArtistSearch = (event) => {\n    let suggestions = this.state.autocompleteArtistSuggestions;\n    if (suggestions) {\n      let highlight = this.state.autocompleteArtistHighlight;\n      if (event.key === \"Tab\") {\n        event.preventDefault();\n        if (highlight > -1) {\n          this.setState({\n            artistName: suggestions[highlight].text\n          });\n          this.fetchAutocompleteArtistSuggestions(suggestions[highlight].text);\n        } else if (suggestions.length) {\n          this.setState({\n            artistName: suggestions[0].text\n          });\n          this.fetchAutocompleteArtistSuggestions(suggestions[0].text);\n        }\n      } else if (event.key === \"ArrowDown\" && highlight < suggestions.length) {\n        event.preventDefault();\n        this.setState({ autocompleteArtistHighlight: highlight + 1 });\n      } else if (event.key === \"ArrowUp\" && highlight > -1) {\n        this.setState({ autocompleteArtistHighlight: highlight - 1 });\n      } else if (event.key === \"Enter\") {\n        if (highlight > -1) {\n          event.preventDefault();\n          this.setState({\n            artistName: suggestions[highlight].text,\n            autocompleteArtistSuggestions: null,\n            autocompleteArtistHighlight: -1\n          });\n        }\n      }\n    }\n  };\n\n  toggleShareSearch = (event) => {\n    event.preventDefault();\n    this.setState({\n      shareSearch: !this.state.shareSearch,\n      advancedSearch: false\n    });\n  };\n\n  toggleAdvancedSearch = (event) => {\n    event.preventDefault();\n    if (!this.state.advancedSearch) {\n      // it was not enabled before\n      const withCountsLanguages = this.state.searchLanguages.filter(\n        (x) => x.count\n      );\n      const withCountsYears = this.state.searchYears.filter((x) => x.count);\n      if (!withCountsLanguages.length || !withCountsYears.length) {\n        this.loadSearchAggregates();\n      }\n    }\n    this.setState({\n      advancedSearch: !this.state.advancedSearch,\n      shareSearch: false\n    });\n  };\n\n  // loadSearchLanguages() {\n  //   return fetch(\"/api/search/languages\").then(r => {\n  //     if (r.status === 200) {\n  //       r.json().then(r => {\n  //         this.setState({ searchLanguages: r.languages });\n  //       });\n  //     }\n  //   });\n  // }\n  loadSearchAggregates() {\n    return fetch(\"/api/search/aggregates\").then((r) => {\n      if (r.status === 200) {\n        r.json().then((r) => {\n          this.setState({ searchLanguages: r.languages, searchYears: r.years });\n        });\n      }\n    });\n  }\n\n  onChangeLanguage = (event) => {\n    event.preventDefault();\n    const searchLanguage = event.target.value;\n    this.setState({ searchLanguage });\n  };\n\n  onChangeYear = (event) => {\n    event.preventDefault();\n    const searchYear = event.target.value;\n    this.setState({ searchYear });\n  };\n\n  onChangeArtistName = (event) => {\n    event.preventDefault();\n    const artistName = event.target.value;\n    this.setState({ artistName }, () => {\n      if (artistName.length) {\n        this.fetchAutocompleteArtistSuggestions(this.state.artistName.trim());\n      } else {\n        this.setState({\n          autocompleteArtistSuggestions: null,\n          autocompleteArtistHighlight: -1\n        });\n      }\n    });\n  };\n\n  onSelectSuggestion = (event, suggestion) => {\n    event.preventDefault();\n    if (suggestion._url) {\n      return this.setState({ redirectTo: suggestion._url });\n    }\n    let newText = suggestion.text;\n    if (suggestion.append) {\n      newText = appendSuggestion(this.state.q, newText);\n    }\n    this.setState(\n      {\n        q: newText,\n        autocompleteSuggestions: null,\n        autocompleteHighlight: -1\n      },\n      () => {\n        this.submitSearch();\n      }\n    );\n  };\n\n  onSelectSuggestionAll = (event) => {\n    event.preventDefault();\n    this.submitSearch();\n  };\n\n  onSelectArtistSuggestion = (event, suggestion) => {\n    event.preventDefault();\n    this.setState(\n      {\n        artistName: suggestion.text,\n        autocompleteArtistSuggestions: null,\n        autocompleteArtistHighlight: -1\n      },\n      () => {\n        this.submitSearch();\n      }\n    );\n  };\n\n  onLoadMore = (event) => {\n    event.preventDefault();\n    this.setState(\n      {\n        resultsPageIndex: this.state.resultsPageIndex + 1\n      },\n      () => {\n        this.startSearch(\n          this.state.q,\n          this.state.searchLanguage,\n          this.state.searchYear,\n          this.state.artistName,\n          this.state.resultsPageIndex,\n          this.state.searchExample\n        );\n      }\n    );\n  };\n\n  submitPhrase = (event, keyPhrase) => {\n    event.preventDefault();\n    const stateUpdate = { q: keyPhrase.phrase, originalQ: this.state.q };\n    if (keyPhrase.year) {\n      stateUpdate.searchYear = keyPhrase.year;\n    }\n    if (keyPhrase.language) {\n      stateUpdate.searchLanguage = keyPhrase.language;\n    }\n    this.setState(stateUpdate, () => {\n      this.submitSearch();\n    });\n  };\n\n  reloadSearch = (event) => {\n    event.preventDefault();\n    window.location.reload();\n  };\n\n  loadMoreByName = (event) => {\n    const previousByNameLimit = this.state.by_name_limit;\n    this.setState(\n      {\n        by_name_total: 0,\n        by_name_limit: 0\n      },\n      () => {\n        const url = `/api/search?q=${encodeURIComponent(\n          this.state.q\n        )}&by_name=${previousByNameLimit}`;\n        fetch(url).then((r) => {\n          if (this.dismounted) {\n            return;\n          }\n          if (r.status === 200) {\n            r.json().then((results) => {\n              if (results) {\n                this.setState({\n                  by_name: results.by_name,\n                  by_name_total: results.by_name_total,\n                  by_name_limit: results.by_name_limit\n                });\n              }\n            });\n          }\n        });\n      }\n    );\n  };\n\n  displayYears = (year) => {\n    let yearEnd = year + 9;\n    const currentYear = new Date().getFullYear();\n    if (yearEnd > currentYear) {\n      yearEnd = currentYear;\n    }\n    return `${year}…${yearEnd}`;\n  };\n\n  render() {\n    const { redirectTo, searchYear } = this.state;\n    if (redirectTo) {\n      return <Redirect to={redirectTo} push={true} />;\n    }\n    let results = null;\n    let pagination = null;\n    if (this.state.results) {\n      let rows = this.state.results;\n      if (this.state.onlyResults) {\n        let onlyIds = this.state.onlyResults.map((r) => r.id);\n        rows = rows.filter((row) => onlyIds.includes(row.id));\n      }\n      results = (\n        <Results\n          results={rows}\n          searched={this.searched}\n          popularityFactor={this.state.popularityFactor}\n          showYear={Boolean(searchYear)}\n        />\n      );\n      if (this.state.results.length < this.state.total) {\n        pagination = (\n          <Pagination\n            location={this.props.location}\n            page={this.state.resultsPageIndex}\n            onLoadMore={this.onLoadMore}\n          />\n        );\n      }\n    }\n\n    let byName = null;\n    if (this.state.by_name && this.state.by_name.length) {\n      byName = (\n        <SongsByName\n          results={this.state.by_name}\n          total={this.state.by_name_total}\n          limit={this.state.by_name_limit}\n          loadMoreByName={this.loadMoreByName}\n        />\n      );\n    }\n\n    let searchToggles = (\n      <span className=\"help-block toggles\">\n        {this.state.results && this.state.results.length ? (\n          <button\n            type=\"button\"\n            className={\n              this.state.shareSearch\n                ? \"btn btn-default btn-sm active\"\n                : \"btn btn-default btn-sm\"\n            }\n            onClick={this.toggleShareSearch}\n          >\n            {this.state.shareSearch\n              ? \"Hide share search\"\n              : \"Share search results\"}\n          </button>\n        ) : null}\n        <button\n          type=\"button\"\n          className={\n            this.state.advancedSearch\n              ? \"btn btn-default btn-sm active\"\n              : \"btn btn-default btn-sm\"\n          }\n          onClick={this.toggleAdvancedSearch}\n        >\n          {this.state.advancedSearch ? \"Hide search options\" : \"Search options\"}\n        </button>\n      </span>\n    );\n    let advancedSearchStatus = null;\n    if (!this.state.advancedSearch) {\n      let parts = [];\n      // if you currently don't have the advanced search options open,\n      // show what's currently selected.\n      if (this.state.searchLanguage && this.state.searchLanguage !== \"en\") {\n        const language = this.state.searchLanguages.filter((e) => {\n          return e.code === this.state.searchLanguage;\n        })[0].language;\n        parts.push(`Language: ${language}`);\n      }\n\n      if (this.state.searchYear) {\n        parts.push(\n          `Years: ${this.displayYears(parseInt(this.state.searchYear))}`\n        );\n      }\n\n      if (this.state.artistName) {\n        parts.push(`Artist: ${this.state.artistName}`);\n      }\n      if (parts.length) {\n        advancedSearchStatus = (\n          <span className=\"help-block advanced-search-status\">\n            <b>Search options:</b> {parts.join(\", \")}\n          </span>\n        );\n      }\n    }\n\n    let advancedInput = null;\n    if (this.state.advancedSearch) {\n      advancedInput = (\n        <div className=\"advanced\">\n          <div className=\"form-group\" style={{ position: \"relative\" }}>\n            <input\n              type=\"search\"\n              ref={this.artistRef}\n              value={this.state.artistName}\n              className=\"form-control input-lg\"\n              maxLength={100}\n              onFocus={this.onFocusArtist}\n              onBlur={this.onBlurArtist}\n              onChange={this.onChangeArtistName}\n              onKeyDown={this.onKeyDownArtistSearch}\n              aria-label=\"Artist search\"\n              placeholder=\"Artist or band name\"\n            />\n            {this.state.autocompleteArtistSuggestions &&\n            this.state.showAutocompleteArtistSuggestions ? (\n              <ShowAutocompleteArtistSuggestions\n                onSelectSuggestion={this.onSelectArtistSuggestion}\n                highlight={this.state.autocompleteArtistHighlight}\n                suggestions={this.state.autocompleteArtistSuggestions}\n              />\n            ) : null}\n          </div>\n          <div className=\"form-group\">\n            <select\n              ref={this.languageRef}\n              onChange={this.onChangeLanguage}\n              value={this.state.searchLanguage}\n              className=\"form-control\"\n            >\n              <option value=\"\">Any language</option>\n              {this.state.searchLanguages.map((each) => {\n                let text = each.language;\n                if (each.count === 1) {\n                  text += \" (1 song)\";\n                } else if (each.count) {\n                  text += ` (${each.count.toLocaleString()} songs)`;\n                }\n                return (\n                  <option key={each.code} value={each.code}>\n                    {text}\n                  </option>\n                );\n              })}\n            </select>\n          </div>\n          <div className=\"form-group\">\n            <select\n              // ref={this.yearRef}\n              onChange={this.onChangeYear}\n              value={this.state.searchYear}\n              className=\"form-control\"\n            >\n              <option value=\"\">Any year</option>\n              {this.state.searchYears.map((each) => {\n                let text = this.displayYears(each.year);\n                if (each.count === 1) {\n                  text += \" (1 song)\";\n                } else if (each.count) {\n                  text += ` (${each.count.toLocaleString()} songs)`;\n                }\n                return (\n                  <option key={text} value={each.year}>\n                    {text}\n                  </option>\n                );\n              })}\n            </select>\n          </div>\n          <div className=\"form-group text-right\">\n            <button type=\"submit\" className=\"btn btn-primary\">\n              Search Now\n            </button>\n          </div>\n        </div>\n      );\n    }\n\n    let keyPhrases = null;\n    if (\n      this.state.results &&\n      // !this.state.results.length &&\n      this.state.keyPhrases &&\n      this.state.keyPhrases.length\n    ) {\n      keyPhrases = (\n        <ShowKeyPhrases\n          nothingFound={!this.state.results.length}\n          phrases={this.state.keyPhrases}\n          submitPhrase={this.submitPhrase}\n        />\n      );\n    }\n\n    return (\n      <div>\n        <form onSubmit={this.onSubmit} action=\"/api/search/redirect\">\n          <div className=\"form-group\" style={{ position: \"relative\" }}>\n            <div className=\"input-group input-group-lg\">\n              <input\n                type=\"search\"\n                ref={this.searchRef}\n                name=\"q\"\n                autoComplete=\"off\"\n                value={this.state.q}\n                onFocus={this.onFocusSearch}\n                onBlur={this.onBlurSearch}\n                onChange={this.onChangeSearch}\n                onKeyDown={this.onKeyDownSearch}\n                className=\"form-control\"\n                maxLength={150}\n                aria-label=\"Lyrics search\"\n                placeholder={this.state.placeholder}\n              />\n              <span className=\"input-group-btn\">\n                <button\n                  className=\"btn btn-default btn-lg\"\n                  type=\"submit\"\n                  title=\"Click to search\"\n                >\n                  Search\n                </button>\n              </span>\n            </div>\n            {this.state.searchMaxLength ? (\n              <ShowMaxlengthWarning\n                length={this.state.searchMaxLength[0]}\n                maxLength={this.state.searchMaxLength[1]}\n              />\n            ) : null}\n            {this.state.desperateSearch &&\n            this.state.results &&\n            this.state.results.length &&\n            !(\n              this.state.showAutocompleteSuggestions &&\n              this.state.autocompleteSuggestions\n            ) ? (\n              <ShowDesperateSearchWarning />\n            ) : null}\n            {!this.state.desperateSearch &&\n            this.state.missing &&\n            this.state.results &&\n            this.state.results.length &&\n            !(\n              this.state.showAutocompleteSuggestions &&\n              this.state.autocompleteSuggestions\n            ) ? (\n              <ShowMissingSearchWarning missing={this.state.missing} />\n            ) : null}\n            {this.state.autocompleteSuggestions &&\n            this.state.showAutocompleteSuggestions ? (\n              <ShowAutocompleteSuggestions\n                q={this.state.q}\n                onSelectSuggestion={this.onSelectSuggestion}\n                onSelectSuggestionAll={this.onSelectSuggestionAll}\n                highlight={this.state.autocompleteHighlight}\n                suggestions={this.state.autocompleteSuggestions}\n                searchSuggestions={this.state.autocompleteSearchSuggestions}\n              />\n            ) : null}\n          </div>\n          <ShowResultCount\n            results={this.state.results}\n            total={this.state.total}\n            byName={this.state.by_name}\n            onlyResults={this.state.onlyResults}\n          />\n\n          {searchToggles}\n          {advancedSearchStatus}\n          {this.state.shareSearch ? (\n            <ShareInput searched={this.searched} />\n          ) : null}\n          {advancedInput}\n        </form>\n \n      <div id=\"waldo-tag-11815\">\n          <script>\n            {`googletag.cmd.push(function() {\n              googletag.display = \"waldo-tag-11815\";\n            })`};\n          </script>\n        </div>\n\n        \n        {/* <CountdownTimer targetDate={dateTimeAfterThreeDays} /> */}\n        \n\n        {this.state.searchError ? (\n          <SearchError error={this.state.searchError} />\n        ) : null}\n        {this.state.showExamples ? (\n          <ShowExamples\n            sampleSearch={this.sampleSearch}\n            examples={this.state.searchExamples}\n          />\n        ) : null}\n        {this.state.showRecentComments && this.state.recentComments ? (\n          <ShowRecentCommentsWrapper\n            comments={this.state.recentComments.comments}\n          />\n        ) : null}\n        {/* {suggestions} */}\n        {byName}\n        {keyPhrases}\n        {results}\n        {this.state.searching ? <Loading text=\"Searching...\" /> : null}\n        {pagination}\n        {this.state.slowSearch ? (\n          <SlowSearch reloadSearch={this.reloadSearch} />\n        ) : null}\n      </div>\n    );\n  }\n}\n\nexport default Home;\n\nclass ShowRecentCommentsWrapper extends React.PureComponent {\n  render() {\n    const { comments } = this.props;\n    return (\n      <div className=\"recent-comments\" style={{ marginTop: 50 }}>\n        <h4>\n          Recent Comments (<Link to=\"/comments\">All</Link>)\n        </h4>\n        <ShowRecentComments comments={comments} isRoot={true} />\n        <div className=\"load-more\">\n          <Link to=\"/comments\">More recent comments</Link>\n        </div>\n      </div>\n    );\n  }\n}\n\nconst ShowResultCount = React.memo(\n  ({ results, total, onlyResults, byName }) => {\n    if (!results) {\n      return null;\n    }\n    let countResults = null;\n    if (results) {\n      const byNameCount = byName ? byName.length : 0;\n      if (onlyResults) {\n        countResults = onlyResults.length + byNameCount;\n      } else {\n        countResults = results.length + byNameCount;\n      }\n    }\n    return (\n      <p className=\"result-metadata text-right\">\n        <b>\n          {total >= 10000 ? \"More than \" : \"\"}\n          {total.toLocaleString()} {total === 1 ? \"song found\" : \"songs found\"}\n        </b>{\" \"}\n        {countResults && countResults < total\n          ? `(showing ${countResults})`\n          : null}\n      </p>\n    );\n  }\n);\n\nclass ShareInput extends React.PureComponent {\n  state = {\n    copied: false,\n    failed: false,\n    hasFocused: false\n  };\n\n  absurlRef = React.createRef();\n\n  render() {\n    const absoluteUrl = window.location.href;\n    return (\n      <div className=\"form-group\" style={{ marginTop: 30 }}>\n        <div className=\"input-group\">\n          <label className=\"sr-only\">URL:</label>\n          <input\n            ref={this.absurlRef}\n            type=\"text\"\n            className=\"form-control\"\n            readOnly\n            value={absoluteUrl}\n            onFocus={() => {\n              if (!this.state.hasFocused) {\n                this.absurlRef.current.select();\n                this.setState({ hasFocused: true });\n              }\n            }}\n          />\n          <span className=\"input-group-btn\">\n            <button\n              type=\"button\"\n              className={\n                this.state.copied ? \"btn btn-success\" : \"btn btn-primary\"\n              }\n              title=\"Click to copy to clipboard\"\n              onClick={(event) => {\n                event.preventDefault();\n                this.absurlRef.current.select();\n                if (copy(absoluteUrl)) {\n                  this.setState({ copied: true, failed: false }, () => {\n                    if (this.props.searched && !this.copied) {\n                      this.copied = this.props.searched;\n                      fetch(`/api/search/copied/${this.props.searched}`, {\n                        method: \"POST\"\n                      });\n                    }\n                  });\n                } else {\n                  this.setState({ copied: false, failed: true });\n                }\n              }}\n            >\n              {this.state.copied ? \"Copied to clipboard\" : \"Copy to clipboard\"}\n            </button>\n          </span>\n        </div>\n        {this.state.copied ? (\n          <p>\n            The URL to this search has now been copied to your clipboard so you\n            can paste it anywhere. Thanks!\n          </p>\n        ) : null}\n      </div>\n    );\n  }\n}\n\nconst ShowKeyPhrases = React.memo(({ phrases, submitPhrase, nothingFound }) => {\n  let subTitle = null;\n  if (nothingFound) {\n    if (phrases.length === 1) {\n      subTitle = <h4>But, try this...</h4>;\n    } else {\n      subTitle = <h4>But, try these...</h4>;\n    }\n  }\n  return (\n    <div className=\"key-phrases\">\n      {nothingFound ? (\n        <h3>Nothing found</h3>\n      ) : (\n        <h3>Fuzzy results. Try breaking it up...</h3>\n      )}\n      {subTitle}\n      <table className=\"table suggestions table-condensed\">\n        <tbody>\n          {phrases.map((phrase) => {\n            let url = `/q/${phrase.phrase}`;\n            if (phrase.year) {\n              url += `?year=${phrase.year}`;\n            }\n            return (\n              <tr key={phrase.phrase}>\n                <td>\n                  <a href={url} onClick={(e) => submitPhrase(e, phrase)}>\n                    {phrase.diff_html ? (\n                      <span\n                        dangerouslySetInnerHTML={{ __html: phrase.diff_html }}\n                      />\n                    ) : (\n                      phrase.phrase\n                    )}\n                  </a>\n                </td>\n                <td>\n                  <b>{phrase.total}</b> {phrase.total === 1 ? \"song\" : \"songs\"}\n                </td>\n              </tr>\n            );\n          })}\n        </tbody>\n      </table>\n    </div>\n  );\n});\n\nconst ShowAutocompleteSuggestions = React.memo(\n  ({\n    q,\n    highlight,\n    suggestions,\n    searchSuggestions,\n    onSelectSuggestion,\n    onSelectSuggestionAll\n  }) => {\n    if (!suggestions.length) {\n      return null;\n    }\n    return (\n      <div className=\"autocomplete\">\n        <ul>\n          {searchSuggestions && q && searchSuggestions.total ? (\n            <li\n              onClick={onSelectSuggestionAll}\n              className={\n                highlight === 0\n                  ? \"active search-suggestion\"\n                  : \"search-suggestion\"\n              }\n            >\n              {searchSuggestions.capped ? (\n                <a\n                  style={{ float: \"right\" }}\n                  href={\"/q/\" + encodeURIComponent(searchSuggestions.term)}\n                >\n                  {searchSuggestions.total.toLocaleString()}{\" \"}\n                  {searchSuggestions.desperate\n                    ? \"approximate matches\"\n                    : \"good matches\"}\n                </a>\n              ) : null}\n              <a href={\"/q/\" + encodeURIComponent(searchSuggestions.term)}>\n                Search for <i>{q}</i>\n              </a>\n            </li>\n          ) : null}\n\n          {suggestions.map((s, index) => {\n            const className = index + 1 === highlight ? \"active\" : \"\";\n            return (\n              <li\n                key={s.id ? s.id : s.text}\n                className={className}\n                onClick={(e) => onSelectSuggestion(e, s)}\n              >\n                {s.id ? (\n                  <ShowAutocompleteSuggestionSong song={s} />\n                ) : (\n                  <ShowAutocompleteSuggestion\n                    text={s.text}\n                    html={s.html}\n                    found={s.found}\n                  />\n                )}\n              </li>\n            );\n          })}\n        </ul>\n      </div>\n    );\n  }\n);\n\nconst ShowAutocompleteSuggestion = React.memo(({ found, html }) => {\n  if (found) {\n    return (\n      <p className=\"search\">\n        <small>{found}</small>\n        <span dangerouslySetInnerHTML={{ __html: html }} />\n      </p>\n    );\n  } else {\n    return <p className=\"search\" dangerouslySetInnerHTML={{ __html: html }} />;\n  }\n});\n\nconst ShowAutocompleteSuggestionSong = React.memo(({ song }) => {\n  let imageUrl = placeholderImage;\n  if (song.image) {\n    if (song.image.thumbnail100) {\n      imageUrl = song.image.thumbnail100;\n    } else {\n      imageUrl = song.image.url;\n    }\n  }\n  return (\n    <div className=\"media autocomplete-suggestion-song\">\n      <div className=\"media-left\">\n        <AutocompleteImage url={imageUrl} name={song.name} />\n      </div>\n      <div className=\"media-body\">\n        <h5 className=\"artist-name\">\n          <b>{song.name}</b>\n          <span className=\"by\">{\" by \"}</span>\n          {song.artist.name}\n        </h5>\n        {song.fragments.map((fragment, i) => {\n          return (\n            <p\n              key={`${song.id}:${i}`}\n              dangerouslySetInnerHTML={{ __html: fragment }}\n            />\n          );\n        })}\n      </div>\n    </div>\n  );\n});\n\nconst ShowAutocompleteArtistSuggestions = React.memo(\n  ({ highlight, suggestions, onSelectSuggestion }) => {\n    if (!suggestions.length) {\n      return null;\n    }\n    return (\n      <div className=\"autocomplete\">\n        <ul>\n          {suggestions.map((s, index) => {\n            let className = index === highlight ? \"active\" : \"\";\n            return (\n              <li\n                key={`${s.text}${index}`}\n                className={className}\n                onClick={(e) => onSelectSuggestion(e, s)}\n              >\n                <div className=\"media\">\n                  <div className=\"media-left\">\n                    <AutocompleteImage\n                      url={s.thumbnail100 || s.image || placeholderImage}\n                      name={s.text}\n                    />\n                  </div>\n                  <div className=\"media-body\">\n                    <h5\n                      className=\"artist-name\"\n                      dangerouslySetInnerHTML={{ __html: s.html }}\n                    />\n                    <span className=\"artist-metadata\">\n                      {s.songs ? s.songs : \"0\"} songs\n                    </span>\n                  </div>\n                </div>\n              </li>\n            );\n          })}\n        </ul>\n      </div>\n    );\n  }\n);\n\nfunction ShowMaxlengthWarning({ length, maxLength }) {\n  let className = \"help-block maxlength\";\n  if (length === maxLength) {\n    className += \" danger\";\n  }\n  return (\n    <span className={className}>\n      {length} of max {maxLength} characters!\n    </span>\n  );\n}\n\nfunction ShowDesperateSearchWarning() {\n  return (\n    <span className=\"help-block warning\">\n      <b>Note!</b> Nothing could be found with that exact search. Showing fuzzy\n      matches.\n    </span>\n  );\n}\n\nfunction ShowMissingSearchWarning({ missing }) {\n  return (\n    <span className=\"help-block warning\">\n      <b>Note!</b> Results found by discarding{\" \"}\n      <i style={{ textDecoration: \"line-through\" }}>{missing}</i>.\n    </span>\n  );\n}\n\nconst ShowExamples = React.memo(({ sampleSearch, examples }) => {\n  return (\n    <div className=\"examples\">\n      <h4>Successful searches for songs by lyrics</h4>\n      <ul>\n        {examples.map((search) => {\n          let link = \"/q/\" + encodeURIComponent(search.term);\n          link += `?example=${search.id}`;\n          if (search.artist) {\n            link += `&artist=${encodeURIComponent(search.artist)}`;\n          }\n          if (search.language) {\n            link += `&language=${encodeURIComponent(search.language)}`;\n          }\n          if (search.year) {\n            link += `&year=${search.year}`;\n          }\n          let searchMeta = null;\n          const searchMetaStrings = [];\n\n          if (search.artist) {\n            searchMetaStrings.push([\"artist\", search.artist]);\n          }\n          if (search.language) {\n            searchMetaStrings.push([\"language\", search.language_human]);\n          }\n          if (search.year) {\n            searchMetaStrings.push([\"year\", search.year]);\n          }\n          if (searchMetaStrings.length) {\n            searchMeta = (\n              <span>\n                (\n                {searchMetaStrings.map((n, i) => {\n                  return (\n                    <React.Fragment key={n[0]}>\n                      {n[0]} <b>{n[1]}</b>\n                      {i + 1 < searchMetaStrings.length ? \", \" : \"\"}\n                    </React.Fragment>\n                  );\n                })}\n                )\n              </span>\n            );\n          }\n\n          return (\n            <li key={search.id}>\n              <Link to={link} onClick={(e) => sampleSearch(e, search)}>\n                <b>{search.term}</b>\n              </Link>{\" \"}\n              {searchMeta} <i>{search.total_found} found</i>\n              <br />\n              {search.opened.map((song) => {\n                return (\n                  <span className=\"opened\" key={song.id}>\n                    clicked on{\" \"}\n                    <Link to={song._url}>\n                      <b>{song.name}</b> by <b>{song.artist.name}</b>\n                    </Link>\n                  </span>\n                );\n              })}\n            </li>\n          );\n        })}\n      </ul>\n    </div>\n  );\n});\n\nfunction SlowSearch({ reloadSearch }) {\n  return (\n    <div className=\"slow-search\">\n      <h4>Sorry, search seems to take longer than normal!</h4>\n      <p>\n        Perhaps it got stuck? <br />\n        <button\n          type=\"button\"\n          className=\"btn btn-default btn-sm\"\n          onClick={reloadSearch}\n        >\n          Reload search\n        </button>\n      </p>\n    </div>\n  );\n}\n\nfunction SearchError({ error }) {\n  return (\n    <div className=\"search-error\">\n      <h4>Sorry, an error occured</h4>\n      {error.status === 400 ? (\n        <p>\n          The query was invalid <code>{error.text}</code>\n        </p>\n      ) : (\n        <p>The server basically failed to compute the search</p>\n      )}\n      {error.status >= 500 && <p>Perhaps simply try again a little later.</p>}\n      {error.status >= 500 && (\n        <p>\n          <button\n            type=\"button\"\n            className=\"btn btn-default\"\n            onClick={(event) => {\n              window.location.reload(true);\n            }}\n          >\n            Reload to try again\n          </button>\n        </p>\n      )}\n    </div>\n  );\n}\n\nclass Results extends React.PureComponent {\n  firstLoad = true;\n  componentDidMount() {\n    if (!isServer) {\n      loadCarbonScript();\n    }\n    this.firstLoad = false;\n  }\n  componentDidUpdate(prevProps) {\n    // Is this if-statement necessary? I mean, isn't componentDidUpdate\n    // something that *only* happens with non-SSR rendering??\n    if (!isServer && prevProps.results !== this.props.results) {\n      loadCarbonScript();\n    }\n  }\n  render() {\n    const { results, searched, popularityFactor, showYear } = this.props;\n    return (\n      <div>\n        {/* This extra span exists to debug if ads are enabled or not */}\n        {!NO_ADS ? <div id=\"carbonadsouter\" /> : <span id=\"_nocardonads\" />}\n\n        <div className=\"results\">\n          {results.map((result, index) => {\n            return (\n              <Result\n                key={result.id}\n                result={result}\n                searched={searched}\n                expandedByDefault={results.length === 1}\n                firstResult={index === 0}\n                popularityFactor={popularityFactor}\n                firstLoad={this.firstLoad}\n                showYear={showYear}\n              />\n            );\n          })}\n        </div>\n      </div>\n    );\n  }\n}\n\nclass Result extends React.PureComponent {\n  state = {\n    collapsed: true,\n    itunes: null,\n    amazon: null,\n    textHtml: this.props.result.text_html\n  };\n  affiliateLookupStarted = [];\n\n  componentDidMount() {\n    if (this.props.expandedByDefault) {\n      this.expand();\n    }\n  }\n\n  componentWillUnmount() {\n    this.dismounted = true;\n  }\n\n  onExpandClick = (event) => {\n    event.preventDefault();\n    this.expand();\n  };\n\n  expand() {\n    const wasCollapsed = this.state.collapsed;\n    this.setState({ collapsed: false });\n    this.fetchTextHTML().then(() => {\n      if (wasCollapsed) {\n        if (this.props.searched) {\n          let recordURL = `/api/song/${this.props.result.id}/`;\n          recordURL += `expand/${this.props.searched}`;\n          fetch(recordURL, { method: \"POST\" })\n            .then((r) => r.json())\n            .then((result) => {\n              // nothing to do\n            });\n        }\n      }\n    });\n  }\n\n  fetchTextHTML() {\n    if (this.state.textHtml) {\n      return Promise.resolve();\n    } else {\n      const url = `/api/song/${this.props.result.id}?text_only=true`;\n      return fetch(url)\n        .then((r) => r.json())\n        .then((result) => {\n          if (this.dismounted) {\n            return;\n          }\n          this.setState({\n            textHtml: result.song.text_html\n          });\n        });\n    }\n  }\n\n  render() {\n    const { result, popularityFactor, firstResult, firstLoad, showYear } =\n      this.props;\n    let className = \"result\";\n    if (this.state.collapsed) {\n      className += \" collapsed\";\n    }\n    let songURL = result._url;\n    let image;\n\n    if (result.image) {\n      image = (\n        <SongImage\n          url={result.image.url}\n          className=\"pull-right img-thumbnail album\"\n          name={result.image.name}\n          forceLoad={firstResult || !firstLoad}\n        />\n      );\n    } else {\n      image = (\n        <SongImage\n          url={null}\n          className=\"pull-right img-thumbnail\"\n          name={result.artist.name}\n          forceLoad={firstResult || !firstLoad}\n        />\n      );\n    }\n\n    let rest = (\n      <p className=\"read-more\">\n        <Link to={songURL}>VIEW SONG</Link>{\" \"}\n        <Link to={songURL} onClick={this.onExpandClick}>\n          EXPAND SONG\n        </Link>\n      </p>\n    );\n    if (!this.state.collapsed) {\n      let searchedId = null;\n      let searched = null;\n      try {\n        searched = localStorage.getItem(\"searched\");\n      } catch (ex) {\n        console.warn(\"'localStorage.getItem(\\\"searched\\\")' didn't work\");\n      }\n      if (searched) {\n        if (searched.includes(\",\")) {\n          // The new way\n          searchedId = parseInt(searched.split(\",\")[0], 10);\n        } else {\n          // The old way!\n          searchedId = parseInt(searched, 10);\n        }\n      }\n      rest = (\n        <div className=\"rest\">\n          <div className=\"text\">\n            <h3>Full Text</h3>\n            {this.state.textHtml ? (\n              <RenderParagraphs text={this.state.textHtml} />\n            ) : (\n              <i>Loading full text...</i>\n            )}\n            <SongComments\n              comments={null}\n              commentsCount={null}\n              song={result}\n              searchedId={searchedId}\n            />\n            <AmazonRelatedProducts song={result} />\n\n            {/* {this.state.textHtml && (\n              <YouTubeSnippetIntersectionLazy song={result} />\n            )} */}\n            <p className=\"load-more\">\n              <Link to={songURL}>GO TO SONG PAGE</Link>\n            </p>\n          </div>\n        </div>\n      );\n    }\n\n    let artistName = <b>{result.artist.name}</b>;\n    if (result.artist.fragment) {\n      artistName = (\n        <b dangerouslySetInnerHTML={{ __html: result.artist.fragment }} />\n      );\n    }\n\n    let tooltipTitle;\n    if (process.env.NODE_ENV === \"development\") {\n      let score = result.score.toFixed(4);\n      tooltipTitle = `Score ${score}`;\n      if (result.popularity) {\n        tooltipTitle += ` Popularity: ${result.popularity.toFixed(6)}`;\n      }\n    } else {\n      tooltipTitle = \"Click to view just this song\";\n    }\n\n    return (\n      <div className={className}>\n        <div className=\"head\">\n          <Link to={songURL}>{image}</Link>\n          <h2 title={tooltipTitle}>\n            <Link to={songURL}>{result.name}</Link>\n            {showYear && result.year && (\n              <span className=\"year\"> {result.year}</span>\n            )}\n            {process.env.NODE_ENV === \"development\" ? (\n              <ShowSongScore song={result} factor={popularityFactor} />\n            ) : null}\n          </h2>\n          <h3>\n            <span className=\"by\">by</span> {artistName}\n          </h3>\n\n          {result.albums.length ? <Albums albums={result.albums} /> : null}\n        </div>\n        <div className=\"fragments\">\n          {result.fragments.map((fragment, i) => {\n            return (\n              <p\n                key={`${result.id}${i}`}\n                dangerouslySetInnerHTML={{ __html: fragment }}\n              />\n            );\n          })}\n        </div>\n        {rest}\n      </div>\n    );\n  }\n}\n\nconst SongImage = React.memo(({ url, name, forceLoad, className }) => {\n  // If the song doesn't haven an image, no point messing around.\n  if (!url) {\n    return (\n      <img\n        src={placeholderImage}\n        className={className}\n        title={name}\n        alt={name}\n      />\n    );\n  }\n  return (\n    <img\n      src={url}\n      className={className}\n      title={name}\n      alt={name}\n      loading={forceLoad ? undefined : \"lazy\"}\n    />\n  );\n});\n\n// This assumes that we'll sooner or later need the lazyloadThumbnailImage image\nif (!isServer) {\n  new Image().src = lazyloadThumbnailImage;\n}\n\n// Module level \"cache\" of which image URLs have been successfully inserted\n// into the DOM at least once.\n// By knowing these, we can, on repeat URLs, avoid the whole lazy-load\n// image swapping trick.\nconst loadedOnce = new Set();\n\nfunction AutocompleteImage({ url, name }) {\n  const [src, setSrc] = useState(\n    loadedOnce.has(url) ? url : lazyloadThumbnailImage\n  );\n\n  useEffect(() => {\n    let preloadImg = null;\n    let dismounted = false;\n\n    if (src === lazyloadThumbnailImage) {\n      // We need to preload the eventually needed image.\n      preloadImg = new Image();\n\n      function cb() {\n        if (!dismounted) {\n          setSrc(url);\n        }\n        loadedOnce.add(url);\n      }\n      // This must come before .decode() otherwise Safari will\n      // raise an EncodingError.\n      preloadImg.src = url;\n      // https://html.spec.whatwg.org/multipage/embedded-content.html#dom-img-decode\n      // https://developer.mozilla.org/en-US/docs/Web/API/HTMLImageElement/decode#Browser_compatibility\n      preloadImg.decode\n        ? preloadImg.decode().then(cb, cb)\n        : (preloadImg.onload = cb);\n      // https://developer.mozilla.org/en-US/docs/Web/API/HTMLImageElement/decoding\n      preloadImg.decoding = \"sync\";\n    }\n\n    return () => {\n      if (preloadImg) {\n        // Immediately undo the preloading since we might not need this image.\n        // See https://jsfiddle.net/nw34gLgt/ for demo of this technique.\n        preloadImg.src = \"\";\n      }\n      dismounted = true;\n    };\n  }, [url, src]);\n\n  if (!url) {\n    // Don't even bother with lazy loading.\n    return (\n      <img\n        className=\"img-rounded\"\n        src={lazyloadThumbnailImage}\n        alt={name}\n        title={name}\n      />\n    );\n  }\n\n  return <img className=\"img-rounded\" src={src} alt={name} title={name} />;\n}\n\nfunction ShowSongScore({ song, factor = 20 }) {\n  const s = song.score - factor * song.popularity;\n  return (\n    <code>\n      {song.score.toFixed(3)} = {s.toFixed(3)} + {factor}\n      &times;\n      {song.popularity.toFixed(4)}\n    </code>\n  );\n}\n\nconst SongsByName = React.memo(({ results, total, limit, loadMoreByName }) => {\n  return (\n    <div className=\"by-name\">\n      <h4>Songs by name</h4>\n      <ul>\n        {results.map((s) => {\n          return (\n            <li key={s.id}>\n              <Link to={s._url}>\n                <b dangerouslySetInnerHTML={{ __html: s.fragment }} /> by{\" \"}\n                <b>{s.artist.name}</b>\n              </Link>\n            </li>\n          );\n        })}\n      </ul>\n      {total > limit ? (\n        <button className=\"btn btn-default btn-sm\" onClick={loadMoreByName}>\n          {total > 20\n            ? \"Show more songs by name\"\n            : `Show all (${total}) songs by name`}\n        </button>\n      ) : null}\n    </div>\n  );\n});\n\nconst Albums = React.memo(({ albums }) => {\n  return (\n    <p className=\"albums\">\n      {albums.map((album, i) => {\n        const parts = [<b key={album.id}>{album.name}</b>];\n        if (album.year) {\n          parts.push(` (${album.year})`);\n        }\n        if (i + 1 < albums.length) {\n          parts.push(\", \");\n        }\n        return parts;\n      })}\n    </p>\n  );\n});\n\nconst Pagination = React.memo(({ location, onLoadMore }) => {\n  const currentURL = location.pathname + location.search;\n  return (\n    <div className=\"load-more\">\n      <a href={currentURL} onClick={onLoadMore}>\n        LOAD MORE RESULTS\n      </a>\n    </div>\n  );\n});\n"]},"metadata":{},"sourceType":"module"}