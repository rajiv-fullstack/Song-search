{"ast":null,"code":"import _slicedToArray from \"/home/mandeep/Downloads/Song-sorch work/site/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\n\nvar _jsxFileName = \"/home/mandeep/Downloads/Song-sorch work/site/src/RecentComments.js\",\n    _s = $RefreshSig$();\n\nimport React, { useCallback, useRef, useEffect, useState } from \"react\";\nimport { Link, useParams } from \"react-router-dom\";\nimport { Loading, SetHTMLHeaders, ServerError } from \"./Common\";\nimport { cachedFetch } from \"./Cache\";\nimport \"./RecentComments.css\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nfunction RecentComments(_ref) {\n  _s();\n\n  var recentComments = _ref.recentComments;\n\n  var _useParams = useParams(),\n      page = _useParams.page;\n\n  var mountedRef = useRef(false);\n\n  var _useState = useState(null),\n      _useState2 = _slicedToArray(_useState, 2),\n      serverError = _useState2[0],\n      setServerError = _useState2[1];\n\n  var _useState3 = useState(recentComments || null),\n      _useState4 = _slicedToArray(_useState3, 2),\n      data = _useState4[0],\n      setData = _useState4[1];\n\n  function getPage(p) {\n    return parseInt(p || \"1\", 10);\n  }\n\n  var fetchComments = useCallback(function () {\n    var url = \"/api/comments/recent\";\n    var pageInt = getPage(page);\n\n    if (pageInt > 1) {\n      url += \"?page=\".concat(pageInt);\n    }\n\n    return cachedFetch(url).then(function (r) {\n      if (!r.ok) {\n        return mountedRef.current && setServerError(r);\n      }\n\n      r.json().then(function (data) {\n        return mountedRef.current && setData(data);\n      });\n    }).catch(function (ex) {\n      return mountedRef.current && setServerError(ex);\n    });\n  }, [page]);\n  useEffect(function () {\n    var pageInt = getPage(page);\n    var suffix = \" - Song Search\";\n    SetHTMLHeaders({\n      title: pageInt > 1 ? \"Recent Comments (page \".concat(pageInt, \")\").concat(suffix) : \"Recent Comments\".concat(suffix)\n    });\n    setData(null);\n    mountedRef.current = true;\n    fetchComments(page);\n    return function () {\n      mountedRef.current = false;\n    };\n  }, [page, fetchComments]);\n  var loading = !data && !serverError;\n\n  var _useState5 = useState(false),\n      _useState6 = _slicedToArray(_useState5, 2),\n      showLoading = _useState6[0],\n      setShowLoading = _useState6[1];\n\n  useEffect(function () {\n    if (loading) {\n      window.setTimeout(function () {\n        mountedRef.current && setShowLoading(true);\n      }, 1000);\n    } else {\n      setShowLoading(false);\n    }\n  }, [loading]);\n  var pageInt = getPage(page);\n  var pagination = null;\n\n  if (data && (data.next_page || pageInt > 1)) {\n    pagination = /*#__PURE__*/_jsxDEV(Pagination, {\n      next: data.next_page,\n      previous: pageInt - 1\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 73,\n      columnNumber: 18\n    }, this);\n  }\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"recent-comments\",\n    children: [!serverError && /*#__PURE__*/_jsxDEV(\"h2\", {\n      children: [\"Recent Comments \", pageInt !== 1 && /*#__PURE__*/_jsxDEV(\"small\", {\n        children: [\"Page \", pageInt]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 80,\n        columnNumber: 45\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 79,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n      children: /*#__PURE__*/_jsxDEV(Link, {\n        to: \"/\",\n        children: \"Back to the home page\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 84,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 83,\n      columnNumber: 7\n    }, this), loading && showLoading && /*#__PURE__*/_jsxDEV(Loading, {\n      text: \"Loading...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 86,\n      columnNumber: 34\n    }, this), serverError && !data && /*#__PURE__*/_jsxDEV(ServerError, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 87,\n      columnNumber: 32\n    }, this), pagination, data && /*#__PURE__*/_jsxDEV(ShowRecentComments, {\n      comments: data.comments,\n      isRoot: true\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 91,\n      columnNumber: 16\n    }, this), pagination]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 77,\n    columnNumber: 5\n  }, this);\n}\n\n_s(RecentComments, \"FG6na5VQArhn4Hnw6KKhTUzstz0=\", false, function () {\n  return [useParams];\n});\n\n_c = RecentComments;\nexport default RecentComments;\nexport function ShowRecentComments(_ref2) {\n  var _this = this;\n\n  var comments = _ref2.comments,\n      isRoot = _ref2.isRoot;\n  var previousSong = null;\n  var previousChronological = null;\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"comments\",\n    children: comments.map(function (comment) {\n      var imageLink = null;\n\n      if (isRoot) {\n        if (comment.image && previousSong !== comment.song.id) {\n          imageLink = /*#__PURE__*/_jsxDEV(Link, {\n            to: comment._url,\n            children: /*#__PURE__*/_jsxDEV(\"img\", {\n              className: \"pull-right img-thumbnail found\",\n              loading: \"lazy\",\n              src: comment.image.thumbnail100 || comment.image.url,\n              alt: comment.song.artist.name\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 111,\n              columnNumber: 17\n            }, _this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 110,\n            columnNumber: 15\n          }, _this);\n        }\n\n        previousSong = comment.song.id;\n      }\n\n      var geoString = null;\n\n      if (comment.geo) {\n        if (comment.geo.city && comment.geo.country) {\n          geoString = \" (from \".concat(comment.geo.city, \", \").concat(comment.geo.country, \") \");\n        } else if (comment.geo.country) {\n          geoString = \" (from \".concat(comment.geo.country, \") \");\n        }\n      }\n\n      var chronologicalDiff = null;\n\n      if (comment.rating) {\n        if (previousChronological) {\n          chronologicalDiff = comment.rating.chronological - previousChronological - 1;\n        }\n\n        previousChronological = comment.rating.chronological;\n      }\n\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"comment\",\n        children: [imageLink, isRoot && /*#__PURE__*/_jsxDEV(\"h4\", {\n          children: [\"On\", \" \", /*#__PURE__*/_jsxDEV(Link, {\n            to: comment._url,\n            children: [/*#__PURE__*/_jsxDEV(\"b\", {\n              children: comment.song.name\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 148,\n              columnNumber: 19\n            }, _this), \" \", /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"by\",\n              children: \"by\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 148,\n              columnNumber: 46\n            }, _this), \" \", comment.song.artist.name]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 147,\n            columnNumber: 17\n          }, _this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 145,\n          columnNumber: 15\n        }, _this), /*#__PURE__*/_jsxDEV(\"blockquote\", {\n          dangerouslySetInnerHTML: {\n            __html: comment.text_rendered\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 153,\n          columnNumber: 13\n        }, _this), isRoot && /*#__PURE__*/_jsxDEV(\"p\", {\n          children: /*#__PURE__*/_jsxDEV(Link, {\n            to: comment._url,\n            className: \"btn btn-info btn-sm\",\n            children: \"Reply\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 158,\n            columnNumber: 17\n          }, _this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 157,\n          columnNumber: 15\n        }, _this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: [\"By \", comment.name ? /*#__PURE__*/_jsxDEV(\"b\", {\n            children: comment.name\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 164,\n            columnNumber: 34\n          }, _this) : /*#__PURE__*/_jsxDEV(\"i\", {\n            children: \"Anonymous\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 164,\n            columnNumber: 58\n          }, _this), geoString, \"on \", comment.approved_human, \" \", comment.rating && /*#__PURE__*/_jsxDEV(\"span\", {\n            children: [\"rating:\", /*#__PURE__*/_jsxDEV(\"code\", {\n              children: comment.rating.score\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 169,\n              columnNumber: 26\n            }, _this), \"chronological: \", /*#__PURE__*/_jsxDEV(\"code\", {\n              children: comment.rating.chronological\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 170,\n              columnNumber: 34\n            }, _this), !!chronologicalDiff && /*#__PURE__*/_jsxDEV(\"i\", {\n              children: chronologicalDiff > 0 ? \" +\".concat(chronologicalDiff) : chronologicalDiff\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 172,\n              columnNumber: 21\n            }, _this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 168,\n            columnNumber: 17\n          }, _this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 163,\n          columnNumber: 13\n        }, _this), comment.replies && comment.replies.length ? /*#__PURE__*/_jsxDEV(ShowRecentComments, {\n          comments: comment.replies,\n          isRoot: false\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 182,\n          columnNumber: 15\n        }, _this) : null]\n      }, comment.id, true, {\n        fileName: _jsxFileName,\n        lineNumber: 142,\n        columnNumber: 11\n      }, _this);\n    })\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 104,\n    columnNumber: 5\n  }, this);\n}\n_c2 = ShowRecentComments;\n\nfunction Pagination(_ref3) {\n  var previous = _ref3.previous,\n      next = _ref3.next;\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"row\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"col-md-6\",\n      style: {\n        textAlign: \"right\"\n      },\n      children: previous ? /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"load-more\",\n        children: /*#__PURE__*/_jsxDEV(Link, {\n          to: previous === 1 ? \"/comments\" : \"/comments/p\".concat(previous),\n          children: \"Previous page\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 197,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 196,\n        columnNumber: 11\n      }, this) : null\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 194,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"col-md-6\",\n      style: {\n        textAlign: \"left\"\n      },\n      children: next && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"load-more\",\n        children: /*#__PURE__*/_jsxDEV(Link, {\n          to: \"/comments/p\".concat(next),\n          children: \"Next page\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 206,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 205,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 203,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 193,\n    columnNumber: 5\n  }, this);\n}\n\n_c3 = Pagination;\n\nvar _c, _c2, _c3;\n\n$RefreshReg$(_c, \"RecentComments\");\n$RefreshReg$(_c2, \"ShowRecentComments\");\n$RefreshReg$(_c3, \"Pagination\");","map":{"version":3,"sources":["/home/mandeep/Downloads/Song-sorch work/site/src/RecentComments.js"],"names":["React","useCallback","useRef","useEffect","useState","Link","useParams","Loading","SetHTMLHeaders","ServerError","cachedFetch","RecentComments","recentComments","page","mountedRef","serverError","setServerError","data","setData","getPage","p","parseInt","fetchComments","url","pageInt","then","r","ok","current","json","catch","ex","suffix","title","loading","showLoading","setShowLoading","window","setTimeout","pagination","next_page","comments","ShowRecentComments","isRoot","previousSong","previousChronological","map","comment","imageLink","image","song","id","_url","thumbnail100","artist","name","geoString","geo","city","country","chronologicalDiff","rating","chronological","__html","text_rendered","approved_human","score","replies","length","Pagination","previous","next","textAlign"],"mappings":"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","sourcesContent":["import React, { useCallback, useRef, useEffect, useState } from \"react\";\nimport { Link, useParams } from \"react-router-dom\";\nimport { Loading, SetHTMLHeaders, ServerError } from \"./Common\";\nimport { cachedFetch } from \"./Cache\";\nimport \"./RecentComments.css\";\n\nfunction RecentComments({ recentComments }) {\n  let { page } = useParams();\n\n  let mountedRef = useRef(false);\n  const [serverError, setServerError] = useState(null);\n  const [data, setData] = useState(recentComments || null);\n\n  function getPage(p) {\n    return parseInt(p || \"1\", 10);\n  }\n\n  const fetchComments = useCallback(() => {\n    let url = \"/api/comments/recent\";\n    const pageInt = getPage(page);\n    if (pageInt > 1) {\n      url += `?page=${pageInt}`;\n    }\n    return cachedFetch(url)\n      .then((r) => {\n        if (!r.ok) {\n          return mountedRef.current && setServerError(r);\n        }\n        r.json().then((data) => {\n          return mountedRef.current && setData(data);\n        });\n      })\n      .catch((ex) => {\n        return mountedRef.current && setServerError(ex);\n      });\n  }, [page]);\n\n  useEffect(() => {\n    const pageInt = getPage(page);\n\n    const suffix = \" - Song Search\";\n    SetHTMLHeaders({\n      title:\n        pageInt > 1\n          ? `Recent Comments (page ${pageInt})${suffix}`\n          : `Recent Comments${suffix}`\n    });\n    setData(null);\n    mountedRef.current = true;\n    fetchComments(page);\n    return () => {\n      mountedRef.current = false;\n    };\n  }, [page, fetchComments]);\n\n  const loading = !data && !serverError;\n\n  const [showLoading, setShowLoading] = useState(false);\n  useEffect(() => {\n    if (loading) {\n      window.setTimeout(() => {\n        mountedRef.current && setShowLoading(true);\n      }, 1000);\n    } else {\n      setShowLoading(false);\n    }\n  }, [loading]);\n\n  const pageInt = getPage(page);\n\n  let pagination = null;\n  if (data && (data.next_page || pageInt > 1)) {\n    pagination = <Pagination next={data.next_page} previous={pageInt - 1} />;\n  }\n\n  return (\n    <div className=\"recent-comments\">\n      {!serverError && (\n        <h2>\n          Recent Comments {pageInt !== 1 && <small>Page {pageInt}</small>}\n        </h2>\n      )}\n      <p>\n        <Link to=\"/\">Back to the home page</Link>\n      </p>\n      {loading && showLoading && <Loading text=\"Loading...\" />}\n      {serverError && !data && <ServerError />}\n\n      {pagination}\n\n      {data && <ShowRecentComments comments={data.comments} isRoot={true} />}\n\n      {pagination}\n    </div>\n  );\n}\n\nexport default RecentComments;\n\nexport function ShowRecentComments({ comments, isRoot }) {\n  let previousSong = null;\n  let previousChronological = null;\n  return (\n    <div className=\"comments\">\n      {comments.map((comment) => {\n        let imageLink = null;\n        if (isRoot) {\n          if (comment.image && previousSong !== comment.song.id) {\n            imageLink = (\n              <Link to={comment._url}>\n                <img\n                  className=\"pull-right img-thumbnail found\"\n                  loading=\"lazy\"\n                  src={comment.image.thumbnail100 || comment.image.url}\n                  alt={comment.song.artist.name}\n                />\n              </Link>\n            );\n          }\n          previousSong = comment.song.id;\n        }\n\n        let geoString = null;\n        if (comment.geo) {\n          if (comment.geo.city && comment.geo.country) {\n            geoString = ` (from ${comment.geo.city}, ${comment.geo.country}) `;\n          } else if (comment.geo.country) {\n            geoString = ` (from ${comment.geo.country}) `;\n          }\n        }\n\n        let chronologicalDiff = null;\n        if (comment.rating) {\n          if (previousChronological) {\n            chronologicalDiff =\n              comment.rating.chronological - previousChronological - 1;\n          }\n          previousChronological = comment.rating.chronological;\n        }\n\n        return (\n          <div key={comment.id} className=\"comment\">\n            {imageLink}\n            {isRoot && (\n              <h4>\n                On{\" \"}\n                <Link to={comment._url}>\n                  <b>{comment.song.name}</b> <span className=\"by\">by</span>{\" \"}\n                  {comment.song.artist.name}\n                </Link>\n              </h4>\n            )}\n            <blockquote\n              dangerouslySetInnerHTML={{ __html: comment.text_rendered }}\n            />\n            {isRoot && (\n              <p>\n                <Link to={comment._url} className=\"btn btn-info btn-sm\">\n                  Reply\n                </Link>\n              </p>\n            )}\n            <p>\n              By {comment.name ? <b>{comment.name}</b> : <i>Anonymous</i>}\n              {geoString}\n              on {comment.approved_human}{\" \"}\n              {comment.rating && (\n                <span>\n                  rating:<code>{comment.rating.score}</code>\n                  chronological: <code>{comment.rating.chronological}</code>\n                  {!!chronologicalDiff && (\n                    <i>\n                      {chronologicalDiff > 0\n                        ? ` +${chronologicalDiff}`\n                        : chronologicalDiff}\n                    </i>\n                  )}\n                </span>\n              )}\n            </p>\n            {comment.replies && comment.replies.length ? (\n              <ShowRecentComments comments={comment.replies} isRoot={false} />\n            ) : null}\n          </div>\n        );\n      })}\n    </div>\n  );\n}\n\nfunction Pagination({ previous, next }) {\n  return (\n    <div className=\"row\">\n      <div className=\"col-md-6\" style={{ textAlign: \"right\" }}>\n        {previous ? (\n          <div className=\"load-more\">\n            <Link to={previous === 1 ? \"/comments\" : `/comments/p${previous}`}>\n              Previous page\n            </Link>\n          </div>\n        ) : null}\n      </div>\n      <div className=\"col-md-6\" style={{ textAlign: \"left\" }}>\n        {next && (\n          <div className=\"load-more\">\n            <Link to={`/comments/p${next}`}>Next page</Link>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}